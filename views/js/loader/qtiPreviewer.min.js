var requirejs,require,define;!function(global){function isFunction(it){return"[object Function]"===ostring.call(it)}function isArray(it){return"[object Array]"===ostring.call(it)}function each(ary,func){if(ary){var i;for(i=0;i<ary.length&&(!ary[i]||!func(ary[i],i,ary));i+=1);}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1&&(!ary[i]||!func(ary[i],i,ary));i-=1);}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj)if(hasProp(obj,prop)&&func(obj[prop],prop))break}function mixin(target,source,force,deepStringMixin){return source&&eachProp(source,function(value,prop){
!force&&hasProp(target,prop)||(!deepStringMixin||"object"!=typeof value||!value||isArray(value)||isFunction(value)||value instanceof RegExp?target[prop]=value:(target[prop]||(target[prop]={}),mixin(target[prop],value,force,deepStringMixin)))}),target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(err){throw err}function getGlobal(value){if(!value)return value;var g=global;return each(value.split("."),function(part){g=g[part]}),g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);return e.requireType=id,
e.requireModules=requireModules,err&&(e.originalError=err),e}function newContext(contextName){function trimDots(ary){var i,part;for(i=0;i<ary.length;i++)if(part=ary[i],"."===part)ary.splice(i,1),i-=1;else if(".."===part){if(0===i||1==i&&".."===ary[2]||".."===ary[i-1])continue;i>0&&(ary.splice(i-1,2),i-=2)}}function normalize(name,baseName,applyMap){var pkgMain,mapValue,nameParts,i,j,nameSegment,lastIndex,foundMap,foundI,foundStarMap,starI,normalizedBaseParts,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"];if(name&&(name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),
"."===name[0].charAt(0)&&baseParts&&(normalizedBaseParts=baseParts.slice(0,baseParts.length-1),name=normalizedBaseParts.concat(name)),trimDots(name),name=name.join("/")),applyMap&&map&&(baseParts||starMap)){nameParts=name.split("/");outerLoop:for(i=nameParts.length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if(mapValue=getOwn(map,baseParts.slice(0,j).join("/")),mapValue&&(mapValue=getOwn(mapValue,nameSegment))){foundMap=mapValue,foundI=i;break outerLoop}!foundStarMap&&starMap&&getOwn(starMap,nameSegment)&&(foundStarMap=getOwn(starMap,nameSegment),starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),
foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return pkgMain=getOwn(config.pkgs,name),pkgMain?pkgMain:name}function removeScript(name){isBrowser&&each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName)return scriptNode.parentNode.removeChild(scriptNode),!0})}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1)return pathConfig.shift(),context.require.undef(id),context.makeRequire(null,{skipMap:!0})([id]),!0}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;
return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=!0,normalizedName="";return name||(isDefine=!1,name="_@r"+(requireCounter+=1)),nameParts=splitPrefix(name),prefix=nameParts[0],name=nameParts[1],prefix&&(prefix=normalize(prefix,parentName,applyMap),pluginModule=getOwn(defined,prefix)),name&&(prefix?normalizedName=pluginModule&&pluginModule.normalize?pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap);
}):name.indexOf("!")===-1?normalize(name,parentName,applyMap):name:(normalizedName=normalize(name,parentName,applyMap),nameParts=splitPrefix(normalizedName),prefix=nameParts[0],normalizedName=nameParts[1],isNormalized=!0,url=context.nameToUrl(normalizedName))),suffix=!prefix||pluginModule||isNormalized?"":"_unnormalized"+(unnormalizedCounter+=1),{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);return mod||(mod=registry[id]=new context.Module(depMap)),
mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);!hasProp(defined,id)||mod&&!mod.defineEmitComplete?(mod=getModule(depMap),mod.error&&"error"===name?fn(mod.error):mod.on(name,fn)):"defined"===name&&fn(defined[id])}function onError(err,errback){var ids=err.requireModules,notified=!1;errback?errback(err):(each(ids,function(id){var mod=getOwn(registry,id);mod&&(mod.error=err,mod.events.error&&(notified=!0,mod.emit("error",err)))}),notified||req.onError(err))}function takeGlobalQueue(){globalDefQueue.length&&(apsp.apply(defQueue,[defQueue.length,0].concat(globalDefQueue)),globalDefQueue=[])}function cleanRegistry(id){delete registry[id],delete enabledRegistry[id];
}function breakCycle(mod,traced,processed){var id=mod.map.id;mod.error?mod.emit("error",mod.error):(traced[id]=!0,each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);!dep||mod.depMatched[i]||processed[depId]||(getOwn(traced,depId)?(mod.defineDep(i,defined[depId]),mod.check()):breakCycle(dep,traced,processed))}),processed[id]=!0)}function checkLoaded(){var err,usingPathFallback,waitInterval=1e3*config.waitSeconds,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=!1,needCycleCheck=!0;if(!inCheckLoaded){if(inCheckLoaded=!0,eachProp(enabledRegistry,function(mod){var map=mod.map,modId=map.id;
if(mod.enabled&&(map.isDefine||reqCalls.push(mod),!mod.error))if(!mod.inited&&expired)hasPathFallback(modId)?(usingPathFallback=!0,stillLoading=!0):(noLoads.push(modId),removeScript(modId));else if(!mod.inited&&mod.fetched&&map.isDefine&&(stillLoading=!0,!map.prefix))return needCycleCheck=!1}),expired&&noLoads.length)return err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads),err.contextName=context.contextName,onError(err);needCycleCheck&&each(reqCalls,function(mod){breakCycle(mod,{},{})}),expired&&!usingPathFallback||!stillLoading||!isBrowser&&!isWebWorker||checkLoadedTimeoutId||(checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0,
checkLoaded()},50)),inCheckLoaded=!1}}function callGetModule(args){hasProp(defined,args[0])||getModule(makeModuleMap(args[0],null,!0)).init(args[1],args[2])}function removeListener(node,func,name,ieName){node.detachEvent&&!isOpera?ieName&&node.detachEvent(ieName,func):node.removeEventListener(name,func,!1)}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;return removeListener(node,context.onScriptLoad,"load","onreadystatechange"),removeListener(node,context.onScriptError,"error"),{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;for(takeGlobalQueue();defQueue.length;){if(args=defQueue.shift(),
null===args[0])return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]));callGetModule(args)}}var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},registry={},enabledRegistry={},undefEvents={},defQueue=[],defined={},urlFetched={},bundlesMap={},requireCounter=1,unnormalizedCounter=1;return handlers={require:function(mod){return mod.require?mod.require:mod.require=context.makeRequire(mod.map)},exports:function(mod){if(mod.usingExports=!0,mod.map.isDefine)return mod.exports?defined[mod.map.id]=mod.exports:mod.exports=defined[mod.map.id]={};
},module:function(mod){return mod.module?mod.module:mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return getOwn(config.config,mod.map.id)||{}},exports:mod.exports||(mod.exports={})}}},Module=function(map){this.events=getOwn(undefEvents,map.id)||{},this.map=map,this.shim=getOwn(config.shim,map.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},Module.prototype={init:function(depMaps,factory,errback,options){options=options||{},this.inited||(this.factory=factory,errback?this.on("error",errback):this.events.error&&(errback=bind(this,function(err){this.emit("error",err)})),this.depMaps=depMaps&&depMaps.slice(0),
this.errback=errback,this.inited=!0,this.ignore=options.ignore,options.enabled||this.enabled?this.enable():this.check())},defineDep:function(i,depExports){this.depMatched[i]||(this.depMatched[i]=!0,this.depCount-=1,this.depExports[i]=depExports)},fetch:function(){if(!this.fetched){this.fetched=!0,context.startTime=(new Date).getTime();var map=this.map;return this.shim?void context.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()})):map.prefix?this.callPlugin():this.load()}},load:function(){var url=this.map.url;urlFetched[url]||(urlFetched[url]=!0,context.load(this.map.id,url));
},check:function(){if(this.enabled&&!this.enabling){var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}else exports=context.execCb(id,factory,depExports,exports);if(this.map.isDefine&&void 0===exports&&(cjsModule=this.module,cjsModule?exports=cjsModule.exports:this.usingExports&&(exports=this.exports)),err)return err.requireMap=this.map,
err.requireModules=this.map.isDefine?[this.map.id]:null,err.requireType=this.map.isDefine?"define":"require",onError(this.error=err)}else exports=factory;this.exports=exports,this.map.isDefine&&!this.ignore&&(defined[id]=exports,req.onResourceLoad&&req.onResourceLoad(context,this.map,this.depMaps)),cleanRegistry(id),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap),on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,bundleId=getOwn(bundlesMap,this.map.id),name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{
enableBuildCallback:!0});return this.map.unnormalized?(plugin.normalize&&(name=plugin.normalize(name,function(name){return normalize(name,parentName,!0)})||""),normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap),on(normalizedMap,"defined",bind(this,function(value){this.init([],function(){return value},null,{enabled:!0,ignore:!0})})),normalizedMod=getOwn(registry,normalizedMap.id),void(normalizedMod&&(this.depMaps.push(normalizedMap),this.events.error&&normalizedMod.on("error",bind(this,function(err){this.emit("error",err)})),normalizedMod.enable()))):bundleId?(this.map.url=context.nameToUrl(bundleId),void this.load()):(load=bind(this,function(value){
this.init([],function(){return value},null,{enabled:!0})}),load.error=bind(this,function(err){this.inited=!0,this.error=err,err.requireModules=[id],eachProp(registry,function(mod){0===mod.map.id.indexOf(id+"_unnormalized")&&cleanRegistry(mod.map.id)}),onError(err)}),load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;textAlt&&(text=textAlt),hasInteractive&&(useInteractive=!1),getModule(moduleMap),hasProp(config.config,id)&&(config.config[moduleName]=config.config[id]);try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]));
}hasInteractive&&(useInteractive=!0),this.depMaps.push(moduleMap),context.completeLoad(moduleName),localRequire([moduleName],load)}),void plugin.load(map.name,localRequire,load,config))})),context.enable(pluginMap,this),this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){enabledRegistry[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if("string"==typeof depMap){if(depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=depMap,handler=getOwn(handlers,depMap.id))return void(this.depExports[i]=handler(this));this.depCount+=1,on(depMap,"defined",bind(this,function(depExports){
this.defineDep(i,depExports),this.check()})),this.errback&&on(depMap,"error",bind(this,this.errback))}id=depMap.id,mod=registry[id],hasProp(handlers,id)||!mod||mod.enabled||context.enable(depMap,this)})),eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);mod&&!mod.enabled&&context.enable(pluginMap,this)})),this.enabling=!1,this.check()},on:function(name,cb){var cbs=this.events[name];cbs||(cbs=this.events[name]=[]),cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)}),"error"===name&&delete this.events[name]}},context={config:config,contextName:contextName,registry:registry,defined:defined,
urlFetched:urlFetched,defQueue:defQueue,Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,onError:onError,configure:function(cfg){cfg.baseUrl&&"/"!==cfg.baseUrl.charAt(cfg.baseUrl.length-1)&&(cfg.baseUrl+="/");var shim=config.shim,objs={paths:!0,bundles:!0,config:!0,map:!0};eachProp(cfg,function(value,prop){objs[prop]?(config[prop]||(config[prop]={}),mixin(config[prop],value,!0,!0)):config[prop]=value}),cfg.bundles&&eachProp(cfg.bundles,function(value,prop){each(value,function(v){v!==prop&&(bundlesMap[v]=prop)})}),cfg.shim&&(eachProp(cfg.shim,function(value,id){isArray(value)&&(value={deps:value}),!value.exports&&!value.init||value.exportsFn||(value.exportsFn=context.makeShimExports(value)),
shim[id]=value}),config.shim=shim),cfg.packages&&each(cfg.packages,function(pkgObj){var location,name;pkgObj="string"==typeof pkgObj?{name:pkgObj}:pkgObj,name=pkgObj.name,location=pkgObj.location,location&&(config.paths[name]=pkgObj.location),config.pkgs[name]=pkgObj.name+"/"+(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(registry,function(mod,id){mod.inited||mod.map.unnormalized||(mod.map=makeModuleMap(id))}),(cfg.deps||cfg.callback)&&context.require(cfg.deps||[],cfg.callback)},makeShimExports:function(value){function fn(){var ret;return value.init&&(ret=value.init.apply(global,arguments)),ret||value.exports&&getGlobal(value.exports);
}return fn},makeRequire:function(relMap,options){function localRequire(deps,callback,errback){var id,map,requireMod;return options.enableBuildCallback&&callback&&isFunction(callback)&&(callback.__requireJsBuild=!0),"string"==typeof deps?isFunction(callback)?onError(makeError("requireargs","Invalid require call"),errback):relMap&&hasProp(handlers,deps)?handlers[deps](registry[relMap.id]):req.get?req.get(context,deps,relMap,localRequire):(map=makeModuleMap(deps,relMap,!1,!0),id=map.id,hasProp(defined,id)?defined[id]:onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))):(intakeDefines(),
context.nextTick(function(){intakeDefines(),requireMod=getModule(makeModuleMap(null,relMap)),requireMod.skipMap=options.skipMap,requireMod.init(deps,callback,errback,{enabled:!0}),checkLoaded()}),localRequire)}return options=options||{},mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative="."===segment||".."===segment;return index!==-1&&(!isRelative||index>1)&&(ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length),moduleNamePlusExt=moduleNamePlusExt.substring(0,index)),context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,!0),ext,!0);
},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,!1,!0).id)},specified:function(id){return id=makeModuleMap(id,relMap,!1,!0).id,hasProp(defined,id)||hasProp(registry,id)}}),relMap||(localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,!0),mod=getOwn(registry,id);removeScript(id),delete defined[id],delete urlFetched[map.url],delete undefEvents[id],eachReverse(defQueue,function(args,i){args[0]===id&&defQueue.splice(i,1)}),mod&&(mod.events.defined&&(undefEvents[id]=mod.events),cleanRegistry(id))}),localRequire},enable:function(depMap){var mod=getOwn(registry,depMap.id);mod&&getModule(depMap).enable()},completeLoad:function(moduleName){
var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;for(takeGlobalQueue();defQueue.length;){if(args=defQueue.shift(),null===args[0]){if(args[0]=moduleName,found)break;found=!0}else args[0]===moduleName&&(found=!0);callGetModule(args)}if(mod=getOwn(registry,moduleName),!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(!(!config.enforceDefine||shExports&&getGlobal(shExports)))return hasPathFallback(moduleName)?void 0:onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]));callGetModule([moduleName,shim.deps||[],shim.exportsFn])}checkLoaded()},nameToUrl:function(moduleName,ext,skipExt){var paths,syms,i,parentModule,url,parentPath,bundleId,pkgMain=getOwn(config.pkgs,moduleName);
if(pkgMain&&(moduleName=pkgMain),bundleId=getOwn(bundlesMap,moduleName))return context.nameToUrl(bundleId,ext,skipExt);if(req.jsExtRegExp.test(moduleName))url=moduleName+(ext||"");else{for(paths=config.paths,syms=moduleName.split("/"),i=syms.length;i>0;i-=1)if(parentModule=syms.slice(0,i).join("/"),parentPath=getOwn(paths,parentModule)){isArray(parentPath)&&(parentPath=parentPath[0]),syms.splice(0,i,parentPath);break}url=syms.join("/"),url+=ext||(/^data\:|\?/.test(url)||skipExt?"":".js"),url=("/"===url.charAt(0)||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs?url+((url.indexOf("?")===-1?"?":"&")+config.urlArgs):url},load:function(id,url){
req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if("load"===evt.type||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id))return onError(makeError("scripterror","Script error for: "+data.id,evt,[data.id]))}},context.require=context.makeRequire(),context}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(script){
if("interactive"===script.readyState)return interactiveScript=script}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.14",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;
if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;return isArray(deps)||"string"==typeof deps||(config=deps,isArray(callback)?(deps=callback,callback=errback,errback=optional):deps=[]),config&&config.context&&(contextName=config.context),context=getOwn(contexts,contextName),context||(context=contexts[contextName]=req.s.newContext(contextName)),config&&context.configure(config),context.require(deps,callback,errback);
},req.config=function(config){return req(config)},req.nextTick="undefined"!=typeof setTimeout?function(fn){setTimeout(fn,4)}:function(fn){fn()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(config,moduleName,url){
var node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return node.type=config.scriptType||"text/javascript",node.charset="utf-8",node.async=!0,node},req.load=function(context,moduleName,url){var node,config=context&&context.config||{};if(isBrowser)return node=req.createNode(config,moduleName,url),node.setAttribute("data-requirecontext",context.contextName),node.setAttribute("data-requiremodule",moduleName),!node.attachEvent||node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0||isOpera?(node.addEventListener("load",context.onScriptLoad,!1),node.addEventListener("error",context.onScriptError,!1)):(useInteractive=!0,
node.attachEvent("onreadystatechange",context.onScriptLoad)),node.src=url,currentlyAddingScript=node,baseElement?head.insertBefore(node,baseElement):head.appendChild(node),currentlyAddingScript=null,node;if(isWebWorker)try{importScripts(url),context.completeLoad(moduleName)}catch(e){context.onError(makeError("importscripts","importScripts failed for "+moduleName+" at "+url,e,[moduleName]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(script){if(head||(head=script.parentNode),dataMain=script.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",
cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(name,deps,callback){var node,context;"string"!=typeof name&&(callback=deps,deps=name,name=null),isArray(deps)||(callback=deps,deps=null),!deps&&isFunction(callback)&&(deps=[],callback.length&&(callback.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(match,dep){deps.push(dep)}),deps=(1===callback.length?["require"]:["require","exports","module"]).concat(deps))),useInteractive&&(node=currentlyAddingScript||getInteractiveScript(),node&&(name||(name=node.getAttribute("data-requiremodule")),
context=contexts[node.getAttribute("data-requirecontext")])),(context?context.defQueue:globalDefQueue).push([name,deps,callback])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("lib/require",function(){}),function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function(){var started=!1,controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={};
}require([controllerPath],function(controller){var startController=function(){started||(started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),"complete"===document.readyState&&startController()})};require([configUrl],function(){bundle?require([bundle],loadController):loadController()})}(),define("loader/bootstrap",function(){}),function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function lib$es6$promise$utils$$isFunction(x){return"function"==typeof x}function lib$es6$promise$utils$$isMaybeThenable(x){return"object"==typeof x&&null!==x;
}function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}function lib$es6$promise$asap$$useNextTick(){var nextTick=process.nextTick,version=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(version)&&"0"===version[1]&&"10"===version[2]&&(nextTick=setImmediate),function(){nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0,observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush),node=document.createTextNode("");
return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=lib$es6$promise$asap$$flush,function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}function lib$es6$promise$asap$$flush(){for(var i=0;i<lib$es6$promise$asap$$len;i+=2){var callback=lib$es6$promise$asap$$queue[i],arg=lib$es6$promise$asap$$queue[i+1];callback(arg),lib$es6$promise$asap$$queue[i]=void 0,lib$es6$promise$asap$$queue[i+1]=void 0}lib$es6$promise$asap$$len=0;
}function lib$es6$promise$asap$$attemptVertex(){try{var r=require,vertx=r("vertx");return lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext,lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}function lib$es6$promise$$internal$$noop(){}function lib$es6$promise$$internal$$selfFullfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){return lib$es6$promise$$internal$$GET_THEN_ERROR.error=error,
lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=!1,error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?lib$es6$promise$$internal$$resolve(promise,value):lib$es6$promise$$internal$$fulfill(promise,value))},function(reason){sealed||(sealed=!0,lib$es6$promise$$internal$$reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));
!sealed&&error&&(sealed=!0,lib$es6$promise$$internal$$reject(promise,error))},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){thenable._state===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,thenable._result):thenable._state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,thenable._result):lib$es6$promise$$internal$$subscribe(thenable,void 0,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor)lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable);else{
var then=lib$es6$promise$$internal$$getThen(maybeThenable);then===lib$es6$promise$$internal$$GET_THEN_ERROR?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error):void 0===then?lib$es6$promise$$internal$$fulfill(promise,maybeThenable):lib$es6$promise$utils$$isFunction(then)?lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then):lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}function lib$es6$promise$$internal$$resolve(promise,value){promise===value?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFullfillment()):lib$es6$promise$utils$$objectOrFunction(value)?lib$es6$promise$$internal$$handleMaybeThenable(promise,value):lib$es6$promise$$internal$$fulfill(promise,value);
}function lib$es6$promise$$internal$$publishRejection(promise){promise._onerror&&promise._onerror(promise._result),lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._result=value,promise._state=lib$es6$promise$$internal$$FULFILLED,0!==promise._subscribers.length&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise))}function lib$es6$promise$$internal$$reject(promise,reason){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._state=lib$es6$promise$$internal$$REJECTED,promise._result=reason,lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise));
}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers,length=subscribers.length;parent._onerror=null,subscribers[length]=child,subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment,subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection,0===length&&parent._state&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child,callback,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],
callback=subscribers[i+settled],child?lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){return lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e,lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var value,error,succeeded,failed,hasCallback=lib$es6$promise$utils$$isFunction(callback);if(hasCallback){if(value=lib$es6$promise$$internal$$tryCatch(callback,detail),
value===lib$es6$promise$$internal$$TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==lib$es6$promise$$internal$$PENDING||(hasCallback&&succeeded?lib$es6$promise$$internal$$resolve(promise,value):failed?lib$es6$promise$$internal$$reject(promise,error):settled===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,value):settled===lib$es6$promise$$internal$$REJECTED&&lib$es6$promise$$internal$$reject(promise,value))}function lib$es6$promise$$internal$$initializePromise(promise,resolver){
try{resolver(function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor,enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop),enumerator._validateInput(input)?(enumerator._input=input,enumerator.length=input.length,enumerator._remaining=input.length,enumerator._init(),0===enumerator.length?lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result):(enumerator.length=enumerator.length||0,
enumerator._enumerate(),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result))):lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}function lib$es6$promise$promise$race$$race(entries){function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries))return lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race.")),
promise;for(var length=entries.length,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&i<length;i++)lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),void 0,onFulfillment,onRejection);return promise}function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$resolve(promise,object),promise}function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$reject(promise,reason),
promise}function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++,this._state=void 0,this._result=void 0,this._subscribers=[],lib$es6$promise$$internal$$noop!==resolver&&(lib$es6$promise$utils$$isFunction(resolver)||lib$es6$promise$promise$$needsResolver(),this instanceof lib$es6$promise$promise$$Promise||lib$es6$promise$promise$$needsNew(),
lib$es6$promise$$internal$$initializePromise(this,resolver))}function lib$es6$promise$polyfill$$polyfill(){var local;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;P&&"[object Promise]"===Object.prototype.toString.call(P.resolve())&&!P.cast||(local.Promise=lib$es6$promise$promise$$default)}var lib$es6$promise$utils$$_isArray;lib$es6$promise$utils$$_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var lib$es6$promise$asap$$vertxNext,lib$es6$promise$asap$$customSchedulerFn,lib$es6$promise$asap$$scheduleFlush,lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray,lib$es6$promise$asap$$len=0,lib$es6$promise$asap$$asap=({}.toString,
function(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback,lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg,lib$es6$promise$asap$$len+=2,2===lib$es6$promise$asap$$len&&(lib$es6$promise$asap$$customSchedulerFn?lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush):lib$es6$promise$asap$$scheduleFlush())}),lib$es6$promise$asap$$browserWindow="undefined"!=typeof window?window:void 0,lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{},lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver,lib$es6$promise$asap$$isNode="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),lib$es6$promise$asap$$isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,lib$es6$promise$asap$$queue=new Array(1e3);
lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$isNode?lib$es6$promise$asap$$useNextTick():lib$es6$promise$asap$$BrowserMutationObserver?lib$es6$promise$asap$$useMutationObserver():lib$es6$promise$asap$$isWorker?lib$es6$promise$asap$$useMessageChannel():void 0===lib$es6$promise$asap$$browserWindow&&"function"==typeof require?lib$es6$promise$asap$$attemptVertex():lib$es6$promise$asap$$useSetTimeout();var lib$es6$promise$$internal$$PENDING=void 0,lib$es6$promise$$internal$$FULFILLED=1,lib$es6$promise$$internal$$REJECTED=2,lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject,lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;
lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)},lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){for(var enumerator=this,length=enumerator.length,promise=enumerator.promise,input=enumerator._input,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&i<length;i++)enumerator._eachEntry(input[i],i);
},lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this,c=enumerator._instanceConstructor;lib$es6$promise$utils$$isMaybeThenable(entry)?entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING?(entry._onerror=null,enumerator._settledAt(entry._state,i,entry._result)):enumerator._willSettleAt(c.resolve(entry),i):(enumerator._remaining--,enumerator._result[i]=entry)},lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this,promise=enumerator.promise;promise._state===lib$es6$promise$$internal$$PENDING&&(enumerator._remaining--,state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,value):enumerator._result[i]=value),
0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(promise,enumerator._result)},lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,void 0,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all,lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race,lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve,lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject,lib$es6$promise$promise$$counter=0,lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;
lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default,lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default,lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default,lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default,lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler,lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap,lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap,lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this,state=parent._state;
if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection)return this;var child=new this.constructor(lib$es6$promise$$internal$$noop),result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection);return child},catch:function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill,lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,
polyfill:lib$es6$promise$polyfill$$default};"function"==typeof define&&define.amd?define("lib/polyfill/es6-promise",[],function(){return lib$es6$promise$umd$$ES6Promise}):"undefined"!=typeof module&&module.exports?module.exports=lib$es6$promise$umd$$ES6Promise:"undefined"!=typeof this&&(this.ES6Promise=lib$es6$promise$umd$$ES6Promise),lib$es6$promise$polyfill$$default()}.call(this),define("lib/uuid",[],function(){var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid=function(len,radix){var i,r,chars=CHARS,uuid=[];if(radix=radix||chars.length,len)for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];else for(uuid[8]=uuid[13]=uuid[18]=uuid[23]="-",
uuid[14]="4",i=0;i<36;i++)uuid[i]||(r=0|16*Math.random(),uuid[i]=chars[19===i?3&r|8:r]);return uuid.join("")};return uuid}),define("tpl!ui/component/tpl/component",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="component"></div>'})}),function(e){function f(a,c){function b(a){return this&&this.constructor===b?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=c,void(a&&v.call(this,a))):new b(a)}return c||w(a,"size",{get:x}),a.constructor=b,b.prototype=a,b}function v(a){this.add?a.forEach(this.add,this):a.forEach(function(a){
this.set(a[0],a[1])},this)}function d(a){return this.has(a)&&(this._keys.splice(b,1),this._values.splice(b,1),this._itp.forEach(function(a){b<a[0]&&a[0]--})),-1<b}function m(a){return this.has(a)?this._values[b]:void 0}function n(a,c){if(this.objectOnly&&c!==Object(c))throw new TypeError("Invalid value used as weak collection key");if(c!=c||0===c)for(b=a.length;b--&&!y(a[b],c););else b=a.indexOf(c);return-1<b}function p(a){return n.call(this,this._values,a)}function q(a){return n.call(this,this._keys,a)}function r(a,c){return this.has(a)?this._values[b]=c:this._values[this._keys.push(a)-1]=c,this}function t(a){return this.has(a)||this._values.push(a),this}function h(){
(this._keys||0).length=this._values.length=0}function z(){return k(this._itp,this._keys)}function l(){return k(this._itp,this._values)}function A(){return k(this._itp,this._keys,this._values)}function B(){return k(this._itp,this._values,this._values)}function k(a,c,b){var g=[0],e=!1;return a.push(g),{next:function(){var f,d=g[0];return!e&&d<c.length?(f=b?[c[d],b[d]]:c[d],g[0]++):(e=!0,a.splice(a.indexOf(g),1)),{done:e,value:f}}}}function x(){return this._values.length}function u(a,c){for(var b=this.entries();;){var d=b.next();if(d.done)break;a.call(c,d.value[1],d.value[0],this)}}var b,w=Object.defineProperty,y=function(a,b){return isNaN(a)?isNaN(b):a===b};"undefined"==typeof WeakMap&&(e.WeakMap=f({
delete:d,clear:h,get:m,has:q,set:r},!0)),"undefined"!=typeof Map&&"function"==typeof(new Map).values&&(new Map).values().next||(e.Map=f({delete:d,has:q,get:m,set:r,keys:z,values:l,entries:A,forEach:u,clear:h})),"undefined"!=typeof Set&&"function"==typeof(new Set).values&&(new Set).values().next||(e.Set=f({has:p,add:t,delete:d,clear:h,keys:l,values:l,entries:B,forEach:u})),"undefined"==typeof WeakSet&&(e.WeakSet=f({delete:d,add:t,clear:h,has:p},!0))}("undefined"!=typeof exports&&"undefined"!=typeof global?global:window),define("lib/polyfill/es6-collections",function(){}),define("taoTests/runner/dataHolder",["core/collections"],function(collections){"use strict";
var defaultObjects=["testData","testContext","testMap"];return function(){var map=new collections.Map;return defaultObjects.forEach(function(entry){map.set(entry,{})}),map}}),define("taoTests/runner/runner",["jquery","lodash","i18n","core/eventifier","core/promise","core/logger","core/providerRegistry","taoTests/runner/dataHolder"],function($,_,__,eventifier,Promise,logger,providerRegistry,dataHolderFactory){"use strict";function testRunnerFactory(providerName,pluginFactories,config){function providerRun(method){var args=[].slice.call(arguments,1);return new Promise(function(resolve){return _.isFunction(provider[method])?resolve(provider[method].apply(runner,args)):resolve();
})}function pluginRun(method){var execStack=[];return _.forEach(runner.getPlugins(),function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)}function reportError(err){runner.trigger("error",err)}var runner,areaBroker,proxy,probeOverseer,testStore,dataHolder=dataHolderFactory(),plugins={},states={init:!1,ready:!1,render:!1,finish:!1,destroy:!1},itemStates={},provider=testRunnerFactory.getProvider(providerName);return config=config||{},runner=eventifier({init:function(){var self=this;return _.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(runner,self.getAreaBroker());plugins[plugin.getName()]=plugin;
}),providerRun("install").then(_.partial(providerRun,"loadPersistentStates")).then(_.partial(pluginRun,"install")).then(_.partial(providerRun,"init")).then(_.partial(pluginRun,"init")).then(function(){self.setState("init",!0).off("init.internal").after("init.internal",function(){this.render()}).trigger("init")}).catch(reportError),this},render:function(){var self=this;return providerRun("render").then(function(){pluginRun("render").then(function(){self.setState("ready",!0).trigger("render").trigger("ready")}).catch(reportError)}).catch(reportError),this},loadItem:function(itemRef){var self=this;return providerRun("loadItem",itemRef).then(function(itemData){self.setItemState(itemRef,"loaded",!0).off("loaditem.internal").after("loaditem.internal",function(){
this.renderItem(itemRef,itemData)}).trigger("loaditem",itemRef,itemData)}).catch(reportError),this},renderItem:function(itemRef,itemData){var self=this;return providerRun("renderItem",itemRef,itemData).then(function(){self.setItemState(itemRef,"ready",!0).trigger("renderitem",itemRef,itemData)}).catch(reportError),this},unloadItem:function(itemRef){var self=this;return providerRun("unloadItem",itemRef).then(function(){itemStates=_.omit(itemStates,itemRef),self.trigger("unloaditem",itemRef)}).catch(reportError),this},disableItem:function(itemRef){var self=this;return this.getItemState(itemRef,"disabled")||providerRun("disableItem",itemRef).then(function(){self.setItemState(itemRef,"disabled",!0).trigger("disableitem",itemRef);
}).catch(reportError),this},enableItem:function(itemRef){var self=this;return this.getItemState(itemRef,"disabled")&&providerRun("enableItem",itemRef).then(function(){self.setItemState(itemRef,"disabled",!1).trigger("enableitem",itemRef)}).catch(reportError),this},finish:function(){var self=this;return providerRun("finish").then(function(){pluginRun("finish").then(function(){self.setState("finish",!0).trigger("finish")}).catch(reportError)}).catch(reportError),this},flush:function(){var self=this;return providerRun("flush").then(function(){pluginRun("flush").then(function(){self.setState("flush",!0).trigger("flush")}).catch(reportError)}).catch(reportError),this;
},destroy:function(){var self=this;return providerRun("destroy").then(function(){pluginRun("destroy").then(function(){var destroyed;return destroyed=proxy?proxy.destroy():Promise.resolve(),destroyed.then(function(){self.setTestContext({}).setTestMap({}).setState("destroy",!0).trigger("destroy")})}).catch(reportError)}).catch(reportError),this},getPlugins:function(){return plugins},getPlugin:function(name){return plugins[name]},getConfig:function(){return config},getAreaBroker:function(){return areaBroker||(areaBroker=provider.loadAreaBroker.call(this)),areaBroker},getProxy:function(){var self=this;if(!proxy){if(!_.isFunction(provider.loadProxy))throw new Error("The provider does not have a loadProxy method");
proxy=provider.loadProxy.call(this),proxy.on("error",function(error){self.trigger("error",error)}),proxy.install(dataHolder)}return proxy},getProbeOverseer:function(){return!probeOverseer&&_.isFunction(provider.loadProbeOverseer)&&(probeOverseer=provider.loadProbeOverseer.call(this)),probeOverseer},getTestStore:function(){return!testStore&&_.isFunction(provider.loadTestStore)&&(testStore=provider.loadTestStore.call(this)),testStore},getPluginStore:function(name){var loadedStore=this.getTestStore();return loadedStore&&_.isFunction(loadedStore.getStore)?this.getTestStore().getStore(name):Promise.reject(new Error("Please configure a testStore via loadTestStore to be able to get a plugin store"));
},getState:function(name){return!!states[name]},setState:function(name,active){if(!_.isString(name)||_.isEmpty(name))throw new TypeError("The state must have a name");return states[name]=!!active,this},getPersistentState:function(name){var state;return _.isFunction(provider.getPersistentState)&&(state=provider.getPersistentState.call(runner,name)),!!state},setPersistentState:function(name,active){var stored;return stored=!_.isString(name)||_.isEmpty(name)?Promise.reject(new TypeError("The state must have a name")):providerRun("setPersistentState",name,!!active),stored.catch(reportError),stored},getItemState:function(itemRef,name){if(_.isEmpty(itemRef)||_.isEmpty(name))throw new TypeError("The state is identified by an itemRef and a name");
return!(!itemStates[itemRef]||!itemStates[itemRef][name])},setItemState:function(itemRef,name,active){if(_.isEmpty(itemRef)||_.isEmpty(name))throw new TypeError("The state is identified by an itemRef and a name");return itemStates[itemRef]=itemStates[itemRef]||{loaded:!1,ready:!1,disabled:!1},itemStates[itemRef][name]=!!active,this},getTestData:function(){return dataHolder&&dataHolder.get("testData")},setTestData:function(testData){return dataHolder&&_.isPlainObject(testData)&&dataHolder.set("testData",testData),this},getTestContext:function(){return dataHolder&&dataHolder.get("testContext")},setTestContext:function(testContext){return dataHolder&&_.isPlainObject(testContext)&&dataHolder.set("testContext",testContext),
this},getTestMap:function(){return dataHolder&&dataHolder.get("testMap")},setTestMap:function(testMap){return dataHolder&&_.isPlainObject(testMap)&&dataHolder.set("testMap",testMap),this},getDataHolder:function(){return dataHolder},next:function(scope){return this.trigger("move","next",scope),this},previous:function(scope){return this.trigger("move","previous",scope),this},jump:function(position,scope){return this.trigger("move","jump",scope,position),this},skip:function(scope){return this.trigger("skip",scope),this},exit:function(why){return this.trigger("exit",why),this},pause:function(){return this.getState("pause")||this.setState("pause",!0).trigger("pause"),
this},resume:function(){return this.getState("pause")===!0&&this.setState("pause",!1).trigger("resume"),this},timeout:function(scope,ref,timer){return this.trigger("timeout",scope,ref,timer),this}}),runner.on("move",function(type){this.trigger.apply(this,[type].concat([].slice.call(arguments,1)))}).after("destroy",function(){dataHolder&&dataHolder.clear(),areaBroker=null,proxy=null,probeOverseer=null,testStore=null}),runner}return providerRegistry(testRunnerFactory,function(provider){if(!_.isFunction(provider.loadAreaBroker))throw new TypeError("The runner provider MUST have a method that returns an areaBroker");return!0})}),define("tpl!taoTests/template/runnerComponent",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="runner-component"></div>\n'})}),define("taoTests/runner/runnerComponent",["jquery","lodash","context","core/promise","core/pluginLoader","core/providerLoader","ui/component","taoTests/runner/runner","tpl!taoTests/template/runnerComponent"],function($,_,context,Promise,pluginLoaderFactory,providerLoaderFactory,component,runnerFactory,runnerComponentTpl){"use strict";function loadModules(loader,modules){return loader().addList(modules).load(context.bundle)}function registerProviders(providers){
return _.forEach(providers,function(provider){runnerFactory.registerProvider(provider.name,provider)}),providers}var requiredOptions=["provider"],defaults={};return function(container,config,template){var runnerComponent,runner=null,runnerComponentApi={getOption:function(name){return this.config[name]},getRunner:function(){return runner}};return config=_.omit(_.defaults(config||{},defaults),["renderTo"]),_.forEach(requiredOptions,function(name){if("undefined"==typeof config[name])throw new TypeError("Missing required option "+name)}),runnerComponent=component(runnerComponentApi).setTemplate(template||runnerComponentTpl).on("init",function(){var self=this,plugins=[],initPromises=[];
self.getOption("providers")&&initPromises.push(loadModules(providerLoaderFactory,self.getOption("providers")).then(registerProviders)),self.getOption("plugins")&&initPromises.push(loadModules(pluginLoaderFactory,self.getOption("plugins")).then(function(loadedPlugins){plugins=loadedPlugins})),Promise.all(initPromises).then(function(){self.on("render.runnerComponent",function(){var runnerConfig=_.assign(_.omit(self.config,["plugins","providers"]),{renderTo:self.getElement()});self.off("render.runnerComponent"),runner=runnerFactory(runnerConfig.provider,plugins,runnerConfig).on("error",function(err){self.trigger("error",err)}).on("ready",function(){_.defer(function(){
self.show().setState("ready").trigger("ready",runner)})}).after("destroy",function(){this.removeAllListeners()}).init()}).render(container).hide()})}).on("destroy",function(){var destroying=runner&&runner.destroy();return runner=null,destroying}).after("destroy",function(){this.removeAllListeners()}),runnerComponent.init(config)}}),define("tpl!taoQtiTestPreviewer/previewer/runner",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="previewer-component"></div>\n'})}),define("taoQtiTestPreviewer/previewer/runner",["jquery","lodash","context","core/promise","taoTests/runner/runnerComponent","tpl!taoQtiTestPreviewer/previewer/runner"],function($,_,context,Promise,runnerComponentFactory,runnerTpl){
"use strict";var defaults={};return function(config,container,template){return config=_.defaults(config||{},defaults),config.providers&&(config.providers=_.filter(config.providers,{category:"previewer"})),runnerComponentFactory(container||$(document.body),config,template||runnerTpl).on("render",function(){this.setState("fullpage",config.fullPage),this.setState("readonly",config.readOnly)}).on("ready",function(runner){var self=this;runner.on("destroy",function(){self.destroy()})})}}),define("normalize",[],function(){function convertURIBase(uri,fromBase,toBase){if(uri.match(absUrlRegEx)||uri.match(protocolRegEx))return uri;uri=removeDoubleSlashes(uri);var toBaseProtocol=toBase.match(protocolRegEx),fromBaseProtocol=fromBase.match(protocolRegEx);
return!fromBaseProtocol||toBaseProtocol&&toBaseProtocol[1]==fromBaseProtocol[1]&&toBaseProtocol[2]==fromBaseProtocol[2]?relativeURI(absoluteURI(uri,fromBase),toBase):absoluteURI(uri,fromBase)}function absoluteURI(uri,base){if("./"==uri.substr(0,2)&&(uri=uri.substr(2)),uri.match(absUrlRegEx)||uri.match(protocolRegEx))return uri;var baseParts=base.split("/"),uriParts=uri.split("/");for(baseParts.pop();curPart=uriParts.shift();)".."==curPart?baseParts.pop():baseParts.push(curPart);return baseParts.join("/")}function relativeURI(uri,base){var baseParts=base.split("/");for(baseParts.pop(),base=baseParts.join("/")+"/",i=0;base.substr(i,1)==uri.substr(i,1);)i++;for(;"/"!=base.substr(i,1);)i--;
base=base.substr(i+1),uri=uri.substr(i+1),baseParts=base.split("/");var uriParts=uri.split("/");for(out="";baseParts.shift();)out+="../";for(;curPart=uriParts.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var slashes=/([^:])\/+/g,removeDoubleSlashes=function(uri){return uri.replace(slashes,"$1/")},protocolRegEx=/[^\:\/]*:\/\/([^\/])*/,absUrlRegEx=/^(\/|data:)/,normalizeCSS=function(source,fromBase,toBase){fromBase=removeDoubleSlashes(fromBase),toBase=removeDoubleSlashes(toBase);var source;return source};return normalizeCSS.convertURIBase=convertURIBase,normalizeCSS.absoluteURI=absoluteURI,normalizeCSS.relativeURI=relativeURI,normalizeCSS}),define("css",[],function(){
if("undefined"==typeof window)return{load:function(n,r,load){load()}};var head=document.getElementsByTagName("head")[0],engine=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,useImportLoad=!1,useOnload=!0;engine[1]||engine[7]?useImportLoad=parseInt(engine[1])<6||parseInt(engine[7])<=9:engine[2]||engine[8]?useOnload=!1:engine[4]&&(useImportLoad=parseInt(engine[4])<18);var cssAPI={};cssAPI.pluginBuilder="./css-builder";var curStyle,curSheet,ieCurCallback,createStyle=function(){curStyle=document.createElement("style"),head.appendChild(curStyle),
curSheet=curStyle.styleSheet||curStyle.sheet},ieCnt=0,ieLoads=[],createIeLoad=function(url){ieCnt++,32==ieCnt&&(createStyle(),ieCnt=0),curSheet.addImport(url),curStyle.onload=function(){processIeLoad()}},processIeLoad=function(){ieCurCallback();var nextLoad=ieLoads.shift();return nextLoad?(ieCurCallback=nextLoad[1],void createIeLoad(nextLoad[0])):void(ieCurCallback=null)},importLoad=function(url,callback){if(curSheet&&curSheet.addImport||createStyle(),curSheet&&curSheet.addImport)ieCurCallback?ieLoads.push([url,callback]):(createIeLoad(url),ieCurCallback=callback);else{curStyle.textContent='@import "'+url+'";';var loadInterval=setInterval(function(){try{curStyle.sheet.cssRules,
clearInterval(loadInterval),callback()}catch(e){}},10)}},linkLoad=function(url,callback){var link=document.createElement("link");if(link.type="text/css",link.rel="stylesheet",useOnload)link.onload=function(){link.onload=function(){},setTimeout(callback,7)};else var loadInterval=setInterval(function(){for(var i=0;i<document.styleSheets.length;i++){var sheet=document.styleSheets[i];if(sheet.href==link.href)return clearInterval(loadInterval),callback()}},10);link.href=url,head.appendChild(link)};return cssAPI.normalize=function(name,normalize){return".css"==name.substr(name.length-4,4)&&(name=name.substr(0,name.length-4)),normalize(name)},cssAPI.load=function(cssId,req,load,config){
(useImportLoad?importLoad:linkLoad)(req.toUrl(cssId+".css"),load)},cssAPI}),define("css!taoQtiTestPreviewer/previewer/provider/item/css/item",[],function(){}),define("taoQtiTestPreviewer/previewer/adapter/item/qtiItem",["lodash","core/logger","taoQtiTestPreviewer/previewer/runner","css!taoQtiTestPreviewer/previewer/provider/item/css/item"],function(_,loggerFactory,previewerFactory){"use strict";var logger=loggerFactory("taoQtiTest/previewer"),defaultProviders=[{id:"qtiItemPreviewer",module:"taoQtiTestPreviewer/previewer/provider/item/item",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"previewer"}],defaultPlugins=[{module:"taoQtiTestPreviewer/previewer/plugins/controls/close",
bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"controls"},{module:"taoQtiTestPreviewer/previewer/plugins/navigation/submit/submit",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"navigation"},{module:"taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher",bundle:"taoQtiTest/loader/testPlugins.min",category:"tools"}];return{name:"qtiItem",init:function(uri,state,config){return config=_.defaults(config||{},{provider:"qtiItemPreviewer",serviceCallId:"previewer"}),config.providers=defaultProviders.concat(config.providers||[]),config.plugins=defaultPlugins.concat(config.plugins||[]),previewerFactory(config).on("error",function(err){
logger.error(err)}).on("ready",function(runner){runner.on("renderitem",function(){state&&runner.itemRunner.setState(state)}).loadItem(uri)})}}}),define("taoQtiTestPreviewer/previewer/config/item",["lodash","util/url","util/config"],function(_,urlUtil,configHelper){"use strict";var _defaults={bootstrap:{serviceController:"Previewer",serviceExtension:"taoQtiTestPreviewer"}},_entries={serviceCallId:!0,bootstrap:!1,timeout:!1};return function(config){var undef,storage=configHelper.from(config,_entries,_defaults);return storage.timeout?storage.timeout*=1e3:storage.timeout=undef,{getParameters:function(itemIdentifier){var type=typeof itemIdentifier,parameters={serviceCallId:this.getServiceCallId()
};if("string"===type)parameters.itemUri=itemIdentifier;else if("object"===type&&_.isPlainObject(itemIdentifier))_.merge(parameters,itemIdentifier);else if("undefined"!==type)throw new TypeError("Wrong parameter type provided for itemIdentifier: "+type+". Only string or plain object are allowed!");return parameters},getServiceCallId:function(){return storage.serviceCallId},getServiceController:function(){return storage.bootstrap.serviceController||_defaults.bootstrap.serviceController},getServiceExtension:function(){return storage.bootstrap.serviceExtension||_defaults.bootstrap.serviceExtension},getTestActionUrl:function(action){return urlUtil.route(action,this.getServiceController(),this.getServiceExtension(),this.getParameters());
},getItemActionUrl:function(itemIdentifier,action){return urlUtil.route(action,this.getServiceController(),this.getServiceExtension(),this.getParameters(itemIdentifier))},getTimeout:function(){return storage.timeout}}}}),define("taoTests/runner/plugin",["lodash","core/plugin"],function(_,pluginFactory){"use strict";return _.partialRight(pluginFactory,{hostName:"testRunner"})}),define("tpl!taoQtiTest/runner/plugins/templates/button",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+=" ",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.className,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="icon icon-',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers.unless.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>'}function program4(depth0,data){
return" no-label"}function program6(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="text">',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="small btn-info action',stack1=helpers.if.call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <a class="li-inner" href="#">\n        ',stack1=helpers.if.call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,
fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </a>\n</li>\n"})}),define("taoQtiTestPreviewer/previewer/plugins/controls/close",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,buttonTpl){"use strict";return pluginFactory({name:"close",init:function(){var self=this,testRunner=this.getTestRunner();this.$element=$(buttonTpl({control:"close",
title:__("Close the previewer"),icon:"close",text:__("Close"),className:"context-action"})),this.$element.on("click",function(e){e.preventDefault(),self.getState("enabled")!==!1&&(self.disable(),testRunner.trigger("finish"))}),this.disable(),testRunner.on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()})},render:function(){var $container=this.getAreaBroker().getArea("context");$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element);
},hide:function(){hider.hide(this.$element)}})}),define("taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint",["lodash"],function(_){"use strict";function printBase(value,withType){var print="",base=value.base;if(withType="undefined"==typeof withType||withType,base)return _.forIn(_formatters,function(formatter,baseType){if(void 0!==base[baseType])return print+=withType?"("+baseType+") ":"",print+=formatter(base[baseType]),!1}),print}function printList(value,withType){var print="",list=value.list;if(withType="undefined"==typeof withType||withType,list)return _.forIn(_formatters,function(formatter,baseType){if(void 0!==list[baseType])return print+=withType?"("+baseType+") ":"",
print+="[",_.each(list[baseType],function(value){print+=formatter(value)+", "}),_.size(list[baseType])&&(print=print.substring(0,print.length-2)),print+="]",!1}),print}function printRecord(value){return value&&value.record?"(record) "+JSON.stringify(value.record):""}var _formatters={boolean:function(value){return value?"true":"false"},integer:function(value){return value},float:function(value){return value},string:function(value){return""===value?"NULL":'"'+value+'"'},point:function(value){return"["+value[0]+", "+value[1]+"]"},pair:function(value){return"["+value[0]+", "+value[1]+"]"},directedPair:function(value){return"["+value[0]+", "+value[1]+"]"},duration:function(value){
return value},file:function(value){return"binary data"},uri:function(value){return value},intOrIdentifier:function(value){return value},identifier:function(value){return value}};return{printBase:printBase,printList:printList,printRecord:printRecord}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash","taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint"],function(_,pciPrettyPrint){"use strict";var _qtiModelPciResponseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"};return{unserialize:function(response,interaction){var mappedCardinality,ret=[],responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");
if(!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";mappedCardinality=_qtiModelPciResponseCardinalities[cardinality];var responseValues=response[mappedCardinality];if(null===responseValues)ret=[];else{if(!_.isObject(responseValues))throw"invalid response cardinality, expected "+cardinality+" ("+mappedCardinality+")";if(void 0===responseValues[baseType])throw"invalid response baseType";ret=responseValues[baseType],ret=_.isArray(ret)?ret:[ret]}return ret},serialize:function(responseValues,interaction){if(!_.isArray(responseValues))throw"invalid argument : responseValues must be an Array";var mappedCardinality,response={},responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");
if(responseValues=_.map(responseValues||[],function(v){return"boolean"===baseType?v===!0||"true"===v:v}),!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";return mappedCardinality=_qtiModelPciResponseCardinalities[cardinality],"base"===mappedCardinality?0===responseValues.length?response.base=null:(response.base={},response.base[baseType]=responseValues[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=responseValues),response},isEmpty:function(response){return null===response||_.isEmpty(response)||null===response.base||_.isArray(response.list)&&_.isEmpty(response.list)||_.isArray(response.record)&&_.isEmpty(response.record);
},prettyPrint:function(response){var print="";if("undefined"!=typeof response.base)print+=pciPrettyPrint.printBase(response,!0);else if("undefined"!=typeof response.list)print+=pciPrettyPrint.printList(response,!0);else{if("undefined"==typeof response.record)throw"Not a valid PCI JSON Response";print+=pciPrettyPrint.printRecord(response,!0)}return print}}}),define("tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="preview-console hidden">\n    <ul class="preview-console-body"></ul>\n</div>\n';
})}),define("tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console-line",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<li><pre><span class="log-time">',(helper=helpers.time)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.time,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span><span class="log-type">',
(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span><span class="log-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span></pre></li>\n"})}),define("tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console-closer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<span class="icon-close preview-console-closer hidden" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close console",options):helperMissing.call(depth0,"__","Close console",options)))+'"></span>\n'})}),define("taoQtiTestPreviewer/previewer/plugins/navigation/submit/submit",["jquery","lodash","i18n","moment","ui/hider","ui/autoscroll","util/strPad","taoTests/runner/plugin","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","tpl!taoQtiTest/runner/plugins/templates/button","tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console","tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console-line","tpl!taoQtiTestPreviewer/previewer/plugins/navigation/submit/preview-console-closer"],function($,_,__,moment,hider,autoscroll,strPad,pluginFactory,pciResponse,buttonTpl,consoleTpl,consoleLineTpl,consoleCloserTpl){
"use strict";return pluginFactory({name:"submit",init:function(){function isPluginAllowed(){var config=testRunner.getConfig();return!config.readOnly}function showConsole(){hider.show(self.controls.$console),hider.show(self.controls.$consoleBody),hider.show(self.controls.$consoleCloser),autoscroll(self.controls.$consoleBody.children().last(),self.controls.$consoleBody)}function hideConsole(){hider.hide(self.controls.$console),hider.hide(self.controls.$consoleCloser)}function addConsoleLine(type,message){var data={time:strPad(moment().format("HH:mm:ss"),12," "),type:strPad(type||"",18," "),message:strPad(message||"",18," ")};self.controls.$consoleBody.append($(consoleLineTpl(data)));
}function showResponses(type,responses){_.forEach(responses,function(response,identifier){addConsoleLine(type,strPad(identifier+": ",15," ")+_.escape(pciResponse.prettyPrint(response)))})}var self=this,testRunner=this.getTestRunner();this.controls={$button:$(buttonTpl({control:"submit",title:__("Submit and show the result"),icon:"forward",text:__("Submit")})),$console:$(consoleTpl()),$consoleCloser:$(consoleCloserTpl())},this.controls.$consoleBody=this.controls.$console.find(".preview-console-body"),this.controls.$button.on("click",function(e){e.preventDefault(),self.getState("enabled")!==!1&&(self.disable(),testRunner.trigger("submititem"))}),this.controls.$consoleCloser.on("click",function(e){
e.preventDefault(),hideConsole()}),isPluginAllowed()||this.hide(),this.disable(),testRunner.on("render",function(){isPluginAllowed()?self.show():self.hide()}).on("submitresponse",function(responses){showResponses(__("Submitted data"),responses),showConsole()}).on("scoreitem",function(responses){responses.itemSession&&(showResponses(__("Output data"),responses.itemSession),showConsole())}).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()})},render:function(){var $container=this.getAreaBroker().getContainer(),$navigation=this.getAreaBroker().getNavigationArea();$navigation.append(this.controls.$button),$navigation.append(this.controls.$consoleCloser),
$container.append(this.controls.$console)},destroy:function(){_.forEach(this.controls,function($el){$el.remove()}),this.controls=null},enable:function(){this.controls.$button.removeProp("disabled").removeClass("disabled")},disable:function(){this.controls.$button.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.controls.$button)},hide:function(){_.forEach(this.controls,hider.hide)}})}),function(name,definition,global){"use strict";"function"==typeof define?define("lib/store/idbstore",definition):"undefined"!=typeof module&&module.exports?module.exports=definition():global[name]=definition()}("IDBStore",function(){"use strict";function mixin(target,source){
var name,s;for(name in source)s=source[name],s!==empty[name]&&s!==target[name]&&(target[name]=s);return target}var defaultErrorHandler=function(error){throw error},defaultSuccessHandler=function(){},defaults={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:defaultErrorHandler,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},IDBStore=function(kwArgs,onStoreReady){"undefined"==typeof onStoreReady&&"function"==typeof kwArgs&&(onStoreReady=kwArgs),"[object Object]"!=Object.prototype.toString.call(kwArgs)&&(kwArgs={});for(var key in defaults)this[key]="undefined"!=typeof kwArgs[key]?kwArgs[key]:defaults[key];
this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,onStoreReady&&(this.onStoreReady=onStoreReady);var env="object"==typeof window?window:self,availableImplementations=this.implementationPreference.filter(function(implName){return implName in env});this.implementation=availableImplementations[0],this.idb=env[this.implementation],this.keyRange=env.IDBKeyRange||env.webkitIDBKeyRange||env.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()},proto={constructor:IDBStore,version:"1.7.0",
db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var openRequest=this.idb.open(this.dbName,this.dbVersion),preventSuccessCallback=!1;openRequest.onerror=function(error){var gotVersionErr=!1;"error"in error.target?gotVersionErr="VersionError"==error.target.error.name:"errorCode"in error.target&&(gotVersionErr=12==error.target.errorCode),gotVersionErr?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(error)}.bind(this),openRequest.onsuccess=function(event){
if(!preventSuccessCallback){if(this.db)return void this.onStoreReady();if(this.db=event.target.result,"string"==typeof this.db.version)return void this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));if(!this.db.objectStoreNames.contains(this.storeName))return void this.onError(new Error("Object store couldn't be created."));var emptyTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=emptyTransaction.objectStore(this.storeName);var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName)return preventSuccessCallback=!0,
void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(preventSuccessCallback=!0,this.onError(new Error('Cannot modify index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else preventSuccessCallback=!0,this.onError(new Error('Cannot create new index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),existingIndexes.length&&(preventSuccessCallback=!0,
this.onError(new Error('Cannot delete index(es) "'+existingIndexes.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),preventSuccessCallback||this.onStoreReady()}}.bind(this),openRequest.onupgradeneeded=function(event){if(this.db=event.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=event.target.transaction.objectStore(this.storeName);else{var optionalParameters={autoIncrement:this.autoIncrement};null!==this.keyPath&&(optionalParameters.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,optionalParameters)}var existingIndexes=Array.prototype.slice.call(this.getIndexList());
this.indexes.forEach(function(indexData){var indexName=indexData.name;if(indexName||(preventSuccessCallback=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(this.store.deleteIndex(indexName),this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry});
},this),existingIndexes.length&&existingIndexes.forEach(function(_indexName){this.store.deleteIndex(_indexName)},this)}.bind(this)},deleteDatabase:function(onSuccess,onError){if(this.idb.deleteDatabase){this.db.close();var deleteRequest=this.idb.deleteDatabase(this.dbName);deleteRequest.onsuccess=onSuccess,deleteRequest.onerror=onError}else onError(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(key,value,onSuccess,onError){null!==this.keyPath&&(onError=onSuccess,onSuccess=value,value=key),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var putRequest,hasSuccess=!1,result=null,putTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);
return putTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},putTransaction.onabort=onError,putTransaction.onerror=onError,null!==this.keyPath?(this._addIdPropertyIfNeeded(value),putRequest=putTransaction.objectStore(this.storeName).put(value)):putRequest=putTransaction.objectStore(this.storeName).put(value,key),putRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},putRequest.onerror=onError,putTransaction},get:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,getTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);
getTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getTransaction.onabort=onError,getTransaction.onerror=onError;var getRequest=getTransaction.objectStore(this.storeName).get(key);return getRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getRequest.onerror=onError,getTransaction},remove:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,removeTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);removeTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;
callback(result)},removeTransaction.onabort=onError,removeTransaction.onerror=onError;var deleteRequest=removeTransaction.objectStore(this.storeName).delete(key);return deleteRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},deleteRequest.onerror=onError,removeTransaction},batch:function(dataArray,onSuccess,onError){if(onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),"[object Array]"!=Object.prototype.toString.call(dataArray))onError(new Error("dataArray argument must be of type Array."));else if(0===dataArray.length)return onSuccess(!0);var count=dataArray.length,called=!1,hasSuccess=!1,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);
batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(hasSuccess)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(){count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(operation){var type=operation.type,key=operation.key,value=operation.value,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err,type,key))};if("remove"==type){var deleteRequest=batchTransaction.objectStore(this.storeName).delete(key);deleteRequest.onsuccess=onItemSuccess,deleteRequest.onerror=onItemError}else if("put"==type){var putRequest;null!==this.keyPath?(this._addIdPropertyIfNeeded(value),
putRequest=batchTransaction.objectStore(this.storeName).put(value)):putRequest=batchTransaction.objectStore(this.storeName).put(value,key),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError}},this),batchTransaction},putBatch:function(dataArray,onSuccess,onError){var batchData=dataArray.map(function(item){return{type:"put",value:item}});return this.batch(batchData,onSuccess,onError)},upsertBatch:function(dataArray,options,onSuccess,onError){"function"==typeof options&&(onSuccess=options,onError=onSuccess,options={}),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),options||(options={}),"[object Array]"!=Object.prototype.toString.call(dataArray)&&onError(new Error("dataArray argument must be of type Array."));
var keyField=options.keyField||this.keyPath,count=dataArray.length,called=!1,hasSuccess=!1,index=0,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){hasSuccess?onSuccess(dataArray):onError(!1)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(event){var record=dataArray[index++];record[keyField]=event.target.result,count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(record){var putRequest,key=record.key,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err))};null!==this.keyPath?(this._addIdPropertyIfNeeded(record),
putRequest=batchTransaction.objectStore(this.storeName).put(record)):putRequest=batchTransaction.objectStore(this.storeName).put(record,key),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError},this),batchTransaction},removeBatch:function(keyArray,onSuccess,onError){var batchData=keyArray.map(function(key){return{type:"remove",key:key}});return this.batch(batchData,onSuccess,onError)},getBatch:function(keyArray,onSuccess,onError,arrayType){if(onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),arrayType||(arrayType="sparse"),"[object Array]"!=Object.prototype.toString.call(keyArray))onError(new Error("keyArray argument must be of type Array."));else if(0===keyArray.length)return onSuccess([]);
var data=[],count=keyArray.length,called=!1,hasSuccess=!1,result=null,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(event){event.target.result||"dense"==arrayType?data.push(event.target.result):"sparse"==arrayType&&data.length++,count--,0===count&&(called=!0,hasSuccess=!0,result=data)};return keyArray.forEach(function(key){var onItemError=function(err){called=!0,result=err,onError(err),batchTransaction.abort()},getRequest=batchTransaction.objectStore(this.storeName).get(key);
getRequest.onsuccess=onItemSuccess,getRequest.onerror=onItemError},this),batchTransaction},getAll:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var getAllTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY),store=getAllTransaction.objectStore(this.storeName);return store.getAll?this._getAllNative(getAllTransaction,store,onSuccess,onError):this._getAllCursor(getAllTransaction,store,onSuccess,onError),getAllTransaction},_getAllNative:function(getAllTransaction,store,onSuccess,onError){var hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;
callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var getAllRequest=store.getAll();getAllRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getAllRequest.onerror=onError},_getAllCursor:function(getAllTransaction,store,onSuccess,onError){var all=[],hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(event){var cursor=event.target.result;cursor?(all.push(cursor.value),cursor.continue()):(hasSuccess=!0,
result=all)},cursorRequest.onError=onError},clear:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,clearTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);clearTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},clearTransaction.onabort=onError,clearTransaction.onerror=onError;var clearRequest=clearTransaction.objectStore(this.storeName).clear();return clearRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},clearRequest.onerror=onError,clearTransaction},_addIdPropertyIfNeeded:function(dataObj){
"undefined"==typeof dataObj[this.keyPath]&&(dataObj[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(indexName){return this.store.indexNames.contains(indexName)},normalizeIndexData:function(indexData){indexData.keyPath=indexData.keyPath||indexData.name,indexData.unique=!!indexData.unique,indexData.multiEntry=!!indexData.multiEntry},indexComplies:function(actual,expected){var complies=["keyPath","unique","multiEntry"].every(function(key){if("multiEntry"==key&&void 0===actual[key]&&expected[key]===!1)return!0;if("keyPath"==key&&"[object Array]"==Object.prototype.toString.call(expected[key])){
var exp=expected.keyPath,act=actual.keyPath;if("string"==typeof act)return exp.toString()==act;if("function"!=typeof act.contains&&"function"!=typeof act.indexOf)return!1;if(act.length!==exp.length)return!1;for(var i=0,m=exp.length;i<m;i++)if(!(act.contains&&act.contains(exp[i])||act.indexOf(exp[i]!==-1)))return!1;return!0}return expected[key]==actual[key]});return complies},iterate:function(onItem,options){options=mixin({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:defaultErrorHandler,limit:1/0,offset:0,allowItemRejection:!1},options||{});var directionType="desc"==options.order.toLowerCase()?"PREV":"NEXT";
options.filterDuplicates&&(directionType+="_NO_DUPLICATE");var hasSuccess=!1,cursorTransaction=this.db.transaction([this.storeName],this.consts[options.writeAccess?"READ_WRITE":"READ_ONLY"]),cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var recordCount=0;cursorTransaction.oncomplete=function(){return hasSuccess?void(options.onEnd?options.onEnd():onItem(null)):void options.onError(null)},cursorTransaction.onabort=options.onError,cursorTransaction.onerror=options.onError;var cursorRequest=cursorTarget.openCursor(options.keyRange,this.consts[directionType]);return cursorRequest.onerror=options.onError,
cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor)if(options.offset)cursor.advance(options.offset),options.offset=0;else{var onItemReturn=onItem(cursor.value,cursor,cursorTransaction);options.allowItemRejection&&onItemReturn===!1||recordCount++,options.autoContinue&&(recordCount+options.offset<options.limit?cursor.continue():hasSuccess=!0)}else hasSuccess=!0},cursorTransaction},query:function(onSuccess,options){var result=[],processedItems=0;return options=options||{},options.autoContinue=!0,options.writeAccess=!1,options.allowItemRejection=!!options.filter,options.onEnd=function(){onSuccess(result,processedItems)},this.iterate(function(item){
processedItems++;var accept=!options.filter||options.filter(item);return accept!==!1&&result.push(item),accept},options)},count:function(onSuccess,options){options=mixin({index:null,keyRange:null},options||{});var onError=options.onError||defaultErrorHandler,hasSuccess=!1,result=null,cursorTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);cursorTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},cursorTransaction.onabort=onError,cursorTransaction.onerror=onError;var cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var countRequest=cursorTarget.count(options.keyRange);
return countRequest.onsuccess=function(evt){hasSuccess=!0,result=evt.target.result},countRequest.onError=onError,cursorTransaction},makeKeyRange:function(options){var keyRange,hasLower="undefined"!=typeof options.lower,hasUpper="undefined"!=typeof options.upper,isOnly="undefined"!=typeof options.only;switch(!0){case isOnly:keyRange=this.keyRange.only(options.only);break;case hasLower&&hasUpper:keyRange=this.keyRange.bound(options.lower,options.upper,options.excludeLower,options.excludeUpper);break;case hasLower:keyRange=this.keyRange.lowerBound(options.lower,options.excludeLower);break;case hasUpper:keyRange=this.keyRange.upperBound(options.upper,options.excludeUpper);
break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return keyRange}},empty={};return IDBStore.prototype=proto,IDBStore.version=proto.version,IDBStore},this),define("taoTests/runner/areaBroker",["lodash","core/areaBroker"],function(_,areaBroker){"use strict";var requireAreas=["content","toolbox","navigation","control","header","panel"];return _.partial(areaBroker,requireAreas)}),define("taoTests/runner/testStore",["lodash","core/promise","core/store","core/logger"],function(_,Promise,store,loggerFactory){"use strict";var logger=loggerFactory("taoQtiTest/runner/provider/testStore"),legacyPrefixes=["actions-","duration-","test-probe","timer-"],modes={
unified:"unified",fragmented:"fragmented"},selectStoreMode=function(testId,preselectedBackend){return store.getAll(function(storeName){return _.some(legacyPrefixes,function(prefix){return!_.isEmpty(storeName)&&prefix+testId===storeName})},preselectedBackend).then(function(foundStores){return _.isArray(foundStores)&&foundStores.length>0?modes.fragmented:modes.unified})};return function(testId,preselectedBackend){var testMode,storeNames=[],volatiles=[],isStoreModeUnified=function(){return _.isUndefined(testMode)?selectStoreMode(testId,preselectedBackend).then(function(result){return testMode=result&&"undefined"!=typeof modes[result]?result:modes.unified,logger.debug("Test store mode "+result+" for "+testId),
result===modes.unified}):Promise.resolve(testMode===modes.unified)};if(_.isEmpty(testId))throw new TypeError("The store must be identified with a unique test identifier");return{getStore:function(storeName){if(_.isEmpty(storeName))throw new TypeError("A store name must be provided to get the store");return _.contains(storeNames,storeName)||storeNames.push(storeName),isStoreModeUnified().then(function(isUnified){var loadStore;return loadStore=isUnified?store(testId,preselectedBackend):store(storeName+"-"+testId,preselectedBackend),loadStore.then(function(loadedStore){var keyPattern=new RegExp("^"+storeName+"__"),storeKey=function(key){return isUnified?storeName+"__"+key:key;
};return{getItem:function(key){return loadedStore.getItem(storeKey(key))},getItems:function(){return isUnified?loadedStore.getItems().then(function(entries){return _.transform(entries,function(acc,entry,key){return keyPattern.test(key)&&(acc[key.replace(keyPattern,"")]=entry),acc},{})}):loadedStore.getItems()},setItem:function(key,value){return loadedStore.setItem(storeKey(key),value)},removeItem:function(key){return loadedStore.removeItem(storeKey(key))},clear:function(){return isUnified?loadedStore.getItems().then(function(entries){_.forEach(entries,function(entry,key){keyPattern.test(key)&&loadedStore.removeItem(key)})}):loadedStore.clear()}}})})},setVolatile:function(storeName){
return _.contains(volatiles,storeName)||volatiles.push(storeName),this},clearVolatileIfStoreChange:function(storeId){var self=this,shouldClear=!1;return store.getIdentifier(preselectedBackend).then(function(savedStoreId){return _.isEmpty(storeId)||_.isEmpty(savedStoreId)||savedStoreId===storeId||(logger.info("Storage change detected ("+savedStoreId+" != "+storeId+") => volatiles data wipe out !"),shouldClear=!0),shouldClear}).then(function(clear){return!!clear&&self.clearVolatileStores()})},clearVolatileStores:function(){var self=this,clearing=volatiles.map(function(storeName){return self.getStore(storeName).then(function(storeInstance){return storeInstance.clear();
})});return Promise.all(clearing).then(function(results){return results&&results.length===volatiles.length})},remove:function(){var legacyStoreExp=new RegExp("-"+testId+"$");return isStoreModeUnified().then(function(isUnified){return isUnified?store(testId,preselectedBackend).then(function(storeInstance){return storeInstance.removeStore()}):store.removeAll(function(storeName){return legacyStoreExp.test(storeName)},preselectedBackend)})},getStorageIdentifier:function(){return store.getIdentifier(preselectedBackend)}}}}),define("taoTests/runner/proxy",["lodash","async","core/delegator","core/eventifier","core/promise","core/providerRegistry","core/tokenHandler","core/connectivity"],function(_,async,delegator,eventifier,Promise,providerRegistry,tokenHandlerFactory,connectivity){
"use strict";function proxyFactory(proxyName,config){function getParams(params){var mergedParams=_.merge({},params,extraCallParams);return extraCallParams={},mergedParams}function getMiddlewares(queue){var list=middlewares[queue]||[];return middlewares.all&&(list=list.concat(middlewares.all)),list}function applyMiddlewares(request,response){var list=_.map(getMiddlewares(request.command),function(middleware){return function(next){middleware(request,response,next)}});return new Promise(function(resolve,reject){async.series(list,function(err){err||"error"!==response.status||(err=response.data),err?(proxy.trigger("error",err),reject(err)):(proxy.trigger("receive",response.data,"proxy"),
resolve(response.data))})})}function delegate(fnName){var request={command:fnName,params:_slice.call(arguments,1)};return initialized||_.contains(["install","init"],fnName)?delegateProxy.apply(null,arguments).then(function(data){return initialized=!0,applyMiddlewares(request,{status:"success",data:data})}).catch(function(data){return applyMiddlewares(request,{status:"error",data:data})}):Promise.reject(new Error("Proxy is not properly initialized or has been destroyed!"))}var proxy,delegateProxy,communicator,communicatorPromise,testDataHolder,extraCallParams={},proxyAdapter=proxyFactory.getProvider(proxyName),initConfig=_.defaults(config||{},_defaults),tokenHandler=tokenHandlerFactory(),middlewares={},initialized=!1,onlineStatus=connectivity.isOnline();
return proxy=eventifier({use:function(command){var queue=command&&_.isString(command)?command:"all",list=middlewares[queue]||[];return middlewares[queue]=list,_.each(arguments,function(cb){_.isFunction(cb)&&list.push(cb)}),this},install:function(dataHolder){return dataHolder&&(testDataHolder=dataHolder),delegate("install",initConfig)},init:function(params){return delegate("init",initConfig,getParams(params))},destroy:function(){return delegate("destroy").then(function(){if(initialized=!1,communicatorPromise)return new Promise(function(resolve,reject){function destroyCommunicator(){communicator.destroy().then(resolve).catch(reject)}communicatorPromise.then(function(){
destroyCommunicator()}).catch(function(){communicator?destroyCommunicator():resolve()})})})},getDataHolder:function(){return testDataHolder},setOnline:function(){return this.isOffline()&&(onlineStatus=!0,this.trigger("reconnect")),this},setOffline:function(source){return this.isOnline()&&(onlineStatus=!1,this.trigger("disconnect",source)),this},isOnline:function(){return onlineStatus},isOffline:function(){return!onlineStatus},isConnectivityError:function(err){return _.isObject(err)&&"network"===err.source&&0===err.code&&err.sent===!1},getTokenHandler:function(){return tokenHandler},hasCommunicator:function(){return!!communicatorPromise},getCommunicator:function(){
var self=this;return initialized?(communicatorPromise||(communicatorPromise=new Promise(function(resolve,reject){_.isFunction(proxyAdapter.loadCommunicator)?(communicator=proxyAdapter.loadCommunicator.call(self),communicator?communicator.before("error",function(e,err){self.isConnectivityError(err)&&self.setOffline("communicator")}).on("error",function(err){self.trigger("error",err)}).on("receive",function(response){self.setOnline(),self.trigger("receive",response,"communicator")}).init().then(function(){return communicator.open().then(function(){resolve(communicator)}).catch(reject)}).catch(reject):reject(new Error("No communicator has been set up!"))):reject(new Error("The proxy provider does not have a loadCommunicator method"));
})),communicatorPromise):Promise.reject(new Error("Proxy is not properly initialized or has been destroyed!"))},channel:function(name,handler){if(!_.isString(name)||name.length<=0)throw new TypeError("A channel must have a name");if(!_.isFunction(handler))throw new TypeError("A handler must be attached to a channel");return this.getCommunicator().then(function(communicatorInstance){communicatorInstance.channel(name,handler)}).catch(_.noop),this.on("channel-"+name,handler),this},send:function(channel,message){return this.getCommunicator().then(function(communicatorInstance){return communicatorInstance.send(channel,message)})},addCallActionParams:function(params){
return _.isPlainObject(params)&&_.merge(extraCallParams,params),this},getTestData:function(){return delegate("getTestData")},getTestContext:function(){return delegate("getTestContext")},getTestMap:function(){return delegate("getTestMap")},sendVariables:function(variables,deferred){return delegate("sendVariables",variables,deferred)},callTestAction:function(action,params,deferred){return delegate("callTestAction",action,getParams(params),deferred)},getItem:function(uri,params){return delegate("getItem",uri,params)},submitItem:function(uri,state,response,params){return delegate("submitItem",uri,state,response,getParams(params))},callItemAction:function(uri,action,params,deferred){
return delegate("callItemAction",uri,action,getParams(params),deferred)},telemetry:function(uri,signal,params){return delegate("telemetry",uri,signal,params)}}),connectivity.on("offline",function(){proxy.setOffline("device")}).on("online",function(){proxy.setOnline()}),proxy.on("message",function(channel,message){this.trigger("channel-"+channel,message)}).use(function(request,response,next){response.data&&response.data.messages&&_.forEach(response.data.messages,function(msg){msg.channel?proxy.trigger("message",msg.channel,msg.message):proxy.trigger("message","malformed",msg)}),next()}).use(function(request,response,next){proxy.isConnectivityError(response.data)?proxy.setOffline("request"):response.data&&response.data.sent===!0&&proxy.setOnline(),
next()}),delegateProxy=delegator(proxy,proxyAdapter,{name:"proxy",wrapper:function(response){return Promise.resolve(response)}}),proxy}var _defaults={},_slice=[].slice;return providerRegistry(proxyFactory)}),define("taoQtiTestPreviewer/previewer/proxy/item",["jquery","lodash","i18n","core/promise","core/promiseQueue","core/communicator","taoQtiTestPreviewer/previewer/config/item","util/httpErrorParser"],function($,_,__,Promise,promiseQueue,communicatorFactory,configFactory,httpErrorParser){"use strict";return{install:function(){var self=this;this.queue=promiseQueue(),this.prepareParams=function(actionParams){var stringifyParams=["itemState","itemResponse"];return _.isPlainObject(actionParams)?_.mapValues(actionParams,function(value,key){
return _.contains(stringifyParams,key)?JSON.stringify(value):value}):actionParams},this.request=function(url,reqParams,contentType,noToken){var runRequest=function(){return new Promise(function(resolve,reject){var token,noop,headers={},action=reqParams?"POST":"GET",preparedParams=self.prepareParams(reqParams),tokenHandler=self.getTokenHandler();noToken||(token=tokenHandler.getToken(),token&&(headers["X-Auth-Token"]=token)),$.ajax({url:url,type:action,cache:!1,data:preparedParams,headers:headers,async:!0,dataType:"json",contentType:contentType||noop,timeout:self.configStorage.getTimeout()}).done(function(data){data&&data.token&&tokenHandler.setToken(data.token),
self.setOnline(),data&&data.success?resolve(data):reject(data)}).fail(function(jqXHR,textStatus,errorThrown){var data;try{data=JSON.parse(jqXHR.responseText)}catch(err){data={}}return data=_.defaults(data,{success:!1,source:"network",cause:url,purpose:"proxy",context:this,code:jqXHR.status,sent:jqXHR.readyState>0,type:textStatus||"error",message:errorThrown||__("An error occurred!")}),data.token?tokenHandler.setToken(data.token):noToken||tokenHandler.setToken(token),self.isConnectivityError(data)?(self.setOffline("request"),resolve(data)):void reject(httpErrorParser.parse(jqXHR,textStatus,errorThrown))})})};return noToken===!0?runRequest():this.queue.serie(runRequest);
}},init:function(config,params){return this.configStorage=configFactory(config||{}),this.request(this.configStorage.getTestActionUrl("init"),params)},destroy:function(){return this.configStorage=null,this.queue=null,Promise.resolve()},callTestAction:function(action,params){return this.request(this.configStorage.getTestActionUrl(action),params)},callItemAction:function(itemIdentifier,action,params){return this.request(this.configStorage.getItemActionUrl(itemIdentifier,action),params)},getItem:function(itemIdentifier,params){return this.request(this.configStorage.getItemActionUrl(itemIdentifier,"getItem"),params)},submitItem:function(itemIdentifier,state,response,params){
var body=_.merge({itemState:state,itemResponse:response},params||{});return this.request(this.configStorage.getItemActionUrl(itemIdentifier,"submitItem"),body)}}}),define("taoQtiTest/runner/ui/toolbox/entry",["lodash","ui/component","tpl!taoQtiTest/runner/plugins/templates/button"],function(_,componentFactory,entryTpl){"use strict";var itemComponentApi={initItem:function(){this.id=this.config.control,this.menu=null},getType:function(){return"entry"},getId:function(){return this.id},setMenuId:function(menuId){this.menuId=menuId},getMenuId:function(){return this.menuId},turnOn:function(){this.setState("active",!0)},turnOff:function(){this.setState("active",!1)},
hoverOn:function(){this.setState("hover",!0)},hoverOff:function(){this.setState("hover",!1)}};return function(specs,defaults){var itemComponent;return specs=_.defaults(specs||{},itemComponentApi),itemComponent=componentFactory(specs,defaults).setTemplate(entryTpl).on("enable",function(){this.is("rendered")&&this.$component.removeProp("disabled")}).on("disable",function(){this.is("rendered")&&(this.$component.prop("disabled",!0),this.turnOff())}).on("init",function(){this.initItem()}).on("render",function(){var self=this;this.disable(),this.$component.on("mousedown",function(event){self.trigger("mousedown",event)}).on("click",function(event){self.trigger("click",event);
})})}}),define("tpl!taoQtiTest/runner/ui/toolbox/templates/menu",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+=" ",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="icon icon-',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers.unless.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>'}function program4(depth0,data){return" no-label"}function program6(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="text">',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="small btn-info action ',stack1=helpers.if.call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <a class="li-inner" data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-button" href="#">\n        ',stack1=helpers.if.call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,
fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        &nbsp; <span class="icon icon-up"></span>\n    </a>\n    <div data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-menu" class="hidden ',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-menu" tabindex="1">\n        <ul data-control="',
(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-list" class="menu ',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-list"></ul>\n    </div>\n</li>\n'})}),define("tpl!taoQtiTest/runner/ui/toolbox/templates/menu-item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,helper,buffer="";return buffer+=" ",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="small action menu-item ',stack1=helpers.if.call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='" data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <a class="li-inner menu-inner">\n        <span class="icon icon-checkbox"></span><span class="icon icon-checkbox-checked"></span>\n        <span class="label">',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    </a>\n</li>"})}),define("taoQtiTest/runner/ui/toolbox/menu",["jquery","lodash","ui/component","ui/hider","ui/stacker","util/shortcut","util/namespace","tpl!taoQtiTest/runner/ui/toolbox/templates/menu","tpl!taoQtiTest/runner/ui/toolbox/templates/menu-item"],function($,_,componentFactory,hider,stackerFactory,shortcut,namespaceHelper,menuTpl,menuItemTpl){
"use strict";var keyCodes={ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},stacker=stackerFactory("test-runner"),menuComponentApi={initMenu:function(){this.id=this.config.control,this.menuItems=[]},getType:function(){return"menu"},getId:function(){return this.id},turnOn:function(){this.setState("active",!0)},turnOff:function(){this.setState("active",!1)},toggleMenu:function(){this.is("disabled")||(this.is("opened")?this.closeMenu():this.openMenu())},openMenu:function(){hider.show(this.$menuContainer),stacker.bringToFront(this.$menuContent),this.$menuStateIcon.removeClass("icon-up"),this.$menuStateIcon.addClass("icon-down"),this.turnOn(),this.enableShortcuts(),
this.hoverOffAll(),this.hoverIndex=this.menuItems.length,document.activeElement&&document.activeElement.blur(),this.$menuContainer.focus(),this.setState("opened",!0),this.trigger("openmenu",this)},closeMenu:function(){hider.hide(this.$menuContainer),this.$menuStateIcon.removeClass("icon-down"),this.$menuStateIcon.addClass("icon-up"),this.turnOff(),this.disableShortcuts(),this.hoverOffAll(),this.setState("opened",!1),this.trigger("closemenu",this)},getItemById:function(itemId){return _.find(this.menuItems,function(item){return item.getId()===itemId})},addItem:function(item){item&&this.menuItems.push(item)},renderItems:function(){var self=this;this.menuItems.forEach(function(item){
item.setTemplate(menuItemTpl),item.render(self.$menuContent),item.enable()}),this.$menuItems=this.$menuContent.find(".menu-item"),this.$menuItems.on("mouseenter",function(e){var itemId=e.currentTarget.getAttribute("data-control");self.mouseOverItem(itemId)})},mouseOverItem:function(itemId){var self=this;this.menuItems.forEach(function(item,index){item.id===itemId&&(self.hoverIndex=index)}),this.hoverItem(itemId)},hasDisplayedItems:function(){return this.menuItems.some(function(item){return!item.is("disabled")&&!item.is("hidden")})},turnOffAll:function(){this.menuItems.forEach(function(current){current.turnOff()})},enableShortcuts:function(){var self=this;this.$menuContainer.on("keydown.menuNavigation",function(e){
var currentKeyCode=e.keyCode?e.keyCode:e.charCode;switch(e.preventDefault(),currentKeyCode){case keyCodes.SPACE:case keyCodes.ENTER:self.triggerHighlightedItem(),e.stopPropagation();break;case keyCodes.LEFT:case keyCodes.UP:self.moveUp(),e.stopPropagation();break;case keyCodes.RIGHT:case keyCodes.DOWN:self.moveDown(),e.stopPropagation()}}),this.$menuButton.on("keydown.menuNavigation",function(e){var currentKeyCode=e.keyCode?e.keyCode:e.charCode;currentKeyCode===keyCodes.UP&&(e.stopPropagation(),self.hoverIndex=self.menuItems.length-1,self.$menuContainer.focus(),self.hoverItem(self.menuItems[self.hoverIndex].id))})},disableShortcuts:function(){this.$menuContainer.off(".menuNavigation"),
this.$menuButton.off(".menuNavigation")},moveUp:function(){this.hoverIndex>0&&(this.hoverIndex--,this.hoverItem(this.menuItems[this.hoverIndex].id))},moveDown:function(){this.hoverIndex<this.menuItems.length-1?(this.hoverIndex++,this.hoverItem(this.menuItems[this.hoverIndex].id)):this.hoverIndex===this.menuItems.length-1&&(this.hoverIndex++,this.hoverOffAll(),this.$menuButton.closest(".action").focus(),this.closeMenu())},hoverItem:function(itemId){var itemToHover=this.getItemById(itemId);this.hoverOffAll(),itemToHover&&itemToHover.hoverOn()},hoverOffAll:function(){this.menuItems.forEach(function(current){current&&current.hoverOff()})},triggerHighlightedItem:function(){
var activeItem;this.menuItems[this.hoverIndex]&&(activeItem=this.menuItems[this.hoverIndex],activeItem.getElement().trigger("click"),this.closeMenu(),document.activeElement&&document.activeElement.blur())}};return function(specs,defaults){var _defaults,menuComponent;return _defaults={$component:$(),$menuButton:$(),$menuContainer:$(),$menuContent:$(),$menuItems:$(),$menuStateIcon:$(),hoverIndex:null,id:null,menuItems:[]},specs=_.defaults(specs||{},menuComponentApi),menuComponent=componentFactory(specs,defaults).setTemplate(menuTpl).on("enable",function(){this.is("rendered")&&this.$component.removeProp("disabled")}).on("disable",function(){this.is("rendered")&&(this.$component.prop("disabled",!0),
this.closeMenu(),this.turnOff())}).on("hide",function(){this.is("rendered")&&this.closeMenu()}).on("init",function(){this.initMenu()}).on("render",function(){var self=this;this.$menuButton=this.$component.find('[data-control="'+this.config.control+'-button"]'),this.$menuContainer=this.$component.find('[data-control="'+this.config.control+'-menu"]'),this.$menuContent=this.$component.find('[data-control="'+this.config.control+'-list"]'),this.$menuStateIcon=this.$menuButton.find(".icon-up"),this.disable(),this.$component.on("click",function(e){e.preventDefault(),self.is("opened")||e.stopPropagation(),self.toggleMenu()}),this.$menuContainer.on("click",function(e){
e.preventDefault(),e.stopPropagation(),self.closeMenu()}),this.$menuContent.on("mouseleave",this.hoverOffAll)}).on("destroy",function(){this.is("rendered")&&(this.$menuContainer.off(".menuNavigation"),this.$menuButton.off(".menuNavigation"))}),_.defaults(menuComponent,_defaults),menuComponent}}),define("tpl!taoQtiTest/runner/ui/toolbox/templates/text",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='class="',(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<li ",stack1=helpers.if.call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" >\n    ',
(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</li>\n"})}),define("taoQtiTest/runner/ui/toolbox/text",["lodash","ui/component","tpl!taoQtiTest/runner/ui/toolbox/templates/text"],function(_,componentFactory,textTpl){"use strict";var textComponentApi={initText:function(){this.id=this.config.control},getType:function(){return"text"},getId:function(){return this.id}};return function(specs,defaults){var textComponent;return specs=_.defaults(specs||{},textComponentApi),textComponent=componentFactory(specs,defaults).setTemplate(textTpl).on("init",function(){
this.initText()}).on("render",function(){this.disable()})}}),define("tpl!taoQtiTest/runner/ui/toolbox/templates/toolbox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<ul class="plain tools-box-list"></ul>'})}),define("taoQtiTest/runner/ui/toolbox/toolbox",["lodash","jquery","ui/component","taoQtiTest/runner/ui/toolbox/entry","taoQtiTest/runner/ui/toolbox/menu","taoQtiTest/runner/ui/toolbox/text","tpl!taoQtiTest/runner/ui/toolbox/templates/toolbox"],function(_,$,componentFactory,entryFactory,menuFactory,textFactory,toolboxTpl){
"use strict";function defaultRenderer($container){var self=this,menuEntries=[];_.isArray(this.allItems)&&this.allItems.forEach(function(item){self.hasMenu(item)||item.render($container)}),this.allMenus.forEach(function(menu){var menuId=menu.getId();menuEntries=self.allItems.filter(function(item){return"entry"===item.getType()&&item.getMenuId()===menuId}),menuEntries.forEach(function(item){menu.addItem(item)}),menu.renderItems()})}var toolboxComponentApi={initToolbox:function(){this.allItems=[],this.allMenus=[]},createMenu:function(config){var self=this,menu=menuFactory().init(config);return this.allItems.push(menu),this.allMenus.push(menu),menu.on("openmenu",function(openedMenu){
self.allMenus.forEach(function(current){openedMenu.getId()!==current.getId()&&current.is("opened")&&current.closeMenu()})}),menu},createEntry:function(config){var item=entryFactory().init(config);return this.allItems.push(item),item},createText:function(config){var text=textFactory().init(config);return this.allItems.push(text),text},hasMenu:function(item){return item&&_.isFunction(item.getMenuId)&&item.getMenuId()}};return function(specs,defaults){var toolboxComponent,$document=$(document);return specs=_.defaults(specs||{},toolboxComponentApi),toolboxComponent=componentFactory(specs,defaults).on("init",function(){this.initToolbox()}).on("render.defaultRenderer",defaultRenderer).on("render",function(){
var self=this;$document.off(".toolboxmenu"),$document.on("click.toolboxmenu",function(){self.allMenus.forEach(function(menu){menu.is("opened")&&menu.closeMenu()})})}).on("destroy",function(){$document.off(".toolboxmenu"),this.allItems.forEach(function(item){item.destroy()})}).setTemplate(toolboxTpl)}}),define("taoItems/assets/manager",["lodash","util/url"],function(_,urlUtil){"use strict";var checkStrategy=function(strategy){if(!_.isPlainObject(strategy)||!_.isFunction(strategy.handle)||!_.isString(strategy.name))throw new TypeError("An asset resolution strategy is an object with a handle method and a name")},assetManagerFactory=function(strategies,data,options){
var cache={};strategies=_.isArray(strategies)?strategies:[strategies],data=data||{},options=_.defaults(options||{},{parseUrl:!0});var assetManager={_strategies:[],addStrategy:function(strategy){checkStrategy(strategy),this._strategies.push(strategy)},prependStrategy:function(strategy){checkStrategy(strategy),this._strategies.unshift(strategy)},setStrategies:function(newStrategies){var self=this;this._strategies=[],_.forEach(newStrategies,function(strategy){_.isPlainObject(strategy)?assetManager.addStrategy(strategy):_.isFunction(strategy)&&self.addStrategy({name:"strategy_"+(self._strategies.length+1),handle:strategy})})},setData:function(key,value){_.isString(key)&&"undefined"!=typeof value?data[key]=value:_.isPlainObject(key)&&(data=key);
},getData:function(key){return _.isString(key)?data[key]:data},resolve:function(url){var resolved,inputUrl;return options.cache&&cache.hasOwnProperty(url)?cache[url]:(inputUrl=options.parseUrl?urlUtil.parse(url):url,_.forEach(this._strategies,function(strategy){var result=strategy.handle(inputUrl,data);if(result)return resolved=result,!1}),resolved=resolved||"",options.cache&&(cache[url]=resolved),resolved)},resolveBy:function(name,url){var inputUrl,resolved="",strategy=_.find(this._strategies,{name:name});return strategy&&(inputUrl=options.parseUrl?urlUtil.parse(url):url,resolved=strategy.handle(inputUrl,data)),resolved},clearCache:function(){options.cache&&(cache={});
}};return assetManager.setStrategies(strategies),assetManager};return assetManagerFactory}),define("taoItems/runner/api/itemRunner",["jquery","lodash","core/eventifier","taoItems/assets/manager"],function($,_,eventifier,assetManagerFactory){"use strict";var itemRunnerFactory=function itemRunnerFactory(providerName,data,options){var provider,providers,assetManager,flow={init:{done:!1,pending:[]},render:{done:!1,pending:[]}};if(_.isPlainObject(providerName)&&(data=providerName,providerName=void 0),data=data||{},options=options||{},providers=itemRunnerFactory.providers,!providers||0===_.size(providers))throw new Error("No provider regitered");if(_.isString(providerName)&&providerName.length>0?provider=providers[providerName]:1===_.size(providers)&&(providerName=_.keys(providers)[0],
provider=providers[providerName]),!provider)throw new Error("No candidate found for the provider");return assetManager=options.assetManager||assetManagerFactory(function(url){return url.toString()}),eventifier({container:null,assetManager:assetManager,options:options,init:function(newData){var self=this,initDone=function(){flow.init.done===!1&&(flow.init.done=!0,_.forEach(flow.init.pending,function(pendingTask){_.isFunction(pendingTask)&&pendingTask.call(self)}),flow.init.pending=[]),self.trigger("init")};return newData&&(data=_.merge(data,newData)),_.isFunction(provider.init)?provider.init.call(this,data,initDone):initDone(),this},assets:function(strategies,data,options){
try{this.assetManager=assetManagerFactory(strategies,data,options)}catch(err){this.trigger("error","Something was wrong while configuring the asset manager : "+err)}return this},render:function(elt,options){var self=this,renderDone=function(){flow.render.done===!1&&(flow.render.done=!0,_.forEach(flow.render.pending,function(pendingTask){_.isFunction(pendingTask)&&pendingTask.call(self)}),flow.render.pending=[]),self.trigger("render"),self.trigger("ready")};return options=_.defaults(options||{},{state:{}}),elt instanceof HTMLElement||elt instanceof $?(options.state&&this.setState(options.state),flow.init.done===!1?flow.init.pending.push(function(){this.render(elt,options);
}):(elt instanceof $?this.container=elt.get(0):this.container=elt,_.isFunction(provider.render)?provider.render.call(this,this.container,renderDone,options):renderDone()),this):self.trigger("error","A valid HTMLElement (or a jquery element) at least is required to render the item")},clear:function(){var self=this,clearDone=function(){self.trigger("clear")};return _.isFunction(provider.clear)?provider.clear.call(this,this.container,clearDone):clearDone(),this},getState:function(){var state=null;return _.isFunction(provider.getState)&&(state=provider.getState.call(this)),state},setState:function(state){return _.isPlainObject(state)?(flow.render.done===!1?flow.render.pending.push(function(){
this.setState(state)}):_.isFunction(provider.setState)&&provider.setState.call(this,state),this):this.trigger("error","The item's state must be a JavaScript Plain Object: "+typeof state+" given")},getResponses:function(){var responses={};return _.isFunction(provider.getResponses)&&(responses=provider.getResponses.call(this)),responses},renderFeedbacks:function(feedbacks,itemSession,done){_.isFunction(provider.renderFeedbacks)&&provider.renderFeedbacks.call(this,feedbacks,itemSession,done)}})};return itemRunnerFactory.register=function(name,provider){if(!_.isString(name)||name.length<=0)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init)&&!_.isFunction(provider.render))throw new TypeError("A provider is an object that contains at least an init function or a render function.");
this.providers=this.providers||{},this.providers[name]=provider},itemRunnerFactory}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",
rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",
endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",
inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",
feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction",infoControl:"taoQtiItem/qtiItem/core/PortableInfoControl",include:"taoQtiItem/qtiItem/core/Include",table:"taoQtiItem/qtiItem/core/Table",printedVariable:"taoQtiItem/qtiItem/core/PrintedVariable",_tooltip:"taoQtiItem/qtiItem/core/Tooltip"}}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(_){"use strict";var util={buildSerial:function(prefix){for(var id=prefix||"",chars="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<22;i++)id+=chars.charAt(Math.floor(Math.random()*chars.length));
return id},buildId:function(item,prefix){var id,usedIds,i=1,suffix="",exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIds();do exists=!1,id=prefix+suffix,_.contains(usedIds,id)&&(exists=!0,suffix="_"+i,i++);while(exists);return id},buildIdentifier:function(item,prefix,useSuffix){var id,usedIds,suffix="",i=1,exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");if(!prefix)throw new TypeError("Prefix is required to build an identifier");usedIds=item.getUsedIdentifiers(),useSuffix=!!_.isUndefined(useSuffix)||useSuffix,prefix&&(prefix=prefix.replace(/_[0-9]+$/gi,"_").replace(/[^a-zA-Z0-9_]/gi,"_").replace(/(_)+/gi,"_"),
useSuffix&&(suffix="_"+i));do exists=!1,id=prefix+suffix,usedIds[id]&&(exists=!0,suffix="_"+i,i++);while(exists);return id},findInCollection:function(element,collectionNames,searchedSerial){var found=null;if(_.isString(collectionNames)&&(collectionNames=[collectionNames]),!_.isArray(collectionNames))throw new Error("invalid argument : collectionNames must be an array or a string");return _.each(collectionNames,function(collectionName){var collection=element;_.each(collectionName.split("."),function(nameToken){collection=collection[nameToken]});var elt=collection[searchedSerial];return elt?(found={parent:element,element:elt},!1):(_.each(collection,function(elt){
if(_.isFunction(elt.find)&&(found=elt.find(searchedSerial)))return!1}),!found&&void 0)}),found},addMarkupNamespace:function(markup,ns){return ns?markup=markup.replace(/<(\/)?([a-z:]+)(\s?)([^><]*)>/g,function($0,$1,$2,$3,$4){return $2.indexOf(":")>0?$0:($1=$1||"",$3=$3||"","<"+$1+ns+":"+$2+$3+$4+">")}):markup},removeMarkupNamespaces:function(markup){return markup.replace(/<(\/)?(\w*):([^>]*)>/g,"<$1$3>")},getMarkupUsedNamespaces:function(markup){var namespaces=[];return markup.replace(/<(\/)?(\w*):([^>]*)>/g,function(original,slash,ns,node){return namespaces.push(ns),"<"+slash+node+">"}),_.uniq(namespaces)}};return util}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(_,$){
var rendererConfigHelper={};return rendererConfigHelper.getOptionsFromArguments=function(args){var options={data:{},placeholder:null,subclass:"",renderer:null};return _.each(args,function(arg){arg&&(arg.isRenderer?options.renderer=arg:arg instanceof $&&arg.length?options.placeholder=arg:_.isString(arg)?options.subclass=arg:_.isPlainObject(arg)?options.data=arg:console.log("invalid arg",arg,args))}),options},rendererConfigHelper}),define("taoQtiItem/qtiItem/core/Element",["jquery","lodash","class","core/logger","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Class,loggerFactory,util,rendererConfig){"use strict";var _instances={},logger=loggerFactory("taoQtiItem/qtiItem/core/Element"),Element=Class.extend({
qtiClass:"",serial:"",rootElement:null,init:function(serial,attributes){if(this.attributes={},this.metaData={},"object"==typeof serial&&(attributes=serial,serial=""),serial||(serial=util.buildSerial(this.qtiClass+"_")),serial&&("string"!=typeof serial||!serial.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof serial+") "+serial;if(_instances[serial])throw"a QTI Element with the same serial already exists "+serial;_instances[serial]=this,this.serial=serial,this.setAttributes(attributes||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function(qtiClass){return qtiClass===this.qtiClass;
},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var usedIds={},elts=this.getComposingElements();for(var i in elts){var elt=elts[i],id=elt.attr("identifier");id&&(usedIds[id]=elt)}return usedIds},getUsedIds:function(){var usedIds=[];return _.forEach(this.getComposingElements(),function(elt){var id=elt.attr("id");id&&!_.contains(usedIds,id)&&usedIds.push(id)}),usedIds},attr:function(name,value){if(name)if(void 0!==value)this.attributes[name]=value;else if("object"==typeof name)for(var prop in name)this.attr(prop,name[prop]);else if("string"==typeof name)return void 0===this.attributes[name]?void 0:this.attributes[name];
return this},data:function(name,value){if(name)if(void 0!==value)this.metaData[name]=value,$(document).trigger("metaChange.qti-widget",{element:this,key:name,value:value});else if("object"==typeof name)for(var prop in name)this.data(prop,name[prop]);else if("string"==typeof name)return void 0===this.metaData[name]?void 0:this.metaData[name];return this},removeData:function(name){return delete this.metaData[name],this},removeAttr:function(name){return this.removeAttributes(name)},setAttributes:function(attributes){return _.isPlainObject(attributes)||logger.warn("attributes should be a plain object"),this.attributes=attributes,this},getAttributes:function(){return _.clone(this.attributes);
},removeAttributes:function(attrNames){"string"==typeof attrNames&&(attrNames=[attrNames]);for(var i in attrNames)delete this.attributes[attrNames[i]];return this},getComposingElements:function(){function append(element){elts[element.getSerial()]=element,elts=_.extend(elts,element.getComposingElements())}var elts={};return"function"==typeof this.initContainer&&append(this.getBody()),"function"==typeof this.initObject&&append(this.getObject()),_.each(this.metaData,function(v){Element.isA(v,"_container")?append(v):_.isArray(v)&&_.each(v,function(v){Element.isA(v,"_container")&&append(v)})}),elts},getUsedClasses:function(){var ret=[this.qtiClass],composingElts=this.getComposingElements();
return _.each(composingElts,function(elt){ret.push(elt.qtiClass)}),_.uniq(ret)},find:function(serial){var object,body,found=null;return"function"==typeof this.initObject&&(object=this.getObject(),object.serial===serial&&(found={parent:this,element:object,location:"object"})),found||"function"!=typeof this.initContainer||(body=this.getBody(),found=body.serial===serial?{parent:this,element:body,location:"body"}:this.getBody().find(serial,this)),found},parent:function(){var item=this.getRootElement();if(item){var found=item.find(this.getSerial());if(found)return found.parent}return null},setRelatedItem:function(item){logger.warn("Deprecated use of setRelatedItem()"),
this.setRootElement(item)},setRootElement:function(item){var composingElts,i;if(Element.isA(item,"assessmentItem")){this.rootElement=item,composingElts=this.getComposingElements();for(i in composingElts)composingElts[i].setRootElement(item)}},getRelatedItem:function(){return logger.warn("Deprecated use of getRelatedItem()"),this.getRootElement()},getRootElement:function(){var ret=null;return Element.isA(this.rootElement,"assessmentItem")&&(ret=this.rootElement),ret},setRenderer:function(renderer){if(!renderer||!renderer.isRenderer)throw"invalid qti rendering engine";this.renderer=renderer;var elts=this.getComposingElements();for(var serial in elts)elts[serial].setRenderer(renderer);
},getRenderer:function(){return this.renderer},render:function(){var rendering,args=rendererConfig.getOptionsFromArguments(arguments),_renderer=args.renderer||this.getRenderer(),tplData={},defaultData={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!_renderer)throw new Error("render: no renderer found for the element "+this.qtiClass+":"+this.serial);return"function"==typeof this.initContainer&&(defaultData.body=this.getBody().render(args.renderer)),"function"==typeof this.initObject&&(defaultData.object={attributes:this.object.getAttributes()},defaultData.object.attributes.data=_renderer.resolveUrl(this.object.attr("data"))),tplData=_.merge(defaultData,args.data||{}),
tplData=_renderer.getData(this,tplData,args.subclass),rendering=_renderer.renderTpl(this,tplData,args.subclass),args.placeholder&&args.placeholder.replaceWith(rendering),rendering},postRender:function(data,altClassName,renderer){var postRenderers=[],_renderer=renderer||this.getRenderer();if("function"==typeof this.initContainer&&(postRenderers=this.getBody().postRender(data,"",renderer)),!_renderer)throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial;return postRenderers.push(_renderer.postRender(this,data,altClassName)),_.compact(postRenderers)},getContainer:function($scope,subclass){var renderer=this.getRenderer();if(renderer)return renderer.getContainer(this,$scope,subclass);
throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var arr={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(arr.body=this.getBody().toArray()),"function"==typeof this.initObject&&(arr.object=this.object.toArray()),arr},isEmpty:function(){return!1},addClass:function(className){var clazz=this.attr("class")||"";_containClass(clazz,className)||this.attr("class",clazz+(clazz.length?" ":"")+className)},hasClass:function(className){return _containClass(this.attr("class"),className)},removeClass:function(className){var clazz=this.attr("class")||"";
if(clazz){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)");clazz=clazz.replace(regex," ").trim(),clazz?this.attr("class",clazz):this.removeAttr("class")}},toggleClass:function(className,state){return"boolean"==typeof state?state?this.addClass(className):this.removeClass(className):this.hasClass(className)?this.removeClass(className):this.addClass(className)},isset:function(){return Element.issetElement(this.serial)},unset:function(){return Element.unsetElement(this.serial)}}),_containClass=function(allClassStr,className){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)","");return allClassStr&&regex.test(allClassStr)};return Element.isA=function(qtiElement,qtiClass){
return qtiElement instanceof Element&&qtiElement.is(qtiClass)},Element.getElementBySerial=function(serial){return _instances[serial]},Element.issetElement=function(serial){return!!_instances[serial]},Element.unsetElement=function(serial){var element=Element.getElementBySerial(serial);if(element){var composingElements=element.getComposingElements();return _.each(composingElements,function(elt){delete _instances[elt.serial]}),delete _instances[element.serial],!0}return!1},Element}),define("taoQtiItem/qtiItem/helper/xmlNsHandler",[],function(){"use strict";function getPrefix(namespaces,html5Ns){var key;for(key in namespaces)if(namespaces[key]===html5Ns)return key;
return"qh5"}var prefixed="article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section";return{stripNs:function(body){var pattern="([\\w]+)\\:("+prefixed+")",openRegEx=new RegExp("(<"+pattern+")","gi"),closeRegEx=new RegExp("(<\\/"+pattern+">)","gi");return body.replace(openRegEx,"<$3").replace(closeRegEx,"</$3>")},restoreNs:function(xml,namespaces){var tagMatch,xmlRe=new RegExp("(<("+prefixed+")[^>]*>|<\\/("+prefixed+")>)","gi"),tagRe=new RegExp("((<)("+prefixed+")([^>]*)(>)|(<\\/)("+prefixed+")(>))","i"),xmlMatch=xml.match(xmlRe),imsXsd="http://www.imsglobal.org/xsd",html5Ns=imsXsd+"/imsqtiv2p2_html5_v1p0",prefix=getPrefix(namespaces,html5Ns),prefixAtt="xmlns:"+prefix+'="'+html5Ns+'"',i=xmlMatch?xmlMatch.length:0;
if(!xmlMatch)return xml;for(;i--;)tagMatch=xmlMatch[i].match(tagRe),xml=xml.replace(xmlMatch[i],tagMatch[5]?"<"+prefix+":"+tagMatch[3]+tagMatch[4]+">":"</"+prefix+":"+tagMatch[7]+">");return xmlMatch.length&&xml.indexOf(prefixAtt)===-1&&(xml=xml.replace("<assessmentItem","<assessmentItem "+prefixAtt)),xml=xml.replace('xmlns="'+imsXsd+'/imsqti_v2p1"','xmlns="'+imsXsd+'/imsqti_v2p2"'),xml=xml.replace('xsi:schemaLocation="'+imsXsd+'/imsqti_v2p1 imsqti_v2p1.xsd"','xsi:schemaLocation="'+imsXsd+"/imsqti_v2p2 "+imsXsd+'/qti/qtiv2p2/imsqti_v2p2.xsd"')}}}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/xmlNsHandler"],function(_,Class,qtiClasses,Element,xmlNsHandler){
"use strict";function loadPortableCustomElementData(portableElement,data){portableElement.typeIdentifier=data.typeIdentifier,portableElement.markup=data.markup,portableElement.entryPoint=data.entryPoint,portableElement.libraries=data.libraries,portableElement.setNamespace("",data.xmlns),loadPortableCustomElementProperties(portableElement,data.properties)}function loadPortableCustomElementProperties(portableElement,rawProperties){var properties={};_.forOwn(rawProperties,function(value,key){try{properties[key]=JSON.parse(value)}catch(e){properties[key]=value}}),portableElement.properties=properties}var Loader=Class.extend({init:function(item,classesLocation){this.qti={},
this.classesLocation={},this.item=item||null,this.setClassesLocation(classesLocation||qtiClasses)},setClassesLocation:function(qtiClasses){return _.extend(this.classesLocation,qtiClasses),this},getRequiredClasses:function(data){var i,ret=[];for(i in data)"qtiClass"===i&&"_container"!==data[i]&&"rootElement"!==i?ret.push(data[i]):"object"==typeof data[i]&&"responseRules"!==i&&(ret=_.union(ret,this.getRequiredClasses(data[i])));return ret},loadRequiredClasses:function(data,callback,reload){var i,requiredClass,requiredClasses=this.getRequiredClasses(data,reload),required=[];for(i in requiredClasses){if(requiredClass=requiredClasses[i],!this.classesLocation[requiredClass])throw new Error("missing qti class location declaration : "+requiredClass);
required.push(this.classesLocation[requiredClass])}var _this=this;require(required,function(){_.each(arguments,function(QtiClass){_this.qti[QtiClass.prototype.qtiClass]=QtiClass}),callback.call(_this,_this.qti)})},getLoadedClasses:function(){return _.keys(this.qti)},loadItemData:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var i;if("object"==typeof data&&"assessmentItem"===data.qtiClass){data.serial&&Element.unsetElement(data.serial),_this.item=new Qti.assessmentItem(data.serial,data.attributes||{}),_this.loadContainer(_this.item.getBody(),data.body);for(i in data.outcomes){var outcome=_this.buildOutcome(data.outcomes[i]);
outcome&&_this.item.addOutcomeDeclaration(outcome)}for(i in data.feedbacks){var feedback=_this.buildElement(data.feedbacks[i]);feedback&&_this.item.addModalFeedback(feedback)}for(i in data.stylesheets){var stylesheet=_this.buildElement(data.stylesheets[i]);stylesheet&&_this.item.addStylesheet(stylesheet)}for(i in data.responses){var response=_this.buildResponse(data.responses[i]);if(response){_this.item.addResponseDeclaration(response);var feedbackRules=data.responses[i].feedbackRules;feedbackRules&&_.forIn(feedbackRules,function(fbData,serial){response.feedbackRules[serial]=_this.buildSimpleFeedbackRule(fbData,response)})}}data.responseProcessing&&_this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing)),
_this.item.setNamespaces(data.namespaces),_this.item.setSchemaLocations(data.schemaLocations),_this.item.setApipAccessibility(data.apipAccessibility)}"function"==typeof callback&&callback.call(_this,_this.item)})},loadAndBuildElement:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var element=_this.buildElement(data);"function"==typeof callback&&callback.call(_this,element)})},loadElement:function(element,data,callback){var _this=this;this.loadRequiredClasses(data,function(){_this.loadElementData(element,data),"function"==typeof callback&&callback.call(_this,element)})},loadElements:function(data,callback){var _this=this;if(!_this.item)throw"QtiLoader : cannot load elements in empty item";
this.loadRequiredClasses(data,function(){var allElements=_this.item.getComposingElements();for(var i in data){var elementData=data[i];elementData&&elementData.qtiClass&&elementData.serial&&allElements[elementData.serial]&&_this.loadElementData(allElements[elementData.serial],elementData)}"function"==typeof callback&&callback.call(_this,_this.item)})},buildResponse:function(data){var response=this.buildElement(data);return response.template=data.howMatch||null,response.defaultValue=data.defaultValue||null,response.correctResponse=data.correctResponses||null,_.size(data.mapping)?response.mapEntries=data.mapping:_.size(data.areaMapping)?response.mapEntries=data.areaMapping:response.mapEntries={},
response.mappingAttributes=data.mappingAttributes||{},response},buildSimpleFeedbackRule:function(data,response){var feedbackRule=this.buildElement(data);feedbackRule.setCondition(response,data.condition,data.comparedValue||null),feedbackRule.feedbackOutcome=this.item.outcomes[data.feedbackOutcome]||null,feedbackRule.feedbackThen=this.item.modalFeedbacks[data.feedbackThen]||null,feedbackRule.feedbackElse=this.item.modalFeedbacks[data.feedbackElse]||null;var response=feedbackRule.comparedOutcome;return feedbackRule.feedbackThen&&feedbackRule.feedbackThen.data("relatedResponse",response),feedbackRule.feedbackElse&&feedbackRule.feedbackElse.data("relatedResponse",response),
feedbackRule},buildOutcome:function(data){var outcome=this.buildElement(data);return outcome.defaultValue=data.defaultValue||null,outcome},buildResponseProcessing:function(data){var rp=this.buildElement(data);return data&&data.processingType&&("custom"===data.processingType?(rp.xml=data.data,rp.processingType="custom"):rp.processingType="templateDriven"),rp},loadContainer:function(bodyObject,bodyData){if(!Element.isA(bodyObject,"_container"))throw"bodyObject must be a QTI Container";if(!bodyData||"string"!=typeof bodyData.body||"array"!=typeof bodyData.elements&&"object"!=typeof bodyData.elements)throw"wrong bodydata format";for(var serial in bodyData.elements){
var eltData=bodyData.elements[serial],element=this.buildElement(eltData);element&&bodyObject.setElement(element,bodyData.body)}bodyObject.body(xmlNsHandler.stripNs(bodyData.body))},buildElement:function(elementData){var elt=null;if(!(elementData&&elementData.qtiClass&&elementData.serial))throw"wrong elementData format";var className=elementData.qtiClass;if(!this.qti[className])throw"the qti element class does not exist: "+className;return elt=new this.qti[className](elementData.serial),this.loadElementData(elt,elementData),elt},loadElementData:function(element,data){var attributes=_.defaults(data.attributes||{},element.attributes||{});return element.setAttributes(attributes),
element.body&&data.body&&element.bdy&&this.loadContainer(element.getBody(),data.body),element.object&&data.object&&element.object&&this.loadObjectData(element.object,data.object),Element.isA(element,"interaction")?this.loadInteractionData(element,data):Element.isA(element,"choice")?this.loadChoiceData(element,data):Element.isA(element,"math")?this.loadMathData(element,data):Element.isA(element,"infoControl")?this.loadPicData(element,data):Element.isA(element,"_tooltip")&&this.loadTooltipData(element,data),element},loadInteractionData:function(interaction,data){Element.isA(interaction,"blockInteraction")&&data.prompt&&this.loadContainer(interaction.prompt.getBody(),data.prompt),
this.buildInteractionChoices(interaction,data),Element.isA(interaction,"customInteraction")&&this.loadPciData(interaction,data)},buildInteractionChoices:function(interaction,data){if(data.choices){if(Element.isA(interaction,"matchInteraction"))for(var set=0;set<2;set++){if(!data.choices[set])throw"missing match set #"+set;var matchSet=data.choices[set];for(var serial in matchSet){var choice=this.buildElement(matchSet[serial]);choice&&interaction.addChoice(choice,set)}}else for(var serial in data.choices){var choice=this.buildElement(data.choices[serial]);choice&&interaction.addChoice(choice)}if(Element.isA(interaction,"graphicGapMatchInteraction")&&data.gapImgs)for(var serial in data.gapImgs){
var gapImg=this.buildElement(data.gapImgs[serial]);gapImg&&interaction.addGapImg(gapImg)}}},loadChoiceData:function(choice,data){Element.isA(choice,"textVariableChoice")?choice.val(data.text):Element.isA(choice,"gapImg")||(Element.isA(choice,"gapText")?choice.body()||choice.body(data.text):Element.isA(choice,"containerChoice"))},loadObjectData:function(object,data){object.setAttributes(data.attributes),data._alt&&("object"===data._alt.qtiClass?object._alt=Loader.buildElement(data._alt):object._alt=data._alt)},loadMathData:function(math,data){math.ns=data.ns||{},math.setMathML(data.mathML||""),_.forIn(data.annotations||{},function(value,encoding){math.setAnnotation(encoding,value);
})},loadTooltipData:function(tooltip,data){tooltip.content(data.content)},loadPciData:function(pci,data){loadPortableCustomElementData(pci,data)},loadPicData:function(pic,data){loadPortableCustomElementData(pic,data)}});return Loader}),define("taoQtiItem/portableElementRegistry/factory/factory",["lodash","core/promise","core/eventifier"],function(_,Promise,eventifier){"use strict";var _requirejs=window.require,_defaultLoadingOptions={reload:!1},loadModuleConfig=function(manifest){return new Promise(function(resolve,reject){var baseUrl,requireConfigAliases={},reqConfigs=[],modules={};return manifest&&manifest.runtime?(baseUrl=manifest.baseUrl,_.isArray(manifest.runtime.config)&&manifest.runtime.config.length&&_.forEach(manifest.runtime.config,function(pciConfig){
_.isString(pciConfig)?reqConfigs.push("json!"+baseUrl+"/"+pciConfig):pciConfig.data?modules=_.defaults(modules,pciConfig.data.paths||{}):pciConfig.file&&reqConfigs.push("json!"+baseUrl+"/"+pciConfig.file)}),void require(reqConfigs,function(){var runtimeModules={};requireConfigAliases[manifest.typeIdentifier]=baseUrl,"IMSPCI"===manifest.model&&(modules=_.reduce(arguments,function(acc,conf){return _.defaults(acc,conf.paths||{})},modules),_.forEach(manifest.runtime.modules||{},function(paths,id){paths&&(_.isString(paths)||_.isArray(paths)&&paths.length)&&(runtimeModules[id]=paths)}),modules=_.merge(modules,runtimeModules),_.forEach(modules,function(paths,id){paths=_.isArray(paths)?paths:[paths],
requireConfigAliases[id]=_.map(paths,function(path){return baseUrl+"/"+path.replace(/\.js$/,"")})})),resolve(requireConfigAliases)},reject)):reject("invalid manifest")})},isPortableElementProvider=function(provider){return provider&&_.isFunction(provider.load)};return function(methods){var _loaded=!1,__providers={};return eventifier(_.defaults(methods||{},{_registry:{},get:function(typeIdentifier,version){if(this._registry[typeIdentifier])return version?_.find(this._registry[typeIdentifier],{version:version}):_.last(this._registry[typeIdentifier])},registerProvider:function(moduleName,provider){return __providers[moduleName]=isPortableElementProvider(provider)?provider:null,
_loaded=!1,this},resetProviders:function(){return __providers={},_loaded=!1,this},loadProviders:function(options){var loadPromise,self=this;return loadPromise=_loaded&&!options.reload?Promise.resolve([]):new Promise(function(resolve,reject){var providerLoadingStack=[];_.forIn(__providers,function(provider,id){null===provider&&providerLoadingStack.push(id)}),_requirejs(providerLoadingStack,function(){_.each([].slice.call(arguments),function(provider){isPortableElementProvider(provider)&&(__providers[providerLoadingStack.shift()]=provider)}),resolve(__providers),_loaded=!0,self.trigger("providersloaded",__providers)},reject)})},getAllVersions:function(){var all={};
return _.forIn(this._registry,function(versions,id){all[id]=_.map(versions,"version")}),all},getRuntime:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement?_.assign(portableElement.runtime,{id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,model:portableElement.model}):void this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})},getCreator:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&portableElement.creator?_.assign(portableElement.creator,{
id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,response:portableElement.response,model:portableElement.model,xmlns:portableElement.xmlns}):void this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})},getLatestCreators:function(){var all={};return _.forIn(this._registry,function(versions,id){var lastVersion=_.last(versions);lastVersion.creator&&lastVersion.creator.hook&&lastVersion.enabled&&(all[id]=lastVersion)}),all},getBaseUrl:function(typeIdentifier,version){var runtime=this.get(typeIdentifier,version);return runtime?runtime.baseUrl:""},loadRuntimes:function(options){
var loadPromise,self=this;return options=_.defaults(options||{},_defaultLoadingOptions),loadPromise=self.loadProviders(options).then(function(providers){var loadStack=[];return _.forEach(providers,function(provider){provider&&loadStack.push(provider.load())}),Promise.all(loadStack).then(function(results){var configLoadingStack=[];return self._registry=_.reduce(results,function(acc,_pcis){return _.merge(acc,_pcis)},self._registry||{}),_.forIn(self._registry,function(versions,typeIdentifier){return!!(_.isArray(options.include)&&_.indexOf(options.include,typeIdentifier)<0)||void configLoadingStack.push(loadModuleConfig(self.get(typeIdentifier)))}),Promise.all(configLoadingStack).then(function(moduleConfigs){
var requireConfigAliases=_.reduce(moduleConfigs,function(acc,paths){return _.merge(acc,paths)},{});_requirejs.config({paths:requireConfigAliases})})})}),loadPromise.then(function(){self.trigger("runtimesloaded")}).catch(function(err){self.trigger("error",err)}),loadPromise},loadCreators:function(options){var loadPromise,self=this;return options=_.defaults(options||{},_defaultLoadingOptions),loadPromise=self.loadRuntimes(options).then(function(){var requiredCreatorHooks=[];return _.forIn(self._registry,function(versions,typeIdentifier){var portableElementModel=self.get(typeIdentifier);if(portableElementModel.creator&&portableElementModel.creator.hook){if(portableElementModel.enabled){
if(_.isArray(options.include)&&_.indexOf(options.include,typeIdentifier)<0)return!0}else if(!_.isArray(options.include)||_.indexOf(options.include,typeIdentifier)<0)return!0;requiredCreatorHooks.push(portableElementModel.creator.hook.replace(/\.js$/,""))}}),requiredCreatorHooks.length?new Promise(function(resolve,reject){_requirejs(requiredCreatorHooks,function(){var creators={};_.each(arguments,function(creatorHook){var id=creatorHook.getTypeIdentifier(),portableElementModel=self.get(id),i=_.findIndex(self._registry[id],{version:portableElementModel.version});i<0?self.trigger("error","no creator found for id/version "+id+"/"+portableElementModel.version):(self._registry[id][i].creator.module=creatorHook,
creators[id]=creatorHook)}),resolve(creators)},reject)}):Promise.resolve({})}),loadPromise.then(function(creators){return self.trigger("creatorsloaded",creators),creators}).catch(function(err){self.trigger("error",err)}),loadPromise},enable:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!0),this},disable:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!1),this},isEnabled:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&portableElement.enabled===!0;
}}))}}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash","i18n"],function($,_,__){"use strict";var QtiElements={};return QtiElements.classes={itemBody:{parents:["bodyElement"],contains:["block"],abstract:!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],abstract:!0},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],abstract:!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},flowStatic:{parents:["flow"],abstract:!0},blockStatic:{
parents:["block"],abstract:!0},inlineStatic:{parents:["inline"],abstract:!0},flow:{parents:["objectFlow"],abstract:!0},tableCell:{parents:["bodyElement"],contains:["flow"],abstract:!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:["flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],
xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0
},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0
},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},var:{parents:["simpleInline"],xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],
xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{parents:["simpleInline","feedbackElement"],qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],
contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],contains:["blockStatic"],qti:!0},templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],
qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{
parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},endAttemptInteraction:{parents:["inlineInteraction"],qti:!0},customInteraction:{parents:["block","flow","interaction"],qti:!0},_container:{parents:["block"],qti:!0}},QtiElements.cache={containable:{},children:{},parents:{}},QtiElements.getAllowedContainersElements=function(qtiClass,$container){var classes=QtiElements.getAllowedContainers(qtiClass),jqSelector="";for(var i in classes)classes[i].qti||(jqSelector+=classes[i]+", ");
return jqSelector&&(jqSelector=jqSelector.substring(0,jqSelector.length-2)),$(jqSelector,$container?$container:$(document)).filter(":not([data-qti-type])")},QtiElements.getAllowedContainers=function(qtiClass){var ret;if(QtiElements.cache.containable[qtiClass])ret=QtiElements.cache.containable[qtiClass];else{ret=[];var parents=QtiElements.getParentClasses(qtiClass,!0);for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];if(model.contains){var intersect=_.intersection(model.contains,parents);intersect.length&&(model.abstract||ret.push(aClass),ret=_.union(ret,QtiElements.getChildClasses(aClass,!0)))}}QtiElements.cache.containable[qtiClass]=ret;
}return ret},QtiElements.getAllowedContents=function(qtiClass,recursive,checked){var ret=[];checked=checked||{};var model=QtiElements.classes[qtiClass];if(model&&model.contains)for(var i in model.contains){var contain=model.contains[i];if(!checked[contain]){checked[contain]=!0,ret.push(contain);var children=QtiElements.getChildClasses(contain,!0);for(var i in children){var child=children[i];checked[child]||(checked[child]=!0,ret.push(child),recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(child,!0,checked))))}recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(contain,!0,checked)))}}var parents=QtiElements.getParentClasses(qtiClass,!0);for(var i in parents)ret=_.union(ret,QtiElements.getAllowedContents(parents[i],recursive,checked));
return _.uniq(ret,!1)},QtiElements.isAllowedClass=function(qtiContainerClass,qtiContentClass){var allowedClasses=QtiElements.getAllowedContents(qtiContainerClass);return _.indexOf(allowedClasses,qtiContentClass)>=0},QtiElements.getParentClasses=function(qtiClass,recursive){var ret;if(recursive&&QtiElements.cache.parents[qtiClass])ret=QtiElements.cache.parents[qtiClass];else{if(ret=[],QtiElements.classes[qtiClass]&&(ret=QtiElements.classes[qtiClass].parents,recursive)){for(var i in ret)ret=_.union(ret,QtiElements.getParentClasses(ret[i],recursive));ret=_.uniq(ret,!1)}QtiElements.cache.parents[qtiClass]=ret}return ret},QtiElements.getChildClasses=function(qtiClass,recursive,type){
var ret,cacheType=type?type:"all";if(recursive&&QtiElements.cache.children[qtiClass]&&QtiElements.cache.children[qtiClass][cacheType])ret=QtiElements.cache.children[qtiClass][cacheType];else{ret=[];for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];_.indexOf(model.parents,qtiClass)>=0&&(type?model[type]&&ret.push(aClass):ret.push(aClass),recursive&&(ret=_.union(ret,QtiElements.getChildClasses(aClass,recursive,type))))}QtiElements.cache.children[qtiClass]||(QtiElements.cache.children[qtiClass]={}),QtiElements.cache.children[qtiClass][cacheType]=ret}return ret},QtiElements.isBlock=function(qtiClass){return QtiElements.is(qtiClass,"block");
},QtiElements.isInline=function(qtiClass){return QtiElements.is(qtiClass,"inline")},QtiElements.is=function(qtiClass,topClass){if(qtiClass===topClass)return!0;var parents=QtiElements.getParentClasses(qtiClass,!0);return _.indexOf(parents,topClass)>=0},QtiElements.getAvailableAuthoringElements=function(){return{choiceInteraction:{label:__("Choice Interaction"),description:__("Select a single (radio buttons) or multiple (check boxes) responses among a set of choices."),icon:"icon-choice",short:__("Choice"),qtiClass:"choiceInteraction",tags:["Common Interactions","mcq"]},orderInteraction:{label:__("Order Interaction"),icon:"icon-order",description:__("Arrange a list of choices in the correct order."),
short:__("Order"),qtiClass:"orderInteraction",tags:["Common Interactions","ordering"]},associateInteraction:{label:__("Associate Interaction"),icon:"icon-associate",description:__("Create pair(s) from a series of choices."),short:__("Associate"),qtiClass:"associateInteraction",tags:["Common Interactions","association"]},matchInteraction:{label:__("Match Interaction"),icon:"icon-match",description:__("Create association(s) between two sets of choices displayed in a table (row and column)."),short:__("Match"),qtiClass:"matchInteraction",tags:["Common Interactions","association"]},hottextInteraction:{label:__("Hottext Interaction"),icon:"icon-hottext",description:__("Select one or more text parts (hottext) within a text."),
short:__("Hottext"),qtiClass:"hottextInteraction",tags:["Common Interactions","text"]},gapMatchInteraction:{label:__("Gap Match Interaction"),icon:"icon-gap-match",description:__(" Fill in the gaps in a text from a set of choices."),short:__("Gap Match"),qtiClass:"gapMatchInteraction",tags:["Common Interactions","text","association"]},sliderInteraction:{label:__("Slider Interaction"),icon:"icon-slider",description:__("Select a value within a numerical range."),short:__("Slider"),qtiClass:"sliderInteraction",tags:["Common Interactions","special"]},extendedTextInteraction:{label:__("Extended Text Interaction"),icon:"icon-extended-text",description:__("Collect open-ended information in one or more text area(s) (strings or numeric values)."),
short:__("Extended Text"),qtiClass:"extendedTextInteraction",tags:["Common Interactions","text"]},uploadInteraction:{label:__("File Upload Interaction"),icon:"icon-upload",description:__("Upload a file (e.g. document, picture...) as a response."),short:__("File Upload"),qtiClass:"uploadInteraction",tags:["Common Interactions","special"]},mediaInteraction:{label:__("Media Interaction"),icon:"icon-media",description:__("Control the playing parameters (auto-start, loop) of a video or audio file and report the number of time it has been played."),short:__("Media"),qtiClass:"mediaInteraction",tags:["Common Interactions","media"]},_container:{label:__("Text Block"),
icon:"icon-font",description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),short:__("Block"),qtiClass:"_container",tags:["Inline Interactions","text"]},inlineChoiceInteraction:{label:__("Inline Choice Interaction"),icon:"icon-inline-choice",description:__("Select a choice from a drop-down list."),short:__("Inline Choice"),qtiClass:"inlineChoiceInteraction",tags:["Inline Interactions","inline-interactions","mcq"]},textEntryInteraction:{label:__("Text Entry Interaction"),icon:"icon-text-entry",description:__("Collect open-ended information in a short text input (strings or numeric values)."),
short:__("Text Entry"),qtiClass:"textEntryInteraction",tags:["Inline Interactions","inline-interactions","text"]},endAttemptInteraction:{label:__("End Attempt Interaction"),icon:"icon-end-attempt",description:__("Trigger the end of the item attempt."),short:__("End Attempt"),qtiClass:"endAttemptInteraction",tags:["Inline Interactions","inline-interactions","button","submit"]},hotspotInteraction:{label:__("Hotspot Interaction"),icon:"icon-hotspot",description:__("Select one or more areas (hotspots) displayed on an picture."),short:__("Hotspot"),qtiClass:"hotspotInteraction",tags:["Graphic Interactions","mcq"]},graphicOrderInteraction:{label:__("Graphic Order Interaction"),
icon:"icon-graphic-order",description:__("Order the areas (hotspots) displayed on a picture."),short:__("Order"),qtiClass:"graphicOrderInteraction",tags:["Graphic Interactions","ordering"]},graphicAssociateInteraction:{label:__("Graphic Associate Interaction"),icon:"icon-graphic-associate",description:__("Create association(s) between areas (hotspots) displayed on a picture."),short:__("Associate"),qtiClass:"graphicAssociateInteraction",tags:["Graphic Interactions","association"]},graphicGapMatchInteraction:{label:__("Graphic Gap Match Interaction"),icon:"icon-graphic-gap",description:__("Fill in the gaps on a picture with a set of image choices."),short:__("Gap Match"),
qtiClass:"graphicGapMatchInteraction",tags:["Graphic Interactions","association"]},selectPointInteraction:{label:__("Select Point Interaction"),icon:"icon-select-point",description:__("Position one or more points on a picture (response areas are not displayed)."),short:__("Select Point"),qtiClass:"selectPointInteraction",tags:["Graphic Interactions"]}}},QtiElements}),define("taoQtiItem/portableElementRegistry/factory/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory","taoQtiItem/qtiCreator/helper/qtiElements"],function(_,portableElementRegistry,qtiElements){"use strict";return function(){return portableElementRegistry({getAuthoringData:function(typeIdentifier,options){
var pciModel;if(options=_.defaults(options||{},{version:0,enabledOnly:!1}),pciModel=this.get(typeIdentifier,options.version),pciModel&&pciModel.creator&&pciModel.creator.hook&&pciModel.creator.icon&&(pciModel.enabled||!options.enabledOnly))return{label:pciModel.label,icon:pciModel.creator.icon.replace(new RegExp("^"+typeIdentifier+"/"),pciModel.baseUrl),short:pciModel.short,description:pciModel.description,qtiClass:"customInteraction."+pciModel.typeIdentifier,tags:_.union(["Custom Interactions"],pciModel.tags)}}}).on("creatorsloaded",function(){var creators=this.getLatestCreators();_.forEach(creators,function(creator,typeIdentifier){qtiElements.classes["customInteraction."+typeIdentifier]={
parents:["customInteraction"],qti:!0}})})}}),define("taoQtiItem/portableElementRegistry/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/ciRegistry","module"],function(_,ciRegistry,module){"use strict";var registry=ciRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define("taoQtiItem/portableElementRegistry/factory/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory"],function(_,portableElementRegistry){"use strict";return function(){return portableElementRegistry();
}}),define("taoQtiItem/portableElementRegistry/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/icRegistry","module"],function(_,icRegistry,module){"use strict";var registry=icRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define("taoQtiItem/portableElementRegistry/provider/sideLoadingProviderFactory",[],function(){"use strict";return function(portableElements){var _registry=portableElements;return{add:function(id,portableElement){return _registry[id]=portableElement,
this},load:function(){return _registry}}}}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(_,Element){return{convertChoices:function(choices,outputType){var ret=[],_this=this;return _.each(choices,function(c){if(Element.isA(c,"choice"))switch(outputType){case"serial":ret.push(c.getSerial());break;case"identifier":ret.push(c.id());break;default:ret.push(c)}else _.isArray(c)&&ret.push(_this.convertChoices(c,outputType))}),ret},findChoices:function(interaction,choices,inputType){var ret=[],_this=this;return _.each(choices,function(c){var choice;_.isString(c)?"serial"===inputType?(choice=interaction.getChoice(c),
choice&&ret.push(choice)):"identifier"===inputType?(choice=interaction.getChoiceByIdentifier(c),choice&&ret.push(choice)):ret.push(c):_.isArray(c)?ret.push(_this.findChoices(interaction,c,inputType)):ret.push(c)}),ret},shuffleChoices:function(choices){var r=[],f={},j=0;for(var i in choices){if(!Element.isA(choices[i],"choice"))throw"invalid element in array: is not a qti choice";var choice=choices[i];choice.attr("fixed")&&(f[j]=choice),r.push(choice),j++}for(var n=0;n<r.length-1;n++)if(!f[n]){var k=-1;do k=n+Math.floor(Math.random()*(r.length-n));while(f[k]);var tmp=r[k];r[k]=r[n],r[n]=tmp}return r},serialToIdentifier:function(interaction,choiceSerial){var choice=interaction.getChoice(choiceSerial);
return choice?choice.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper","ui/themeLoader"],function(_,$,Handlebars,Promise,Element,interactionHelper,themeLoader){"use strict";function getDocumentBaseUrl(){return window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/([^\/]*)$/,"")}var _isValidRenderer=function(renderer){var valid=!0;if("object"!=typeof renderer)return!1;var classCorrect=!1;if(renderer.qtiClass)if(_.indexOf(_renderableClasses,renderer.qtiClass)>=0)classCorrect=!0;else{var pos=renderer.qtiClass.indexOf(".");
if(pos>0){var qtiClass=renderer.qtiClass.slice(0,pos),subClass=renderer.qtiClass.slice(pos+1);_renderableSubclasses[qtiClass]&&_.indexOf(_renderableSubclasses[qtiClass],subClass)>=0&&(classCorrect=!0)}}if(!classCorrect)throw valid=!1,new Error("invalid qti class name in renderer declaration : "+renderer.qtiClass);if(!renderer.template)throw valid=!1,new Error("missing template in renderer declaration : "+renderer.qtiClass);return valid},_renderableClasses=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","_tooltip","img","math","object","table","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","infoControl","include","printedVariable"],_dependencies={
assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:["_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},_renderableSubclasses={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]
},_defaults={shuffleChoices:!0},Renderer=function(options){function registerRendererClass(qtiClass,list){var success=!1;return _locations[qtiClass]===!1?(_renderers[qtiClass]=!1,success=!0):_locations[qtiClass]&&(list.push(_locations[qtiClass]),success=!0),success}var _locations={},_renderers={};options=_.defaults(options||{},_defaults),this.isRenderer=!0,this.name="",this.shuffledChoices=[];var _getClassRenderer=function(qtiClass){var ret=null;if(_renderers[qtiClass])ret=_renderers[qtiClass];else{var pos=qtiClass.indexOf(".");pos>0&&(qtiClass=qtiClass.slice(0,pos),_renderers[qtiClass]&&(ret=_renderers[qtiClass]))}return ret};this.setOption=function(key,value){
return"string"==typeof key&&(options[key]=value),this},this.setOptions=function(opts){return options=_.extend(options,opts),this},this.getOption=function(key){return"string"==typeof key&&options[key]?options[key]:null},this.getCustomMessage=function(elementName,messageKey){var messages=this.getOption("messages");return messages&&elementName&&messages[elementName]&&_.isString(messages[elementName][messageKey])?Handlebars.compile(messages[elementName][messageKey]):null},this.getAssetManager=function(){return options.assetManager},this.getThemeLoader=function(){return this.themeLoader},this.renderTpl=function(element,data,qtiSubclass){var res,ret="",qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass),decorators=this.getOption("decorators");
if(!renderer||!_.isFunction(renderer.template))throw new Error("no renderer template loaded under the class name : "+qtiClass);return _.isObject(decorators)&&_.isFunction(decorators.before)&&(res=decorators.before(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret+=renderer.template(data),_.isObject(decorators)&&_.isFunction(decorators.after)&&(res=decorators.after(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret},this.getData=function(element,data,qtiSubclass){var ret=data,qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.getData&&(ret=renderer.getData.call(this,element,data)),ret;
},this.renderDirect=function(tpl,data){return Handlebars.compile(tpl)(data)},this.getContainer=function(qtiElement,$scope,qtiSubclass){var ret=null,qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer found for the class : "+qtiElement.qtiClass;return ret=renderer.getContainer(qtiElement,$scope)},this.postRender=function(qtiElement,data,qtiSubclass){var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer&&"function"==typeof renderer.render)return renderer.render.call(this,qtiElement,data)},this.setResponse=function(qtiInteraction,response,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);
if(!renderer)throw"no renderer registered under the name : "+qtiClass;if("function"==typeof renderer.setResponse){ret=renderer.setResponse.call(this,qtiInteraction,response);var $container=renderer.getContainer.call(this,qtiInteraction);$container instanceof $&&$container.length&&$container.trigger("responseSet",[qtiInteraction,response])}return ret},this.getResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.getResponse&&(ret=renderer.getResponse.call(this,qtiInteraction)),
ret},this.resetResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.resetResponse&&(ret=renderer.resetResponse.call(this,qtiInteraction)),ret},this.getState=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return ret=_.isFunction(renderer.getState)?renderer.getState.call(this,qtiInteraction):renderer.getResponse.call(this,qtiInteraction);
},this.setState=function(qtiInteraction,state,qtiSubclass){var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;_.isFunction(renderer.setState)?renderer.setState.call(this,qtiInteraction,state):(renderer.resetResponse.call(this,qtiInteraction),renderer.setResponse.call(this,qtiInteraction,state))},this.destroy=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return _.isFunction(renderer.destroy)&&(ret=renderer.destroy.call(this,qtiInteraction)),
ret},this.getLoadedRenderers=function(){return _renderers},this.register=function(renderersLocations){_.extend(_locations,renderersLocations)},this.load=function(callback,requiredClasses){var self=this,required=[];if(options.themes&&(options.themes.base=this.resolveUrl(options.themes.base),_.forEach(options.themes.available,function(theme,index){options.themes.available[index].path=self.resolveUrl(theme.path)}),this.themeLoader=themeLoader(options.themes).load(options.preload)),requiredClasses){if(!_.isArray(requiredClasses))throw new Error('invalid argument type: expected array for arg "requireClasses"');requiredClasses=_.intersection(requiredClasses,_renderableClasses),
_.each(requiredClasses,function(reqClass){var deps=_dependencies[reqClass];deps&&(requiredClasses=_.union(requiredClasses,deps))}),_.forEach(requiredClasses,function(qtiClass){var requiredSubClasses;if(_renderableSubclasses[qtiClass])requiredSubClasses=_.intersection(requiredClasses,_renderableSubclasses[qtiClass]),_.each(requiredSubClasses,function(subclass){if(!registerRendererClass(qtiClass+"."+subclass,required)&&!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass+", subclass: "+subclass)});else if(!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass);
})}else required=_.values(_locations);return require(required,function(){_.each(arguments,function(clazz){_isValidRenderer(clazz)&&(_renderers[clazz.qtiClass]=clazz)}),"function"==typeof callback&&callback.call(self,_renderers)}),this},this.unload=function(){return this.themeLoader&&themeLoader(options.themes).unload(),this},this.setShuffledChoices=function(interaction,choices,identificationType){Element.isA(interaction,"interaction")&&(this.shuffledChoices[interaction.getSerial()]=_.pluck(interactionHelper.findChoices(interaction,choices,identificationType),"serial"))},this.getShuffledChoices=function(interaction,reshuffle,returnedType){var serial,i,choices=[];
if(Element.isA(interaction,"interaction")){if(serial=interaction.getSerial(),!this.shuffledChoices[serial]||reshuffle)if(Element.isA(interaction,"matchInteraction"))for(this.shuffledChoices[serial]=[],i=0;i<2;i++)choices[i]=interactionHelper.shuffleChoices(interaction.getChoices(i)),this.shuffledChoices[serial][i]=_.pluck(choices[i],"serial");else choices=interactionHelper.shuffleChoices(interaction.getChoices()),this.shuffledChoices[serial]=_.pluck(choices,"serial");else Element.isA(interaction,"matchInteraction")?_.forEach(choices,function(choice,index){index<2&&_.forEach(this.shuffledChoices[serial][i],function(choiceSerial){choice.push(interaction.getChoice(choiceSerial));
})}):_.forEach(this.shuffledChoices[serial],function(choiceSerial){choices.push(interaction.getChoice(choiceSerial))});return"serial"===returnedType||"identifier"===returnedType?interactionHelper.convertChoices(choices,returnedType):_.clone(choices)}return[]},this.getRenderers=function(){return _renderers},this.getLocations=function(){return _locations},this.resolveUrl=function(url){return options.assetManager?"string"==typeof url&&url.length>0?options.assetManager.resolve(url):void 0:url},this.getAbsoluteUrl=function(relUrl){if(console.warn("DEPRECATED used getAbsoluteUrl with ",arguments),this.getOption("userRelativeUrl"))return relUrl.replace(/^\.?\//,"");if(/^http(s)?:\/\//i.test(relUrl)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(relUrl))return relUrl;
var absUrl="",runtimeLocations=this.getOption("runtimeLocations");if(runtimeLocations&&_.size(runtimeLocations)&&_.forIn(runtimeLocations,function(runtimeLocation,typeIdentifier){if(0===relUrl.indexOf(typeIdentifier))return absUrl=relUrl.replace(typeIdentifier,runtimeLocation),!1}),absUrl)return absUrl;var baseUrl=this.getOption("baseUrl")||getDocumentBaseUrl();return baseUrl+relUrl},this.setAreaBroker=function(areaBroker){this._areaBroker=areaBroker},this.getAreaBroker=function(){if(this._areaBroker)return this._areaBroker},this.getItemCreator=function(){return this.getOption("itemCreator")}};return{build:function(renderersLocations,name,defaultOptions){var NewRenderer=function(){
var options=_.isPlainObject(arguments[0])?arguments[0]:{};Renderer.apply(this),this.register(renderersLocations),this.name=name||"",this.setOptions(_.defaults(options,defaultOptions||{}))};return NewRenderer.prototype=Renderer.prototype,NewRenderer}}}),define("taoItems/assets/strategies",["util/url","lodash"],function(urlUtil,_){"use strict";var prependToUrl=function(url,base,slashcat){return slashcat===!0?base.replace(/\/$/,"")+"/"+url.directory.replace(/^\.\//,"").replace(/^\//,"")+encodeURIComponent(url.file.replace(/^\.\//,"").replace(/^\//,"")):base+url.directory.replace(/^\.?\//,"")+encodeURIComponent(url.file.replace(/^\.?\//,""))},strategies={packedUrl:{
name:"packedUrl",handle:function(url,data){var type;if(!_.isUndefined(url.source)&&!_.isUndefined(data.assets)&&(type=_.findKey(data.assets,url.source),type&&urlUtil.isAbsolute(data.assets[type][url.source])))return data.assets[type][url.source]}},baseUrl:{name:"baseUrl",handle:function(url,data){if("string"==typeof data.baseUrl&&urlUtil.isRelative(url))return prependToUrl(url,data.baseUrl,data.slashcat)}},itemCssNoCache:{name:"itemCssNoCache",handle:function(url,data){if("string"==typeof data.baseUrl&&urlUtil.isRelative(url)&&/\.css$/.test(url.file))return urlUtil.build(prependToUrl(url,data.baseUrl,data.slashcat),{bust:Date.now()})}},external:{name:"external",
handle:function(url){if(urlUtil.isAbsolute(url))return url.toString()}},base64:{name:"base64",handle:function(url){if(urlUtil.isBase64(url))return url.toString()}},taomedia:{name:"taomedia",handle:function(url,data){var baseUrl=data.baseUrl||"./";if("object"==typeof url&&"taomedia"===url.protocol||/^taomedia:\/\//.test(url.toString()))return baseUrl+url.toString()}}};return strategies}),define("taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy",["taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/portableElementRegistry/icRegistry"],function(ciRegistry,icRegistry){"use strict";function getBaseUrlByIdentifier(typeIdentifier){return ciRegistry.get(typeIdentifier)?ciRegistry.getBaseUrl(typeIdentifier):icRegistry.get(typeIdentifier)?icRegistry.getBaseUrl(typeIdentifier):typeIdentifier;
}return{name:"portableElementLocation",handle:function(url){return url.file===url.path?getBaseUrlByIdentifier(url.file):url.source===url.relative?url.relative.replace(/^(\.\/)?([a-z_0-9]+)\/(.*)/i,function(fullmatch,$1,typeIdentifier,relPath){var runtimeLocation=getBaseUrlByIdentifier(typeIdentifier);return runtimeLocation?runtimeLocation+"/"+relPath:fullmatch}):void 0}}}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","context","ui/themes","taoItems/assets/manager","taoItems/assets/strategies","module","taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy"],function(_,context,themes,assetManagerFactory,assetStrategies,module,portableAssetStrategy){
"use strict";var itemThemes=themes.get("items"),moduleConfig=module.config(),assetManager=assetManagerFactory([{name:"theme",handle:function(url){if(itemThemes&&url.path&&(url.path===itemThemes.base||_.contains(_.pluck(itemThemes.available,"path"),url.path)))return context.root_url+url.toString()}},assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.itemCssNoCache,assetStrategies.baseUrl,portableAssetStrategy],{baseUrl:""}),locations={assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,_tooltip:"taoQtiItem/qtiCommonRenderer/renderers/Tooltip",
stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:!1,responseDeclaration:!1,responseProcessing:!1,img:"taoQtiItem/qtiCommonRenderer/renderers/Img",math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",table:"taoQtiItem/qtiCommonRenderer/renderers/Table",printedVariable:"taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",
extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",
"simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",
hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",hotspotChoice:!1,gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",
gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",associableHotspot:!1,customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",infoControl:"taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiCommonRenderer/renderers/Include",endAttemptInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction"};return{name:"commonRenderer",locations:locations,options:{assetManager:assetManager,themes:itemThemes,enableDragAndDrop:{associate:!!moduleConfig.associateDragAndDrop,
gapMatch:!!moduleConfig.gapMatchDragAndDrop,graphicGapMatch:!!moduleConfig.graphicGapMatchDragAndDrop,order:!!moduleConfig.orderDragAndDrop},messages:moduleConfig.messages}}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/runner/provider/manager/picManager",["jquery","lodash","taoQtiItem/qtiItem/core/Element"],function($,_,Element){"use strict";var picManager={init:function(pic,item){return Element.isA(pic,"infoControl")&&(this._pic=pic),
Element.isA(item,"assessmentItem")&&(this._item=item),this},getPic:function(){return this._pic},getItem:function(){return this._item},getSerial:function(){return this._pic&&this._pic.serial},getTypeIdentifier:function(){return this._pic&&this._pic.typeIdentifier},getDom:function(){if(!this._dom){var pic,tool,serial=this.getSerial();serial&&(pic=$('[data-serial="'+serial+'"]'),pic.length&&(tool=$('[data-pic-serial="'+serial+'"]'),tool.length||(tool=pic.children().first()),this._dom={pic:pic,tool:tool,button:tool.find(".sts-button"),broken:pic.is(":empty")}))}return this._dom},enable:function(){var dom=this.getDom();return dom&&(dom.button.removeClass("disabled"),
dom.tool.find(".sts-button-disable-mask").remove(),this.disabled=!1,this.trigger("enable")),this},disable:function(){var button,dom=this.getDom();return dom&&(button=dom.button.addClass("disabled"),$('<div class="sts-button-disable-mask" style="position:absolute;z-index:10000000000000"></div>').appendTo(dom.tool).offset(button.offset()).width(button.outerWidth()).height(button.outerHeight()),dom.tool.find(".sts-container, .sts-menu-container").addClass("sts-hidden-container"),this.disabled=!0,this.trigger("disable")),this},show:function(){var dom=this.getDom();return dom&&(dom.tool.show(),this.trigger("show")),this},hide:function(){var dom=this.getDom();return dom&&(dom.tool.hide(),
this.trigger("hide")),this},trigger:function(eventName){var dom=this.getDom(),args=_.rest(arguments,1);return args.unshift(this),dom&&(dom.tool.trigger(eventName,args),dom.broken&&dom.pic.trigger(eventName,args)),this}},picManagerCollection={init:function(item){return Element.isA(item,"assessmentItem")&&(this._item=item),this},getList:function(force){var self=this;return!force&&self._list||(self._map={},self._list=[],self._item&&_.forEach(self._item.getElements(),function(element){var manager;Element.isA(element,"infoControl")&&(manager=managerFactory(element,self._item),self._list.push(manager),self._map[element.serial]=manager,self._map[element.typeIdentifier]=manager);
})),this._list},getPic:function(picId){return this.getList(),this._map[picId]},execute:function(picId,action){var pic=this.getPic(picId);if(pic&&pic[action])return pic[action].apply(pic,_.rest(arguments,2))},executeAll:function(action,filter){var cb,args=_.rest(arguments,2);return cb="function"==typeof filter?function(pic){filter.call(pic,pic)&&pic[action]&&pic[action].apply(pic,args)}:function(pic){pic[action]&&pic[action].apply(pic,args)},this.each(cb)},each:function(cb){return _.forEach(this.getList(),cb),this},enablePic:function(picId){return this.execute(picId,"enable"),this},disablePic:function(picId){return this.execute(picId,"disable"),this},showPic:function(picId){
return this.execute(picId,"show"),this},hidePic:function(picId){return this.execute(picId,"hide"),this},enableAll:function(filter){return this.executeAll("enable",filter),this},disableAll:function(filter){return this.executeAll("disable",filter),this},showAll:function(filter){return this.executeAll("show",filter),this},hideAll:function(filter){return this.executeAll("hide",filter),this}},managerFactory=function(pic,item){var manager=_.clone(picManager,!0);return manager.init(pic,item)},collectionFactory=function(item){var collection=_.clone(picManagerCollection,!0);return collection.init(item)};return{collection:collectionFactory,manager:managerFactory}}),define("taoQtiItem/runner/provider/manager/userModules",["lodash","module","core/promise"],function(_,module,Promise){
"use strict";return{load:function(userModules){var config=module.config();return userModules&&_.isArray(userModules)||(userModules=config&&config.userModules&&_.isArray(config.userModules)?config.userModules:[]),new Promise(function(resolve,reject){require(userModules,function(){_.forEach(arguments,function(dependency){dependency&&_.isFunction(dependency.exec)&&dependency.exec()}),resolve()},function(err){reject(err.message)})})}}}),define("taoQtiItem/qtiItem/helper/pci",["lodash"],function(_){var pci={getRawValues:function(pciVar){if(_.isPlainObject(pciVar)){if(void 0!==pciVar.base)return _.values(pciVar.base);if(pciVar.list)return _.values(pciVar.list)}throw"unsupported type ";
}};return pci}),define("taoQtiItem/qtiItem/helper/container",["lodash","jquery"],function(_,$){"use strict";function _checkContainerType(element){if(_.isFunction(element.initContainer)&&_.isFunction(element.body))return!0;throw"the element is not of a container type"}function _getBodyDom(element){if(_checkContainerType(element))return $("<div>").html(element.body()).find(".x-tao-wrapper")}function _setBodyDomClass(element,newClass,oldClass){if(_checkContainerType(element)&&(oldClass||newClass)){var $wrapper=$("<div>").html(element.body());_setDomClass($wrapper,newClass,oldClass),element.body($wrapper.html())}}function _setDomClass($wrapper,newClass,oldClass){
var $bodyDom=$wrapper.find(".x-tao-wrapper");$bodyDom.length||($wrapper.wrapInner('<div class="x-tao-wrapper">'),$bodyDom=$wrapper.find(".x-tao-wrapper")),oldClass&&$bodyDom.removeClass(oldClass),newClass&&$bodyDom.addClass(newClass)}function setEncodedDataToDom($wrapper,dataName,newValue,oldValue){_setDomClass($wrapper,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))}function _getEncodedDataString(dataName,value){return dataName&&value?_prefix+dataName+"-"+value:""}function setEncodedData(element,dataName,newValue){var oldValue=getEncodedData(element,dataName);return _setBodyDomClass(element,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue));
}function removeEncodedData(element,dataName){var oldValue=getEncodedData(element,dataName);dataName&&oldValue&&_setBodyDomClass(element,"",_getEncodedDataString(dataName,oldValue))}function hasEncodedData(element,dataName,value){var $body=_getBodyDom(element);return!!($body&&$body.length&&dataName&&value)&&$body.hasClass(_getEncodedDataString(dataName,value))}function getEncodedData(element,dataName){var regex,matches,$body=_getBodyDom(element);if(dataName&&$body&&$body.length&&$body.attr("class")&&(regex=new RegExp(_prefix+dataName+"-([a-zA-Z0-9-._]*)"),matches=$body.attr("class").match(regex)))return matches[1]}var _prefix="x-tao-";return{setEncodedData:setEncodedData,
hasEncodedData:hasEncodedData,getEncodedData:getEncodedData,removeEncodedData:removeEncodedData,setEncodedDataToDom:setEncodedDataToDom}}),define("taoQtiItem/qtiItem/helper/modalFeedback",["jquery","lodash","taoQtiItem/qtiItem/helper/pci","taoQtiItem/qtiItem/helper/container"],function($,_,pci,containerHelper){"use strict";var getFeedbackMessageSignature=function(feedback){return(""+feedback.body()+feedback.attr("title")).toLowerCase().trim().replace(/x-tao-[a-zA-Z0-9\-._\s]*/g,"")},extractDisplayInfo=function(interaction){var messageGroupId,$displayContainer,$interactionContainer=interaction.getContainer(),responseIdentifier=interaction.attr("responseIdentifier");
return interaction.is("inlineInteraction")?($displayContainer=$interactionContainer.closest('[class*=" col-"], [class^="col-"]'),messageGroupId=$displayContainer.attr("data-messageGroupId"),messageGroupId||(messageGroupId=_.uniqueId("inline_message_group_"),$displayContainer.attr("data-messageGroupId",messageGroupId))):(messageGroupId=responseIdentifier,$displayContainer=$interactionContainer),{responseIdentifier:responseIdentifier,interactionContainer:$interactionContainer,displayContainer:$displayContainer,messageGroupId:messageGroupId,order:-1}},getInteractionsDisplayInfo=function(item){var interactionsDisplayInfo=[],$itemContainer=item.getContainer(),interactionOrder=0;
return _.forEach(item.getComposingElements(),function(element){element.is("interaction")&&interactionsDisplayInfo.push(extractDisplayInfo(element))}),$itemContainer.find(".qti-interaction").each(function(){var self=this;_.forEach(interactionsDisplayInfo,function(_interactionInfo){if(_interactionInfo.interactionContainer[0]===self)return _interactionInfo.order=interactionOrder,!1}),interactionOrder++}),interactionsDisplayInfo=_.sortBy(interactionsDisplayInfo,"order")},getFeedbacks=function(item,itemSession){var messages={},$itemContainer=item.getContainer(),$itemBody=$(".qti-itemBody",$itemContainer),interactionsDisplayInfo=getInteractionsDisplayInfo(item),renderingQueue=[];
return _.forEach(item.modalFeedbacks,function(feedback){var feedbackIds,message,$container,comparedOutcome,_currentMessageGroupId,interactionInfo,outcomeIdentifier=feedback.attr("outcomeIdentifier"),order=-1;if(itemSession[outcomeIdentifier]){if(feedbackIds=pci.getRawValues(itemSession[outcomeIdentifier]),!_.contains(feedbackIds,feedback.id()))return!0;if(message=getFeedbackMessageSignature(feedback),comparedOutcome=containerHelper.getEncodedData(feedback,"relatedOutcome"),interactionInfo=_.find(interactionsDisplayInfo,{responseIdentifier:comparedOutcome}),comparedOutcome&&interactionInfo?($container=interactionInfo.displayContainer,_currentMessageGroupId=interactionInfo.messageGroupId,
order=interactionInfo.order):($container=$itemBody,_currentMessageGroupId="__item__"),messages[_currentMessageGroupId]||(messages[_currentMessageGroupId]=[]),_.contains(messages[_currentMessageGroupId],message))return!0;messages[_currentMessageGroupId].push(message),renderingQueue.push({feedback:feedback,$container:$container,order:order})}}),renderingQueue=_.sortBy(renderingQueue,"order")};return{getFeedbacks:getFeedbacks}}),define("taoQtiItem/runner/provider/qti",["jquery","lodash","context","core/promise","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiItem/core/Element","taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/portableElementRegistry/icRegistry","taoQtiItem/portableElementRegistry/provider/sideLoadingProviderFactory","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/runner/provider/manager/picManager","taoQtiItem/runner/provider/manager/userModules","taoQtiItem/qtiItem/helper/modalFeedback","taoItems/assets/manager"],function($,_,context,Promise,QtiLoader,Element,ciRegistry,icRegistry,sideLoadingProviderFactory,QtiRenderer,picManager,userModules,modalFeedbackHelper){
"use strict";var timeout=1e3*(context.timeout>0?context.timeout+1:30),qtiItemRuntimeProvider={init:function(itemData,done){var self=this,rendererOptions=_.merge({assetManager:this.assetManager},_.pick(this.options,["themes","preload"]));this._renderer=new QtiRenderer(rendererOptions),this._loader=new QtiLoader,this._loader.loadItemData(itemData,function(item){return item?(self._item=item,void self._renderer.load(function(){self._item.setRenderer(this),done()},this.getLoadedClasses())):self.trigger("error","Unable to load item from the given data.")})},render:function(elt,done,options){var self=this;if(options=_.defaults(options||{},{state:{}}),this._item){try{
elt.innerHTML=this._item.render({})}catch(e){self.trigger("error","Error in template rendering : "+e.message)}try{options.portableElements&&(options.portableElements.pci&&(ciRegistry.resetProviders(),ciRegistry.registerProvider("pciDeliveryProvider",sideLoadingProviderFactory(options.portableElements.pci))),options.portableElements.pic&&(icRegistry.resetProviders(),icRegistry.registerProvider("picDeliveryProvider",sideLoadingProviderFactory(options.portableElements.pic)))),Promise.race([Promise.all(this._item.postRender(options)),new Promise(function(resolve,reject){_.delay(reject,timeout,new Error("Post rendering ran out of time."))})]).then(function(){return $(elt).off("responseChange").on("responseChange",function(){
self.trigger("statechange",self.getState()),self.trigger("responsechange",self.getResponses())}).off("endattempt").on("endattempt",function(e,responseIdentifier){self.trigger("endattempt",responseIdentifier||e.originalEvent.detail)}).off("themechange").on("themechange",function(e,themeName){var themeLoader=self._renderer.getThemeLoader();themeName=themeName||e.originalEvent.detail,themeLoader&&themeLoader.change(themeName)}),self.trigger("listpic",picManager.collection(self._item)),userModules.load().then(done)}).catch(function(err){self.trigger("error","Error in post rendering : "+err instanceof Error?err.message:err)})}catch(err){self.trigger("error","Error in post rendering : "+err.message);
}}},clear:function(elt,done){this._item&&(_.invoke(this._item.getInteractions(),"clear"),this._item.clear(),$(elt).off("responseChange").off("endattempt").off("themechange").off("feedback").empty(),this._renderer&&this._renderer.unload(),this._item=null),done()},getState:function(){var state={};return this._item&&(_.forEach(this._item.getInteractions(),function(interaction){state[interaction.attr("responseIdentifier")]=interaction.getState()}),_.forEach(this._item.getElements(),function(element){Element.isA(element,"infoControl")&&element.attr("id")&&(state.pic=state.pic||{},state.pic[element.attr("id")]=element.getState())})),state},setState:function(state){
this._item&&state&&(_.forEach(this._item.getInteractions(),function(interaction){var id=interaction.attr("responseIdentifier");id&&state[id]&&interaction.setState(state[id])}),state.pic&&_.forEach(this._item.getElements(),function(element){Element.isA(element,"infoControl")&&state.pic[element.attr("id")]&&element.setState(state.pic[element.attr("id")])}))},getResponses:function(){var responses={};return this._item&&_.reduce(this._item.getInteractions(),function(res,interaction){return responses[interaction.attr("responseIdentifier")]=interaction.getResponse(),responses},responses),responses},renderFeedbacks:function(feedbacks,itemSession,done){var self=this,_renderer=self._item.getRenderer(),_loader=new QtiLoader(self._item);
_loader.loadElements(feedbacks,function(item){_renderer.load(function(){var renderingQueue=modalFeedbackHelper.getFeedbacks(item,itemSession);done(renderingQueue)},this.getLoadedClasses())})}};return qtiItemRuntimeProvider}),define("taoQtiItem/runner/qtiItemRunner",["taoItems/runner/api/itemRunner","taoQtiItem/runner/provider/qti"],function(itemRunner,qtiRuntimeProvider){"use strict";return itemRunner.register("qti",qtiRuntimeProvider),itemRunner}),define("taoQtiTest/runner/config/assetManager",["taoItems/assets/manager","taoItems/assets/strategies","taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy"],function(assetManagerFactory,assetStrategies,assetPortableElement){
"use strict";var defaultStrategies=[assetStrategies.packedUrl,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl,assetPortableElement],assetManagers={};return function(testId){var assetManager;return"undefined"!=typeof assetManagers[testId]?assetManager=assetManagers[testId]:(assetManager=assetManagerFactory(defaultStrategies,{baseUrl:""}),assetManagers[testId]=assetManager),assetManager}}),define("tpl!taoQtiTestPreviewer/previewer/provider/item/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},
'<main class="item-previewer-scope">\n    <div class="action-bar content-action-bar horizontal-action-bar top-action-bar">\n        <div class="control-box size-wrapper">\n            <div class="lft tools-box"></div>\n            <div class="rgt navi-box">\n                <ul class="plain navi-box-list"></ul>\n            </div>\n        </div>\n    </div>\n\n    <div class="test-runner-sections">\n\n        <aside class="test-sidebar test-sidebar-left"></aside>\n\n        <section class="content-wrapper">\n            <div id="qti-content"></div>\n        </section>\n    </div>\n\n    <nav class="action-bar content-action-bar horizontal-action-bar bottom-action-bar">\n        <div class="control-box size-wrapper">\n            <div class="lft tools-box"></div>\n            <div class="rgt navi-box">\n                <ul class="plain navi-box-list"></ul>\n            </div>\n        </div>\n    </nav>\n\n</main>\n';
})}),define("taoQtiTestPreviewer/previewer/provider/item/item",["jquery","lodash","i18n","core/store","core/promise","core/cachedStore","taoTests/runner/areaBroker","taoTests/runner/testStore","taoTests/runner/proxy","taoQtiTestPreviewer/previewer/proxy/item","taoQtiTest/runner/ui/toolbox/toolbox","taoQtiItem/runner/qtiItemRunner","taoQtiTest/runner/config/assetManager","tpl!taoQtiTestPreviewer/previewer/provider/item/tpl/item"],function($,_,__,store,Promise,cachedStore,areaBrokerFactory,testStoreFactory,proxyFactory,proxyProvider,toolboxFactory,qtiItemRunner,assetManagerFactory,layoutTpl){"use strict";var assetManager=assetManagerFactory();return proxyFactory.registerProvider("qtiItemPreviewerProxy",proxyProvider),
{name:"qtiItemPreviewer",loadAreaBroker:function(){var $layout=$(layoutTpl());return areaBrokerFactory($layout,{content:$("#qti-content",$layout),toolbox:$(".bottom-action-bar .tools-box",$layout),navigation:$(".bottom-action-bar .navi-box-list",$layout),control:$(".top-action-bar .control-box",$layout),actionsBar:$(".bottom-action-bar .control-box",$layout),panel:$(".test-sidebar-left",$layout),header:$(".top-action-bar .tools-box",$layout),context:$(".top-action-bar .navi-box-list",$layout)})},loadProxy:function(){var config=this.getConfig(),proxyConfig=_.pick(config,["serviceCallId","bootstrap","timeout"]);return proxyFactory(config.proxyProvider||"qtiItemPreviewerProxy",proxyConfig);
},loadTestStore:function(){var config=this.getConfig(),identifier=config.serviceCallId||"test-"+Date.now();return testStoreFactory(identifier)},init:function(){var self=this,dataHolder=this.getDataHolder(),areaBroker=this.getAreaBroker();return areaBroker.setComponent("toolbox",toolboxFactory()),areaBroker.getToolbox().init(),this.on("submititem",function(){var itemRunner=this.itemRunner,itemState=itemRunner.getState(),itemResponses=itemRunner.getResponses();return this.trigger("disabletools disablenav"),this.trigger("submitresponse",itemResponses,itemState),this.getProxy().submitItem(dataHolder.get("itemIdentifier"),itemState,itemResponses).then(function(response){
self.trigger("scoreitem",response),self.trigger("enabletools enablenav resumeitem")}).catch(function(err){self.trigger("enabletools enablenav"),200===err.code&&self.trigger("alert.submitError",err.message||__("An error occurred during results submission. Please retry."),function(){self.trigger("resumeitem")})})}).on("ready",function(){var itemIdentifier=dataHolder.get("itemIdentifier"),itemData=dataHolder.get("itemData");itemIdentifier&&(itemData?self.renderItem(itemIdentifier,itemData):self.loadItem(itemIdentifier))}).on("loaditem",function(itemRef,itemData){dataHolder.set("itemIdentifier",itemRef),dataHolder.set("itemData",itemData)}).on("renderitem",function(){
this.trigger("enabletools enablenav")}).on("resumeitem",function(){this.trigger("enableitem enablenav")}).on("disableitem",function(){this.trigger("disabletools")}).on("enableitem",function(){this.trigger("enabletools")}).on("error",function(){this.trigger("disabletools enablenav")}).on("finish leave",function(){this.trigger("disablenav disabletools"),this.flush()}).on("flush",function(){this.destroy()}),this.getProxy().init().then(function(data){dataHolder.set("itemIdentifier",data.itemIdentifier),dataHolder.set("itemData",data.itemData)})},render:function(){var config=this.getConfig(),areaBroker=this.getAreaBroker();config.renderTo.append(areaBroker.getContainer()),
areaBroker.getToolbox().render(areaBroker.getToolboxArea())},loadItem:function(itemIdentifier){return this.getProxy().getItem(itemIdentifier)},renderItem:function(itemIdentifier,itemData){var self=this,changeState=function(){self.setItemState(itemIdentifier,"changed",!0)};return new Promise(function(resolve,reject){assetManager.setData("baseUrl",itemData.baseUrl),itemData.content=itemData.content||{},self.itemRunner=qtiItemRunner(itemData.content.type,itemData.content.data,{assetManager:assetManager}).on("error",function(err){self.trigger("enablenav"),reject(err)}).on("init",function(){var itemContainer=self.getAreaBroker().getContentArea(),options=_.pick(itemData,["state","portableElements"]);
this.render(itemContainer,options)}).on("render",function(){this.on("responsechange",changeState),this.on("statechange",changeState),resolve()}).init()})},unloadItem:function(){var self=this;return self.trigger("beforeunloaditem disablenav disabletools"),new Promise(function(resolve){return self.itemRunner?void self.itemRunner.on("clear",resolve).clear():void resolve()})},destroy:function(){var areaBroker=this.getAreaBroker();this.itemRunner&&this.itemRunner.clear(),this.itemRunner=null,areaBroker&&areaBroker.getToolbox().destroy()}}}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/util"],function(Element,util){
"use strict";var IdentifiedElement=Element.extend({buildIdentifier:function(prefix,useSuffix){var item=this.getRootElement(),id=util.buildIdentifier(item,prefix||this.qtiClass,useSuffix);return id&&this.attr("identifier",id),this},id:function(value){return value||this.attr("identifier")||this.buildIdentifier(this.qtiClass,!0),this.attr("identifier",value)}});return IdentifiedElement}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var Choice=IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){return"choice"===qtiClass||this._super(qtiClass);
},getInteraction:function(){var found,ret=null,item=this.getRootElement();return item&&(found=item.find(this.serial),found&&(ret=found.parent)),ret}});return Choice}),define("taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){var QtiHotspot=QtiChoice.extend({});return QtiHotspot}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiAssociableHotspot=QtiHotspot.extend({qtiClass:"associableHotspot"});return QtiAssociableHotspot}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function(targetClass,methods,options){
if("function"==typeof targetClass&&"object"==typeof methods)for(var methodName in methods)if(Object.hasOwnProperty(targetClass.prototype,methodName)){if(options&&options.append){var _parent=targetClass.prototype[methodName];targetClass.prototype[methodName]=function(){return methods[methodName].apply(this,arguments),_parent.apply(this,arguments)}}}else targetClass.prototype[methodName]=methods[methodName]}}}),define("taoQtiItem/qtiItem/core/Container",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Element,rendererConfig){"use strict";var Container=Element.extend({qtiClass:"_container",init:function(body){
if(this._super(),body&&"string"!=typeof body)throw"the body of a container must be a string";this.bdy=body||"",this.elements={}},body:function(body){if("undefined"==typeof body)return this.bdy;if("string"!=typeof body)throw"body must be a string";this.bdy=body,$(document).trigger("containerBodyChange",{body:body,container:this,parent:this.parent()})},setElements:function(elements,body){var returnValue=!1;for(var i in elements){var elt=elements[i];if(!(elt instanceof Element))throw returnValue=!1,"expected a qti element";body=body||this.bdy,body.indexOf(elt.placeholder())===-1&&(body+=elt.placeholder()),elt.setRootElement(this.getRootElement()||null),this.elements[elt.getSerial()]=elt,
$(document).trigger("containerElementAdded",{element:elt,container:this}),returnValue=!0}return this.body(body),returnValue},setElement:function(element,body){return this.setElements([element],body)},removeElement:function(element){var serial="";return"string"==typeof element?serial=element:element instanceof Element&&(serial=element.getSerial()),delete this.elements[serial],this.body(this.body().replace("{{"+serial+"}}","")),this},getElements:function(qtiClass){var elts={};if("string"==typeof qtiClass)for(var serial in this.elements)Element.isA(this.elements[serial],qtiClass)&&(elts[serial]=this.elements[serial]);else elts=_.clone(this.elements);return elts},
getElement:function(serial){return this.elements[serial]?this.elements[serial]:null},getComposingElements:function(){var elements=this.getElements(),elts={};for(var serial in elements)elts[serial]=elements[serial],elts=_.extend(elts,elements[serial].getComposingElements());return elts},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),elementsData=[],tpl=this.body();for(var serial in this.elements){var elt=this.elements[serial];if("function"!=typeof elt.render)throw"render() is not defined for the qti element: "+serial;"_container"===elt.qtiClass?tpl=tpl.replace(elt.placeholder(),elt.render(renderer)):(tpl=tpl.replace(elt.placeholder(),"{{{"+serial+"}}}"),
elementsData[serial]=elt.render(renderer))}if(renderer.isRenderer)return this._super({body:renderer.renderDirect(tpl,elementsData),contentModel:this.contentModel||"flow"},renderer,args.placeholder);throw"invalid qti renderer for qti container"},postRender:function(data,altClassName,renderer){renderer=renderer||this.getRenderer();var res=_(this.elements).filter(function(elt){return"function"==typeof elt.postRender}).map(function(elt){return elt.postRender(data,"",renderer)}).flatten(!0).value().concat(this._super(data,altClassName,renderer));return res},toArray:function(){var arr={serial:this.serial,body:this.bdy,elements:{}};for(var serial in this.elements)arr.elements[serial]=this.elements[serial].toArray();
return arr},find:function(serial,parent){var found=null;return this.elements[serial]?found={parent:parent||this,element:this.elements[serial],location:"body"}:_.each(this.elements,function(elt){if(found=elt.find(serial))return!1}),found},isEmpty:function(){return!this.bdy}});return Container}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(Mixin,Container){var methods={initContainer:function(body){this.bdy=new Container(body||""),this.bdy.setRootElement(this.getRootElement()||null),this.bdy.contentModel="blockStatic"},getBody:function(){return this.bdy},body:function(body){var ret=this.bdy.body(body);
return body?this:ret},setElement:function(element,body){return this.bdy.setElement(element,body),this},removeElement:function(element){return this.bdy.removeElement(element)},getElements:function(qtiClass){return this.bdy.getElements(qtiClass)},getElement:function(serial){return this.bdy.getElement(serial)}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(Choice,Container){var ContainerChoice=Choice.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){
return"containerChoice"===qtiClass||this._super(qtiClass)}});return Container.augment(ContainerChoice),ContainerChoice}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){var QtiGap=QtiChoice.extend({qtiClass:"gap"});return QtiGap}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){var QtiObject=Element.extend({qtiClass:"object",getMediaType:function(){var type="undefined",mimetype=this.attr("type");return mimetype&&(type=0===mimetype.indexOf("video")?"video":0===mimetype.indexOf("audio")?"audio":0===mimetype.indexOf("image")?"image":0===mimetype.indexOf("text/html")?"html":"object"),
type},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};switch(this.getMediaType()){case"video":defaultData.video=!0;break;case"audio":defaultData.audio=!0;break;case"html":defaultData.html=!0;break;case"image":default:defaultData.object=!0}return defaultData.attributes={data:renderer.resolveUrl(this.attr("data"))},defaultData.body=this._alt,this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!this.attr("data")}});return QtiObject}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(QtiChoice,QtiObject){
var QtiGapImg=QtiChoice.extend({qtiClass:"gapImg",initObject:function(object){this.object=object||new QtiObject},getObject:function(){return this.object}});return QtiGapImg}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){"use strict";var QtiGapText=QtiContainerChoice.extend({qtiClass:"gapText"});return QtiGapText}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiHotspotChoice=QtiHotspot.extend({qtiClass:"hotspotChoice"});return QtiHotspotChoice}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){
var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="inlineStatic"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Choice,Container){var Hottext=Choice.extend({qtiClass:"hottext"});return Container.augment(Hottext),Hottext}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["jquery","lodash","taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,QtiChoice,rendererConfig){
var QtiTextVariableChoice=QtiChoice.extend({init:function(serial,attributes,text){this._super(serial,attributes),this.val(text||"")},is:function(qtiClass){return"textVariableChoice"===qtiClass||this._super(qtiClass)},val:function(text){if("undefined"==typeof text)return this.text;if("string"!=typeof text)throw"text must be a string";return this.text=text,$(document).trigger("choiceTextChange",{choice:this,text:text}),this},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={body:this.text};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}
});return QtiTextVariableChoice}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){var QtiInlineChoice=QtiTextVariableChoice.extend({qtiClass:"inlineChoice"});return QtiInlineChoice}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){var QtiSimpleAssociableChoice=QtiContainerChoice.extend({qtiClass:"simpleAssociableChoice"});return QtiSimpleAssociableChoice}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){
var QtiSimpleChoice=QtiContainerChoice.extend({qtiClass:"simpleChoice"});return QtiSimpleChoice}),define("taoQtiItem/qtiItem/core/choices/TextEntry",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){var QtiTextEntry=QtiTextVariableChoice.extend({qtiClass:"textEntry"});return QtiTextEntry}),define("taoQtiItem/qtiItem/core/feedbacks/Feedback",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var Feedback=IdentifiedElement.extend({is:function(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)}});return Feedback}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){
var FeedbackBlock=Feedback.extend({});return FeedbackBlock}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){var FeedbackInline=Feedback.extend({});return FeedbackInline}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(IdentifiedElement,Container){var ModalFeedback=IdentifiedElement.extend({qtiClass:"modalFeedback",is:function(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)}});return Container.augment(ModalFeedback),ModalFeedback}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){
var Img=Element.extend({qtiClass:"img",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={src:renderer.resolveUrl(this.attr("src"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!this.attr("src")}});return Img}),define("taoQtiItem/qtiItem/mixin/NamespacedElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){"use strict";var methods={getNamespace:function(){var relatedItem,namespaces,ns;if(this.ns&&(this.ns.name||this.ns.uri))return _.clone(this.ns);if(relatedItem=this.getRootElement()){
namespaces=relatedItem.getNamespaces();for(ns in namespaces)if(namespaces[ns].indexOf(this.nsUriFragment)>0)return{name:ns,uri:namespaces[ns]};return relatedItem.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function(name,uri){this.ns={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Include",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/mixin/NamespacedElement"],function(Element,Container,NamespacedElement){var Include=Element.extend({qtiClass:"include",
defaultNsName:"xi",defaultNsUri:"http://www.w3.org/2001/XInclude",nsUriFragment:"XInclude",isEmpty:function(){return!this.attr("href")||this.getBody().isEmpty()}});return Container.augment(Include),NamespacedElement.augment(Include),Include}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){"use strict";var QtiInteraction=Element.extend({init:function(serial,attributes){this._super(serial,attributes),this.choices={}},is:function(qtiClass){return"interaction"===qtiClass||this._super(qtiClass)},
addChoice:function(choice){return choice.setRootElement(this.getRootElement()||null),this.choices[choice.getSerial()]=choice,this},getChoices:function(){var choices={};for(var i in this.choices)choices[i]=this.choices[i];return choices},getChoice:function(serial){var ret=null;return this.choices[serial]&&(ret=this.choices[serial]),ret},getChoiceByIdentifier:function(identifier){for(var i in this.choices)if(this.choices[i].id()===identifier)return this.choices[i];return null},getComposingElements:function(){var elts=this._super();for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(elts[serial]=this.choices[serial],elts=_.extend(elts,this.choices[serial].getComposingElements()));
return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,"choices",serial)),found},getResponseDeclaration:function(){var response=null,responseId=this.attr("responseIdentifier");if(responseId){var item=this.getRootElement();if(!item)throw"cannot get response of an interaction out of its item context";response=item.getResponseDeclaration(responseId)}return response},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={_type:this.qtiClass.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()}),choices:[],choiceShuffle:!0};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;
var choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),interactionData={interaction:{serial:this.serial,attributes:this.attributes}},_this=this;_.each(choices,function(choice){if(Element.isA(choice,"choice"))try{var renderedChoice=choice.render(_.clone(interactionData,!0),null,choice.qtiClass+"."+_this.qtiClass,renderer);defaultData.choices.push(renderedChoice)}catch(e){}});var tplName=args.subclass?this.qtiClass+"."+args.subclass:this.qtiClass;return this._super(_.merge(defaultData,args.data),args.placeholder,tplName,renderer)},postRender:function(data,altClassName,renderer){var self=this;return renderer=renderer||this.getRenderer(),
_(this.getChoices()).filter(function(elt){return Element.isA(elt,"choice")}).map(function(choice){return choice.postRender({},choice.qtiClass+"."+self.qtiClass,renderer)}).value().concat(this._super(data,altClassName,renderer))},setResponse:function(values){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return ret=renderer.setResponse(this,values)},getResponse:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return ret=renderer.getResponse(this)},resetResponse:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;
return ret=renderer.resetResponse(this)},getState:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return _.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;_.isFunction(renderer.setState)&&renderer.setState(this,state)},clear:function(){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.destroy)&&renderer.destroy(this)},toArray:function(){var arr=this._super();arr.choices={};for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(arr.choices[serial]=this.choices[serial].toArray());
return arr},getNormalMaximum:function(){return!1}});return QtiInteraction}),define("taoQtiItem/qtiItem/core/interactions/Prompt",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Element,Container){var Prompt=Element.extend({qtiClass:"prompt"});return Container.augment(Prompt),Prompt}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Interaction,Prompt,_,rendererConfig){"use strict";var BlockInteraction=Interaction.extend({init:function(serial,attributes){
this._super(serial,attributes),this.prompt=new Prompt("")},is:function(qtiClass){return"blockInteraction"===qtiClass||this._super(qtiClass)},getComposingElements:function(){var elts=this._super();return elts=_.extend(elts,this.prompt.getComposingElements()),elts[this.prompt.getSerial()]=this.prompt,elts},find:function(serial){return this._super(serial)||this.prompt.find(serial)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={prompt:this.prompt.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){
return renderer=renderer||this.getRenderer(),[].concat(this.prompt.postRender({},"",renderer)).concat(this._super(data,altClassName,renderer))},toArray:function(){var arr=this._super();return arr.prompt=this.prompt.toArray(),arr}});return BlockInteraction}),define("lib/gamp/gamp",[],function(){"use strict";function precision(val){var digits=String(val),point=digits.indexOf(".");return point<0?1:Math.pow(10,digits.length-point-1)}function gamp(){for(var i=arguments.length-1,factor=-(1/0);i>=0;)factor=Math.max(factor,precision(arguments[i--]));return Math.abs(factor)}return gamp.normalize=function(val,factor){return Math.round(factor*Number(val))},gamp.round=function(val,digits){
return Number(Number(val).toPrecision("undefined"==typeof digits?16:digits))},gamp.add=function(a,b){var factor=gamp(a,b);return gamp.round((gamp.normalize(a,factor)+gamp.normalize(b,factor))/factor)},gamp.sub=function(a,b){var factor=gamp(a,b);return gamp.round((gamp.normalize(a,factor)-gamp.normalize(b,factor))/factor)},gamp.mul=function(a,b){var factor=gamp(a,b);return gamp.round(gamp.normalize(a,factor)*gamp.normalize(b,factor)/(factor*factor),15)},gamp.div=function(a,b){var factor=gamp(a,b);return gamp.round(gamp.normalize(a,factor)/gamp.normalize(b,factor))},gamp.pow=function(a,b){var factor=gamp(a),ta=gamp.normalize(a,factor),ib=Math.floor(b),fb=b-ib,res=ib?Math.pow(ta,ib)/Math.pow(factor,ib):1;
return fb&&(res=gamp.div(gamp.mul(res,Math.pow(ta,fb)),Math.pow(factor,fb))),gamp.round(res,15)},gamp}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(_){"use strict";var _templateNames={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point",NONE:"no_response_processing"};return{isUsingTemplate:function(response,tpl){return!(!_.isString(tpl)||tpl!==response.template&&_templateNames[tpl]!==response.template)},isValidTemplateName:function(tplName){
return!!this.getTemplateUriFromName(tplName)},getTemplateUriFromName:function(tplName){return _templateNames[tplName]?_templateNames[tplName]:""},getTemplateNameFromUri:function(tplUri){var tplName="";return _.forIn(_templateNames,function(uri,name){if(uri===tplUri)return tplName=name,!1}),tplName}}}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","lodash"],function($,_){"use strict";var _ns=".qti-creator",_ns_model=".qti-creator",eventList=["containerBodyChange","containerElementAdded","elementCreated.qti-widget","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget","mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"],event={
choiceCreated:function(choice,interaction){$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:interaction})},deleted:function(element,parent){element.isset()&&element.unset(),$(document).off("."+element.getSerial()),$(document).trigger("deleted.qti-widget",{element:element,parent:parent})},getList:function(addedNamespace){var events=_.clone(eventList);return addedNamespace?_.map(events,function(e){return e+"."+addedNamespace}):events},initElementToWidgetListeners:function(){var ns=".widget-container";$(document).off(ns).on(event.getList(ns).join(" "),function(e,data){var element=data.element||data.container||null,widget=data&&element&&element.data("widget");
!widget&&data.parent&&(element=data.parent,widget=element.data("widget")),widget&&widget.$container.trigger(e.type+_ns+_ns_model,data)})},getNs:function(){return _ns},getNsModel:function(){return _ns_model}};return event}),define("taoQtiItem/qtiCreator/model/helper/invalidator",["lodash"],function(_){"use strict";var invalidator={completelyValid:function(element){var serial,invalidElements,item=element.getRootElement();item&&(serial=element.getSerial(),invalidElements=item.data("invalid")||{},delete invalidElements[serial],item.data("invalid",invalidElements))},valid:function(element,key){var invalidElements,item=element.getRootElement(),serial=element.getSerial();
if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required argument "key"');invalidElements[serial]&&invalidElements[serial][key]&&(delete invalidElements[serial][key],_.size(invalidElements[serial])||delete invalidElements[serial],item.data("invalid",invalidElements))}},invalid:function(element,key,message,stateName){var invalidElements,item=element.getRootElement(),serial=element.getSerial();if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required arguments "key"');invalidElements[serial]||(invalidElements[serial]={}),invalidElements[serial][key]={message:message||"",stateName:stateName||"active"
},item.data("invalid",invalidElements)}},isValid:function(element){var invalidElements,item=element.getRootElement(),serial=element.getSerial();return!item||(invalidElements=item.data("invalid")||{},!invalidElements[serial])}};return invalidator}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","core/encoder/entity","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/invalidator"],function(_,$,entity,Element,event,invalidator){"use strict";var _removeSelf=function(element){var found,parent,removed=!1,related=element.getRootElement();if(!related)throw new Error("no related item found");
return found=related.find(element.getSerial()),found&&(parent=found.parent,Element.isA(parent,"interaction")?("gapImg"===element.qtiClass?parent.removeGapImg(element):Element.isA(element,"choice")&&parent.removeChoice(element),removed=!0):"body"===found.location&&_.isFunction(parent.initContainer)?(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.getBody().removeElement(element),removed=!0):Element.isA(parent,"_container")&&(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.removeElement(element),removed=!0),removed&&(element.data("removed",!0),invalidator.completelyValid(element),event.deleted(element,parent))),removed},_removeElement=function(element,containerPropName,eltToBeRemoved){
var targetElt,targetSerial="";return element[containerPropName]&&("string"==typeof eltToBeRemoved?(targetSerial=eltToBeRemoved,targetElt=Element.getElementBySerial(targetSerial)):eltToBeRemoved instanceof Element&&(targetSerial=eltToBeRemoved.getSerial(),targetElt=eltToBeRemoved),targetSerial&&(invalidator.completelyValid(targetElt),delete element[containerPropName][targetSerial],Element.unsetElement(targetSerial))),element},methods={init:function(serial,attributes){var attr={};"object"==typeof serial&&(attributes=serial,serial=""),_.isFunction(this.getDefaultAttributes)&&_.extend(attr,this.getDefaultAttributes()),_.extend(attr,attributes),this._super(serial,attr);
},attr:function(key,value){var ret=this._super(key,value);return"undefined"!=typeof key&&"undefined"!=typeof value&&$(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:entity.encode(value)}),_.isString(ret)?entity.decode(ret):ret},removeAttr:function(key){var ret=this._super(key);return $(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:null}),ret},remove:function(){if(0===arguments.length)return _removeSelf(this);if(2===arguments.length)return _removeElement(this,arguments[0],arguments[1]);throw new Error("invalid number of argument given")}};return methods}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){
"use strict";var VariableDeclaration=IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes),this.defaultValue=null},is:function(qtiClass){return"variableDeclaration"===qtiClass||this._super(qtiClass)},toArray:function(){var arr=this._super();return arr.defaultValue=this.defaultValue,arr},setDefaultValue:function(value){this.defaultValue=value},getDefaultValue:function(){return this.defaultValue}});return VariableDeclaration}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(VariableDeclaration){return VariableDeclaration.extend({qtiClass:"outcomeDeclaration"
})}),define("taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(_,editable,OutcomeDeclaration){"use strict";var methods={};return _.extend(methods,editable),OutcomeDeclaration.extend(methods)}),define("taoQtiItem/qtiItem/helper/maxScore",["lodash","lib/gamp/gamp","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration"],function(_,gamp,responseHelper,OutcomeDeclaration){"use strict";var _ignoreMinChoice=!0,pairExists=function(collection,pair){return 2===pair.length&&(collection[pair[0]+" "+pair[1]]||collection[pair[1]+" "+pair[0]]);
};return{setNormalMaximum:function(item){var normalMaximum,scoreOutcome=item.getOutcomeDeclaration("SCORE");scoreOutcome&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(normalMaximum=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return!!_.isNumber(interactionMaxScore)&&gamp.add(acc,interactionMaxScore)},0),_.isNumber(normalMaximum)?scoreOutcome.attr("normalMaximum",normalMaximum):scoreOutcome.removeAttr("normalMaximum"))},setMaxScore:function(item){var customOutcomes,maxScore,maxScoreOutcome,hasInvalidInteraction=!1,scoreOutcome=item.getOutcomeDeclaration("SCORE");
scoreOutcome&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(maxScore=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return _.isNumber(interactionMaxScore)?gamp.add(acc,interactionMaxScore):(hasInvalidInteraction=!0,acc)},0),customOutcomes=_(item.getOutcomes()).filter(function(outcome){return"SCORE"!==outcome.id()&&"MAXSCORE"!==outcome.id()}),customOutcomes.size()&&(maxScore=customOutcomes.reduce(function(acc,outcome){return gamp.add(acc,parseFloat(outcome.attr("normalMaximum")||0))},maxScore)),!hasInvalidInteraction||customOutcomes.size()?(maxScoreOutcome=item.getOutcomeDeclaration("MAXSCORE"),
maxScoreOutcome||(maxScoreOutcome=new OutcomeDeclaration({cardinality:"single",baseType:"float"}),item.addOutcomeDeclaration(maxScoreOutcome),maxScoreOutcome.buildIdentifier("MAXSCORE",!1)),maxScoreOutcome.setDefaultValue(maxScore)):item.removeOutcome("MAXSCORE"))},getMatchMaxOrderedChoices:function(choiceCollection){return _(choiceCollection).map(function(choice){var matchMax=parseInt(choice.attr("matchMax"),10);return _.isNaN(matchMax)&&(matchMax=0),{matchMax:0===matchMax?1/0:matchMax,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()},choiceInteractionBased:function(interaction,options){var max,maxChoice,minChoice,scoreMaps,requiredChoiceCount,totalAnswerableResponse,sortedMapEntries,missingMapsCount,responseDeclaration=interaction.getResponseDeclaration(),mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);
if(options=_.defaults(options||{},{maxChoices:0,minChoices:0}),maxChoice=parseInt(interaction.attr("maxChoices")||options.maxChoices,10),minChoice=_ignoreMinChoice?0:parseInt(interaction.attr("minChoices")||options.minChoices,10),maxChoice&&minChoice&&maxChoice<minChoice)return 0;if("MATCH_CORRECT"===template)max=maxChoice&&_.isArray(responseDeclaration.correctResponse)&&(responseDeclaration.correctResponse.length>maxChoice||responseDeclaration.correctResponse.length<minChoice)?0:!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;
requiredChoiceCount=minChoice,totalAnswerableResponse=0===maxChoice?1/0:maxChoice,scoreMaps=_.values(responseDeclaration.mapEntries),sortedMapEntries=_(scoreMaps).map(function(v){return parseFloat(v)}).sortBy().reverse().first(totalAnswerableResponse),missingMapsCount=minChoice-sortedMapEntries.size(),_.times(missingMapsCount,function(){sortedMapEntries.push(mapDefault)}),mapDefault&&mapDefault>0&&(missingMapsCount=maxChoice?maxChoice-sortedMapEntries.size():_.size(interaction.getChoices())-sortedMapEntries.size(),missingMapsCount>0&&_.times(missingMapsCount,function(){sortedMapEntries.push(mapDefault)})),max=sortedMapEntries.reduce(function(acc,v){var score=v;
return score<0&&requiredChoiceCount<=0&&(score=0),requiredChoiceCount--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},orderInteractionBased:function(interaction){var max,minChoice=_ignoreMinChoice?0:parseInt(interaction.attr("minChoices")||0,10),maxChoice=parseInt(interaction.attr("maxChoices")||0,10),responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);return maxChoice&&minChoice&&maxChoice<minChoice?0:("MATCH_CORRECT"===template?max=_.isArray(responseDeclaration.correctResponse)&&maxChoice&&responseDeclaration.correctResponse.length>maxChoice||minChoice&&responseDeclaration.correctResponse.length<minChoice?0:!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1:"MAP_RESPONSE"!==template&&"MAP_RESPONSE_POINT"!==template||(max=0),
max)},associateInteractionBased:function(interaction,options){var max,requiredAssoc,totalAnswerableResponse,usedChoices,choicesIdentifiers,sortedMapEntries,i,allPossibleMapEntries,infiniteScoringPair,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),maxAssoc=parseInt(interaction.attr("maxAssociations")||0,10),minAssoc=_ignoreMinChoice?0:parseInt(interaction.attr("minAssociations")||0,10),mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0);if(options=_.defaults(options||{},{possiblePairs:[],checkInfinitePair:!1}),maxAssoc&&minAssoc&&maxAssoc<minAssoc)return 0;
if("MATCH_CORRECT"===template)!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&(!responseDeclaration.correctResponse.length||maxAssoc&&responseDeclaration.correctResponse.length>maxAssoc||minAssoc&&responseDeclaration.correctResponse.length<minAssoc)?max=0:(max=1,choicesIdentifiers=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(choicesIdentifiers.push(choices[0].trim()),choicesIdentifiers.push(choices[1].trim())))}),_.forEach(_.countBy(choicesIdentifiers),function(count,identifier){var matchMax,choice=interaction.getChoiceByIdentifier(identifier);
return choice?(matchMax=parseInt(choice.attr("matchMax"),10),matchMax&&matchMax<count?(max=0,!1):void 0):(max=0,!1)}));else if("MAP_RESPONSE"===template){if(requiredAssoc=minAssoc,totalAnswerableResponse=0===maxAssoc?1/0:maxAssoc,usedChoices={},!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;if(allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&mapDefault>0&&_.forEachRight(options.possiblePairs,function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),sortedMapEntries=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair
}}).sortBy("score").reverse().filter(function(mapEntry){var choices,choiceId,choice,_usedChoices,pair=mapEntry.pair;if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length){for(_usedChoices=_.cloneDeep(usedChoices),i=0;i<2;i++){if(choiceId=choices[i],!_usedChoices[choiceId]){if(choice=interaction.getChoiceByIdentifier(choiceId),!choice)return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}if(_usedChoices[choiceId].max&&_usedChoices[choiceId].used===_usedChoices[choiceId].max)return!1;_usedChoices[choiceId].used++}return infiniteScoringPair=infiniteScoringPair||options.checkInfinitePair&&mapEntry.score>0&&0===_usedChoices[choices[0]].max&&0===_usedChoices[choices[1]].max,
_.assign(usedChoices,_usedChoices),!0}return!1}).first(totalAnswerableResponse),infiniteScoringPair)return!1;max=sortedMapEntries.reduce(function(acc,v){var score=v.score;return v.score<0&&requiredAssoc<=0&&(score=0),requiredAssoc--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},gapMatchInteractionBased:function(interaction){var max,skippableWrongResponse,totalAnswerableResponse,usedChoices,usedGaps,group1,group2,allPossibleMapEntries,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),maxAssoc=0,minAssoc=0,mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),getMatchMaxOrderedChoices=function(choiceCollection){
return _(choiceCollection).map(function(choice){return{matchMax:0===choice.attr("matchMax")?1/0:choice.attr("matchMax")||0,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()},calculatePossiblePairs=function(gapMatchInteraction){var pairs=[],matchSet1=getMatchMaxOrderedChoices(gapMatchInteraction.getChoices()),matchSet2=getMatchMaxOrderedChoices(gapMatchInteraction.getGaps());return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs};if("MATCH_CORRECT"===template)!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?max=0:(max=1,
group1=[],group2=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(group1.push(choices[0].trim()),group2.push(choices[1].trim())))}),_.forEach(_.countBy(group1),function(count,identifier){var choice=interaction.getChoiceByIdentifier(identifier),matchMax=parseInt(choice.attr("matchMax"),10);if(matchMax&&matchMax<count)return max=0,!1}),_.forEach(_.countBy(group2),function(count){var matchMax=1;if(matchMax&&matchMax<count)return max=0,!1}));else if("MAP_RESPONSE"===template){if(skippableWrongResponse=0===minAssoc?1/0:minAssoc,totalAnswerableResponse=0===maxAssoc?1/0:maxAssoc,
usedChoices={},usedGaps={},!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&mapDefault>0&&_.forEachRight(calculatePossiblePairs(interaction),function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),max=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair}}).sortBy("score").reverse().filter(function(mapEntry){var choices,choiceId,gapId,choice,pair=mapEntry.pair,_usedChoices=_.cloneDeep(usedChoices);if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length){
if(choiceId=choices[0],gapId=choices[1],!_usedChoices[choiceId]){if(choice=interaction.getChoiceByIdentifier(choiceId),!choice)return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}return(!_usedChoices[choiceId].max||_usedChoices[choiceId].used!==_usedChoices[choiceId].max)&&(_usedChoices[choiceId].used++,usedGaps[gapId]||(usedGaps[gapId]={used:0,max:1}),(!usedGaps[gapId].max||usedGaps[gapId].used!==usedGaps[gapId].max)&&(usedGaps[gapId].used++,_.assign(usedChoices,_usedChoices),!0))}return!1}).first(totalAnswerableResponse).reduce(function(acc,v){var score=v.score;return score>=0?acc+score:skippableWrongResponse>0?(skippableWrongResponse--,
acc):acc+score},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=!1);return max},selectPointInteractionBased:function(interaction){var max,skippableWrongResponse,totalAnswerableResponse,maxChoice=parseInt(interaction.attr("maxChoices"),10),minChoice=_ignoreMinChoice?0:parseInt(interaction.attr("minChoices"),10),responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);return"MATCH_CORRECT"===template||"MAP_RESPONSE"===template?0:("MAP_RESPONSE_POINT"===template&&(skippableWrongResponse=0===minChoice?1/0:minChoice,
totalAnswerableResponse=0===maxChoice?1/0:maxChoice,max=_(responseDeclaration.mapEntries).map(function(v){return parseFloat(v.mappedValue)}).sortBy().reverse().first(totalAnswerableResponse).reduce(function(acc,v){return v>=0?acc+v:skippableWrongResponse>0?(skippableWrongResponse--,acc):acc+v},0),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))),max)},sliderInteractionBased:function(interaction){var max,scoreMaps,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);if("MATCH_CORRECT"===template)max=!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1;else if("MAP_RESPONSE"===template){
if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(responseDeclaration.mapEntries),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},textEntryInteractionBased:function(interaction){var max,scoreMaps,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),isPossibleResponse=function(value){var patternMask=interaction.attr("patternMask");
return!patternMask||!!value.match(new RegExp(patternMask))};if("MATCH_CORRECT"===template)max=!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:isPossibleResponse(responseDeclaration.correctResponse[0])?1:0;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(_.filter(responseDeclaration.mapEntries,function(score,key){return isPossibleResponse(key)})),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)));
}else"MAP_RESPONSE_POINT"===template&&(max=0);return max}}}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";var AssociateInteraction=BlockInteraction.extend({qtiClass:"associateInteraction",getNormalMaximum:function(){var calculatePossiblePairs=function(associateInteraction){var i,j,pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices());for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)pairs.push([choices[i].id,choices[j].id]);return pairs};return maxScore.associateInteractionBased(this,{
possiblePairs:calculatePossiblePairs(this)})}});return AssociateInteraction}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";var ChoiceInteraction=BlockInteraction.extend({qtiClass:"choiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return ChoiceInteraction}),define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(BlockInteraction,Container){var ContainerInteraction=BlockInteraction.extend({});
return Container.augment(ContainerInteraction),ContainerInteraction}),define("taoQtiItem/qtiItem/mixin/CustomElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){var methods={prop:function(name,value){if(name)if(void 0!==value)this.properties[name]=value;else if("object"==typeof name)for(var prop in name)this.prop(prop,name[prop]);else if("string"==typeof name)return void 0===this.properties[name]?void 0:this.properties[name];return this},removeProp:function(propNames){var _this=this;return"string"==typeof propNames&&(propNames=[propNames]),_.each(propNames,function(propName){delete _this.attributes[propName]}),this},getProperties:function(){
return _.clone(this.properties)},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function(name,uri){this.markupNs={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/interactions/CustomInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Interaction,CustomElement,NamespacedElement,rendererConfig){
var CustomInteraction=Interaction.extend({qtiClass:"customInteraction",defaultNsName:"pci",defaultNsUri:"http://www.imsglobal.org/xsd/portableCustomInteraction",nsUriFragment:"portableCustomInteraction",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.pciReadyCallbacks=[]},is:function(qtiClass){return"customInteraction"===qtiClass||this._super(qtiClass)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={
typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pci:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri
}):{}},setMarkupNamespace:function(name,uri){this.markupNs={name:name,uri:uri}},onPciReady:function(callback){this.pciReadyCallbacks.push(callback),this.data("pci")&&this.triggerPciReady()},triggerPciReady:function(){var _this=this,pci=this.data("pci");if(!pci)throw"cannot trigger pci ready when no pci is actually attached to the interaction";_.each(this.pciReadyCallbacks,function(fn){fn.call(_this,pci)}),this.pciReadyCallbacks=[],this.data("pciReady",!0)},onPci:function(event,callback){return this.onPciReady(function(pci){if(!_.isFunction(pci.on))throw"the pci does not implement on() function";pci.on(event,callback)}),this},offPci:function(event){return this.onPciReady(function(pci){
if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.off(event)}),this},triggerPci:function(event,args){return this.onPciReady(function(pci){if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.trigger(event,args)}),this}});return CustomElement.augment(CustomInteraction),NamespacedElement.augment(CustomInteraction),CustomInteraction}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(Interaction){"use strict";return Interaction.extend({is:function(qtiClass){return"inlineInteraction"===qtiClass||this._super(qtiClass)}})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(InlineInteraction){
return InlineInteraction.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore"],function(_,BlockInteraction,rendererConfig,maxScore){"use strict";var ExtendedTextInteraction=BlockInteraction.extend({qtiClass:"extendedTextInteraction",render:function(){var i,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={multiple:!1,maxStringLoop:[]},response=this.getResponseDeclaration();if(this.attr("maxStrings")&&("multiple"===response.attr("cardinality")||"ordered"===response.attr("cardinality")))for(defaultData.multiple=!0,
i=0;i<this.attr("maxStrings");i++)defaultData.maxStringLoop.push(i+"");return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}});return ExtendedTextInteraction}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,maxScore){"use strict";var GapMatchInteraction=ContainerInteraction.extend({qtiClass:"gapMatchInteraction",getGaps:function(){return this.getBody().getElements("gap")},getNormalMaximum:function(){return maxScore.gapMatchInteractionBased(this);
}});return GapMatchInteraction}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(QtiBlockInteraction,QtiObject){var QtiObjectInteraction=QtiBlockInteraction.extend({initObject:function(object){this.object=object||new QtiObject},getObject:function(){return this.object}});return QtiObjectInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(QtiObjectInteraction,_,rendererConfig){var QtiGraphicInteraction=QtiObjectInteraction.extend({
render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={backgroundImage:this.object.getAttributes(),object:this.object.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return QtiGraphicInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";var GraphicAssociateInteraction=GraphicInteraction.extend({qtiClass:"graphicAssociateInteraction",getNormalMaximum:function(){
var calculatePossiblePairs=function(associateInteraction){var i,j,pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices());for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)i!==j&&pairs.push([choices[i].id,choices[j].id]);return pairs};return maxScore.associateInteractionBased(this,{possiblePairs:calculatePossiblePairs(this)})}});return GraphicAssociateInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore","taoQtiItem/qtiItem/helper/response"],function(GraphicInteraction,Element,_,rendererConfig,maxScore,responseHelper){
"use strict";var GraphicGapMatchInteraction=GraphicInteraction.extend({qtiClass:"graphicGapMatchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.gapImgs={}},addGapImg:function(gapImg){Element.isA(gapImg,"gapImg")&&(gapImg.setRootElement(this.getRootElement()||null),this.gapImgs[gapImg.getSerial()]=gapImg)},removeGapImg:function(gapImg){var serial="";return"string"==typeof gapImg?serial=gapImg:Element.isA(gapImg,"gapImg")&&(serial=gapImg.getSerial()),delete this.gapImgs[serial],this},getGapImgs:function(){return _.clone(this.gapImgs)},getGapImg:function(serial){return this.gapImgs[serial]},getChoiceByIdentifier:function(identifier){
var choice=this._super(identifier);return choice||(choice=_.find(this.gapImgs,function(elt){return elt&&elt.id()===identifier})),choice},getComposingElements:function(){var serial,elts=this._super();for(serial in this.gapImgs)elts[serial]=this.gapImgs[serial],elts=_.extend(elts,this.gapImgs[serial].getComposingElements());return elts},find:function(serial){var found=this._super(serial);return found||this.gapImgs[serial]&&(found={parent:this,element:this.gapImgs[serial]}),found},render:function(){var serial,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={gapImgs:[]},gapImgs=this.getGapImgs();for(serial in gapImgs)Element.isA(gapImgs[serial],"choice")&&defaultData.gapImgs.push(gapImgs[serial].render({},null,"",renderer));
return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var serial,gapImgs,arr=this._super();arr.gapImgs={},gapImgs=this.getGapImgs();for(serial in gapImgs)arr.gapImgs[serial]=gapImgs[serial].toArray();return arr},getNormalMaximum:function(){var calculatePossiblePairs=function(graphicGapInteraction){var pairs=[],matchSet1=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getGapImgs()),matchSet2=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getChoices());return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs};return maxScore.associateInteractionBased(this,{
possiblePairs:calculatePossiblePairs(this),checkInfinitePair:!0})}});return GraphicGapMatchInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";var GraphicOrderInteraction=GraphicInteraction.extend({qtiClass:"graphicOrderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(this)}});return GraphicOrderInteraction}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){
"use strict";var HotspotInteraction=GraphicInteraction.extend({qtiClass:"hotspotInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return HotspotInteraction}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,Element,maxScore){"use strict";var HottextInteraction=ContainerInteraction.extend({qtiClass:"hottextInteraction",getChoices:function(){return this.getBody().getElements("hottext")},getChoice:function(serial){var element=this.getBody().getElement(serial);
return Element.isA(element,"choice")?element:null},getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return HottextInteraction}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){"use strict";var InlineChoiceInteraction=InlineInteraction.extend({qtiClass:"inlineChoiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this,{maxChoices:1})}});return InlineChoiceInteraction}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,SimpleAssociableChoice,_,rendererConfig,util,maxScore){
"use strict";var MatchInteraction=BlockInteraction.extend({qtiClass:"matchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.choices=[{},{}]},addChoice:function(choice,matchSet){matchSet=parseInt(matchSet),this.choices[matchSet]&&(choice.setRootElement(this.getRootElement()||null),this.choices[matchSet][choice.getSerial()]=choice)},getChoices:function(matchSet){return matchSet=parseInt(matchSet),this.choices[matchSet]?_.clone(this.choices[matchSet]):_.clone(this.choices)},getChoice:function(serial){return this.choices[0][serial]||this.choices[1][serial]||null},getChoiceByIdentifier:function(identifier){var i,matchSet,serial;for(i=0;i<2;i++){
matchSet=this.getChoices(i);for(serial in matchSet)if(matchSet[serial]instanceof SimpleAssociableChoice&&matchSet[serial].id()===identifier)return matchSet[serial]}return null},getComposingElements:function(){var i,matchSet,serial,elts=this._super();for(i=0;i<2;i++){matchSet=this.getChoices(i);for(serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(elts[serial]=matchSet[serial],elts=_.extend(elts,matchSet[serial].getComposingElements()))}return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["choices.0","choices.1"],serial)),found},render:function(){var choices,i,matchSet,serial,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={
matchSet1:[],matchSet2:[]},interactionData={interaction:{serial:this.serial,attributes:this.attributes}};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;for(choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),i=0;i<2;i++){matchSet=choices[i];for(serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&defaultData["matchSet"+(i+1)].push(matchSet[serial].render(_.clone(interactionData,!0),null,"simpleAssociableChoice.matchInteraction",renderer))}return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){
return renderer=renderer||this.getRenderer(),_(this.getChoices()).map(function(choices){return _(choices).filter(function(choice){return choice instanceof SimpleAssociableChoice}).map(function(choice){return choice.postRender({},"simpleAssociableChoice.matchInteraction",renderer)}).value()}).flatten(!0).value().concat(this._super(data,altClassName,renderer))},toArray:function(){var i,matchSet,serial,arr=this._super();for(arr.choices={0:{},1:{}},i=0;i<2;i++){matchSet=this.getChoices(i);for(serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(arr.choices[i][serial]=matchSet[serial].toArray())}return arr},getNormalMaximum:function(){var calculatePossiblePairs=function(matchInteraction){
var pairs=[],matchSet1=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(0)),matchSet2=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(1));return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs};return maxScore.associateInteractionBased(this,{possiblePairs:calculatePossiblePairs(this)})}});return MatchInteraction}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,ObjectInteraction,rendererConfig){"use strict";var MediaInteraction=ObjectInteraction.extend({
qtiClass:"mediaInteraction",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={object:this.object.render({},null,"",renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return MediaInteraction}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";var OrderInteraction=BlockInteraction.extend({qtiClass:"orderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(this);
}});return OrderInteraction}),define("taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";var SelectPointInteraction=GraphicInteraction.extend({qtiClass:"selectPointInteraction",getNormalMaximum:function(){return maxScore.selectPointInteractionBased(this)}});return SelectPointInteraction}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";var SliderInteraction=BlockInteraction.extend({
qtiClass:"sliderInteraction",getNormalMaximum:function(){return maxScore.sliderInteractionBased(this)}});return SliderInteraction}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){"use strict";var TextEntryInteraction=InlineInteraction.extend({qtiClass:"textEntryInteraction",getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}});return TextEntryInteraction}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(InlineInteraction){
var UploadInteraction=InlineInteraction.extend({qtiClass:"uploadInteraction"});return UploadInteraction}),define("taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="itemBody"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(Element,IdentifiedElement,Container,_,$,util){
"use strict";var Item=IdentifiedElement.extend({qtiClass:"assessmentItem",init:function(serial,attributes){this._super(serial,attributes),this.rootElement=this,this.stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.namespaces={},this.schemaLocations={},this.responseProcessing=null,this.apipAccessibility=null},getInteractions:function(){var interactions=[],elts=this.getComposingElements();for(var serial in elts)Element.isA(elts[serial],"interaction")&&interactions.push(elts[serial]);return interactions},addResponseDeclaration:function(response){if(!Element.isA(response,"responseDeclaration"))throw"is not a qti response declaration";return response.setRootElement(this),
this.responses[response.getSerial()]=response,this},getResponseDeclaration:function(identifier){for(var i in this.responses)if(this.responses[i].attr("identifier")===identifier)return this.responses[i];return null},addOutcomeDeclaration:function(outcome){if(!Element.isA(outcome,"outcomeDeclaration"))throw"is not a qti outcome declaration";return outcome.setRootElement(this),this.outcomes[outcome.getSerial()]=outcome,this},getOutcomeDeclaration:function(identifier){var found;return _.forEach(this.outcomes,function(outcome){if(outcome.id()===identifier)return found=outcome,!1}),found},getOutcomes:function(){return _.clone(this.outcomes)},removeOutcome:function(identifier){
var outcome=this.getOutcomeDeclaration(identifier);outcome&&(this.outcomes=_.omit(this.outcomes,outcome.getSerial()))},addModalFeedback:function(feedback){if(!Element.isA(feedback,"modalFeedback"))throw"is not a qti modal feedback";return feedback.setRootElement(this),this.modalFeedbacks[feedback.getSerial()]=feedback,this},getComposingElements:function(){var elts=this._super(),_this=this;return _.forEach(["responses","outcomes","modalFeedbacks","stylesheets"],function(elementCollection){for(var i in _this[elementCollection]){var elt=_this[elementCollection][i];elts[i]=elt,elts=_.extend(elts,elt.getComposingElements())}}),this.responseProcessing instanceof Element&&(elts[this.responseProcessing.getSerial()]=this.responseProcessing),
elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],serial)),found},getResponses:function(){return _.clone(this.responses)},getRootElement:function(){return this},addNamespace:function(name,uri){this.namespaces[name]=uri},setNamespaces:function(namespaces){this.namespaces=namespaces},getNamespaces:function(){return _.clone(this.namespaces)},setSchemaLocations:function(locations){this.schemaLocations=locations},getSchemaLocations:function(){return _.clone(this.schemaLocations)},setApipAccessibility:function(apip){this.apipAccessibility=apip||null},getApipAccessibility:function(){
return this.apipAccessibility},addStylesheet:function(stylesheet){if(!Element.isA(stylesheet,"stylesheet"))throw"is not a qti stylesheet declaration";return stylesheet.setRootElement(this),this.stylesheets[stylesheet.getSerial()]=stylesheet,this},removeStyleSheet:function(stylesheet){return delete this.stylesheets[stylesheet.getSerial()],this},stylesheetExists:function(href){var exists=!1;return _.forEach(this.stylesheets,function(stylesheet){if(stylesheet.attr("href")===href)return exists=!0,!1}),exists},setResponseProcessing:function(rp){if(!Element.isA(rp,"responseProcessing"))throw"is not a response processing";return rp.setRootElement(this),this.responseProcessing=rp,
this},toArray:function toArray(){var arr=this._super(),toArray=function(elt){return elt.toArray()};return arr.namespaces=this.namespaces,arr.schemaLocations=this.schemaLocations,arr.outcomes=_.map(this.outcomes,toArray),arr.responses=_.map(this.responses,toArray),arr.stylesheets=_.map(this.stylesheets,toArray),arr.modalFeedbacks=_.map(this.modalFeedbacks,toArray),arr.responseProcessing=this.responseProcessing.toArray(),arr},isEmpty:function(){var body=this.body().trim();if(body){var $dummy=$("<div>").html(body),$children=$dummy.children();return!(1!==$children.length||!$children.hasClass("empty"))}return!0},clear:function(){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.destroy)&&renderer.destroy(this);
}});return Container.augment(Item),Item}),define("taoQtiItem/qtiItem/core/Math",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/mixin/NamespacedElement"],function($,_,Element,rendererConfig,NamespacedElement){"use strict";function _stripMathTags(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":"")+"math[^>]*>","g");return mathML.replace(regex,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")}function _stripNamespace(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":""),"g");return mathML.replace(regex,"<$1")}function _isEmptyMathML(mathStr){var $math,mathText,hasContent=!1;
return mathStr&&mathStr.trim()&&($math=$($.parseHTML(mathStr)),mathText=$math.text(),hasContent=_.isString(mathText)&&!!mathText.trim()),!hasContent}var Math;return Math=Element.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",nsUriFragment:"MathML",init:function(serial,attributes){this._super(serial,attributes),this.ns=null,this.mathML="",this.annotations={}},setAnnotation:function(encoding,value){this.annotations[encoding]=_.unescape(value)},getAnnotation:function(encoding){return this.annotations[encoding]},removeAnnotation:function(encoding){delete this.annotations[encoding]},setMathML:function(mathML){var ns=this.getNamespace(),nsName=ns.name&&ns.uri?ns.name:"";
mathML=_stripMathTags(mathML,nsName),ns&&(mathML=_stripNamespace(mathML,nsName)),this.mathML=mathML},getMathML:function(){return this.mathML},render:function(){var encoding,defaultData,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),tag=this.qtiClass,raw=this.mathML,body=raw,ns=this.getNamespace(),annotations="";for(encoding in this.annotations)annotations+='<annotation encoding="'+encoding+'">'+_.escape(this.annotations[encoding])+"</annotation>";return annotations&&(raw=raw.indexOf("</semantics>")>0?raw.replace("</semantics>",annotations+"</semantics>"):"<semantics>"+raw+annotations+"</semantics>"),ns&&ns.name&&(body=raw.replace(/<(\/)?([^!<])/g,"<$1"+ns.name+":$2"),
tag=ns.name+":"+tag),body=body.replace(/<!--.*?-->/g,""),body=body.replace(/&lt;!--.*?--&gt;/g,""),defaultData={block:"block"===this.attr("display"),body:body,raw:raw,tag:tag,ns:ns},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return _isEmptyMathML(this.mathML)&&(!this.annotations.latex||!this.annotations.latex.trim())}}),NamespacedElement.augment(Math),Math}),define("taoQtiItem/qtiItem/core/PortableInfoControl",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,CustomElement,NamespacedElement,rendererConfig){
"use strict";var PortableInfoControl=Element.extend({qtiClass:"infoControl",defaultNsName:"pic",defaultNsUri:"http://www.imsglobal.org/xsd/portableInfoControl",nsUriFragment:"portableInfoControl",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.readyStack=[]},is:function(qtiClass){return"infoControl"===qtiClass||this._super(qtiClass)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,
markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pic:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getState:function(){var ret=null,renderer=this.getRenderer();return renderer&&_.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.getState)&&renderer.setState(this,state)},toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},onReady:function(cb){this.readyStack.push(cb),this.data("_ready")&&this.data("pic")&&this.triggerReady();
},triggerReady:function(){var self=this;_.forEach(this.readyStack,function(cb){cb.call(self,self.data("pic"))}),this.readyStack=[],this.data("_ready",!0)}});return CustomElement.augment(PortableInfoControl),NamespacedElement.augment(PortableInfoControl),PortableInfoControl}),define("taoQtiItem/qtiItem/core/PrintedVariable",["taoQtiItem/qtiItem/core/Element"],function(Element){"use strict";var PrintedVariable=Element.extend({qtiClass:"printedVariable"});return PrintedVariable}),define("taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){"use strict";var SimpleFeedbackRule=Element.extend({qtiClass:"_simpleFeedbackRule",
serial:"",rootElement:null,init:function(serial,feedbackOutcome,feedbackThen,feedbackElse){this._super(serial,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=feedbackOutcome,Element.isA(feedbackThen,"feedback")?this.feedbackThen=feedbackThen:this.feedbackThen=null,Element.isA(feedbackElse,"feedback")?this.feedbackElse=feedbackThen:this.feedbackElse=null},setCondition:function(comparedOutcome,condition,comparedValue){var _comparedValues=[];if(!Element.isA(comparedOutcome,"variableDeclaration"))throw"invalid outcome type: must be a variableDeclaration";switch(condition){case"correct":case"incorrect":if(!Element.isA(comparedOutcome,"responseDeclaration"))throw"invalid outcome type: must be a responseDeclaration";
this.comparedOutcome=comparedOutcome,this.condition=condition;break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null===comparedValue||void 0===comparedValue)throw"compared value must not be null";this.comparedOutcome=comparedOutcome,this.condition=condition,this.comparedValue=comparedValue;break;case"choices":if(!Element.isA(comparedOutcome,"responseDeclaration")||null===comparedValue||!_.isArray(comparedValue))throw"compared value must not be null";var choices=_.values(comparedOutcome.getInteraction().getChoices());this.comparedOutcome=comparedOutcome,this.condition=condition,_.each(comparedValue,function(v){v instanceof Element?_comparedValues.push(v):_.isString(v)&&_.each(choices,function(c){
if(c.attr("identifier")===v)return _comparedValues.push(c),!1})}),this.comparedValue=_comparedValues;break;default:throw"unknown condition type : ".condition}return this},setFeedbackElse:function(feedback){Element.isA(feedback,"feedback")&&(this.feedbackElse=feedback)},toArray:function(){var val=this.comparedValue,_toString=function(v){return val instanceof Element?val.attr("identifier"):val+""};return val=_.isArray(val)?_.map(val,_toString):_toString(val),{condition:this.condition,comparedOutcome:this.comparedOutcome.id(),comparedValue:val}}});return SimpleFeedbackRule}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){
var ResponseProcessing=Element.extend({qtiClass:"responseProcessing",processingType:"",xml:"",toArray:function(){var arr=this._super();return arr.processingType=this.processingType,arr.xml=this.xml,arr}});return ResponseProcessing}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],function(Element,Container){var RubricBlock=Element.extend({qtiClass:"rubricBlock",isEmpty:function(){return!(this.bdy&&this.bdy.body())}});return Container.augment(RubricBlock),RubricBlock}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){
var Stylesheet=Element.extend({qtiClass:"stylesheet",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={href:renderer.resolveUrl(this.attr("href"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return Stylesheet}),define("taoQtiItem/qtiItem/mixin/ContainerTable",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){"use strict";var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),
this.bdy.contentModel="table"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Table",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerTable"],function(_,Element,Container){"use strict";var Table=Element.extend({qtiClass:"table"});return Container.augment(Table),Table=Table.extend({body:function(newBody){return _.isString(newBody)&&(newBody=newBody.replace("<table>","").replace("</table>","")),this._super(newBody)}})}),define("taoQtiItem/qtiItem/core/Tooltip",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,ContainerInline,rendererConfig){
"use strict";var Tooltip=Element.extend({qtiClass:"_tooltip",init:function(serial,attributes,newContent){this._super(serial,attributes),this.content(newContent||"")},content:function(newContent){if("undefined"==typeof newContent)return this.tooltipContent;if("string"!=typeof newContent)throw new Error("newContent must be a string");return this.tooltipContent=newContent,this},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={content:this.tooltipContent};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return ContainerInline.augment(Tooltip),
Tooltip}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(VariableDeclaration,_){"use strict";var ResponseDeclaration=VariableDeclaration.extend({qtiClass:"responseDeclaration",init:function(serial,attributes){this._super(serial,attributes),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function(){return _.values(this.feedbackRules)},getComposingElements:function(){var elts=this._super();return elts=_.extend(elts,this.feedbackRules)},toArray:function(){var arr=this._super();return arr.howMatch=this.template,
arr.correctResponses=this.correctResponse,arr.mapping=this.mapEntries,arr.mappingAttributes=this.mappingAttributes,arr.feedbackRules=_.map(this.feedbackRules,function(rule){return rule.toArray()}),arr},getInteraction:function(){var interaction=null,responseId=this.id(),item=this.getRootElement(),interactions=item.getInteractions();return _.each(interactions,function(i){if(i.attributes.responseIdentifier===responseId)return interaction=i,!1}),interaction},isCardinality:function(cardinalities){var comparison;if(_.isArray(cardinalities))comparison=cardinalities;else{if(!_.isString(cardinalities))return!1;cardinalities=[cardinalities]}return _.indexOf(comparison,this.attr("cardinality"))>=0;
}});return ResponseDeclaration}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span class="qti-choice qti-gap" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\r\n    <span data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" class="gapmatch-content">&nbsp;</span>\r\n</span>'})}),define("taoQtiItem/qtiCommonRenderer/helpers/container",["lodash","jquery","taoQtiItem/qtiItem/core/Element"],function(_,$,Element){"use strict";var _containers={},_$containerContext=$(),_getSelector=function(element){var serial=element.getSerial(),selector="[data-serial="+serial+"]";return Element.isA(element,"choice")?selector=".qti-choice"+selector:Element.isA(element,"interaction")&&(selector=".qti-interaction"+selector),selector},containerHelper={setContext:function($scope){_$containerContext=$scope;
},get:function(element,$scope){var serial=element.getSerial();return $scope instanceof $&&$scope.length?$scope.find(_getSelector(element)):_$containerContext instanceof $&&_$containerContext.length?_$containerContext.find(_getSelector(element)):(_containers[serial]&&_containers[serial].length||(_containers[serial]=$(_getSelector(element))),_containers[serial])},reset:function(element){element instanceof Element&&_containers[element.getSerial()]&&(_containers=_.omit(_containers,element.getSerial()))},clear:function(){_containers={},_$containerContext=$()},trigger:function(eventType,element,data){eventType&&(data&&!_.isArray(data)&&(data=[data]),this.get(element).trigger(eventType,data));
},triggerResponseChangeEvent:function(interaction,extraData){this.trigger("responseChange",interaction,[{interaction:interaction,response:interaction.getResponse()},extraData])},targetBlank:function($container){$container.on("click","a",function(e){e.preventDefault();var href=$(this).attr("href");href&&href.match(/^http/i)&&window.open(href,"_blank")})}};return containerHelper}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gap",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+='alt="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.objetLabel,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<li class="qti-choice qti-gapImg selectable" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data
}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <img src="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.data,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n         width="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.width,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"\n         height="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.height,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"\n         ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.objectLabel),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />\n</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gapImg",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="qti-choice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gapText",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span class="qti-choice qti-hottext hottext" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\r\n    <label class="hottext-checkmark">\r\n        <input type="checkbox" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\r\n        <span class="icon-checkbox small"></span>\r\n    </label>\r\n    <span class="hottext-content">',
(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>\r\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"hottext",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<option data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</option>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(_,tpl,containerHelper){"use strict";return{qtiClass:"inlineChoice",getContainer:containerHelper.get,template:tpl,getData:function(choice,data){return data.body=_.unescape(data.body),data}}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<th class="qti-choice qti-associableChoice qti-simpleAssociableChoice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</th>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:containerHelper.get,
template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="radio" name="response-'+escapeExpression((stack1=depth0&&depth0.interaction,stack1=null==stack1||stack1===!1?stack1:stack1.serial,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="1">\n            <span class="icon-radio"></span>\n            '}function program5(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="checkbox" name="response-'+escapeExpression((stack1=depth0&&depth0.interaction,stack1=null==stack1||stack1===!1?stack1:stack1.serial,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" value="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="1">\n            <span class="icon-checkbox"></span>\n            '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<li class="qti-choice qti-simpleChoice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="pseudo-label-box">\n        <label class="real-label">\n            ',stack1=helpers.if.call(depth0,depth0&&depth0.unique,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </label>\n        <div class="label-box">\n            <div class="label-content clear" contenteditable="false">\n                ',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                <svg class="overlay-answer-eliminator">\n                    <line x1="0" y1="100%" x2="100%" y2="0"/>\n                    <line x1="0" y1="0" x2="100%" y2="100%"/>\n                </svg>\n            </div>\n        </div>\n    </div>\n    <label data-eliminable="container" data-label="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Eliminate",options):helperMissing.call(depth0,"__","Eliminate",options)))+'">\n        <span data-eliminable="trigger" class="icon-checkbox"></span>\n    </label>\n</li>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleChoice.choiceInteraction",getContainer:containerHelper.get,getData:function(choice,data){return data.unique=1===parseInt(data.interaction.attributes.maxChoices),
data},template:tpl}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleChoice.orderInteraction",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="qti-block"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>"}function program2(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program4(depth0,data){
var stack1,helper,buffer="";return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.contentModel,"blockStatic",options):helperMissing.call(depth0,"equal",depth0&&depth0.contentModel,"blockStatic",options),
stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Container",["tpl!taoQtiItem/qtiCommonRenderer/tpl/container"],function(tpl){"use strict";return{qtiClass:"_container",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+='class="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program5(depth0,data){var stack1,buffer="";return buffer+='height="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.height,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}function program7(depth0,data){var stack1,buffer="";return buffer+='width="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.width,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}function program9(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<img \n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n    data-qti-class="img" \n    src="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.src,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    alt="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.alt,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,
fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.height),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.width),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{
hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["core/promise","ui/waitForMedia","tpl!taoQtiItem/qtiCommonRenderer/tpl/img","taoQtiItem/qtiCommonRenderer/helpers/container"],function(Promise,waitForMedia,tpl,containerHelper){"use strict";return{qtiClass:"img",template:tpl,getContainer:containerHelper.get,render:function(img,data){return new Promise(function(resolve,reject){containerHelper.get(img).waitForMedia(resolve)})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,functionType="function";return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Include",["tpl!taoQtiItem/qtiCommonRenderer/tpl/include"],function(tpl){"use strict";return{qtiClass:"include",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div\n    ",
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    class="qti-interaction qti-blockInteraction qti-associateInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n    data-qti-class="associateInteraction"\n    ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <ul class="choice-area clearfix  none block-listing solid horizontal source">\n        ',
options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n    <ul class="result-area none target clearfix">\n    </ul>\n    <div class="notification-container"></div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"incomplete-pair"}function program3(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="',stack1=helpers.if.call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,
fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="target lft"></div>\n    <div class="target rgt"></div>\n</li>\n'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div id="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="small feedback-info item-instruction"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <span class="icon-info icon"></span><span class="instruction-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(_,util,instructionTpl){
var _notificationLevels=["info","warning","error","success"],Instruction=function(interaction,message,callback){this.interaction=interaction,this.defaultMessage=message||"",this.currentMessage="",this.level="info",this.serial=util.buildSerial("instruction_"),this.callback=callback,this.$dom=null,this.state=!1};return Instruction.isValidLevel=function(level){return _.indexOf(_notificationLevels,level)>=0},Instruction.prototype.setState=function(state){this.state=state},Instruction.prototype.checkState=function(state){return this.state===state},Instruction.prototype.getId=function(){return this.serial},Instruction.prototype.create=function($container){$container.append(instructionTpl({
message:this.defaultMessage,serial:this.serial})),this.$dom=$container.find("#"+this.serial)},Instruction.prototype.update=function(options){var level=options&&options.level?options.level:"",message=options&&options.message?options.message:"",timeout=options&&options.timeout?options.timeout:0,start=options&&"function"==typeof options.start?options.start:null,stop=options&&"function"==typeof options.stop?options.stop:null;if(level&&Instruction.isValidLevel(level)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+level),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+level),this.level=level),message&&(this.$dom.find(".instruction-message").html(message),
this.currentMessage=message),timeout){var _this=this;start&&start.call(_this),_this.timer=setTimeout(function(){stop&&stop.call(_this),_this.timer=null},timeout)}},Instruction.prototype.setLevel=function(level,timeout){var options={level:level};timeout&&(options.timeout=parseInt(timeout),options.stop=function(){this.setLevel("info")}),this.update(options)},Instruction.prototype.getLevel=function(){return this.level},Instruction.prototype.setMessage=function(message,timeout){this.update({message:message,timeout:timeout})},Instruction.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),this.state=!1},Instruction.prototype.validate=function(data){
"function"==typeof this.callback&&this.callback.call(this,data)},Instruction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;
return buffer+='<div class="small feedback-',(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+' item-notification"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <span class="icon-',(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span><span class="feedback-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+'" class="icon-close close-trigger"></span>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager",["lodash","jquery","i18n","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(_,$,__,containerHelper,Instruction,notifTpl){
"use strict";var _instructions={},instructionManager={validateInstructions:function(element,data){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.validate(data||{})})},appendInstruction:function(element,message,validateCallback){var serial=element.getSerial(),instruction=new Instruction(element,message,validateCallback);return _instructions[serial]||(_instructions[serial]={}),_instructions[serial][instruction.getId()]=instruction,instruction.create($(".instruction-container",containerHelper.get(element))),instruction},removeInstructions:function(element){_instructions[element.getSerial()]={},
containerHelper.get(element).find(".instruction-container").empty()},resetInstructions:function(element){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.reset()})},minMaxChoiceInstructions:function(interaction,options){var msg,self=this,min=options.min||0,max=options.max||0,getResponse=options.getResponse,onError=options.onError||_.noop(),choiceCount=options.choiceCount!==!1&&_.size(interaction.getChoices()),minInstructionSet=!1;if(!_.isFunction(getResponse))throw"invalid parameter getResponse";max>0&&(choiceCount===!1||max<choiceCount)&&(max===min?(minInstructionSet=!0,msg=max<=1?__("You must select exactly %d choice",max):__("You must select exactly %d choices",max),
self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function(){onError(data)},stop:function(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=max<=1?__("You can select maximum %d choice",max):__("You can select maximum %d choices",max),self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({
level:"warning",timeout:2e3,start:function(){onError(data)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&min>0&&(choiceCount===!1||min<choiceCount)&&(msg=min<=1?__("You must at least %d choice",min):__("You must select at least %d choices",min),self.appendInstruction(interaction,msg,function(){getResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},appendNotification:function(element,message,level){if(level=level||"info",Instruction.isValidLevel(level)){var $container=containerHelper.get(element);$container.find(".notification-container").prepend(notifTpl({level:level,message:message
}));var $notif=$container.find(".item-notification:first"),_remove=function(){$notif.fadeOut()};return $notif.find(".close-trigger").on("click",_remove),setTimeout(_remove,2e3),$notif}},removeNotifications:function(element){containerHelper.get(element).find(".item-notification").remove()}};return instructionManager}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter",["jquery","lodash","util/adaptSize","ui/waitForMedia"],function($,_,adaptSize,waitForMedia){"use strict";return{adaptSize:function(target){var $elements,$container;switch(!0){case"undefined"!=typeof target.$container:$elements=target.$container.find(".add-option, .result-area .target, .choice-area .qti-choice"),
$container=target.$container;break;default:$elements=target,$container=$($elements).first().parent()}$container.waitForMedia(function(){adaptSize.height($elements)})}}}),function(realWindow){"use strict";function blank(){}function isElement(o){if(!o||"object"!=typeof o)return!1;var _window=getWindow(o)||window;return/object|function/.test(typeof _window.Element)?o instanceof _window.Element:1===o.nodeType&&"string"==typeof o.nodeName}function isWindow(thing){return thing===window||!(!thing||!thing.Window)&&thing instanceof thing.Window}function isDocFrag(thing){return!!thing&&thing instanceof DocumentFragment}function isArray(thing){return isObject(thing)&&void 0!==typeof thing.length&&isFunction(thing.splice);
}function isObject(thing){return!!thing&&"object"==typeof thing}function isFunction(thing){return"function"==typeof thing}function isNumber(thing){return"number"==typeof thing}function isBool(thing){return"boolean"==typeof thing}function isString(thing){return"string"==typeof thing}function trySelector(value){return!!isString(value)&&(document.querySelector(value),!0)}function extend(dest,source){for(var prop in source)dest[prop]=source[prop];return dest}function pointerExtend(dest,source){for(var prop in source){var deprecated=!1;for(var vendor in prefixedPropREs)if(0===prop.indexOf(vendor)&&prefixedPropREs[vendor].test(prop)){deprecated=!0;break}deprecated||(dest[prop]=source[prop]);
}return dest}function copyCoords(dest,src){dest.page=dest.page||{},dest.page.x=src.page.x,dest.page.y=src.page.y,dest.client=dest.client||{},dest.client.x=src.client.x,dest.client.y=src.client.y,dest.timeStamp=src.timeStamp}function setEventXY(targetObj,pointers,interaction){var pointer=pointers.length>1?pointerAverage(pointers):pointers[0];getPageXY(pointer,tmpXY,interaction),targetObj.page.x=tmpXY.x,targetObj.page.y=tmpXY.y,getClientXY(pointer,tmpXY,interaction),targetObj.client.x=tmpXY.x,targetObj.client.y=tmpXY.y,targetObj.timeStamp=(new Date).getTime()}function setEventDeltas(targetObj,prev,cur){targetObj.page.x=cur.page.x-prev.page.x,targetObj.page.y=cur.page.y-prev.page.y,
targetObj.client.x=cur.client.x-prev.client.x,targetObj.client.y=cur.client.y-prev.client.y,targetObj.timeStamp=(new Date).getTime()-prev.timeStamp;var dt=Math.max(targetObj.timeStamp/1e3,.001);targetObj.page.speed=hypot(targetObj.page.x,targetObj.page.y)/dt,targetObj.page.vx=targetObj.page.x/dt,targetObj.page.vy=targetObj.page.y/dt,targetObj.client.speed=hypot(targetObj.client.x,targetObj.page.y)/dt,targetObj.client.vx=targetObj.client.x/dt,targetObj.client.vy=targetObj.client.y/dt}function isNativePointer(pointer){return pointer instanceof window.Event||supportsTouch&&window.Touch&&pointer instanceof window.Touch}function getXY(type,pointer,xy){return xy=xy||{},
type=type||"page",xy.x=pointer[type+"X"],xy.y=pointer[type+"Y"],xy}function getPageXY(pointer,page){return page=page||{},isOperaMobile&&isNativePointer(pointer)?(getXY("screen",pointer,page),page.x+=window.scrollX,page.y+=window.scrollY):getXY("page",pointer,page),page}function getClientXY(pointer,client){return client=client||{},isOperaMobile&&isNativePointer(pointer)?getXY("screen",pointer,client):getXY("client",pointer,client),client}function getScrollXY(win){return win=win||window,{x:win.scrollX||win.document.documentElement.scrollLeft,y:win.scrollY||win.document.documentElement.scrollTop}}function getPointerId(pointer){return isNumber(pointer.pointerId)?pointer.pointerId:pointer.identifier;
}function getActualElement(element){return element instanceof SVGElementInstance?element.correspondingUseElement:element}function getWindow(node){if(isWindow(node))return node;var rootNode=node.ownerDocument||node;return rootNode.defaultView||rootNode.parentWindow||window}function getElementClientRect(element){var clientRect=element instanceof SVGElement?element.getBoundingClientRect():element.getClientRects()[0];return clientRect&&{left:clientRect.left,right:clientRect.right,top:clientRect.top,bottom:clientRect.bottom,width:clientRect.width||clientRect.right-clientRect.left,height:clientRect.height||clientRect.bottom-clientRect.top}}function getElementRect(element){
var clientRect=getElementClientRect(element);if(!isIOS7&&clientRect){var scroll=getScrollXY(getWindow(element));clientRect.left+=scroll.x,clientRect.right+=scroll.x,clientRect.top+=scroll.y,clientRect.bottom+=scroll.y}return clientRect}function getTouchPair(event){var touches=[];return isArray(event)?(touches[0]=event[0],touches[1]=event[1]):"touchend"===event.type?1===event.touches.length?(touches[0]=event.touches[0],touches[1]=event.changedTouches[0]):0===event.touches.length&&(touches[0]=event.changedTouches[0],touches[1]=event.changedTouches[1]):(touches[0]=event.touches[0],touches[1]=event.touches[1]),touches}function pointerAverage(pointers){for(var prop,average={
pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},i=0;i<pointers.length;i++)for(prop in average)average[prop]+=pointers[i][prop];for(prop in average)average[prop]/=pointers.length;return average}function touchBBox(event){if(event.length||event.touches&&event.touches.length>1){var touches=getTouchPair(event),minX=Math.min(touches[0].pageX,touches[1].pageX),minY=Math.min(touches[0].pageY,touches[1].pageY),maxX=Math.max(touches[0].pageX,touches[1].pageX),maxY=Math.max(touches[0].pageY,touches[1].pageY);return{x:minX,y:minY,left:minX,top:minY,width:maxX-minX,height:maxY-minY}}}function touchDistance(event,deltaSource){deltaSource=deltaSource||defaultOptions.deltaSource;
var sourceX=deltaSource+"X",sourceY=deltaSource+"Y",touches=getTouchPair(event),dx=touches[0][sourceX]-touches[1][sourceX],dy=touches[0][sourceY]-touches[1][sourceY];return hypot(dx,dy)}function touchAngle(event,prevAngle,deltaSource){deltaSource=deltaSource||defaultOptions.deltaSource;var sourceX=deltaSource+"X",sourceY=deltaSource+"Y",touches=getTouchPair(event),dx=touches[0][sourceX]-touches[1][sourceX],dy=touches[0][sourceY]-touches[1][sourceY],angle=180*Math.atan(dy/dx)/Math.PI;if(isNumber(prevAngle)){var dr=angle-prevAngle,drClamped=dr%360;drClamped>315?angle-=360+angle/360|0:drClamped>135?angle-=180+angle/360|0:drClamped<-315?angle+=360+angle/360|0:drClamped<-135&&(angle+=180+angle/360|0);
}return angle}function getOriginXY(interactable,element){var origin=interactable?interactable.options.origin:defaultOptions.origin;return"parent"===origin?origin=parentElement(element):"self"===origin?origin=interactable.getRect(element):trySelector(origin)&&(origin=closest(element,origin)||{x:0,y:0}),isFunction(origin)&&(origin=origin(interactable&&element)),isElement(origin)&&(origin=getElementRect(origin)),origin.x="x"in origin?origin.x:origin.left,origin.y="y"in origin?origin.y:origin.top,origin}function _getQBezierValue(t,p1,p2,p3){var iT=1-t;return iT*iT*p1+2*iT*t*p2+t*t*p3}function getQuadraticCurvePoint(startX,startY,cpX,cpY,endX,endY,position){return{
x:_getQBezierValue(position,startX,cpX,endX),y:_getQBezierValue(position,startY,cpY,endY)}}function easeOutQuad(t,b,c,d){return t/=d,-c*t*(t-2)+b}function nodeContains(parent,child){for(;child;){if(child===parent)return!0;child=child.parentNode}return!1}function closest(child,selector){for(var parent=parentElement(child);isElement(parent);){if(matchesSelector(parent,selector))return parent;parent=parentElement(parent)}return null}function parentElement(node){var parent=node.parentNode;if(isDocFrag(parent)){for(;(parent=parent.host)&&isDocFrag(parent););return parent}return parent}function inContext(interactable,element){return interactable._context===element.ownerDocument||nodeContains(interactable._context,element);
}function testIgnore(interactable,interactableElement,element){var ignoreFrom=interactable.options.ignoreFrom;return!(!ignoreFrom||!isElement(element))&&(isString(ignoreFrom)?matchesUpTo(element,ignoreFrom,interactableElement):!!isElement(ignoreFrom)&&nodeContains(ignoreFrom,element))}function testAllow(interactable,interactableElement,element){var allowFrom=interactable.options.allowFrom;return!allowFrom||!!isElement(element)&&(isString(allowFrom)?matchesUpTo(element,allowFrom,interactableElement):!!isElement(allowFrom)&&nodeContains(allowFrom,element))}function checkAxis(axis,interactable){if(!interactable)return!1;var thisAxis=interactable.options.drag.axis;
return"xy"===axis||"xy"===thisAxis||thisAxis===axis}function checkSnap(interactable,action){var options=interactable.options;return/^resize/.test(action)&&(action="resize"),options[action].snap&&options[action].snap.enabled}function checkRestrict(interactable,action){var options=interactable.options;return/^resize/.test(action)&&(action="resize"),options[action].restrict&&options[action].restrict.enabled}function checkAutoScroll(interactable,action){var options=interactable.options;return/^resize/.test(action)&&(action="resize"),options[action].autoScroll&&options[action].autoScroll.enabled}function withinInteractionLimit(interactable,element,action){for(var options=interactable.options,maxActions=options[action.name].max,maxPerElement=options[action.name].maxPerElement,activeInteractions=0,targetCount=0,targetElementCount=0,i=0,len=interactions.length;i<len;i++){
var interaction=interactions[i],otherAction=interaction.prepared.name,active=interaction.interacting();if(active){if(activeInteractions++,activeInteractions>=maxInteractions)return!1;if(interaction.target===interactable){if(targetCount+=otherAction===action.name|0,targetCount>=maxActions)return!1;if(interaction.element===element&&(targetElementCount++,otherAction!==action.name||targetElementCount>=maxPerElement))return!1}}}return maxInteractions>0}function indexOfDeepestElement(elements){var dropzone,parent,child,i,n,deepestZone=elements[0],index=deepestZone?0:-1,deepestZoneParents=[],dropzoneParents=[];for(i=1;i<elements.length;i++)if(dropzone=elements[i],dropzone&&dropzone!==deepestZone)if(deepestZone){
if(dropzone.parentNode!==dropzone.ownerDocument)if(deepestZone.parentNode!==dropzone.ownerDocument){if(!deepestZoneParents.length)for(parent=deepestZone;parent.parentNode&&parent.parentNode!==parent.ownerDocument;)deepestZoneParents.unshift(parent),parent=parent.parentNode;if(deepestZone instanceof HTMLElement&&dropzone instanceof SVGElement&&!(dropzone instanceof SVGSVGElement)){if(dropzone===deepestZone.parentNode)continue;parent=dropzone.ownerSVGElement}else parent=dropzone;for(dropzoneParents=[];parent.parentNode!==parent.ownerDocument;)dropzoneParents.unshift(parent),parent=parent.parentNode;for(n=0;dropzoneParents[n]&&dropzoneParents[n]===deepestZoneParents[n];)n++;
var parents=[dropzoneParents[n-1],dropzoneParents[n],deepestZoneParents[n]];for(child=parents[0].lastChild;child;){if(child===parents[1]){deepestZone=dropzone,index=i,deepestZoneParents=[];break}if(child===parents[2])break;child=child.previousSibling}}else deepestZone=dropzone,index=i}else deepestZone=dropzone,index=i;return index}function Interaction(){if(this.target=null,this.element=null,this.dropTarget=null,this.dropElement=null,this.prevDropTarget=null,this.prevDropElement=null,this.prepared={name:null,axis:null,edges:null},this.matches=[],this.matchElements=[],this.inertiaStatus={active:!1,smoothEnd:!1,ending:!1,startEvent:null,upCoords:{},xe:0,ye:0,sx:0,
sy:0,t0:0,vx0:0,vys:0,duration:0,resumeDx:0,resumeDy:0,lambda_v0:0,one_ve_v0:0,i:null},isFunction(Function.prototype.bind))this.boundInertiaFrame=this.inertiaFrame.bind(this),this.boundSmoothEndFrame=this.smoothEndFrame.bind(this);else{var that=this;this.boundInertiaFrame=function(){return that.inertiaFrame()},this.boundSmoothEndFrame=function(){return that.smoothEndFrame()}}this.activeDrops={dropzones:[],elements:[],rects:[]},this.pointers=[],this.pointerIds=[],this.downTargets=[],this.downTimes=[],this.holdTimers=[],this.prevCoords={page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},this.curCoords={page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},this.startCoords={page:{
x:0,y:0},client:{x:0,y:0},timeStamp:0},this.pointerDelta={page:{x:0,y:0,vx:0,vy:0,speed:0},client:{x:0,y:0,vx:0,vy:0,speed:0},timeStamp:0},this.downEvent=null,this.downPointer={},this._eventTarget=null,this._curEventTarget=null,this.prevEvent=null,this.tapTime=0,this.prevTap=null,this.startOffset={left:0,right:0,top:0,bottom:0},this.restrictOffset={left:0,right:0,top:0,bottom:0},this.snapOffsets=[],this.gesture={start:{x:0,y:0},startDistance:0,prevDistance:0,distance:0,scale:1,startAngle:0,prevAngle:0},this.snapStatus={x:0,y:0,dx:0,dy:0,realX:0,realY:0,snappedX:0,snappedY:0,targets:[],locked:!1,changed:!1},this.restrictStatus={dx:0,dy:0,restrictedX:0,restrictedY:0,
snap:null,restricted:!1,changed:!1},this.restrictStatus.snap=this.snapStatus,this.pointerIsDown=!1,this.pointerWasMoved=!1,this.gesturing=!1,this.dragging=!1,this.resizing=!1,this.resizeAxes="xy",this.mouse=!1,interactions.push(this)}function getInteractionFromPointer(pointer,eventType,eventTarget){var interaction,i=0,len=interactions.length,mouseEvent=/mouse/i.test(pointer.pointerType||eventType)||4===pointer.pointerType,id=getPointerId(pointer);if(/down|start/i.test(eventType))for(i=0;i<len;i++){interaction=interactions[i];var element=eventTarget;if(interaction.inertiaStatus.active&&interaction.target.options[interaction.prepared.name].inertia.allowResume&&interaction.mouse===mouseEvent)for(;element;){
if(element===interaction.element)return interaction;element=parentElement(element)}}if(mouseEvent||!supportsTouch&&!supportsPointerEvent){for(i=0;i<len;i++)if(interactions[i].mouse&&!interactions[i].inertiaStatus.active)return interactions[i];for(i=0;i<len;i++)if(interactions[i].mouse&&(!/down/.test(eventType)||!interactions[i].inertiaStatus.active))return interaction;return interaction=new Interaction,interaction.mouse=!0,interaction}for(i=0;i<len;i++)if(contains(interactions[i].pointerIds,id))return interactions[i];if(/up|end|out/i.test(eventType))return null;for(i=0;i<len;i++)if(interaction=interactions[i],(!interaction.prepared.name||interaction.target.options.gesture.enabled)&&!interaction.interacting()&&(mouseEvent||!interaction.mouse))return interaction;
return new Interaction}function doOnInteractions(method){return function(event){var interaction,i,eventTarget=getActualElement(event.path?event.path[0]:event.target),curEventTarget=getActualElement(event.currentTarget);if(supportsTouch&&/touch/.test(event.type))for(prevTouchTime=(new Date).getTime(),i=0;i<event.changedTouches.length;i++){var pointer=event.changedTouches[i];interaction=getInteractionFromPointer(pointer,event.type,eventTarget),interaction&&(interaction._updateEventTargets(eventTarget,curEventTarget),interaction[method](pointer,event,eventTarget,curEventTarget))}else{if(!supportsPointerEvent&&/mouse/.test(event.type)){for(i=0;i<interactions.length;i++)if(!interactions[i].mouse&&interactions[i].pointerIsDown)return;
if((new Date).getTime()-prevTouchTime<500)return}if(interaction=getInteractionFromPointer(event,event.type,eventTarget),!interaction)return;interaction._updateEventTargets(eventTarget,curEventTarget),interaction[method](event,event,eventTarget,curEventTarget)}}}function InteractEvent(interaction,event,action,phase,element,related){var client,page,target=interaction.target,snapStatus=interaction.snapStatus,restrictStatus=interaction.restrictStatus,pointers=interaction.pointers,deltaSource=(target&&target.options||defaultOptions).deltaSource,sourceX=deltaSource+"X",sourceY=deltaSource+"Y",options=target?target.options:defaultOptions,origin=getOriginXY(target,element),starting="start"===phase,ending="end"===phase,coords=starting?interaction.startCoords:interaction.curCoords;
element=element||interaction.element,page=extend({},coords.page),client=extend({},coords.client),page.x-=origin.x,page.y-=origin.y,client.x-=origin.x,client.y-=origin.y;var relativePoints=options[action].snap&&options[action].snap.relativePoints;!checkSnap(target,action)||starting&&relativePoints&&relativePoints.length||(this.snap={range:snapStatus.range,locked:snapStatus.locked,x:snapStatus.snappedX,y:snapStatus.snappedY,realX:snapStatus.realX,realY:snapStatus.realY,dx:snapStatus.dx,dy:snapStatus.dy},snapStatus.locked&&(page.x+=snapStatus.dx,page.y+=snapStatus.dy,client.x+=snapStatus.dx,client.y+=snapStatus.dy)),!checkRestrict(target,action)||starting&&options[action].restrict.elementRect||!restrictStatus.restricted||(page.x+=restrictStatus.dx,
page.y+=restrictStatus.dy,client.x+=restrictStatus.dx,client.y+=restrictStatus.dy,this.restrict={dx:restrictStatus.dx,dy:restrictStatus.dy}),this.pageX=page.x,this.pageY=page.y,this.clientX=client.x,this.clientY=client.y,this.x0=interaction.startCoords.page.x-origin.x,this.y0=interaction.startCoords.page.y-origin.y,this.clientX0=interaction.startCoords.client.x-origin.x,this.clientY0=interaction.startCoords.client.y-origin.y,this.ctrlKey=event.ctrlKey,this.altKey=event.altKey,this.shiftKey=event.shiftKey,this.metaKey=event.metaKey,this.button=event.button,this.buttons=event.buttons,this.target=element,this.t0=interaction.downTimes[0],this.type=action+(phase||""),
this.interaction=interaction,this.interactable=target;var inertiaStatus=interaction.inertiaStatus;if(inertiaStatus.active&&(this.detail="inertia"),related&&(this.relatedTarget=related),ending?"client"===deltaSource?(this.dx=client.x-interaction.startCoords.client.x,this.dy=client.y-interaction.startCoords.client.y):(this.dx=page.x-interaction.startCoords.page.x,this.dy=page.y-interaction.startCoords.page.y):starting?(this.dx=0,this.dy=0):"inertiastart"===phase?(this.dx=interaction.prevEvent.dx,this.dy=interaction.prevEvent.dy):"client"===deltaSource?(this.dx=client.x-interaction.prevEvent.clientX,this.dy=client.y-interaction.prevEvent.clientY):(this.dx=page.x-interaction.prevEvent.pageX,
this.dy=page.y-interaction.prevEvent.pageY),interaction.prevEvent&&"inertia"===interaction.prevEvent.detail&&!inertiaStatus.active&&options[action].inertia&&options[action].inertia.zeroResumeDelta&&(inertiaStatus.resumeDx+=this.dx,inertiaStatus.resumeDy+=this.dy,this.dx=this.dy=0),"resize"===action&&interaction.resizeAxes?options.resize.square?("y"===interaction.resizeAxes?this.dx=this.dy:this.dy=this.dx,this.axes="xy"):(this.axes=interaction.resizeAxes,"x"===interaction.resizeAxes?this.dy=0:"y"===interaction.resizeAxes&&(this.dx=0)):"gesture"===action&&(this.touches=[pointers[0],pointers[1]],starting?(this.distance=touchDistance(pointers,deltaSource),this.box=touchBBox(pointers),
this.scale=1,this.ds=0,this.angle=touchAngle(pointers,void 0,deltaSource),this.da=0):ending||event instanceof InteractEvent?(this.distance=interaction.prevEvent.distance,this.box=interaction.prevEvent.box,this.scale=interaction.prevEvent.scale,this.ds=this.scale-1,this.angle=interaction.prevEvent.angle,this.da=this.angle-interaction.gesture.startAngle):(this.distance=touchDistance(pointers,deltaSource),this.box=touchBBox(pointers),this.scale=this.distance/interaction.gesture.startDistance,this.angle=touchAngle(pointers,interaction.gesture.prevAngle,deltaSource),this.ds=this.scale-interaction.gesture.prevScale,this.da=this.angle-interaction.gesture.prevAngle)),
starting)this.timeStamp=interaction.downTimes[0],this.dt=0,this.duration=0,this.speed=0,this.velocityX=0,this.velocityY=0;else if("inertiastart"===phase)this.timeStamp=interaction.prevEvent.timeStamp,this.dt=interaction.prevEvent.dt,this.duration=interaction.prevEvent.duration,this.speed=interaction.prevEvent.speed,this.velocityX=interaction.prevEvent.velocityX,this.velocityY=interaction.prevEvent.velocityY;else if(this.timeStamp=(new Date).getTime(),this.dt=this.timeStamp-interaction.prevEvent.timeStamp,this.duration=this.timeStamp-interaction.downTimes[0],event instanceof InteractEvent){var dx=this[sourceX]-interaction.prevEvent[sourceX],dy=this[sourceY]-interaction.prevEvent[sourceY],dt=this.dt/1e3;
this.speed=hypot(dx,dy)/dt,this.velocityX=dx/dt,this.velocityY=dy/dt}else this.speed=interaction.pointerDelta[deltaSource].speed,this.velocityX=interaction.pointerDelta[deltaSource].vx,this.velocityY=interaction.pointerDelta[deltaSource].vy;if((ending||"inertiastart"===phase)&&interaction.prevEvent.speed>600&&this.timeStamp-interaction.prevEvent.timeStamp<150){var angle=180*Math.atan2(interaction.prevEvent.velocityY,interaction.prevEvent.velocityX)/Math.PI,overlap=22.5;angle<0&&(angle+=360);var left=135-overlap<=angle&&angle<225+overlap,up=225-overlap<=angle&&angle<315+overlap,right=!left&&(315-overlap<=angle||angle<45+overlap),down=!up&&45-overlap<=angle&&angle<135+overlap;
this.swipe={up:up,down:down,left:left,right:right,angle:angle,speed:interaction.prevEvent.speed,velocity:{x:interaction.prevEvent.velocityX,y:interaction.prevEvent.velocityY}}}}function preventOriginalDefault(){this.originalEvent.preventDefault()}function getActionCursor(action){var cursor="";if("drag"===action.name&&(cursor=actionCursors.drag),"resize"===action.name)if(action.axis)cursor=actionCursors[action.name+action.axis];else if(action.edges){for(var cursorKey="resize",edgeNames=["top","bottom","left","right"],i=0;i<4;i++)action.edges[edgeNames[i]]&&(cursorKey+=edgeNames[i]);cursor=actionCursors[cursorKey]}return cursor}function checkResizeEdge(name,value,page,element,interactableElement,rect,margin){
if(!value)return!1;if(value===!0){var width=isNumber(rect.width)?rect.width:rect.right-rect.left,height=isNumber(rect.height)?rect.height:rect.bottom-rect.top;if(width<0&&("left"===name?name="right":"right"===name&&(name="left")),height<0&&("top"===name?name="bottom":"bottom"===name&&(name="top")),"left"===name)return page.x<(width>=0?rect.left:rect.right)+margin;if("top"===name)return page.y<(height>=0?rect.top:rect.bottom)+margin;if("right"===name)return page.x>(width>=0?rect.right:rect.left)-margin;if("bottom"===name)return page.y>(height>=0?rect.bottom:rect.top)-margin}return!!isElement(element)&&(isElement(value)?value===element:matchesUpTo(element,value,interactableElement));
}function defaultActionChecker(pointer,interaction,element){var resizeEdges,rect=this.getRect(element),shouldResize=!1,action=null,resizeAxes=null,page=extend({},interaction.curCoords.page),options=this.options;if(!rect)return null;if(actionIsEnabled.resize&&options.resize.enabled){var resizeOptions=options.resize;if(resizeEdges={left:!1,right:!1,top:!1,bottom:!1},isObject(resizeOptions.edges)){for(var edge in resizeEdges)resizeEdges[edge]=checkResizeEdge(edge,resizeOptions.edges[edge],page,interaction._eventTarget,element,rect,resizeOptions.margin||margin);resizeEdges.left=resizeEdges.left&&!resizeEdges.right,resizeEdges.top=resizeEdges.top&&!resizeEdges.bottom,
shouldResize=resizeEdges.left||resizeEdges.right||resizeEdges.top||resizeEdges.bottom}else{var right="y"!==options.resize.axis&&page.x>rect.right-margin,bottom="x"!==options.resize.axis&&page.y>rect.bottom-margin;shouldResize=right||bottom,resizeAxes=(right?"x":"")+(bottom?"y":"")}}return action=shouldResize?"resize":actionIsEnabled.drag&&options.drag.enabled?"drag":null,actionIsEnabled.gesture&&interaction.pointerIds.length>=2&&!interaction.dragging&&!interaction.resizing&&(action="gesture"),action?{name:action,axis:resizeAxes,edges:resizeEdges}:null}function validateAction(action,interactable){if(!isObject(action))return null;var actionName=action.name,options=interactable.options;
return("resize"===actionName&&options.resize.enabled||"drag"===actionName&&options.drag.enabled||"gesture"===actionName&&options.gesture.enabled)&&actionIsEnabled[actionName]?("resize"!==actionName&&"resizeyx"!==actionName||(actionName="resizexy"),action):null}function delegateListener(event,useCapture){var fakeEvent={},delegated=delegatedEvents[event.type],eventTarget=getActualElement(event.path?event.path[0]:event.target),element=eventTarget;useCapture=!!useCapture;for(var prop in event)fakeEvent[prop]=event[prop];for(fakeEvent.originalEvent=event,fakeEvent.preventDefault=preventOriginalDefault;isElement(element);){for(var i=0;i<delegated.selectors.length;i++){
var selector=delegated.selectors[i],context=delegated.contexts[i];if(matchesSelector(element,selector)&&nodeContains(context,eventTarget)&&nodeContains(context,element)){var listeners=delegated.listeners[i];fakeEvent.currentTarget=element;for(var j=0;j<listeners.length;j++)listeners[j][1]===useCapture&&listeners[j][0](fakeEvent)}}element=parentElement(element)}}function delegateUseCapture(event){return delegateListener.call(this,event,!0)}function interact(element,options){return interactables.get(element,options)||new Interactable(element,options)}function Interactable(element,options){this._element=element,this._iEvents=this._iEvents||{};var _window;if(trySelector(element)){
this.selector=element;var context=options&&options.context;_window=context?getWindow(context):window,context&&(_window.Node?context instanceof _window.Node:isElement(context)||context===_window.document)&&(this._context=context)}else _window=getWindow(element),isElement(element,_window)&&(supportsPointerEvent?(events.add(this._element,pEventTypes.down,listeners.pointerDown),events.add(this._element,pEventTypes.move,listeners.pointerHover)):(events.add(this._element,"mousedown",listeners.pointerDown),events.add(this._element,"mousemove",listeners.pointerHover),events.add(this._element,"touchstart",listeners.pointerDown),events.add(this._element,"touchmove",listeners.pointerHover)));
this._doc=_window.document,contains(documents,this._doc)||listenToDocument(this._doc),interactables.push(this),this.set(options)}function warnOnce(method,message){var warned=!1;return function(){return warned||(window.console.warn(message),warned=!0),method.apply(this,arguments)}}function endAllInteractions(event){for(var i=0;i<interactions.length;i++)interactions[i].pointerEnd(event,event)}function listenToDocument(doc){if(!contains(documents,doc)){var win=doc.defaultView||doc.parentWindow;for(var eventType in delegatedEvents)events.add(doc,eventType,delegateListener),events.add(doc,eventType,delegateUseCapture,!0);supportsPointerEvent?(pEventTypes=PointerEvent===win.MSPointerEvent?{
up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"},events.add(doc,pEventTypes.down,listeners.selectorDown),events.add(doc,pEventTypes.move,listeners.pointerMove),events.add(doc,pEventTypes.over,listeners.pointerOver),events.add(doc,pEventTypes.out,listeners.pointerOut),events.add(doc,pEventTypes.up,listeners.pointerUp),events.add(doc,pEventTypes.cancel,listeners.pointerCancel),events.add(doc,pEventTypes.move,listeners.autoScrollMove)):(events.add(doc,"mousedown",listeners.selectorDown),
events.add(doc,"mousemove",listeners.pointerMove),events.add(doc,"mouseup",listeners.pointerUp),events.add(doc,"mouseover",listeners.pointerOver),events.add(doc,"mouseout",listeners.pointerOut),events.add(doc,"touchstart",listeners.selectorDown),events.add(doc,"touchmove",listeners.pointerMove),events.add(doc,"touchend",listeners.pointerUp),events.add(doc,"touchcancel",listeners.pointerCancel),events.add(doc,"mousemove",listeners.autoScrollMove),events.add(doc,"touchmove",listeners.autoScrollMove)),events.add(win,"blur",endAllInteractions);try{if(win.frameElement){var parentDoc=win.frameElement.ownerDocument,parentWindow=parentDoc.defaultView;events.add(parentDoc,"mouseup",listeners.pointerEnd),
events.add(parentDoc,"touchend",listeners.pointerEnd),events.add(parentDoc,"touchcancel",listeners.pointerEnd),events.add(parentDoc,"pointerup",listeners.pointerEnd),events.add(parentDoc,"MSPointerUp",listeners.pointerEnd),events.add(parentWindow,"blur",endAllInteractions)}}catch(error){interact.windowParentError=error}events.add(doc,"dragstart",function(event){for(var i=0;i<interactions.length;i++){var interaction=interactions[i];if(interaction.element&&(interaction.element===event.target||nodeContains(interaction.element,event.target)))return void interaction.checkAndPreventDefault(event,interaction.target,interaction.element)}}),events.useAttachEvent&&(events.add(doc,"selectstart",function(event){
var interaction=interactions[0];interaction.currentAction()&&interaction.checkAndPreventDefault(event)}),events.add(doc,"dblclick",doOnInteractions("ie8Dblclick"))),documents.push(doc)}}function indexOf(array,target){for(var i=0,len=array.length;i<len;i++)if(array[i]===target)return i;return-1}function contains(array,target){return indexOf(array,target)!==-1}function matchesSelector(element,selector,nodeList){return ie8MatchesSelector?ie8MatchesSelector(element,selector,nodeList):(window!==realWindow&&(selector=selector.replace(/\/deep\//g," ")),element[prefixedMatchesSelector](selector))}function matchesUpTo(element,selector,limit){for(;isElement(element);){
if(matchesSelector(element,selector))return!0;if(element=parentElement(element),element===limit)return matchesSelector(element,selector)}return!1}if(realWindow){var pEventTypes,ie8MatchesSelector,window=function(){var el=realWindow.document.createTextNode("");return el.ownerDocument!==realWindow.document&&"function"==typeof realWindow.wrap&&realWindow.wrap(el)===el?realWindow.wrap(realWindow):realWindow}(),document=window.document,DocumentFragment=window.DocumentFragment||blank,SVGElement=window.SVGElement||blank,SVGSVGElement=window.SVGSVGElement||blank,SVGElementInstance=window.SVGElementInstance||blank,HTMLElement=window.HTMLElement||window.Element,PointerEvent=window.PointerEvent||window.MSPointerEvent,hypot=Math.hypot||function(x,y){
return Math.sqrt(x*x+y*y)},tmpXY={},documents=[],interactables=[],interactions=[],dynamicDrop=!1,delegatedEvents={},defaultOptions={base:{accept:null,actionChecker:null,styleCursor:!0,preventDefault:"auto",origin:{x:0,y:0},deltaSource:"page",allowFrom:null,ignoreFrom:null,_context:document,dropChecker:null},drag:{enabled:!1,manualStart:!0,max:1/0,maxPerElement:1,snap:null,restrict:null,inertia:null,autoScroll:null,axis:"xy"},drop:{enabled:!1,accept:null,overlap:"pointer"},resize:{enabled:!1,manualStart:!1,max:1/0,maxPerElement:1,snap:null,restrict:null,inertia:null,autoScroll:null,square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},
gesture:{manualStart:!1,enabled:!1,max:1/0,maxPerElement:1,restrict:null},perAction:{manualStart:!1,max:1/0,maxPerElement:1,snap:{enabled:!1,endOnly:!1,range:1/0,targets:null,offsets:null,relativePoints:null},restrict:{enabled:!1,endOnly:!1},autoScroll:{enabled:!1,container:null,margin:60,speed:300},inertia:{enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,zeroResumeDelta:!0,smoothEndDuration:300}},_holdDuration:600},autoScroll={interaction:null,i:null,x:0,y:0,scroll:function(){var vx,vy,sx,sy,options=autoScroll.interaction.target.options[autoScroll.interaction.prepared.name].autoScroll,container=options.container||getWindow(autoScroll.interaction.element),now=(new Date).getTime(),dtx=(now-autoScroll.prevTimeX)/1e3,dty=(now-autoScroll.prevTimeY)/1e3;
options.velocity?(vx=options.velocity.x,vy=options.velocity.y):vx=vy=options.speed,sx=vx*dtx,sy=vy*dty,(sx>=1||sy>=1)&&(isWindow(container)?container.scrollBy(autoScroll.x*sx,autoScroll.y*sy):container&&(container.scrollLeft+=autoScroll.x*sx,container.scrollTop+=autoScroll.y*sy),sx>=1&&(autoScroll.prevTimeX=now),sy>=1&&(autoScroll.prevTimeY=now)),autoScroll.isScrolling&&(cancelFrame(autoScroll.i),autoScroll.i=reqFrame(autoScroll.scroll))},isScrolling:!1,prevTimeX:0,prevTimeY:0,start:function(interaction){autoScroll.isScrolling=!0,cancelFrame(autoScroll.i),autoScroll.interaction=interaction,autoScroll.prevTimeX=(new Date).getTime(),autoScroll.prevTimeY=(new Date).getTime(),
autoScroll.i=reqFrame(autoScroll.scroll)},stop:function(){autoScroll.isScrolling=!1,cancelFrame(autoScroll.i)}},supportsTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsPointerEvent=PointerEvent&&!/Chrome/.test(navigator.userAgent),margin=supportsTouch||supportsPointerEvent?20:10,pointerMoveTolerance=1,prevTouchTime=0,maxInteractions=1/0,actionCursors=document.all&&!window.atob?{drag:"move",resizex:"e-resize",resizey:"s-resize",resizexy:"se-resize",resizetop:"n-resize",resizeleft:"w-resize",resizebottom:"s-resize",resizeright:"e-resize",resizetopleft:"se-resize",resizebottomright:"se-resize",resizetopright:"ne-resize",
resizebottomleft:"ne-resize",gesture:""}:{drag:"move",resizex:"ew-resize",resizey:"ns-resize",resizexy:"nwse-resize",resizetop:"ns-resize",resizeleft:"ew-resize",resizebottom:"ns-resize",resizeright:"ew-resize",resizetopleft:"nwse-resize",resizebottomright:"nwse-resize",resizetopright:"nesw-resize",resizebottomleft:"nesw-resize",gesture:""},actionIsEnabled={drag:!0,resize:!0,gesture:!0},wheelEvent="onmousewheel"in document?"mousewheel":"wheel",eventTypes=["dragstart","dragmove","draginertiastart","dragend","dragenter","dragleave","dropactivate","dropdeactivate","dropmove","drop","resizestart","resizemove","resizeinertiastart","resizeend","gesturestart","gesturemove","gestureinertiastart","gestureend","down","move","up","cancel","tap","doubletap","hold"],globalEvents={},isOperaMobile="Opera"==navigator.appName&&supportsTouch&&navigator.userAgent.match("Presto"),isIOS7=/iP(hone|od|ad)/.test(navigator.platform)&&/OS 7[^\d]/.test(navigator.appVersion),prefixedMatchesSelector="matches"in Element.prototype?"matches":"webkitMatchesSelector"in Element.prototype?"webkitMatchesSelector":"mozMatchesSelector"in Element.prototype?"mozMatchesSelector":"oMatchesSelector"in Element.prototype?"oMatchesSelector":"msMatchesSelector",reqFrame=realWindow.requestAnimationFrame,cancelFrame=realWindow.cancelAnimationFrame,events=function(){
function add(element,type,listener,useCapture){var elementIndex=indexOf(elements,element),target=targets[elementIndex];if(target||(target={events:{},typeCount:0},elementIndex=elements.push(element)-1,targets.push(target),attachedListeners.push(useAttachEvent?{supplied:[],wrapped:[],useCount:[]}:null)),target.events[type]||(target.events[type]=[],target.typeCount++),!contains(target.events[type],listener)){var ret;if(useAttachEvent){var listeners=attachedListeners[elementIndex],listenerIndex=indexOf(listeners.supplied,listener),wrapped=listeners.wrapped[listenerIndex]||function(event){event.immediatePropagationStopped||(event.target=event.srcElement,event.currentTarget=element,
event.preventDefault=event.preventDefault||preventDef,event.stopPropagation=event.stopPropagation||stopProp,event.stopImmediatePropagation=event.stopImmediatePropagation||stopImmProp,/mouse|click/.test(event.type)&&(event.pageX=event.clientX+getWindow(element).document.documentElement.scrollLeft,event.pageY=event.clientY+getWindow(element).document.documentElement.scrollTop),listener(event))};ret=element[addEvent](on+type,wrapped,Boolean(useCapture)),listenerIndex===-1?(listeners.supplied.push(listener),listeners.wrapped.push(wrapped),listeners.useCount.push(1)):listeners.useCount[listenerIndex]++}else ret=element[addEvent](type,listener,useCapture||!1);return target.events[type].push(listener),
ret}}function remove(element,type,listener,useCapture){var i,listeners,listenerIndex,elementIndex=indexOf(elements,element),target=targets[elementIndex],wrapped=listener;if(target&&target.events)if(useAttachEvent&&(listeners=attachedListeners[elementIndex],listenerIndex=indexOf(listeners.supplied,listener),wrapped=listeners.wrapped[listenerIndex]),"all"!==type){if(target.events[type]){var len=target.events[type].length;if("all"===listener){for(i=0;i<len;i++)remove(element,type,target.events[type][i],Boolean(useCapture));return}for(i=0;i<len;i++)if(target.events[type][i]===listener){element[removeEvent](on+type,wrapped,useCapture||!1),target.events[type].splice(i,1),
useAttachEvent&&listeners&&(listeners.useCount[listenerIndex]--,0===listeners.useCount[listenerIndex]&&(listeners.supplied.splice(listenerIndex,1),listeners.wrapped.splice(listenerIndex,1),listeners.useCount.splice(listenerIndex,1)));break}target.events[type]&&0===target.events[type].length&&(target.events[type]=null,target.typeCount--)}target.typeCount||(targets.splice(elementIndex,1),elements.splice(elementIndex,1),attachedListeners.splice(elementIndex,1))}else for(type in target.events)target.events.hasOwnProperty(type)&&remove(element,type,"all")}function preventDef(){this.returnValue=!1}function stopProp(){this.cancelBubble=!0}function stopImmProp(){this.cancelBubble=!0,
this.immediatePropagationStopped=!0}var useAttachEvent="attachEvent"in window&&!("addEventListener"in window),addEvent=useAttachEvent?"attachEvent":"addEventListener",removeEvent=useAttachEvent?"detachEvent":"removeEventListener",on=useAttachEvent?"on":"",elements=[],targets=[],attachedListeners=[];return{add:add,remove:remove,useAttachEvent:useAttachEvent,_elements:elements,_targets:targets,_attachedListeners:attachedListeners}}(),prefixedPropREs={webkit:/(Movement[XY]|Radius[XY]|RotationAngle|Force)$/};Interaction.prototype={getPageXY:function(pointer,xy){return getPageXY(pointer,xy,this)},getClientXY:function(pointer,xy){return getClientXY(pointer,xy,this);
},setEventXY:function(target,ptr){return setEventXY(target,ptr,this)},pointerOver:function(pointer,event,eventTarget){function pushCurMatches(interactable,selector){interactable&&inContext(interactable,eventTarget)&&!testIgnore(interactable,eventTarget,eventTarget)&&testAllow(interactable,eventTarget,eventTarget)&&matchesSelector(eventTarget,selector)&&(curMatches.push(interactable),curMatchElements.push(eventTarget))}if(!this.prepared.name&&this.mouse){var curMatches=[],curMatchElements=[],prevTargetElement=this.element;this.addPointer(pointer),!this.target||!testIgnore(this.target,this.element,eventTarget)&&testAllow(this.target,this.element,eventTarget)||(this.target=null,
this.element=null,this.matches=[],this.matchElements=[]);var elementInteractable=interactables.get(eventTarget),elementAction=elementInteractable&&!testIgnore(elementInteractable,eventTarget,eventTarget)&&testAllow(elementInteractable,eventTarget,eventTarget)&&validateAction(elementInteractable.getAction(pointer,event,this,eventTarget),elementInteractable);elementAction&&!withinInteractionLimit(elementInteractable,eventTarget,elementAction)&&(elementAction=null),elementAction?(this.target=elementInteractable,this.element=eventTarget,this.matches=[],this.matchElements=[]):(interactables.forEachSelector(pushCurMatches),this.validateSelector(pointer,event,curMatches,curMatchElements)?(this.matches=curMatches,
this.matchElements=curMatchElements,this.pointerHover(pointer,event,this.matches,this.matchElements),events.add(eventTarget,supportsPointerEvent?pEventTypes.move:"mousemove",listeners.pointerHover)):this.target&&(nodeContains(prevTargetElement,eventTarget)?(this.pointerHover(pointer,event,this.matches,this.matchElements),events.add(this.element,supportsPointerEvent?pEventTypes.move:"mousemove",listeners.pointerHover)):(this.target=null,this.element=null,this.matches=[],this.matchElements=[])))}},pointerHover:function(pointer,event,eventTarget,curEventTarget,matches,matchElements){var target=this.target;if(!this.prepared.name&&this.mouse){var action;this.setEventXY(this.curCoords,[pointer]),
matches?action=this.validateSelector(pointer,event,matches,matchElements):target&&(action=validateAction(target.getAction(this.pointers[0],event,this,this.element),this.target)),target&&target.options.styleCursor&&(action?target._doc.documentElement.style.cursor=getActionCursor(action):target._doc.documentElement.style.cursor="")}else this.prepared.name&&this.checkAndPreventDefault(event,target,this.element)},pointerOut:function(pointer,event,eventTarget){this.prepared.name||(interactables.get(eventTarget)||events.remove(eventTarget,supportsPointerEvent?pEventTypes.move:"mousemove",listeners.pointerHover),this.target&&this.target.options.styleCursor&&!this.interacting()&&(this.target._doc.documentElement.style.cursor=""));
},selectorDown:function(pointer,event,eventTarget,curEventTarget){function pushMatches(interactable,selector,context){var elements=ie8MatchesSelector?context.querySelectorAll(selector):void 0;inContext(interactable,element)&&!testIgnore(interactable,element,eventTarget)&&testAllow(interactable,element,eventTarget)&&matchesSelector(element,selector,elements)&&(that.matches.push(interactable),that.matchElements.push(element))}var action,that=this,eventCopy=events.useAttachEvent?extend({},event):event,element=eventTarget,pointerIndex=this.addPointer(pointer);if(this.holdTimers[pointerIndex]=setTimeout(function(){that.pointerHold(events.useAttachEvent?eventCopy:pointer,eventCopy,eventTarget,curEventTarget);
},defaultOptions._holdDuration),this.pointerIsDown=!0,this.inertiaStatus.active&&this.target.selector)for(;isElement(element);){if(element===this.element&&validateAction(this.target.getAction(pointer,event,this,this.element),this.target).name===this.prepared.name)return cancelFrame(this.inertiaStatus.i),this.inertiaStatus.active=!1,void this.collectEventTargets(pointer,event,eventTarget,"down");element=parentElement(element)}if(this.interacting())return void this.collectEventTargets(pointer,event,eventTarget,"down");for(this.setEventXY(this.curCoords,[pointer]),this.downEvent=event;isElement(element)&&!action;)this.matches=[],this.matchElements=[],interactables.forEachSelector(pushMatches),
action=this.validateSelector(pointer,event,this.matches,this.matchElements),element=parentElement(element);return action?(this.prepared.name=action.name,this.prepared.axis=action.axis,this.prepared.edges=action.edges,this.collectEventTargets(pointer,event,eventTarget,"down"),this.pointerDown(pointer,event,eventTarget,curEventTarget,action)):(this.downTimes[pointerIndex]=(new Date).getTime(),this.downTargets[pointerIndex]=eventTarget,pointerExtend(this.downPointer,pointer),copyCoords(this.prevCoords,this.curCoords),this.pointerWasMoved=!1,void this.collectEventTargets(pointer,event,eventTarget,"down"))},pointerDown:function(pointer,event,eventTarget,curEventTarget,forceAction){
if(!forceAction&&!this.inertiaStatus.active&&this.pointerWasMoved&&this.prepared.name)return void this.checkAndPreventDefault(event,this.target,this.element);this.pointerIsDown=!0,this.downEvent=event;var action,pointerIndex=this.addPointer(pointer);if(this.pointerIds.length>1&&this.target._element===this.element){var newAction=validateAction(forceAction||this.target.getAction(pointer,event,this,this.element),this.target);withinInteractionLimit(this.target,this.element,newAction)&&(action=newAction),this.prepared.name=null}else if(!this.prepared.name){var interactable=interactables.get(curEventTarget);interactable&&!testIgnore(interactable,curEventTarget,eventTarget)&&testAllow(interactable,curEventTarget,eventTarget)&&(action=validateAction(forceAction||interactable.getAction(pointer,event,this,curEventTarget),interactable,eventTarget))&&withinInteractionLimit(interactable,curEventTarget,action)&&(this.target=interactable,
this.element=curEventTarget)}var target=this.target,options=target&&target.options;if(!target||!forceAction&&this.prepared.name)this.inertiaStatus.active&&curEventTarget===this.element&&validateAction(target.getAction(pointer,event,this,this.element),target).name===this.prepared.name&&(cancelFrame(this.inertiaStatus.i),this.inertiaStatus.active=!1,this.checkAndPreventDefault(event,target,this.element));else{if(action=action||validateAction(forceAction||target.getAction(pointer,event,this,curEventTarget),target,this.element),this.setEventXY(this.startCoords,this.pointers),!action)return;options.styleCursor&&(target._doc.documentElement.style.cursor=getActionCursor(action)),
this.resizeAxes="resize"===action.name?action.axis:null,"gesture"===action&&this.pointerIds.length<2&&(action=null),this.prepared.name=action.name,this.prepared.axis=action.axis,this.prepared.edges=action.edges,this.snapStatus.snappedX=this.snapStatus.snappedY=this.restrictStatus.restrictedX=this.restrictStatus.restrictedY=NaN,this.downTimes[pointerIndex]=(new Date).getTime(),this.downTargets[pointerIndex]=eventTarget,pointerExtend(this.downPointer,pointer),copyCoords(this.prevCoords,this.startCoords),this.pointerWasMoved=!1,this.checkAndPreventDefault(event,target,this.element)}},setModifications:function(coords,preEnd){var target=this.target,shouldMove=!0,shouldSnap=checkSnap(target,this.prepared.name)&&(!target.options[this.prepared.name].snap.endOnly||preEnd),shouldRestrict=checkRestrict(target,this.prepared.name)&&(!target.options[this.prepared.name].restrict.endOnly||preEnd);
return shouldSnap?this.setSnapping(coords):this.snapStatus.locked=!1,shouldRestrict?this.setRestriction(coords):this.restrictStatus.restricted=!1,shouldSnap&&this.snapStatus.locked&&!this.snapStatus.changed?shouldMove=shouldRestrict&&this.restrictStatus.restricted&&this.restrictStatus.changed:shouldRestrict&&this.restrictStatus.restricted&&!this.restrictStatus.changed&&(shouldMove=!1),shouldMove},setStartOffsets:function(action,interactable,element){var width,height,rect=interactable.getRect(element),origin=getOriginXY(interactable,element),snap=interactable.options[this.prepared.name].snap,restrict=interactable.options[this.prepared.name].restrict;rect?(this.startOffset.left=this.startCoords.page.x-rect.left,
this.startOffset.top=this.startCoords.page.y-rect.top,this.startOffset.right=rect.right-this.startCoords.page.x,this.startOffset.bottom=rect.bottom-this.startCoords.page.y,width="width"in rect?rect.width:rect.right-rect.left,height="height"in rect?rect.height:rect.bottom-rect.top):this.startOffset.left=this.startOffset.top=this.startOffset.right=this.startOffset.bottom=0,this.snapOffsets.splice(0);var snapOffset=snap&&"startCoords"===snap.offset?{x:this.startCoords.page.x-origin.x,y:this.startCoords.page.y-origin.y}:snap&&snap.offset||{x:0,y:0};if(rect&&snap&&snap.relativePoints&&snap.relativePoints.length)for(var i=0;i<snap.relativePoints.length;i++)this.snapOffsets.push({
x:this.startOffset.left-width*snap.relativePoints[i].x+snapOffset.x,y:this.startOffset.top-height*snap.relativePoints[i].y+snapOffset.y});else this.snapOffsets.push(snapOffset);rect&&restrict.elementRect?(this.restrictOffset.left=this.startOffset.left-width*restrict.elementRect.left,this.restrictOffset.top=this.startOffset.top-height*restrict.elementRect.top,this.restrictOffset.right=this.startOffset.right-width*(1-restrict.elementRect.right),this.restrictOffset.bottom=this.startOffset.bottom-height*(1-restrict.elementRect.bottom)):this.restrictOffset.left=this.restrictOffset.top=this.restrictOffset.right=this.restrictOffset.bottom=0},start:function(action,interactable,element){
this.interacting()||!this.pointerIsDown||this.pointerIds.length<("gesture"===action.name?2:1)||(indexOf(interactions,this)===-1&&interactions.push(this),this.prepared.name||this.setEventXY(this.startCoords,this.pointers),this.prepared.name=action.name,this.prepared.axis=action.axis,this.prepared.edges=action.edges,this.target=interactable,this.element=element,this.setStartOffsets(action.name,interactable,element),this.setModifications(this.startCoords.page),this.prevEvent=this[this.prepared.name+"Start"](this.downEvent))},pointerMove:function(pointer,event,eventTarget,curEventTarget,preEnd){if(this.inertiaStatus.active){var pageUp=this.inertiaStatus.upCoords.page,clientUp=this.inertiaStatus.upCoords.client,inertiaPosition={
pageX:pageUp.x+this.inertiaStatus.sx,pageY:pageUp.y+this.inertiaStatus.sy,clientX:clientUp.x+this.inertiaStatus.sx,clientY:clientUp.y+this.inertiaStatus.sy};this.setEventXY(this.curCoords,[inertiaPosition])}else this.recordPointer(pointer),this.setEventXY(this.curCoords,this.pointers);var dx,dy,duplicateMove=this.curCoords.page.x===this.prevCoords.page.x&&this.curCoords.page.y===this.prevCoords.page.y&&this.curCoords.client.x===this.prevCoords.client.x&&this.curCoords.client.y===this.prevCoords.client.y,pointerIndex=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer));if(this.pointerIsDown&&!this.pointerWasMoved&&(dx=this.curCoords.client.x-this.startCoords.client.x,
dy=this.curCoords.client.y-this.startCoords.client.y,this.pointerWasMoved=hypot(dx,dy)>pointerMoveTolerance),duplicateMove||this.pointerIsDown&&!this.pointerWasMoved||(this.pointerIsDown&&clearTimeout(this.holdTimers[pointerIndex]),this.collectEventTargets(pointer,event,eventTarget,"move")),this.pointerIsDown){if(duplicateMove&&this.pointerWasMoved&&!preEnd)return void this.checkAndPreventDefault(event,this.target,this.element);if(setEventDeltas(this.pointerDelta,this.prevCoords,this.curCoords),this.prepared.name){if(this.pointerWasMoved&&(!this.inertiaStatus.active||pointer instanceof InteractEvent&&/inertiastart/.test(pointer.type))){if(!this.interacting()&&(setEventDeltas(this.pointerDelta,this.prevCoords,this.curCoords),
"drag"===this.prepared.name)){var absX=Math.abs(dx),absY=Math.abs(dy),targetAxis=this.target.options.drag.axis,axis=absX>absY?"x":absX<absY?"y":"xy";if("xy"!==axis&&"xy"!==targetAxis&&targetAxis!==axis){this.prepared.name=null;for(var element=eventTarget;isElement(element);){var elementInteractable=interactables.get(element);if(elementInteractable&&elementInteractable!==this.target&&!elementInteractable.options.drag.manualStart&&"drag"===elementInteractable.getAction(this.downPointer,this.downEvent,this,element).name&&checkAxis(axis,elementInteractable)){this.prepared.name="drag",this.target=elementInteractable,this.element=element;break}element=parentElement(element);
}if(!this.prepared.name){var thisInteraction=this,getDraggable=function(interactable,selector,context){var elements=ie8MatchesSelector?context.querySelectorAll(selector):void 0;if(interactable!==thisInteraction.target)return inContext(interactable,eventTarget)&&!interactable.options.drag.manualStart&&!testIgnore(interactable,element,eventTarget)&&testAllow(interactable,element,eventTarget)&&matchesSelector(element,selector,elements)&&"drag"===interactable.getAction(thisInteraction.downPointer,thisInteraction.downEvent,thisInteraction,element).name&&checkAxis(axis,interactable)&&withinInteractionLimit(interactable,element,"drag")?interactable:void 0};for(element=eventTarget;isElement(element);){
var selectorInteractable=interactables.forEachSelector(getDraggable);if(selectorInteractable){this.prepared.name="drag",this.target=selectorInteractable,this.element=element;break}element=parentElement(element)}}}}var starting=!!this.prepared.name&&!this.interacting();if(starting&&(this.target.options[this.prepared.name].manualStart||!withinInteractionLimit(this.target,this.element,this.prepared)))return void this.stop(event);if(this.prepared.name&&this.target){starting&&this.start(this.prepared,this.target,this.element);var shouldMove=this.setModifications(this.curCoords.page,preEnd);(shouldMove||starting)&&(this.prevEvent=this[this.prepared.name+"Move"](event)),
this.checkAndPreventDefault(event,this.target,this.element)}}copyCoords(this.prevCoords,this.curCoords),(this.dragging||this.resizing)&&this.autoScrollMove(pointer)}}},dragStart:function(event){var dragEvent=new InteractEvent(this,event,"drag","start",this.element);this.dragging=!0,this.target.fire(dragEvent),this.activeDrops.dropzones=[],this.activeDrops.elements=[],this.activeDrops.rects=[],this.dynamicDrop||this.setActiveDrops(this.element);var dropEvents=this.getDropEvents(event,dragEvent);return dropEvents.activate&&this.fireActiveDrops(dropEvents.activate),dragEvent},dragMove:function(event){var target=this.target,dragEvent=new InteractEvent(this,event,"drag","move",this.element),draggableElement=this.element,drop=this.getDrop(dragEvent,event,draggableElement);
this.dropTarget=drop.dropzone,this.dropElement=drop.element;var dropEvents=this.getDropEvents(event,dragEvent);return target.fire(dragEvent),dropEvents.leave&&this.prevDropTarget.fire(dropEvents.leave),dropEvents.enter&&this.dropTarget.fire(dropEvents.enter),dropEvents.move&&this.dropTarget.fire(dropEvents.move),this.prevDropTarget=this.dropTarget,this.prevDropElement=this.dropElement,dragEvent},resizeStart:function(event){var resizeEvent=new InteractEvent(this,event,"resize","start",this.element);if(this.prepared.edges){var startRect=this.target.getRect(this.element);if(this.target.options.resize.square||this.target.options.resize.preserveAspectRatio){var linkedEdges=extend({},this.prepared.edges);
linkedEdges.top=linkedEdges.top||linkedEdges.left&&!linkedEdges.bottom,linkedEdges.left=linkedEdges.left||linkedEdges.top&&!linkedEdges.right,linkedEdges.bottom=linkedEdges.bottom||linkedEdges.right&&!linkedEdges.top,linkedEdges.right=linkedEdges.right||linkedEdges.bottom&&!linkedEdges.left,this.prepared._linkedEdges=linkedEdges}else this.prepared._linkedEdges=null;this.target.options.resize.preserveAspectRatio&&(this.resizeStartAspectRatio=startRect.width/startRect.height),this.resizeRects={start:startRect,current:extend({},startRect),restricted:extend({},startRect),previous:extend({},startRect),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},resizeEvent.rect=this.resizeRects.restricted,
resizeEvent.deltaRect=this.resizeRects.delta}return this.target.fire(resizeEvent),this.resizing=!0,resizeEvent},resizeMove:function(event){var resizeEvent=new InteractEvent(this,event,"resize","move",this.element),edges=this.prepared.edges,invert=this.target.options.resize.invert,invertible="reposition"===invert||"negate"===invert;if(edges){var dx=resizeEvent.dx,dy=resizeEvent.dy,start=this.resizeRects.start,current=this.resizeRects.current,restricted=this.resizeRects.restricted,delta=this.resizeRects.delta,previous=extend(this.resizeRects.previous,restricted),originalEdges=edges;if(this.target.options.resize.preserveAspectRatio){var resizeStartAspectRatio=this.resizeStartAspectRatio;
edges=this.prepared._linkedEdges,originalEdges.left&&originalEdges.bottom||originalEdges.right&&originalEdges.top?dy=-dx/resizeStartAspectRatio:originalEdges.left||originalEdges.right?dy=dx/resizeStartAspectRatio:(originalEdges.top||originalEdges.bottom)&&(dx=dy*resizeStartAspectRatio)}else this.target.options.resize.square&&(edges=this.prepared._linkedEdges,originalEdges.left&&originalEdges.bottom||originalEdges.right&&originalEdges.top?dy=-dx:originalEdges.left||originalEdges.right?dy=dx:(originalEdges.top||originalEdges.bottom)&&(dx=dy));if(edges.top&&(current.top+=dy),edges.bottom&&(current.bottom+=dy),edges.left&&(current.left+=dx),edges.right&&(current.right+=dx),
invertible){if(extend(restricted,current),"reposition"===invert){var swap;restricted.top>restricted.bottom&&(swap=restricted.top,restricted.top=restricted.bottom,restricted.bottom=swap),restricted.left>restricted.right&&(swap=restricted.left,restricted.left=restricted.right,restricted.right=swap)}}else restricted.top=Math.min(current.top,start.bottom),restricted.bottom=Math.max(current.bottom,start.top),restricted.left=Math.min(current.left,start.right),restricted.right=Math.max(current.right,start.left);restricted.width=restricted.right-restricted.left,restricted.height=restricted.bottom-restricted.top;for(var edge in restricted)delta[edge]=restricted[edge]-previous[edge];
resizeEvent.edges=this.prepared.edges,resizeEvent.rect=restricted,resizeEvent.deltaRect=delta}return this.target.fire(resizeEvent),resizeEvent},gestureStart:function(event){var gestureEvent=new InteractEvent(this,event,"gesture","start",this.element);return gestureEvent.ds=0,this.gesture.startDistance=this.gesture.prevDistance=gestureEvent.distance,this.gesture.startAngle=this.gesture.prevAngle=gestureEvent.angle,this.gesture.scale=1,this.gesturing=!0,this.target.fire(gestureEvent),gestureEvent},gestureMove:function(event){if(!this.pointerIds.length)return this.prevEvent;var gestureEvent;return gestureEvent=new InteractEvent(this,event,"gesture","move",this.element),
gestureEvent.ds=gestureEvent.scale-this.gesture.scale,this.target.fire(gestureEvent),this.gesture.prevAngle=gestureEvent.angle,this.gesture.prevDistance=gestureEvent.distance,gestureEvent.scale===1/0||null===gestureEvent.scale||void 0===gestureEvent.scale||isNaN(gestureEvent.scale)||(this.gesture.scale=gestureEvent.scale),gestureEvent},pointerHold:function(pointer,event,eventTarget){this.collectEventTargets(pointer,event,eventTarget,"hold")},pointerUp:function(pointer,event,eventTarget,curEventTarget){var pointerIndex=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer));clearTimeout(this.holdTimers[pointerIndex]),this.collectEventTargets(pointer,event,eventTarget,"up"),
this.collectEventTargets(pointer,event,eventTarget,"tap"),this.pointerEnd(pointer,event,eventTarget,curEventTarget),this.removePointer(pointer)},pointerCancel:function(pointer,event,eventTarget,curEventTarget){var pointerIndex=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer));clearTimeout(this.holdTimers[pointerIndex]),this.collectEventTargets(pointer,event,eventTarget,"cancel"),this.pointerEnd(pointer,event,eventTarget,curEventTarget),this.removePointer(pointer)},ie8Dblclick:function(pointer,event,eventTarget){this.prevTap&&event.clientX===this.prevTap.clientX&&event.clientY===this.prevTap.clientY&&eventTarget===this.prevTap.target&&(this.downTargets[0]=eventTarget,
this.downTimes[0]=(new Date).getTime(),this.collectEventTargets(pointer,event,eventTarget,"tap"))},pointerEnd:function(pointer,event,eventTarget,curEventTarget){var endEvent,target=this.target,options=target&&target.options,inertiaOptions=options&&this.prepared.name&&options[this.prepared.name].inertia,inertiaStatus=this.inertiaStatus;if(this.interacting()){if(inertiaStatus.active&&!inertiaStatus.ending)return;var pointerSpeed,startEvent,now=(new Date).getTime(),inertiaPossible=!1,inertia=!1,smoothEnd=!1,endSnap=checkSnap(target,this.prepared.name)&&options[this.prepared.name].snap.endOnly,endRestrict=checkRestrict(target,this.prepared.name)&&options[this.prepared.name].restrict.endOnly,dx=0,dy=0;
if(pointerSpeed=this.dragging?"x"===options.drag.axis?Math.abs(this.pointerDelta.client.vx):"y"===options.drag.axis?Math.abs(this.pointerDelta.client.vy):this.pointerDelta.client.speed:this.pointerDelta.client.speed,inertiaPossible=inertiaOptions&&inertiaOptions.enabled&&"gesture"!==this.prepared.name&&event!==inertiaStatus.startEvent,inertia=inertiaPossible&&now-this.curCoords.timeStamp<50&&pointerSpeed>inertiaOptions.minSpeed&&pointerSpeed>inertiaOptions.endSpeed,inertiaPossible&&!inertia&&(endSnap||endRestrict)){var snapRestrict={};snapRestrict.snap=snapRestrict.restrict=snapRestrict,endSnap&&(this.setSnapping(this.curCoords.page,snapRestrict),snapRestrict.locked&&(dx+=snapRestrict.dx,
dy+=snapRestrict.dy)),endRestrict&&(this.setRestriction(this.curCoords.page,snapRestrict),snapRestrict.restricted&&(dx+=snapRestrict.dx,dy+=snapRestrict.dy)),(dx||dy)&&(smoothEnd=!0)}if(inertia||smoothEnd){if(copyCoords(inertiaStatus.upCoords,this.curCoords),this.pointers[0]=inertiaStatus.startEvent=startEvent=new InteractEvent(this,event,this.prepared.name,"inertiastart",this.element),inertiaStatus.t0=now,target.fire(inertiaStatus.startEvent),inertia){inertiaStatus.vx0=this.pointerDelta.client.vx,inertiaStatus.vy0=this.pointerDelta.client.vy,inertiaStatus.v0=pointerSpeed,this.calcInertia(inertiaStatus);var statusObject,page=extend({},this.curCoords.page),origin=getOriginXY(target,this.element);
if(page.x=page.x+inertiaStatus.xe-origin.x,page.y=page.y+inertiaStatus.ye-origin.y,statusObject={useStatusXY:!0,x:page.x,y:page.y,dx:0,dy:0,snap:null},statusObject.snap=statusObject,dx=dy=0,endSnap){var snap=this.setSnapping(this.curCoords.page,statusObject);snap.locked&&(dx+=snap.dx,dy+=snap.dy)}if(endRestrict){var restrict=this.setRestriction(this.curCoords.page,statusObject);restrict.restricted&&(dx+=restrict.dx,dy+=restrict.dy)}inertiaStatus.modifiedXe+=dx,inertiaStatus.modifiedYe+=dy,inertiaStatus.i=reqFrame(this.boundInertiaFrame)}else inertiaStatus.smoothEnd=!0,inertiaStatus.xe=dx,inertiaStatus.ye=dy,inertiaStatus.sx=inertiaStatus.sy=0,inertiaStatus.i=reqFrame(this.boundSmoothEndFrame);
return void(inertiaStatus.active=!0)}(endSnap||endRestrict)&&this.pointerMove(pointer,event,eventTarget,curEventTarget,!0)}if(this.dragging){endEvent=new InteractEvent(this,event,"drag","end",this.element);var draggableElement=this.element,drop=this.getDrop(endEvent,event,draggableElement);this.dropTarget=drop.dropzone,this.dropElement=drop.element;var dropEvents=this.getDropEvents(event,endEvent);dropEvents.leave&&this.prevDropTarget.fire(dropEvents.leave),dropEvents.enter&&this.dropTarget.fire(dropEvents.enter),dropEvents.drop&&this.dropTarget.fire(dropEvents.drop),dropEvents.deactivate&&this.fireActiveDrops(dropEvents.deactivate),target.fire(endEvent)}else this.resizing?(endEvent=new InteractEvent(this,event,"resize","end",this.element),
target.fire(endEvent)):this.gesturing&&(endEvent=new InteractEvent(this,event,"gesture","end",this.element),target.fire(endEvent));this.stop(event)},collectDrops:function(element){var i,drops=[],elements=[];for(element=element||this.element,i=0;i<interactables.length;i++)if(interactables[i].options.drop.enabled){var current=interactables[i],accept=current.options.drop.accept;if(!(isElement(accept)&&accept!==element||isString(accept)&&!matchesSelector(element,accept)))for(var dropElements=current.selector?current._context.querySelectorAll(current.selector):[current._element],j=0,len=dropElements.length;j<len;j++){var currentElement=dropElements[j];currentElement!==element&&(drops.push(current),
elements.push(currentElement))}}return{dropzones:drops,elements:elements}},fireActiveDrops:function(event){var i,current,currentElement,prevElement;for(i=0;i<this.activeDrops.dropzones.length;i++)current=this.activeDrops.dropzones[i],currentElement=this.activeDrops.elements[i],currentElement!==prevElement&&(event.target=currentElement,current.fire(event)),prevElement=currentElement},setActiveDrops:function(dragElement){var possibleDrops=this.collectDrops(dragElement,!0);this.activeDrops.dropzones=possibleDrops.dropzones,this.activeDrops.elements=possibleDrops.elements,this.activeDrops.rects=[];for(var i=0;i<this.activeDrops.dropzones.length;i++)this.activeDrops.rects[i]=this.activeDrops.dropzones[i].getRect(this.activeDrops.elements[i]);
},getDrop:function(dragEvent,event,dragElement){var validDrops=[];dynamicDrop&&this.setActiveDrops(dragElement);for(var j=0;j<this.activeDrops.dropzones.length;j++){var current=this.activeDrops.dropzones[j],currentElement=this.activeDrops.elements[j],rect=this.activeDrops.rects[j];validDrops.push(current.dropCheck(dragEvent,event,this.target,dragElement,currentElement,rect)?currentElement:null)}var dropIndex=indexOfDeepestElement(validDrops),dropzone=this.activeDrops.dropzones[dropIndex]||null,element=this.activeDrops.elements[dropIndex]||null;return{dropzone:dropzone,element:element}},getDropEvents:function(pointerEvent,dragEvent){var dropEvents={enter:null,
leave:null,activate:null,deactivate:null,move:null,drop:null};return this.dropElement!==this.prevDropElement&&(this.prevDropTarget&&(dropEvents.leave={target:this.prevDropElement,dropzone:this.prevDropTarget,relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,timeStamp:dragEvent.timeStamp,type:"dragleave"},dragEvent.dragLeave=this.prevDropElement,dragEvent.prevDropzone=this.prevDropTarget),this.dropTarget&&(dropEvents.enter={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,timeStamp:dragEvent.timeStamp,type:"dragenter"
},dragEvent.dragEnter=this.dropElement,dragEvent.dropzone=this.dropTarget)),"dragend"===dragEvent.type&&this.dropTarget&&(dropEvents.drop={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,timeStamp:dragEvent.timeStamp,type:"drop"},dragEvent.dropzone=this.dropTarget),"dragstart"===dragEvent.type&&(dropEvents.activate={target:null,dropzone:null,relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,timeStamp:dragEvent.timeStamp,type:"dropactivate"}),"dragend"===dragEvent.type&&(dropEvents.deactivate={target:null,dropzone:null,
relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,timeStamp:dragEvent.timeStamp,type:"dropdeactivate"}),"dragmove"===dragEvent.type&&this.dropTarget&&(dropEvents.move={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:dragEvent.target,draggable:dragEvent.interactable,dragEvent:dragEvent,interaction:this,dragmove:dragEvent,timeStamp:dragEvent.timeStamp,type:"dropmove"},dragEvent.dropzone=this.dropTarget),dropEvents},currentAction:function(){return this.dragging&&"drag"||this.resizing&&"resize"||this.gesturing&&"gesture"||null},interacting:function(){return this.dragging||this.resizing||this.gesturing;
},clearTargets:function(){this.target=this.element=null,this.dropTarget=this.dropElement=this.prevDropTarget=this.prevDropElement=null},stop:function(event){if(this.interacting()){autoScroll.stop(),this.matches=[],this.matchElements=[];var target=this.target;target.options.styleCursor&&(target._doc.documentElement.style.cursor=""),event&&isFunction(event.preventDefault)&&this.checkAndPreventDefault(event,target,this.element),this.dragging&&(this.activeDrops.dropzones=this.activeDrops.elements=this.activeDrops.rects=null)}this.clearTargets(),this.pointerIsDown=this.snapStatus.locked=this.dragging=this.resizing=this.gesturing=!1,this.prepared.name=this.prevEvent=null,
this.inertiaStatus.resumeDx=this.inertiaStatus.resumeDy=0;for(var i=0;i<this.pointers.length;i++)indexOf(this.pointerIds,getPointerId(this.pointers[i]))===-1&&this.pointers.splice(i,1)},inertiaFrame:function(){var inertiaStatus=this.inertiaStatus,options=this.target.options[this.prepared.name].inertia,lambda=options.resistance,t=(new Date).getTime()/1e3-inertiaStatus.t0;if(t<inertiaStatus.te){var progress=1-(Math.exp(-lambda*t)-inertiaStatus.lambda_v0)/inertiaStatus.one_ve_v0;if(inertiaStatus.modifiedXe===inertiaStatus.xe&&inertiaStatus.modifiedYe===inertiaStatus.ye)inertiaStatus.sx=inertiaStatus.xe*progress,inertiaStatus.sy=inertiaStatus.ye*progress;else{var quadPoint=getQuadraticCurvePoint(0,0,inertiaStatus.xe,inertiaStatus.ye,inertiaStatus.modifiedXe,inertiaStatus.modifiedYe,progress);
inertiaStatus.sx=quadPoint.x,inertiaStatus.sy=quadPoint.y}this.pointerMove(inertiaStatus.startEvent,inertiaStatus.startEvent),inertiaStatus.i=reqFrame(this.boundInertiaFrame)}else inertiaStatus.ending=!0,inertiaStatus.sx=inertiaStatus.modifiedXe,inertiaStatus.sy=inertiaStatus.modifiedYe,this.pointerMove(inertiaStatus.startEvent,inertiaStatus.startEvent),this.pointerEnd(inertiaStatus.startEvent,inertiaStatus.startEvent),inertiaStatus.active=inertiaStatus.ending=!1},smoothEndFrame:function(){var inertiaStatus=this.inertiaStatus,t=(new Date).getTime()-inertiaStatus.t0,duration=this.target.options[this.prepared.name].inertia.smoothEndDuration;t<duration?(inertiaStatus.sx=easeOutQuad(t,0,inertiaStatus.xe,duration),
inertiaStatus.sy=easeOutQuad(t,0,inertiaStatus.ye,duration),this.pointerMove(inertiaStatus.startEvent,inertiaStatus.startEvent),inertiaStatus.i=reqFrame(this.boundSmoothEndFrame)):(inertiaStatus.ending=!0,inertiaStatus.sx=inertiaStatus.xe,inertiaStatus.sy=inertiaStatus.ye,this.pointerMove(inertiaStatus.startEvent,inertiaStatus.startEvent),this.pointerEnd(inertiaStatus.startEvent,inertiaStatus.startEvent),inertiaStatus.smoothEnd=inertiaStatus.active=inertiaStatus.ending=!1)},addPointer:function(pointer){var id=getPointerId(pointer),index=this.mouse?0:indexOf(this.pointerIds,id);return index===-1&&(index=this.pointerIds.length),this.pointerIds[index]=id,this.pointers[index]=pointer,
index},removePointer:function(pointer){var id=getPointerId(pointer),index=this.mouse?0:indexOf(this.pointerIds,id);index!==-1&&(this.pointers.splice(index,1),this.pointerIds.splice(index,1),this.downTargets.splice(index,1),this.downTimes.splice(index,1),this.holdTimers.splice(index,1))},recordPointer:function(pointer){var index=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer));index!==-1&&(this.pointers[index]=pointer)},collectEventTargets:function(pointer,event,eventTarget,eventType){function collectSelectors(interactable,selector,context){var els=ie8MatchesSelector?context.querySelectorAll(selector):void 0;interactable._iEvents[eventType]&&isElement(element)&&inContext(interactable,element)&&!testIgnore(interactable,element,eventTarget)&&testAllow(interactable,element,eventTarget)&&matchesSelector(element,selector,els)&&(targets.push(interactable),
elements.push(element))}var pointerIndex=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer));if("tap"!==eventType||!this.pointerWasMoved&&this.downTargets[pointerIndex]&&this.downTargets[pointerIndex]===eventTarget){for(var targets=[],elements=[],element=eventTarget;element;)interact.isSet(element)&&interact(element)._iEvents[eventType]&&(targets.push(interact(element)),elements.push(element)),interactables.forEachSelector(collectSelectors),element=parentElement(element);(targets.length||"tap"===eventType)&&this.firePointers(pointer,event,eventTarget,targets,elements,eventType)}},firePointers:function(pointer,event,eventTarget,targets,elements,eventType){
var i,interval,createNewDoubleTap,pointerIndex=this.mouse?0:indexOf(this.pointerIds,getPointerId(pointer)),pointerEvent={};for("doubletap"===eventType?pointerEvent=pointer:(pointerExtend(pointerEvent,event),event!==pointer&&pointerExtend(pointerEvent,pointer),pointerEvent.preventDefault=preventOriginalDefault,pointerEvent.stopPropagation=InteractEvent.prototype.stopPropagation,pointerEvent.stopImmediatePropagation=InteractEvent.prototype.stopImmediatePropagation,pointerEvent.interaction=this,pointerEvent.timeStamp=(new Date).getTime(),pointerEvent.originalEvent=event,pointerEvent.originalPointer=pointer,pointerEvent.type=eventType,pointerEvent.pointerId=getPointerId(pointer),
pointerEvent.pointerType=this.mouse?"mouse":supportsPointerEvent?isString(pointer.pointerType)?pointer.pointerType:[,,"touch","pen","mouse"][pointer.pointerType]:"touch"),"tap"===eventType&&(pointerEvent.dt=pointerEvent.timeStamp-this.downTimes[pointerIndex],interval=pointerEvent.timeStamp-this.tapTime,createNewDoubleTap=!!(this.prevTap&&"doubletap"!==this.prevTap.type&&this.prevTap.target===pointerEvent.target&&interval<500),pointerEvent.double=createNewDoubleTap,this.tapTime=pointerEvent.timeStamp),i=0;i<targets.length&&(pointerEvent.currentTarget=elements[i],pointerEvent.interactable=targets[i],targets[i].fire(pointerEvent),!(pointerEvent.immediatePropagationStopped||pointerEvent.propagationStopped&&elements[i+1]!==pointerEvent.currentTarget));i++);
if(createNewDoubleTap){var doubleTap={};extend(doubleTap,pointerEvent),doubleTap.dt=interval,doubleTap.type="doubletap",this.collectEventTargets(doubleTap,event,eventTarget,"doubletap"),this.prevTap=doubleTap}else"tap"===eventType&&(this.prevTap=pointerEvent)},validateSelector:function(pointer,event,matches,matchElements){for(var i=0,len=matches.length;i<len;i++){var match=matches[i],matchElement=matchElements[i],action=validateAction(match.getAction(pointer,event,this,matchElement),match);if(action&&withinInteractionLimit(match,matchElement,action))return this.target=match,this.element=matchElement,action}},setSnapping:function(pageCoords,status){var target,page,i,snap=this.target.options[this.prepared.name].snap,targets=[];
if(status=status||this.snapStatus,status.useStatusXY)page={x:status.x,y:status.y};else{var origin=getOriginXY(this.target,this.element);page=extend({},pageCoords),page.x-=origin.x,page.y-=origin.y}status.realX=page.x,status.realY=page.y,page.x=page.x-this.inertiaStatus.resumeDx,page.y=page.y-this.inertiaStatus.resumeDy;for(var len=snap.targets?snap.targets.length:0,relIndex=0;relIndex<this.snapOffsets.length;relIndex++){var relative={x:page.x-this.snapOffsets[relIndex].x,y:page.y-this.snapOffsets[relIndex].y};for(i=0;i<len;i++)target=isFunction(snap.targets[i])?snap.targets[i](relative.x,relative.y,this):snap.targets[i],target&&targets.push({x:isNumber(target.x)?target.x+this.snapOffsets[relIndex].x:relative.x,
y:isNumber(target.y)?target.y+this.snapOffsets[relIndex].y:relative.y,range:isNumber(target.range)?target.range:snap.range})}var closest={target:null,inRange:!1,distance:0,range:0,dx:0,dy:0};for(i=0,len=targets.length;i<len;i++){target=targets[i];var range=target.range,dx=target.x-page.x,dy=target.y-page.y,distance=hypot(dx,dy),inRange=distance<=range;range===1/0&&closest.inRange&&closest.range!==1/0&&(inRange=!1),closest.target&&!(inRange?closest.inRange&&range!==1/0?distance/range<closest.distance/closest.range:range===1/0&&closest.range!==1/0||distance<closest.distance:!closest.inRange&&distance<closest.distance)||(range===1/0&&(inRange=!0),closest.target=target,
closest.distance=distance,closest.range=range,closest.inRange=inRange,closest.dx=dx,closest.dy=dy,status.range=range)}var snapChanged;return closest.target?(snapChanged=status.snappedX!==closest.target.x||status.snappedY!==closest.target.y,status.snappedX=closest.target.x,status.snappedY=closest.target.y):(snapChanged=!0,status.snappedX=NaN,status.snappedY=NaN),status.dx=closest.dx,status.dy=closest.dy,status.changed=snapChanged||closest.inRange&&!status.locked,status.locked=closest.inRange,status},setRestriction:function(pageCoords,status){var page,target=this.target,restrict=target&&target.options[this.prepared.name].restrict,restriction=restrict&&restrict.restriction;
if(!restriction)return status;status=status||this.restrictStatus,page=page=status.useStatusXY?{x:status.x,y:status.y}:extend({},pageCoords),status.snap&&status.snap.locked&&(page.x+=status.snap.dx||0,page.y+=status.snap.dy||0),page.x-=this.inertiaStatus.resumeDx,page.y-=this.inertiaStatus.resumeDy,status.dx=0,status.dy=0,status.restricted=!1;var rect,restrictedX,restrictedY;return isString(restriction)&&(restriction="parent"===restriction?parentElement(this.element):"self"===restriction?target.getRect(this.element):closest(this.element,restriction),!restriction)?status:(isFunction(restriction)&&(restriction=restriction(page.x,page.y,this.element)),isElement(restriction)&&(restriction=getElementRect(restriction)),
rect=restriction,restriction?"x"in restriction&&"y"in restriction?(restrictedX=Math.max(Math.min(rect.x+rect.width-this.restrictOffset.right,page.x),rect.x+this.restrictOffset.left),restrictedY=Math.max(Math.min(rect.y+rect.height-this.restrictOffset.bottom,page.y),rect.y+this.restrictOffset.top)):(restrictedX=Math.max(Math.min(rect.right-this.restrictOffset.right,page.x),rect.left+this.restrictOffset.left),restrictedY=Math.max(Math.min(rect.bottom-this.restrictOffset.bottom,page.y),rect.top+this.restrictOffset.top)):(restrictedX=page.x,restrictedY=page.y),status.dx=restrictedX-page.x,status.dy=restrictedY-page.y,status.changed=status.restrictedX!==restrictedX||status.restrictedY!==restrictedY,
status.restricted=!(!status.dx&&!status.dy),status.restrictedX=restrictedX,status.restrictedY=restrictedY,status)},checkAndPreventDefault:function(event,interactable,element){if(interactable=interactable||this.target){var options=interactable.options,prevent=options.preventDefault;if("auto"===prevent&&element&&!/^(input|select|textarea)$/i.test(event.target.nodeName)){if(/down|start/i.test(event.type)&&"drag"===this.prepared.name&&"xy"!==options.drag.axis)return;if(options[this.prepared.name]&&options[this.prepared.name].manualStart&&!this.interacting())return;return void event.preventDefault()}return"always"===prevent?void event.preventDefault():void 0}},calcInertia:function(status){
var inertiaOptions=this.target.options[this.prepared.name].inertia,lambda=inertiaOptions.resistance,inertiaDur=-Math.log(inertiaOptions.endSpeed/status.v0)/lambda;status.x0=this.prevEvent.pageX,status.y0=this.prevEvent.pageY,status.t0=status.startEvent.timeStamp/1e3,status.sx=status.sy=0,status.modifiedXe=status.xe=(status.vx0-inertiaDur)/lambda,status.modifiedYe=status.ye=(status.vy0-inertiaDur)/lambda,status.te=inertiaDur,status.lambda_v0=lambda/status.v0,status.one_ve_v0=1-inertiaOptions.endSpeed/status.v0},autoScrollMove:function(pointer){if(this.interacting()&&checkAutoScroll(this.target,this.prepared.name)){if(this.inertiaStatus.active)return void(autoScroll.x=autoScroll.y=0);
var top,right,bottom,left,options=this.target.options[this.prepared.name].autoScroll,container=options.container||getWindow(this.element);if(isWindow(container))left=pointer.clientX<autoScroll.margin,top=pointer.clientY<autoScroll.margin,right=pointer.clientX>container.innerWidth-autoScroll.margin,bottom=pointer.clientY>container.innerHeight-autoScroll.margin;else{var rect=getElementClientRect(container);left=pointer.clientX<rect.left+autoScroll.margin,top=pointer.clientY<rect.top+autoScroll.margin,right=pointer.clientX>rect.right-autoScroll.margin,bottom=pointer.clientY>rect.bottom-autoScroll.margin}autoScroll.x=right?1:left?-1:0,autoScroll.y=bottom?1:top?-1:0,
autoScroll.isScrolling||(autoScroll.margin=options.margin,autoScroll.speed=options.speed,autoScroll.start(this))}},_updateEventTargets:function(target,currentTarget){this._eventTarget=target,this._curEventTarget=currentTarget}},InteractEvent.prototype={preventDefault:blank,stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},stopPropagation:function(){this.propagationStopped=!0}};for(var listeners={},interactionListeners=["dragStart","dragMove","resizeStart","resizeMove","gestureStart","gestureMove","pointerOver","pointerOut","pointerHover","selectorDown","pointerDown","pointerMove","pointerUp","pointerCancel","pointerEnd","addPointer","removePointer","recordPointer","autoScrollMove"],i=0,len=interactionListeners.length;i<len;i++){
var name=interactionListeners[i];listeners[name]=doOnInteractions(name)}interactables.indexOfElement=function(element,context){context=context||document;for(var i=0;i<this.length;i++){var interactable=this[i];if(interactable.selector===element&&interactable._context===context||!interactable.selector&&interactable._element===element)return i}return-1},interactables.get=function(element,options){return this[this.indexOfElement(element,options&&options.context)]},interactables.forEachSelector=function(callback){for(var i=0;i<this.length;i++){var interactable=this[i];if(interactable.selector){var ret=callback(interactable,interactable.selector,interactable._context,i,this);
if(void 0!==ret)return ret}}},Interactable.prototype={setOnEvents:function(action,phases){return"drop"===action?(isFunction(phases.ondrop)&&(this.ondrop=phases.ondrop),isFunction(phases.ondropactivate)&&(this.ondropactivate=phases.ondropactivate),isFunction(phases.ondropdeactivate)&&(this.ondropdeactivate=phases.ondropdeactivate),isFunction(phases.ondragenter)&&(this.ondragenter=phases.ondragenter),isFunction(phases.ondragleave)&&(this.ondragleave=phases.ondragleave),isFunction(phases.ondropmove)&&(this.ondropmove=phases.ondropmove)):(action="on"+action,isFunction(phases.onstart)&&(this[action+"start"]=phases.onstart),isFunction(phases.onmove)&&(this[action+"move"]=phases.onmove),
isFunction(phases.onend)&&(this[action+"end"]=phases.onend),isFunction(phases.oninertiastart)&&(this[action+"inertiastart"]=phases.oninertiastart)),this},draggable:function(options){return isObject(options)?(this.options.drag.enabled=options.enabled!==!1,this.setPerAction("drag",options),this.setOnEvents("drag",options),/^x$|^y$|^xy$/.test(options.axis)?this.options.drag.axis=options.axis:null===options.axis&&delete this.options.drag.axis,this):isBool(options)?(this.options.drag.enabled=options,this):this.options.drag},setPerAction:function(action,options){for(var option in options)option in defaultOptions[action]&&(isObject(options[option])?(this.options[action][option]=extend(this.options[action][option]||{},options[option]),
isObject(defaultOptions.perAction[option])&&"enabled"in defaultOptions.perAction[option]&&(this.options[action][option].enabled=options[option].enabled!==!1)):isBool(options[option])&&isObject(defaultOptions.perAction[option])?this.options[action][option].enabled=options[option]:void 0!==options[option]&&(this.options[action][option]=options[option]))},dropzone:function(options){return isObject(options)?(this.options.drop.enabled=options.enabled!==!1,this.setOnEvents("drop",options),/^(pointer|center)$/.test(options.overlap)?this.options.drop.overlap=options.overlap:isNumber(options.overlap)&&(this.options.drop.overlap=Math.max(Math.min(1,options.overlap),0)),
"accept"in options&&(this.options.drop.accept=options.accept),"checker"in options&&(this.options.drop.checker=options.checker),this):isBool(options)?(this.options.drop.enabled=options,this):this.options.drop},dropCheck:function(dragEvent,event,draggable,draggableElement,dropElement,rect){var dropped=!1;if(!(rect=rect||this.getRect(dropElement)))return!!this.options.drop.checker&&this.options.drop.checker(dragEvent,event,dropped,this,dropElement,draggable,draggableElement);var dropOverlap=this.options.drop.overlap;if("pointer"===dropOverlap){var horizontal,vertical,page=getPageXY(dragEvent),origin=getOriginXY(draggable,draggableElement);page.x+=origin.x,page.y+=origin.y,
horizontal=page.x>rect.left&&page.x<rect.right,vertical=page.y>rect.top&&page.y<rect.bottom,dropped=horizontal&&vertical}var dragRect=draggable.getRect(draggableElement);if("center"===dropOverlap){var cx=dragRect.left+dragRect.width/2,cy=dragRect.top+dragRect.height/2;dropped=cx>=rect.left&&cx<=rect.right&&cy>=rect.top&&cy<=rect.bottom}if(isNumber(dropOverlap)){var overlapArea=Math.max(0,Math.min(rect.right,dragRect.right)-Math.max(rect.left,dragRect.left))*Math.max(0,Math.min(rect.bottom,dragRect.bottom)-Math.max(rect.top,dragRect.top)),overlapRatio=overlapArea/(dragRect.width*dragRect.height);dropped=overlapRatio>=dropOverlap}return this.options.drop.checker&&(dropped=this.options.drop.checker(dragEvent,event,dropped,this,dropElement,draggable,draggableElement)),
dropped},dropChecker:function(checker){return isFunction(checker)?(this.options.drop.checker=checker,this):null===checker?(delete this.options.getRect,this):this.options.drop.checker},accept:function(newValue){return isElement(newValue)?(this.options.drop.accept=newValue,this):trySelector(newValue)?(this.options.drop.accept=newValue,this):null===newValue?(delete this.options.drop.accept,this):this.options.drop.accept},resizable:function(options){return isObject(options)?(this.options.resize.enabled=options.enabled!==!1,this.setPerAction("resize",options),this.setOnEvents("resize",options),/^x$|^y$|^xy$/.test(options.axis)?this.options.resize.axis=options.axis:null===options.axis&&(this.options.resize.axis=defaultOptions.resize.axis),
isBool(options.preserveAspectRatio)?this.options.resize.preserveAspectRatio=options.preserveAspectRatio:isBool(options.square)&&(this.options.resize.square=options.square),this):isBool(options)?(this.options.resize.enabled=options,this):this.options.resize},squareResize:function(newValue){return isBool(newValue)?(this.options.resize.square=newValue,this):null===newValue?(delete this.options.resize.square,this):this.options.resize.square},gesturable:function(options){return isObject(options)?(this.options.gesture.enabled=options.enabled!==!1,this.setPerAction("gesture",options),this.setOnEvents("gesture",options),this):isBool(options)?(this.options.gesture.enabled=options,
this):this.options.gesture},autoScroll:function(options){return isObject(options)?options=extend({actions:["drag","resize"]},options):isBool(options)&&(options={actions:["drag","resize"],enabled:options}),this.setOptions("autoScroll",options)},snap:function(options){var ret=this.setOptions("snap",options);return ret===this?this:ret.drag},setOptions:function(option,options){var i,actions=options&&isArray(options.actions)?options.actions:["drag"];if(isObject(options)||isBool(options)){for(i=0;i<actions.length;i++){var action=/resize/.test(actions[i])?"resize":actions[i];if(isObject(this.options[action])){var thisOption=this.options[action][option];isObject(options)?(extend(thisOption,options),
thisOption.enabled=options.enabled!==!1,"snap"===option&&("grid"===thisOption.mode?thisOption.targets=[interact.createSnapGrid(extend({offset:thisOption.gridOffset||{x:0,y:0}},thisOption.grid||{}))]:"anchor"===thisOption.mode?thisOption.targets=thisOption.anchors:"path"===thisOption.mode&&(thisOption.targets=thisOption.paths),"elementOrigin"in options&&(thisOption.relativePoints=[options.elementOrigin]))):isBool(options)&&(thisOption.enabled=options)}}return this}var ret={},allActions=["drag","resize","gesture"];for(i=0;i<allActions.length;i++)option in defaultOptions[allActions[i]]&&(ret[allActions[i]]=this.options[allActions[i]][option]);return ret},inertia:function(options){
var ret=this.setOptions("inertia",options);return ret===this?this:ret.drag},getAction:function(pointer,event,interaction,element){var action=this.defaultActionChecker(pointer,interaction,element);return this.options.actionChecker?this.options.actionChecker(pointer,event,action,this,element,interaction):action},defaultActionChecker:defaultActionChecker,actionChecker:function(checker){return isFunction(checker)?(this.options.actionChecker=checker,this):null===checker?(delete this.options.actionChecker,this):this.options.actionChecker},getRect:function(element){return element=element||this._element,this.selector&&!isElement(element)&&(element=this._context.querySelector(this.selector)),
getElementRect(element)},rectChecker:function(checker){return isFunction(checker)?(this.getRect=checker,this):null===checker?(delete this.options.getRect,this):this.getRect},styleCursor:function(newValue){return isBool(newValue)?(this.options.styleCursor=newValue,this):null===newValue?(delete this.options.styleCursor,this):this.options.styleCursor},preventDefault:function(newValue){return/^(always|never|auto)$/.test(newValue)?(this.options.preventDefault=newValue,this):isBool(newValue)?(this.options.preventDefault=newValue?"always":"never",this):this.options.preventDefault},origin:function(newValue){return trySelector(newValue)?(this.options.origin=newValue,this):isObject(newValue)?(this.options.origin=newValue,
this):this.options.origin},deltaSource:function(newValue){return"page"===newValue||"client"===newValue?(this.options.deltaSource=newValue,this):this.options.deltaSource},restrict:function(options){if(!isObject(options))return this.setOptions("restrict",options);for(var ret,actions=["drag","resize","gesture"],i=0;i<actions.length;i++){var action=actions[i];if(action in options){var perAction=extend({actions:[action],restriction:options[action]},options);ret=this.setOptions("restrict",perAction)}}return ret},context:function(){return this._context},_context:document,ignoreFrom:function(newValue){return trySelector(newValue)?(this.options.ignoreFrom=newValue,this):isElement(newValue)?(this.options.ignoreFrom=newValue,
this):this.options.ignoreFrom},allowFrom:function(newValue){return trySelector(newValue)?(this.options.allowFrom=newValue,this):isElement(newValue)?(this.options.allowFrom=newValue,this):this.options.allowFrom},element:function(){return this._element},fire:function(iEvent){if(!iEvent||!iEvent.type||!contains(eventTypes,iEvent.type))return this;var listeners,i,len,onEvent="on"+iEvent.type,funcName="";if(iEvent.type in this._iEvents)for(listeners=this._iEvents[iEvent.type],i=0,len=listeners.length;i<len&&!iEvent.immediatePropagationStopped;i++)funcName=listeners[i].name,listeners[i](iEvent);if(isFunction(this[onEvent])&&(funcName=this[onEvent].name,this[onEvent](iEvent)),
iEvent.type in globalEvents&&(listeners=globalEvents[iEvent.type]))for(i=0,len=listeners.length;i<len&&!iEvent.immediatePropagationStopped;i++)funcName=listeners[i].name,listeners[i](iEvent);return this},on:function(eventType,listener,useCapture){var i;if(isString(eventType)&&eventType.search(" ")!==-1&&(eventType=eventType.trim().split(/ +/)),isArray(eventType)){for(i=0;i<eventType.length;i++)this.on(eventType[i],listener,useCapture);return this}if(isObject(eventType)){for(var prop in eventType)this.on(prop,eventType[prop],listener);return this}if("wheel"===eventType&&(eventType=wheelEvent),useCapture=!!useCapture,contains(eventTypes,eventType))eventType in this._iEvents?this._iEvents[eventType].push(listener):this._iEvents[eventType]=[listener];else if(this.selector){
if(!delegatedEvents[eventType])for(delegatedEvents[eventType]={selectors:[],contexts:[],listeners:[]},i=0;i<documents.length;i++)events.add(documents[i],eventType,delegateListener),events.add(documents[i],eventType,delegateUseCapture,!0);var index,delegated=delegatedEvents[eventType];for(index=delegated.selectors.length-1;index>=0&&(delegated.selectors[index]!==this.selector||delegated.contexts[index]!==this._context);index--);index===-1&&(index=delegated.selectors.length,delegated.selectors.push(this.selector),delegated.contexts.push(this._context),delegated.listeners.push([])),delegated.listeners[index].push([listener,useCapture])}else events.add(this._element,eventType,listener,useCapture);
return this},off:function(eventType,listener,useCapture){var i;if(isString(eventType)&&eventType.search(" ")!==-1&&(eventType=eventType.trim().split(/ +/)),isArray(eventType)){for(i=0;i<eventType.length;i++)this.off(eventType[i],listener,useCapture);return this}if(isObject(eventType)){for(var prop in eventType)this.off(prop,eventType[prop],listener);return this}var eventList,index=-1;if(useCapture=!!useCapture,"wheel"===eventType&&(eventType=wheelEvent),contains(eventTypes,eventType))eventList=this._iEvents[eventType],eventList&&(index=indexOf(eventList,listener))!==-1&&this._iEvents[eventType].splice(index,1);else if(this.selector){var delegated=delegatedEvents[eventType],matchFound=!1;
if(!delegated)return this;for(index=delegated.selectors.length-1;index>=0;index--)if(delegated.selectors[index]===this.selector&&delegated.contexts[index]===this._context){var listeners=delegated.listeners[index];for(i=listeners.length-1;i>=0;i--){var fn=listeners[i][0],useCap=listeners[i][1];if(fn===listener&&useCap===useCapture){listeners.splice(i,1),listeners.length||(delegated.selectors.splice(index,1),delegated.contexts.splice(index,1),delegated.listeners.splice(index,1),events.remove(this._context,eventType,delegateListener),events.remove(this._context,eventType,delegateUseCapture,!0),delegated.selectors.length||(delegatedEvents[eventType]=null)),matchFound=!0;
break}}if(matchFound)break}}else events.remove(this._element,eventType,listener,useCapture);return this},set:function(options){isObject(options)||(options={}),this.options=extend({},defaultOptions.base);var i,actions=["drag","drop","resize","gesture"],methods=["draggable","dropzone","resizable","gesturable"],perActions=extend(extend({},defaultOptions.perAction),options[action]||{});for(i=0;i<actions.length;i++){var action=actions[i];this.options[action]=extend({},defaultOptions[action]),this.setPerAction(action,perActions),this[methods[i]](options[action])}var settings=["accept","actionChecker","allowFrom","deltaSource","dropChecker","ignoreFrom","origin","preventDefault","rectChecker","styleCursor"];
for(i=0,len=settings.length;i<len;i++){var setting=settings[i];this.options[setting]=defaultOptions.base[setting],setting in options&&this[setting](options[setting])}return this},unset:function(){if(events.remove(this._element,"all"),isString(this.selector))for(var type in delegatedEvents)for(var delegated=delegatedEvents[type],i=0;i<delegated.selectors.length;i++){delegated.selectors[i]===this.selector&&delegated.contexts[i]===this._context&&(delegated.selectors.splice(i,1),delegated.contexts.splice(i,1),delegated.listeners.splice(i,1),delegated.selectors.length||(delegatedEvents[type]=null)),events.remove(this._context,type,delegateListener),events.remove(this._context,type,delegateUseCapture,!0);
break}else events.remove(this,"all"),this.options.styleCursor&&(this._element.style.cursor="");return this.dropzone(!1),interactables.splice(indexOf(interactables,this),1),interact}},Interactable.prototype.snap=warnOnce(Interactable.prototype.snap,"Interactable#snap is deprecated. See the new documentation for snapping at http://interactjs.io/docs/snapping"),Interactable.prototype.restrict=warnOnce(Interactable.prototype.restrict,"Interactable#restrict is deprecated. See the new documentation for resticting at http://interactjs.io/docs/restriction"),Interactable.prototype.inertia=warnOnce(Interactable.prototype.inertia,"Interactable#inertia is deprecated. See the new documentation for inertia at http://interactjs.io/docs/inertia"),
Interactable.prototype.autoScroll=warnOnce(Interactable.prototype.autoScroll,"Interactable#autoScroll is deprecated. See the new documentation for autoScroll at http://interactjs.io/docs/#autoscroll"),Interactable.prototype.squareResize=warnOnce(Interactable.prototype.squareResize,"Interactable#squareResize is deprecated. See http://interactjs.io/docs/#resize-square"),Interactable.prototype.accept=warnOnce(Interactable.prototype.accept,"Interactable#accept is deprecated. use Interactable#dropzone({ accept: target }) instead"),Interactable.prototype.dropChecker=warnOnce(Interactable.prototype.dropChecker,"Interactable#dropChecker is deprecated. use Interactable#dropzone({ dropChecker: checkerFunction }) instead"),
Interactable.prototype.context=warnOnce(Interactable.prototype.context,"Interactable#context as a method is deprecated. It will soon be a DOM Node instead"),interact.isSet=function(element,options){return interactables.indexOfElement(element,options&&options.context)!==-1},interact.on=function(type,listener,useCapture){if(isString(type)&&type.search(" ")!==-1&&(type=type.trim().split(/ +/)),isArray(type)){for(var i=0;i<type.length;i++)interact.on(type[i],listener,useCapture);return interact}if(isObject(type)){for(var prop in type)interact.on(prop,type[prop],listener);return interact}return contains(eventTypes,type)?globalEvents[type]?globalEvents[type].push(listener):globalEvents[type]=[listener]:events.add(document,type,listener,useCapture),
interact},interact.off=function(type,listener,useCapture){if(isString(type)&&type.search(" ")!==-1&&(type=type.trim().split(/ +/)),isArray(type)){for(var i=0;i<type.length;i++)interact.off(type[i],listener,useCapture);return interact}if(isObject(type)){for(var prop in type)interact.off(prop,type[prop],listener);return interact}if(contains(eventTypes,type)){var index;type in globalEvents&&(index=indexOf(globalEvents[type],listener))!==-1&&globalEvents[type].splice(index,1)}else events.remove(document,type,listener,useCapture);return interact},interact.enableDragging=warnOnce(function(newValue){return null!==newValue&&void 0!==newValue?(actionIsEnabled.drag=newValue,
interact):actionIsEnabled.drag},"interact.enableDragging is deprecated and will soon be removed."),interact.enableResizing=warnOnce(function(newValue){return null!==newValue&&void 0!==newValue?(actionIsEnabled.resize=newValue,interact):actionIsEnabled.resize},"interact.enableResizing is deprecated and will soon be removed."),interact.enableGesturing=warnOnce(function(newValue){return null!==newValue&&void 0!==newValue?(actionIsEnabled.gesture=newValue,interact):actionIsEnabled.gesture},"interact.enableGesturing is deprecated and will soon be removed."),interact.eventTypes=eventTypes,interact.debug=function(){var interaction=interactions[0]||new Interaction;return{
interactions:interactions,target:interaction.target,dragging:interaction.dragging,resizing:interaction.resizing,gesturing:interaction.gesturing,prepared:interaction.prepared,matches:interaction.matches,matchElements:interaction.matchElements,prevCoords:interaction.prevCoords,startCoords:interaction.startCoords,pointerIds:interaction.pointerIds,pointers:interaction.pointers,addPointer:listeners.addPointer,removePointer:listeners.removePointer,recordPointer:listeners.recordPointer,snap:interaction.snapStatus,restrict:interaction.restrictStatus,inertia:interaction.inertiaStatus,downTime:interaction.downTimes[0],downEvent:interaction.downEvent,downPointer:interaction.downPointer,
prevEvent:interaction.prevEvent,Interactable:Interactable,interactables:interactables,pointerIsDown:interaction.pointerIsDown,defaultOptions:defaultOptions,defaultActionChecker:defaultActionChecker,actionCursors:actionCursors,dragMove:listeners.dragMove,resizeMove:listeners.resizeMove,gestureMove:listeners.gestureMove,pointerUp:listeners.pointerUp,pointerDown:listeners.pointerDown,pointerMove:listeners.pointerMove,pointerHover:listeners.pointerHover,eventTypes:eventTypes,events:events,globalEvents:globalEvents,delegatedEvents:delegatedEvents,prefixedPropREs:prefixedPropREs}},interact.getPointerAverage=pointerAverage,interact.getTouchBBox=touchBBox,interact.getTouchDistance=touchDistance,
interact.getTouchAngle=touchAngle,interact.getElementRect=getElementRect,interact.getElementClientRect=getElementClientRect,interact.matchesSelector=matchesSelector,interact.closest=closest,interact.margin=warnOnce(function(newvalue){return isNumber(newvalue)?(margin=newvalue,interact):margin},"interact.margin is deprecated. Use interact(target).resizable({ margin: number }); instead."),interact.supportsTouch=function(){return supportsTouch},interact.supportsPointerEvent=function(){return supportsPointerEvent},interact.stop=function(event){for(var i=interactions.length-1;i>=0;i--)interactions[i].stop(event);return interact},interact.dynamicDrop=function(newValue){
return isBool(newValue)?(dynamicDrop=newValue,interact):dynamicDrop},interact.pointerMoveTolerance=function(newValue){return isNumber(newValue)?(pointerMoveTolerance=newValue,this):pointerMoveTolerance},interact.maxInteractions=function(newValue){return isNumber(newValue)?(maxInteractions=newValue,this):maxInteractions},interact.createSnapGrid=function(grid){return function(x,y){var offsetX=0,offsetY=0;isObject(grid.offset)&&(offsetX=grid.offset.x,offsetY=grid.offset.y);var gridx=Math.round((x-offsetX)/grid.x),gridy=Math.round((y-offsetY)/grid.y),newX=gridx*grid.x+offsetX,newY=gridy*grid.y+offsetY;return{x:newX,y:newY,range:grid.range}}},listenToDocument(document),
prefixedMatchesSelector in Element.prototype&&isFunction(Element.prototype[prefixedMatchesSelector])||(ie8MatchesSelector=function(element,selector,elems){elems=elems||element.parentNode.querySelectorAll(selector);for(var i=0,len=elems.length;i<len;i++)if(elems[i]===element)return!0;return!1}),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!realWindow.requestAnimationFrame;++x)reqFrame=realWindow[vendors[x]+"RequestAnimationFrame"],cancelFrame=realWindow[vendors[x]+"CancelAnimationFrame"]||realWindow[vendors[x]+"CancelRequestAnimationFrame"];reqFrame||(reqFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=setTimeout(function(){
callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),cancelFrame||(cancelFrame=function(id){clearTimeout(id)})}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=interact),exports.interact=interact):"function"==typeof define&&define.amd?define("interact",[],function(){return interact}):realWindow.interact=interact}}("undefined"==typeof window?void 0:window),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","interact","ui/interactUtils"],function($,_,__,Promise,tpl,pairTpl,containerHelper,instructionMgr,pciResponse,sizeAdapter,interact,interactUtils){
"use strict";var setChoice=function(interaction,$choice,$target){var $container=containerHelper.get(interaction),choiceSerial=$choice.data("serial"),usage=$choice.data("usage")||0,choice=interaction.getChoice(choiceSerial);if(!choiceSerial)throw"empty choice serial";usage++,$choice.data("usage",usage);var _setChoice=function(){$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&usage>=choice.attr("matchMax")&&$choice.addClass("deactivated")};if($target.siblings("div").hasClass("filled")){var $resultArea=$(".result-area",$container),$pair=$target.parent(),thisPairSerial=[$target.siblings("div").data("serial"),choiceSerial],$otherRepeatedPair=$();
$resultArea.children().not($pair).each(function(){var $otherPair=$(this).children(".filled");if(2===$otherPair.length){var otherPairSerial=[$($otherPair[0]).data("serial"),$($otherPair[1]).data("serial")];if(2===_.intersection(thisPairSerial,otherPairSerial).length)return $otherRepeatedPair=$otherPair,!1}}),0===$otherRepeatedPair.length?(_setChoice(),containerHelper.triggerResponseChangeEvent(interaction,{type:"added",$pair:$pair,choices:thisPairSerial}),instructionMgr.validateInstructions(interaction,{choice:$choice,target:$target}),(interaction.responseMappingMode||0===parseInt(interaction.attr("maxAssociations")))&&($pair.removeClass("incomplete-pair"),$resultArea.children(".incomplete-pair").length||($resultArea.append(pairTpl({
empty:!0})),$resultArea.children(".incomplete-pair").fadeIn(600,function(){$(this).show()})))):($otherRepeatedPair.css("border","1px solid orange"),$target.html(__("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){$otherRepeatedPair.removeAttr("style"),$target.empty().css({color:"",border:""})},2e3))}else _setChoice()},unsetChoice=function(interaction,$filledChoice,animate,triggerChange){var $container=containerHelper.get(interaction),choiceSerial=$filledChoice.data("serial"),$choice=$container.find(".choice-area [data-serial="+choiceSerial+"]"),usage=$choice.data("usage")||0,$parent=$filledChoice.parent(),$sibling=$container.find(".choice-area [data-serial="+$filledChoice.siblings(".target").data("serial")+"]");
usage--,$choice.data("usage",usage).removeClass("deactivated"),$filledChoice.removeClass("filled").removeData("serial").empty(),interaction.swapping||(triggerChange!==!1&&(containerHelper.triggerResponseChangeEvent(interaction,{type:"removed",$pair:$filledChoice.parent()}),instructionMgr.validateInstructions(interaction,{choice:$choice})),$sibling.data("usage",$sibling.data("usage")-1).removeClass("deactivated"),$choice.siblings("div").hasClass("filled")||0!==parseInt(interaction.attr("maxAssociations"))&&!interaction.responseMappingMode||$parent.hasClass("incomplete-pair")||(animate?$parent.addClass("removing").fadeOut(500,function(){$(this).remove()}):$parent.remove()));
},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction),choice=interaction.getChoiceByIdentifier(identifier);if(!choice)throw new Error("cannot find a choice with the identifier : "+identifier);return $(".choice-area [data-serial="+choice.getSerial()+"]",$container)},renderEmptyPairs=function(interaction){var $container=containerHelper.get(interaction),max=parseInt(interaction.attr("maxAssociations")),$resultArea=$(".result-area",$container);if(interaction.responseMappingMode||0===max)$resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").show();else for(var i=0;i<max;i++)$resultArea.append(pairTpl());
},render=function(interaction){var self=this;return new Promise(function(resolve,reject){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){var $activeDrop=$(resultSelector+".dropzone");$activeDrop.length&&interact(resultSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),$activeDrop=$(choiceSelector+".dropzone"),$activeDrop.length&&interact(choiceSelector+".empty").fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}var isDragAndDropEnabled,dragOptions,dropOptions,$container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$activeChoice=null,$bin=$("<span>",{
class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" >li",resultSelector=$resultArea.selector+" >li>div",binSelector=$container.selector+" .remove-choice",_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){setChoice(interaction,$choice,$target),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_resetSelection=function(){$activeChoice&&($resultArea.find(".remove-choice").remove(),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){
unsetChoice(interaction,$choice,!0),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_isInsertionMode=function(){return $activeChoice&&$activeChoice.data("identifier")},_isModeEditing=function(){return $activeChoice&&!$activeChoice.data("identifier")},_handleChoiceActivate=function($target){$target.hasClass("deactivated")||(_isModeEditing()?(interaction.swapping=!0,_unsetChoice($activeChoice),_setChoice($target,$activeChoice),_resetSelection(),interaction.swapping=!1):$target.hasClass("active")?_resetSelection():_activateChoice($target))},_activateChoice=function($choice){_resetSelection(),$activeChoice=$choice,
$choice.addClass("active"),$resultArea.find(">li>.target").addClass("empty")},_handleResultActivate=function($target){var choiceSerial,targetSerial=$target.data("serial");_isInsertionMode()?(choiceSerial=$activeChoice.data("serial"),targetSerial!==choiceSerial&&($target.hasClass("filled")&&(interaction.swapping=!0),targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target),interaction.swapping=!1),_resetSelection()):_isModeEditing()?(choiceSerial=$activeChoice.data("serial"),targetSerial!==choiceSerial&&(($target.hasClass("filled")||$activeChoice.siblings("div")[0]===$target[0])&&(interaction.swapping=!0),_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),
_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target),interaction.swapping=!1),_resetSelection()):targetSerial&&(_activateResult($target),$target.append($bin))},_activateResult=function($target){var targetSerial=$target.data("serial");$activeChoice=$target,$activeChoice.addClass("active"),$resultArea.find(">li>.target").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty")};interact($container.selector).on("tap",function(){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||_resetSelection();
}),interact($choiceArea.selector+" >li").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleChoiceActivate($target),e.preventDefault())}),interact($resultArea.selector+" >li>div").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleResultActivate($target),e.preventDefault())}),interact(binSelector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection(),e.preventDefault());
}),interaction.responseMappingMode||_setInstructions(interaction),self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").associate&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").associate),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector+":not(.deactivated)").draggable(_.defaults({onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_activateChoice($target),_iFrameDragFix(choiceSelector+":not(.deactivated)",e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy);
},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),_resetSelection(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),interact(resultSelector+".filled").draggable(_.defaults({onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_resetSelection(),_activateResult($target),_iFrameDragFix(resultSelector+".filled",e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&_unsetChoice($activeChoice),_resetSelection(),
interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),dropOptions={overlap:.15,ondragenter:function(e){$(e.target).addClass("dropzone"),$(e.relatedTarget).addClass("droppable")},ondragleave:function(e){$(e.target).removeClass("dropzone"),$(e.relatedTarget).removeClass("droppable")}},interact(resultSelector).dropzone(_.defaults({ondrop:function(e){this.ondragleave(e),_handleResultActivate($(e.target))}},dropOptions)),interact(choiceSelector+".empty").dropzone(_.defaults({ondrop:function(e){this.ondragleave(e),_handleChoiceActivate($(e.target))}},dropOptions))),renderEmptyPairs(interaction),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",$container)),
resolve()})},_setInstructions=function(interaction){var min=parseInt(interaction.attr("minAssociations"),10),max=parseInt(interaction.attr("maxAssociations"),10);if(0===min)0===max&&instructionMgr.appendInstruction(interaction,__("You may make as many association pairs as you want."));else{0===max&&instructionMgr.appendInstruction(interaction,__("The maximum number of association is unlimited."));var msg=__("You need to make")+" ";msg+=min>1?__("at least")+" "+min+" "+__("association pairs"):__("one association pair"),instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()})}},resetResponse=function(interaction){
var $container=containerHelper.get(interaction);$container.find(".result-area .active").each(function(){interactUtils.tapOn(this)}),$(".result-area>li>div",$container).each(function(){unsetChoice(interaction,$(this),!1,!1)}),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},_setPairs=function(interaction,pairs){var $container=containerHelper.get(interaction),addedPairs=0,$emptyPair=$(".result-area>li:first",$container);return pairs&&"single"===interaction.getResponseDeclaration().attr("cardinality")&&pairs.length&&(pairs=[pairs]),_.each(pairs,function(pair){if(!$emptyPair.length)return!1;var $divs=$emptyPair.children("div");
setChoice(interaction,getChoice(interaction,pair[0]),$($divs[0])),setChoice(interaction,getChoice(interaction,pair[1]),$($divs[1])),addedPairs++,$emptyPair=$emptyPair.next("li")}),addedPairs},setResponse=function(interaction,response){_setPairs(interaction,pciResponse.unserialize(response,interaction))},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".result-area>li",$container).each(function(){var pair=[];$(this).find("div").each(function(){var serial=$(this).data("serial");serial&&pair.push(interaction.getChoice(serial).id())}),2===pair.length&&response.push(pair)}),response},getResponse=function(interaction){
return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);interact($container.selector).unset(),interact($container.find(".choice-area").selector+" >li").unset(),interact($container.find(".result-area").selector+" >li>div").unset(),interact($container.find(".remove-choice").selector).unset(),instructionMgr.removeInstructions(interaction),$(".result-area",$container).empty(),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),
$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"associateInteraction",template:tpl,render:render,
getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,renderEmptyPairs:renderEmptyPairs}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){return" horizontal";
}function program11(depth0,data){var stack1,helper;return(helper=helpers.listStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.listStyle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program13(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<div\n  ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  class="qti-interaction qti-blockInteraction qti-choiceInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n  data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n  data-qti-class="choiceInteraction"\n  ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n  ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <ol class="plain block-listing solid choice-area',
stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" ",stack1=helpers.if.call(depth0,depth0&&depth0.listStyle,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n      ',options={hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{
hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  </ol>\n  <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(_,$,__,tpl,containerHelper,instructionMgr,pciResponse,sizeAdapter){
"use strict";var KEY_CODE_SPACE=32,KEY_CODE_ENTER=13,KEY_CODE_LEFT=37,KEY_CODE_UP=38,KEY_CODE_RIGHT=39,KEY_CODE_DOWN=40,_triggerInput=function($choiceBox,state){var $input=$choiceBox.find("input:radio,input:checkbox").not("[disabled]").not(".disabled"),$choiceBoxes=$choiceBox.add($choiceBox.siblings());$input.length&&(_.isBoolean(state)||(state=!$input.prop("checked")),$input.prop("checked",state),$input.trigger("change"),$choiceBoxes.removeClass("user-selected"),$choiceBoxes.find("input:checked").not("[disabled]").not(".disabled").parents(".qti-choice").addClass("user-selected"))},_pseudoLabel=function(interaction,$container){var inputSelector=".qti-choice input:radio:not([disabled]):not(.disabled), .qti-choice input:checkbox:not([disabled]):not(.disabled)";
$container.off(".commonRenderer"),$container.on("keydown.commonRenderer.keyNavigation",inputSelector,function(e){var $qtiChoice=$(this).closest(".qti-choice"),keyCode=e.keyCode?e.keyCode:e.charCode;keyCode===KEY_CODE_UP||keyCode===KEY_CODE_LEFT?(e.preventDefault(),e.stopPropagation(),$qtiChoice.prev(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus()):keyCode!==KEY_CODE_DOWN&&keyCode!==KEY_CODE_RIGHT||(e.preventDefault(),e.stopPropagation(),$qtiChoice.next(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus())}).on("keyup.commonRenderer.keyNavigation",inputSelector,function(e){var keyCode=e.keyCode?e.keyCode:e.charCode;
keyCode!==KEY_CODE_SPACE&&keyCode!==KEY_CODE_ENTER||(e.preventDefault(),e.stopPropagation(),_triggerInput($(this).closest(".qti-choice")))}),$container.on("click.commonRenderer",".qti-choice",function(e){var state,$choiceBox=$(this),eliminator=e.target.dataset&&e.target.dataset.eliminable,input=this.querySelector(".real-label > input");e.originalEvent&&$(e.originalEvent.target).is("input")||$choiceBox.closest(".qti-item").hasClass("prevent-click-handler")||(e.preventDefault(),e.stopPropagation(),_.isUndefined(eliminator)||(state=!1,"trigger"===eliminator&&this.classList.toggle("eliminated")),_triggerInput($choiceBox,state),this.classList.contains("eliminated")?input.setAttribute("disabled","disabled"):input.removeAttribute("disabled"),
instructionMgr.validateInstructions(interaction,{choice:$choiceBox}),containerHelper.triggerResponseChangeEvent(interaction))})},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $(".real-label > input[name=response-"+interaction.getSerial()+"]:checked",$container).each(function(){values.push($(this).val())}),values},_setInstructions=function(interaction){var msg,min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),choiceCount=_.size(interaction.getChoices()),minInstructionSet=!1,highlightInvalidInput=function($choice){var $input=$choice.find(".real-label > input"),$li=$choice.css("color","#BA122B"),$icon=$choice.find(".real-label > span").css("color","#BA122B").addClass("cross error"),timeout=interaction.data("__instructionTimeout");
timeout&&clearTimeout(timeout),timeout=setTimeout(function(){$input.prop("checked",!1),$li.removeAttr("style"),$icon.removeAttr("style").removeClass("cross"),$li.toggleClass("user-selected",!1),containerHelper.triggerResponseChangeEvent(interaction)},150),interaction.data("__instructionTimeout",timeout)};max>1&&max<choiceCount&&(max===min?(minInstructionSet=!0,msg=__("You must select exactly %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function(){
data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=1===max?__("You can select maximum of 1 choice"):__("You can select maximum of %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&min>0&&min<choiceCount&&(msg=1===min?__("You must select at least 1 choice"):__("You must select at least %s choices",min),
instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},render=function(interaction){var $container=containerHelper.get(interaction);_pseudoLabel(interaction,$container),_setInstructions(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize($(".add-option, .result-area .target, .choice-area .qti-choice",$container))},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".real-label > input",$container).prop("checked",!1)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction);try{
_.forEach(pciResponse.unserialize(response,interaction),function(identifier){var $input=$container.find('.real-label > input[value="'+identifier+'"]').prop("checked",!0);$input.closest(".qti-choice").toggleClass("user-selected",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},isEliminable=function(interaction){return/\beliminable\b/.test(interaction.attr("class"))},getCustomData=function(interaction,data){var listStyles=(interaction.attr("class")||"").match(/\blist-style-[\w-]+/)||[];
return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation"),listStyle:listStyles.pop(),eliminable:isEliminable(interaction)})},destroy=function(interaction){var $container=containerHelper.get(interaction),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),$container.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),$container=containerHelper.get(interaction),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&$(".qti-simpleChoice",$container).sort(function(a,b){
var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container)),isEliminable(interaction)&&_.isArray(state.eliminated)&&state.eliminated.length&&_.forEach(state.eliminated,function(identifier){$container.find(".qti-simpleChoice[data-identifier="+identifier+"]").addClass("eliminated")}))},getState=function(interaction){var $container=containerHelper.get(interaction),state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&(state.order=[],$(".qti-simpleChoice",$container).each(function(){
state.order.push($(this).data("identifier"))})),isEliminable(interaction)&&(state.eliminated=[],$container.find(".qti-simpleChoice.eliminated").each(function(){state.eliminated.push($(this).data("identifier"))})),state};return{qtiClass:"choiceInteraction",template:tpl,getData:getCustomData,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<a class="qti-interaction qti-inlineInteraction qti-endAttemptInteraction btn small btn-info"\n        data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n        data-qti-class="endAttemptInteraction"\n        value="false"\n        tabindex="0"\n        ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+"\n</a>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(_,tpl,containerHelper,pciResponse,__){
"use strict";function render(interaction,options){var $container=containerHelper.get(interaction);$container.on("click.commonRenderer",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||($container.val(!0),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("endattempt",[interaction.attr("responseIdentifier")]))})}function setResponse(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])}function getResponse(interaction){var val=containerHelper.get(interaction).val();return val=val&&"false"!==val&&"0"!==val,pciResponse.serialize([val],interaction)}function resetResponse(interaction){
_setVal(interaction,!1)}function setState(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))}function getState(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}function _setVal(interaction,val){containerHelper.get(interaction).val(val).change()}function destroy(interaction){containerHelper.get(interaction).off(".commonRenderer")}function getCustomData(interaction,data){return data.attributes.title||(data.attributes.title=__("End Attempt")),data}return{qtiClass:"endAttemptInteraction",template:tpl,getData:getCustomData,render:render,
getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1,helper,options,buffer="";
return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(14,program14,data),fn:self.program(10,program10,data),data:data},stack1=helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),"xhtml",options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),"xhtml",options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        {!-- If there's an expected length or a max length --}}\n        ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.expectedLength),{
hash:{},inverse:self.noop,fn:self.program(18,program18,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers.if.call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program10(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},
inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program11(depth0,data){var stack1,buffer="";return buffer+='\n                <div class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+"_"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" contenteditable></div>\n            '}function program12(depth0,data){return" attributes.class"}function program14(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program15(depth0,data){var stack1,buffer="";return buffer+='\n                <textarea class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+"_"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n            "}function program16(depth0,data){var stack1,buffer="";return buffer+='pattern="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.patternMask,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program18(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.expectedLength,typeof stack1===functionType?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"recommanded",options):helperMissing.call(depth0,"__","recommanded",options)))+".\n            </div>\n        ";
}function program20(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxLength,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        "}function program22(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-words">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxWords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxWords,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"words",options):helperMissing.call(depth0,"__","words",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        "}function program24(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(27,program27,data),fn:self.program(25,program25,data),
data:data},stack1=helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),depth0&&depth0.xhtml,options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),depth0&&depth0.xhtml,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.expectedLength),{hash:{},inverse:self.noop,fn:self.program(29,program29,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.maxLength,{
hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers.if.call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program25(depth0,data){var stack1,buffer="";return buffer+='\n            <div class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" contenteditable></div>\n        '}function program27(depth0,data){var stack1,buffer="";return buffer+='\n            <textarea class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n        "}function program29(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.expectedLength,typeof stack1===functionType?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"recommended",options):helperMissing.call(depth0,"__","recommended",options)))+".\n            </div>\n        "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;
return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-extendedTextInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="extendedTextInteraction"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    ',stack1=helpers.if.call(depth0,depth0&&depth0.multiple,{
hash:{},inverse:self.program(24,program24,data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator",["ui/ckeditor/ckConfigurator"],function(ckConfigurator){"use strict";var getConfig=function(editor,toolbarType,options){return options=options||{},options.underline=!0,ckConfigurator.getConfig(editor,toolbarType,options)};return{getConfig:getConfig}}),define("taoQtiItem/qtiCommonRenderer/helpers/patternMask",[],function(){"use strict";var regexChar=/\^\[\\s\\S\]\{\d+\,(\d+)\}\$/,regexWords=/\^\(\?\:\(\?\:\[\^\\s\\:\\!\\\?\\\;\\\…\\\€\]\+\)\[\\s\\:\\!\\\?\\;\\\…\\\€\]\*\)\{\d+\,(\d+)\}\$/,patternMaskHelper={
parsePattern:function(pattern,type){if(void 0===pattern||null===pattern)return null;if("words"===type){var result=pattern.match(regexWords);return null!==result&&result.length>1?result[1]:null}if("chars"===type){var result=pattern.match(regexChar);return null!==result&&result.length>1?result[1]:null}return null},createMaxWordPattern:function(max){return"^(?:(?:[^\\s\\:\\!\\?\\;\\…\\€]+)[\\s\\:\\!\\?\\;\\…\\€]*){0,"+max.toString()+"}$"},createMaxCharPattern:function(max){return"^[\\s\\S]{0,"+max.toString()+"}$"}};return patternMaskHelper}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["jquery","lodash","i18n","core/promise","util/strLimiter","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","ckeditor","taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator","taoQtiItem/qtiCommonRenderer/helpers/patternMask"],function($,_,__,Promise,strLimiter,tpl,containerHelper,instructionMgr,ckEditor,ckConfigurator,patternMaskHelper){
"use strict";var render=function(interaction){return new Promise(function(resolve,reject){var $el,expectedLength,minStrings,patternMask,placeholderType,editor,$container=containerHelper.get(interaction),multiple=_isMultiple(interaction),limiter=inputLimiter(interaction),placeholderText=interaction.attr("placeholderText"),toolbarType="extendedText",ckOptions={extraPlugins:"onchange",language:"en",defaultLanguage:"en",resize_enabled:!0,secure:"https:"==location.protocol,forceCustomDomain:!0};if(multiple){if($el=$container.find("input"),minStrings=interaction.attr("minStrings"),expectedLength=interaction.attr("expectedLength"),patternMask=interaction.attr("patternMask"),
minStrings){var _getNumStrings=function($element){var num=0;return $element.each(function(){""!==$(this).val()&&num++}),num};minStrings=parseInt(minStrings,10),minStrings>0&&$el.on("blur.commonRenderer",function(){setTimeout(function(){!$el.is(":focus")&&_getNumStrings($el)<minStrings&&instructionMgr.appendNotification(interaction,__("The minimum number of answers is ")+" : "+minStrings,"warning")},100)})}expectedLength&&(expectedLength=parseInt(expectedLength,10),expectedLength>0&&$el.each(function(){$(this).css("width",expectedLength+"em")})),patternMask&&$el.each(function(){_setPattern($(this),patternMask)}),placeholderText&&(placeholderType="first","multiple"===placeholderType?$el.each(function(){
$(this).attr("placeholder",placeholderText)}):"first"===placeholderType&&$el.first().attr("placeholder",placeholderText)),resolve()}else $el=$container.find("textarea"),placeholderText&&$el.attr("placeholder",placeholderText),"xhtml"===_getFormat(interaction)?(editor=_setUpCKEditor(interaction,ckOptions),editor||reject("Unable to instantiate ckEditor"),editor.on("instanceReady",function(){_.delay(resolve,300)}),"ready"!==editor.status&&"loaded"!==editor.status||_.defer(resolve),editor.on("configLoaded",function(e){editor.config=ckConfigurator.getConfig(editor,toolbarType,ckOptions),limiter.enabled&&limiter.listenTextInput()}),editor.on("change",function(e){containerHelper.triggerResponseChangeEvent(interaction,{});
})):($el.on("keyup.commonRenderer change.commonRenderer",function(e){containerHelper.triggerResponseChangeEvent(interaction,{})}),limiter.enabled&&limiter.listenTextInput(),resolve())})},resetResponse=function(interaction){"xhtml"===_getFormat(interaction)?_getCKEditor(interaction).setData(""):containerHelper.get(interaction).find("input, textarea").val("")},setResponse=function(interaction,response){var _setMultipleVal=function(identifier,value){interaction.getContainer().find("#"+identifier).val(value)},baseType=interaction.getResponseDeclaration().attr("baseType");if(response.base&&void 0!==response.base[baseType])setText(interaction,response.base[baseType]);else{
if(!response.list||!response.list[baseType])throw new Error("wrong response format in argument.");for(var i in response.list[baseType]){var serial=void 0===response.list.serial?"":response.list.serial[i];_setMultipleVal(serial+"_"+i,response.list[baseType][i])}}},getResponse=function(interaction){var $container=containerHelper.get(interaction),attributes=interaction.getAttributes(),responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),numericBase=attributes.base||10,multiple=!(!attributes.maxStrings||"multiple"!==responseDeclaration.attr("cardinality")&&"ordered"!==responseDeclaration.attr("cardinality")),ret=multiple?{
list:{}}:{base:{}};if(multiple){var values=[];$container.find("input").each(function(i){var $el=$(this);attributes.placeholderText&&$el.val()===attributes.placeholderText?values[i]="":"integer"===baseType?(values[i]=parseInt($el.val(),numericBase),values[i]=isNaN(values[i])?"":values[i]):"float"===baseType?(values[i]=parseFloat($el.val()),values[i]=isNaN(values[i])?"":values[i]):"string"===baseType&&(values[i]=$el.val())}),ret.list[baseType]=values}else{var value="";attributes.placeholderText&&_getTextareaValue(interaction)===attributes.placeholderText?value="":"integer"===baseType?value=parseInt(_getTextareaValue(interaction),numericBase):"float"===baseType?value=parseFloat(_getTextareaValue(interaction)):"string"===baseType&&(value=_getTextareaValue(interaction,!0)),
ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value}return ret},inputLimiter=function(interaction){var $textarea,$charsCounter,$wordsCounter,maxWords,maxLength,$container=containerHelper.get(interaction),expectedLength=interaction.attr("expectedLength"),expectedLines=interaction.attr("expectedLines"),patternMask=interaction.attr("patternMask"),enabled=!1;(expectedLength||expectedLines||patternMask)&&(enabled=!0,$textarea=$(".text-container",$container),$charsCounter=$(".count-chars",$container),$wordsCounter=$(".count-words",$container),""!==patternMask&&(maxWords=patternMaskHelper.parsePattern(patternMask,"words"),maxLength=patternMaskHelper.parsePattern(patternMask,"chars"),
maxWords=_.isNaN(maxWords)?void 0:maxWords,maxLength=_.isNaN(maxLength)?void 0:maxLength));var limiter={enabled:enabled,listenTextInput:function(){var cke,self=this,ignoreKeyCodes=[8,16,17,46,37,38,39,40,35,36,1114177,3342401,1114181,3342405,2228232,2228261,4456485,2228262,2228263,4456487,2228264,1114120,1114177,1114202,1114200],triggerKeyCodes=[32,13,2228237],keyLimitHandler=function(e){var keyCode=e&&e.data?e.data.keyCode:e.which;return!_.contains(ignoreKeyCodes,keyCode)&&(maxWords&&self.getWordsCount()>=maxWords&&_.contains(triggerKeyCodes,keyCode)||maxLength&&self.getCharsCount()>=maxLength)?(e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),
!1):void _.defer(function(){self.updateCounter()})},nonKeyLimitHandler=function(e){var newValue,oldValue=_getTextareaValue(interaction),isCke="xhtml"===_getFormat(interaction);return newValue=isCke?e.data.dataValue:e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text"):e.originalEvent.dataTransfer.getData("text")||e.originalEvent.dataTransfer.getData("text/plain")||"",e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),!!newValue&&(_.isNull(maxWords)?_.isNull(maxLength)||(newValue=strLimiter.limitByCharCount(newValue,maxLength-self.getCharsCount())):newValue=strLimiter.limitByWordCount(newValue,maxWords-self.getWordsCount()),
isCke?_getCKEditor(interaction).insertText(newValue):containerHelper.get(interaction).find("textarea").val(oldValue+newValue),void _.defer(function(){self.updateCounter()}))};"xhtml"===_getFormat(interaction)?(cke=_getCKEditor(interaction),cke.on("key",keyLimitHandler),cke.on("paste",nonKeyLimitHandler)):$textarea.on("keydown.commonRenderer",keyLimitHandler).on("paste.commonRenderer drop.commonRenderer",nonKeyLimitHandler)},getWordsCount:function(){var value=_getTextareaValue(interaction)||"";return _.isEmpty(value)?0:value.trim().replace(/\s+/gi," ").split(" ").length},getCharsCount:function(){var value=_getTextareaValue(interaction)||"";return value.length},
updateCounter:function(){$charsCounter.text(this.getCharsCount()),$wordsCounter.text(this.getWordsCount())}};return limiter},_getTextareaValue=function(interaction,raw){return"xhtml"===_getFormat(interaction)?_ckEditorData(interaction,raw):containerHelper.get(interaction).find("textarea").val()},_setPattern=function($element,pattern){var patt=new RegExp(pattern);$element.on("keyup.commonRenderer",function(){$element.removeClass("field-error"),patt.test($element.val())||$element.addClass("field-error")})},_isMultiple=function(interaction){var attributes=interaction.getAttributes(),response=interaction.getResponseDeclaration();return!(!attributes.maxStrings||"multiple"!==response.attr("cardinality")&&"ordered"!==response.attr("cardinality"));
},_setUpCKEditor=function(interaction,options){var $container=containerHelper.get(interaction),editor=ckEditor.replace($container.find(".text-container")[0],options||{});if(editor)return $container.data("editor",editor.name),editor},_destroyCkEditor=function(interaction){var editor,$container=containerHelper.get(interaction),name=$container.data("editor");name&&(editor=ckEditor.instances[name]),editor&&(editor.destroy(),$container.removeData("editor"))},_getCKEditor=function(interaction){var $container=containerHelper.get(interaction),name=$container.data("editor");return ckEditor.instances[name]},_ckEditorData=function(interaction,raw){var editor=_getCKEditor(interaction),data=editor&&editor.getData()||"";
return raw||(data=_stripTags(data)),data},_stripTags=function(str){var tempNode=document.createElement("div");return tempNode.innerHTML=str,tempNode.textContent},_getFormat=function(interaction){var format=interaction.attr("format");return _.contains(["plain","xhtml","preformatted"],format)?format:"plain"},enable=function(interaction){var editor,$container=containerHelper.get(interaction);$container.find("input, textarea").removeAttr("disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!1):editor.readOnly=!1))},disable=function(interaction){var editor,$container=containerHelper.get(interaction);
$container.find("input, textarea").attr("disabled","disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!0):editor.readOnly=!0))},clearText=function(interaction){setText(interaction,"")},setText=function(interaction,text){var limiter=inputLimiter(interaction);if("xhtml"===_getFormat(interaction))try{_getCKEditor(interaction).setData(text,function(){limiter.enabled&&limiter.updateCounter()})}catch(e){console.error("setText error",e)}else containerHelper.get(interaction).find("textarea").val(text),limiter.enabled&&limiter.updateCounter()},destroy=function(interaction){var $container=containerHelper.get(interaction),$el=$container.find("input, textarea");
"xhtml"===_getFormat(interaction)&&_destroyCkEditor(interaction),$el.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){if(_.isObject(state)&&state.response)try{interaction.setResponse(state.response)}catch(e){throw interaction.resetResponse(),e}},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getCustomData=function(interaction,data){var pattern=interaction.attr("patternMask"),maxWords=parseInt(patternMaskHelper.parsePattern(pattern,"words")),maxLength=parseInt(patternMaskHelper.parsePattern(pattern,"chars")),expectedLength=parseInt(interaction.attr("expectedLines"),10);
return _.merge(data||{},{maxWords:isNaN(maxWords)?void 0:maxWords,maxLength:isNaN(maxLength)?void 0:maxLength,attributes:isNaN(expectedLength)?void 0:{expectedLength:72*expectedLength}})};return{qtiClass:"extendedTextInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,getData:getCustomData,resetResponse:resetResponse,destroy:destroy,getState:getState,setState:setState,enable:enable,disable:disable,clearText:clearText,setText:setText}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-gapMatchInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="gapMatchInteraction"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <ul class="choice-area none block-listing solid horizontal source">\n        ',options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),
data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n    <div class="instruction-container"></div>\n    <div class="qti-flow-container">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,__,$,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){"use strict";var _choiceUsages={},setChoice=function(interaction,$choice,$target){var choiceSerial=$choice.data("serial"),choice=interaction.getChoice(choiceSerial);_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),
_choiceUsages[choiceSerial]++,$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&_choiceUsages[choiceSerial]>=choice.attr("matchMax")&&$choice.attr("class","deactivated"),containerHelper.triggerResponseChangeEvent(interaction)},unsetChoice=function(interaction,$choice){var serial=$choice.data("serial"),$container=containerHelper.get(interaction);$container.find(".choice-area [data-serial="+serial+"]").removeClass().addClass("qti-choice"),_choiceUsages[serial]--,$choice.removeClass("filled").removeData("serial").empty(),interaction.swapping||containerHelper.triggerResponseChangeEvent(interaction);
},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".choice-area [data-identifier="+identifier+"]",$container)},getGap=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".qti-flow-container [data-identifier="+identifier+"]",$container)},render=function(interaction){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){$activeDrop&&interact(gapSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _handleChoiceSelect($target){$activeChoice&&$target.hasClass("active")||$target.hasClass("deactivated")||(_resetSelection(),
$activeChoice=$target.addClass("active"),$(gapSelector).addClass("empty"))}function _handleFilledGapSelect($target){$activeChoice=$target,$(gapSelector).addClass("active")}function _handleGapSelect($target){var choiceSerial,targetSerial;_isInsertionMode()?(choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&(targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target)),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null):_isModeEditing()?(choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&(_unsetChoice($activeChoice),
targetSerial&&(_unsetChoice($target),_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target)),_resetSelection()):$target.data("serial")&&$target.hasClass("filled")&&(targetSerial=$target.data("serial"),$activeChoice=$target,$activeChoice.addClass("active"),$flowContainer.find(">li>div").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$target.append($bin))}var isDragAndDropEnabled,dragOptions,$container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$flowContainer=$container.find(".qti-flow-container"),$activeChoice=null,$activeDrop=null,$bin=$("<span>",{
class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" .qti-choice",gapSelector=$flowContainer.selector+" .gapmatch-content",filledGapSelector=gapSelector+".filled",binSelector=$container.selector+" .remove-choice",_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){return setChoice(interaction,$choice,$target)},_resetSelection=function(){$activeChoice&&($flowContainer.find(".remove-choice").remove(),$activeChoice.removeClass("deactivated active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){return unsetChoice(interaction,$choice);
},_isInsertionMode=function(){return $activeChoice&&!$activeChoice.hasClass("filled")},_isModeEditing=function(){return $activeChoice&&$activeChoice.hasClass("filled")};this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").gapMatch&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").gapMatch),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_handleChoiceSelect($target),_iFrameDragFix(choiceSelector,e.target);
},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(filledGapSelector).draggable(_.assign({},dragOptions,{onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_handleFilledGapSelect($target),_iFrameDragFix(filledGapSelector,e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&(_unsetChoice($activeChoice),
_resetSelection()),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(gapSelector).dropzone({overlap:.05,ondragenter:function(e){var $target=$(e.target),$dragged=$(e.relatedTarget);$activeDrop=$target,$target.addClass("dropzone"),$dragged.addClass("droppable")},ondrop:function(e){_handleGapSelect($(e.target)),this.ondragleave(e)},ondragleave:function(e){var $target=$(e.target),$dragged=$(e.relatedTarget);$target.removeClass("dropzone"),$dragged.removeClass("droppable"),$activeDrop=null}})),interact($container.selector).on("tap",function(e){e.stopPropagation(),_resetSelection()}),interact(choiceSelector).on("tap",function(e){e.stopPropagation(),_handleChoiceSelect($(e.currentTarget)),
e.preventDefault()}),interact(gapSelector).on("tap",function(e){e.stopPropagation(),_handleGapSelect($(e.currentTarget)),e.preventDefault()}),interact(binSelector).on("tap",function(e){e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection(),e.preventDefault()})},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".gapmatch-content.active",$container).removeClass("active"),$(".gapmatch-content",$container).each(function(){unsetChoice(interaction,$(this))})},_setPairs=function(interaction,pairs){_.each(pairs,function(pair){pair&&setChoice(interaction,getChoice(interaction,pair[0]),getGap(interaction,pair[1]).find(".gapmatch-content"));
})},setResponse=function(interaction,response){resetResponse(interaction),_setPairs(interaction,pciResponse.unserialize(response,interaction))},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".gapmatch-content",$container).each(function(){var choiceSerial=$(this).data("serial"),pair=[];choiceSerial&&pair.push(interaction.getChoice(choiceSerial).attr("identifier")),pair.push($(this).data("identifier")),2===pair.length&&response.push(pair)}),response},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);
interact($container.selector).unset(),interact($container.find(".choice-area").selector+" .qti-choice").unset(),interact($container.find(".qti-flow-container").selector+" .gapmatch-content").unset(),interact($container.find(".remove-choice").selector).unset(),$container.find(".gapmatch-content").empty(),$container.find(".active").removeClass("active"),$container.find(".remove-choice").remove(),$container.find(".empty").removeClass("empty"),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),
$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"gapMatchInteraction",template:tpl,render:render,
getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction clearfix',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7",
"stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect-stroke":{fill:"#ffffff",stroke:"#666666","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},"imageset-rect-no-stroke":{fill:"#ffffff",stroke:"#ffffff","stroke-width":2,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",
stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{stroke:"#444444","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"score-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"small-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":16,cursor:"pointer"},"layer-pos-text":{stroke:"#333","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":14},target:{path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",
fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",
fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function($,_,raphael,scaleRaphael,gstyle){"use strict";var shapeMap={default:"rect",poly:"path"},coordsValidator={rect:4,ellipse:4,circle:3,poly:6,default:0},qti2raphCoordsMapper={rect:function(coords){return[coords[0],coords[1],coords[2]-coords[0],coords[3]-coords[1]]},default:function(paper){return[0,0,paper.width,paper.height];
},poly:function(coords){var a,size=coords.length;for(coords[0]!==coords[size-2]&&coords[1]!==coords[size-1]&&(coords.push(coords[0]),coords.push(coords[1])),coords[0]="M"+coords[0],a=1;a<size;a++)a%2===0&&(coords[a]="L"+coords[a]);return[coords.join(" ")]}},raph2qtiCoordsMapper={rect:function(attr){return[attr.x,attr.y,attr.x+attr.width,attr.y+attr.height]},circle:function(attr){return[attr.cx,attr.cy,attr.r]},ellipse:function(attr){return[attr.cx,attr.cy,attr.rx,attr.ry]},default:function(attr){return this.rect(attr)},path:function(attr){var i,poly=[];if(_.isArray(attr.path))for(i=1;i<attr.path.length;i++)3===attr.path[i].length&&(poly.push(attr.path[i][1]),
poly.push(attr.path[i][2]));return poly}},GraphicHelper={_style:gstyle,setStyle:function(element,name){element&&gstyle[name]&&element.attr(gstyle[name])},responsivePaper:function(id,serial,options){function resizePaper(e,givenWidth){var diff,maxWidth,containerWidth,containerHeight,factor;e&&e.stopPropagation(),diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1,maxWidth=$body.width(),containerWidth=$container.innerWidth(),(containerWidth>0||givenWidth>0)&&(givenWidth<containerWidth&&givenWidth<maxWidth?containerWidth=givenWidth-diff:containerWidth>maxWidth?containerWidth=maxWidth-diff:containerWidth-=diff,factor=containerWidth/imgWidth,
containerHeight=imgHeight*factor,containerWidth>0&&paper.changeSize(containerWidth,containerHeight,!1,!1),"function"==typeof options.resize&&options.resize(containerWidth,factor),$container.trigger("resized.qti-widget"))}var paper,image,$container=options.container||$("#"+id).parent(),$editor=$(".image-editor",$container),$body=$container.closest(".qti-itemBody"),resizer=_.throttle(resizePaper,10),imgWidth=options.width||$container.innerWidth(),imgHeight=options.height||$container.innerHeight();return paper=scaleRaphael(id,imgWidth,imgHeight),image=paper.image(options.img,0,0,imgWidth,imgHeight),image.id=options.imgId||image.id,paper.setViewBox(0,0,imgWidth,imgHeight),
resizer(),$(image.node).attr("externalResourcesRequired","true").on("load",resizer),"SVG"===raphael.type?($(window).on("resize.qti-widget."+serial,resizer),$container.on("resize.qti-widget."+serial,resizer),$(document).on("customcssloaded.styleeditor",resizer)):($container.find(".main-image-box").width(imgWidth),"function"==typeof options.resize&&options.resize(imgWidth,1)),paper},createElement:function(paper,type,coords,options){var element,self=this,shaper=shapeMap[type]?paper[shapeMap[type]]:paper[type],shapeCoords=options.qtiCoords!==!1?self.raphaelCoords(paper,type,coords):coords;if("function"!=typeof shaper)throw new Error("Unable to find method "+type+" on paper");
return element=shaper.apply(paper,shapeCoords),element&&(options.id&&(element.id=options.id),options.title&&element.attr("title",options.title),element.attr(gstyle[options.style||"basic"]).toFront(),$(element.node).removeAttr("stroke-dasharray"),options.hover!==!1&&element.hover(function(){element.flashing||self.updateElementState(this,"hover")},function(){element.flashing||self.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),options.touchEffect!==!1&&element.touchstart(function(){self.createTouchCircle(paper,element.getBBox())})),element},createTarget:function(paper,options){var baseSize,count,factor,half,hover,layer,point,self,tBBox,targetSize,x,y,target;
return options=options||{},self=this,point=options.point||{x:0,y:0},factor=0!==paper.w?paper.width/paper.w:1,hover="undefined"==typeof options.hover||!!options.hover,baseSize=18,half=baseSize/2,x=point.x-half,y=point.y-half,targetSize=0!==factor?2/factor:2,target=paper.path(gstyle.target.path).transform("t"+x+","+y+"s"+targetSize).attr(gstyle.target).attr("title",_("Click again to remove")),options.id?target.id=options.id:(count=0,paper.forEach(function(element){element.data("target")&&count++}),target.id="target-"+count),tBBox=target.getBBox(),layer=paper.rect(tBBox.x,tBBox.y,tBBox.width,tBBox.height).attr(gstyle.layer).click(function(){var id=target.id,p=this.data("point");
_.isFunction(options.select)&&options.select(target,p,this),_.isFunction(options.remove)&&(this.remove(),target.remove(),options.remove(id,p))}),hover&&layer.hover(function(){target.flashing||self.setStyle(target,"target-hover")},function(){target.flashing||self.setStyle(target,"target-success")}),layer.id="layer-"+target.id,layer.data("point",point),target.data("target",point),_.isFunction(options.create)&&options.create(target),target},raphaelCoords:function(paper,type,coords){var shapeCoords;if(_.isString(coords)&&(coords=_.map(coords.split(","),function(coord){return parseInt(coord,10)})),!_.isArray(coords)||coords.length<coordsValidator[type])throw new Error("Invalid coords "+JSON.stringify(coords)+"  for type "+type);
switch(type){case"rect":shapeCoords=qti2raphCoordsMapper.rect(coords);break;case"default":shapeCoords=qti2raphCoordsMapper.default.call(null,paper);break;case"poly":shapeCoords=qti2raphCoordsMapper.poly(coords);break;default:shapeCoords=coords}return shapeCoords},qtiCoords:function(element){var mapper=raph2qtiCoordsMapper[element.type],result="";return _.isFunction(mapper)&&(result=_.map(mapper.call(raph2qtiCoordsMapper,element.attr()),function(coord){return _.parseInt(coord)}).join(",")),result},createTouchCircle:function(paper,bbox){var radius=bbox.width>bbox.height?bbox.width:bbox.height,tCircle=paper.circle(bbox.x+bbox.width/2,bbox.y+bbox.height/2,radius);
tCircle.attr(gstyle["touch-circle"]),_.defer(function(){tCircle.animate({r:radius+5,opacity:.7},300,function(){tCircle.remove()})})},createText:function(paper,options){var fontSize,scaledFontSize,text,top=options.top||0,left=options.left||0,content=options.content||"",style=options.style||"small-text",title=options.title||"",factor=1;return paper.width&&paper.w&&(factor=paper.width/paper.w),text=paper.text(left,top,content).toFront(),options.id&&(text.id=options.id),options.hide&&text.hide(),text.attr(gstyle[style]),"undefined"!=typeof factor&&1!==factor&&(fontSize=parseInt(text.attr("font-size"),10),scaledFontSize=Math.floor(fontSize/factor)+1,text.attr("font-size",scaledFontSize)),
title&&this.updateTitle(text,title),text},createShapeText:function(paper,shape,options){var self=this,bbox=shape.getBBox(),text=this.createText(paper,_.merge({left:bbox.x+bbox.width/2,top:bbox.y+bbox.height/2},options));return options.shapeClick&&text.click(function(){self.trigger(shape,"click")}),text},createBorderedImage:function(paper,options){var padding=options.padding>=0?options.padding:6,halfPad=padding/2,rx=options.left,ry=options.top,rw=options.width+padding,rh=options.height+padding,ix=options.left+halfPad,iy=options.top+halfPad,iw=options.width,ih=options.height,set=paper.set(),rect=paper.rect(rx,ry,rw,rh).attr(options.border?gstyle["imageset-rect-stroke"]:gstyle["imageset-rect-no-stroke"]),image=paper.image(options.url,ix,iy,iw,ih).attr(gstyle["imageset-img"]);
return options.shadow&&set.push(rect.glow({width:2,offsetx:1,offsety:1})),set.push(rect,image),set.move=function(x,y,duration){var animation=raphael.animation({x:x,y:y},duration||400),elt=rect.animate(animation);return image.animateWith(elt,animation,{x:x+halfPad,y:y+halfPad},duration||400),set},set},updateElementState:function(element,state,title){element&&element.animate&&(element.animate(gstyle[state],200,"linear",function(){element.attr(gstyle[state]),$(element.node).removeAttr("stroke-dasharray")}),title&&this.updateTitle(element,title))},updateTitle:function(element,title){element&&element.node&&(_.forEach(element.node.children,function(child){"title"===child.nodeName.toLowerCase()&&element.node.removeChild(child);
}),element.attr("title",title))},highlightError:function(element,restoredState){var self=this;element&&(element.flashing=!0,self.updateElementState(element,"error"),_.delay(function(){self.updateElementState(element,restoredState||"basic"),element.flashing=!1},800))},trigger:function(element,event){var evt=_.where(element.events,{name:event});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.apply(element,Array.prototype.slice.call(arguments,2))},getPoint:function(event,paper,$container){var point=this.clickPoint($container,event),rect=$container.get(0).getBoundingClientRect(),factor=paper.w/rect.width;return point.x=Math.round(point.x*factor),point.y=Math.round(point.y*factor),
point},position:function($container,paper){var pw=parseInt(paper.w||paper.width,10),cw=parseInt($container.width(),10),ph=parseInt(paper.w||paper.width,10),ch=parseInt($container.height(),10);return{left:(cw-pw)/2,top:(ch-ph)/2}},clickPoint:function($container,event){var x,y,offset=$container.offset();return event.pageX||event.pageY?(x=event.pageX-offset.left,y=event.pageY-offset.top):(event.clientX||event.clientY)&&(x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-offset.left,y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop-offset.top),{x:x,y:y}}};return GraphicHelper}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$(".main-image-box",$container);interaction._vsets=[],$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_paperUnSelect(interaction),
instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minAssociations"),max:interaction.attr("maxAssociations"),getResponse:_getRawResponse,onError:function(data){data&&data.target&&graphic.highlightError(data.target)}})})},_renderChoice=function(interaction,choice){var shape=choice.attr("shape"),coords=choice.attr("coords"),maxAssociations=interaction.attr("maxAssociations");graphic.createElement(interaction.paper,shape,coords,{id:choice.serial,title:__("Select this area to start an association")}).data("max",choice.attr("matchMax")).data("matching",0).removeData("assocs").click(function(){var active,assocs,self=this;return maxAssociations>0&&_getRawResponse(interaction).length>=maxAssociations?(_shapesUnSelectable(interaction),
void instructionMgr.validateInstructions(interaction,{choice:choice,target:this})):(this.selectable?(active=_getActiveElement(interaction),active&&(active.data("matching",active.data("matching")+1),this.data("matching",this.data("matching")+1),assocs=active.data("assocs")||[],assocs.push(choice.id()),active.data("assocs",assocs),_createPath(interaction,active,this,function(){active.data("matching",active.data("matching")-1),self.data("matching",self.data("matching")-1),active.data("assocs",_.remove(active.data("assocs")||[],choice.id())),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:self
})})),_shapesUnSelectable(interaction)):this.active?(graphic.updateElementState(this,"basic",__("Select another area to complete the association")),this.active=!1,_shapesUnSelectable(interaction)):_isMatchable(this)&&(graphic.updateElementState(this,"active",__("Select this area to start an association")),this.active=!0,_shapesSelectable(interaction,this)),containerHelper.triggerResponseChangeEvent(interaction),void instructionMgr.validateInstructions(interaction,{choice:choice,target:this}))})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),image=interaction.paper.getById("bg-image-"+interaction.serial);image&&image.click(function(){
_shapesUnSelectable(interaction),$container.trigger("unselect.graphicassociate")})},_getActiveElement=function(interaction){var active;return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);if(element&&element.active===!0)return active=element,!1}),active},_createPath=function(interaction,srcElement,destElement,onRemove){function showCloser(){closerBg.toFront().animate({opacity:.8},300).click(removeSet),closer.toFront().animate({opacity:1},300).click(removeSet)}function hideCloser(){closerBg&&closerBg.type&&(closerBg.animate({opacity:0},300,function(){closerBg.toBack()}).unclick(),closer.animate({opacity:0
},300,function(){closer.toBack()}).unclick())}function removeSet(){_.invoke(vset,"remove"),interaction._vsets=_.without(interaction._vsets,vset),"function"==typeof onRemove&&onRemove()}var $container=containerHelper.get(interaction),vset=[],src=srcElement.getBBox(),sx=src.x+src.width/2,sy=src.y+src.height/2,dest=destElement.getBBox(),dx=dest.x+dest.width/2,dy=dest.y+dest.height/2,srcBullet=interaction.paper.circle(sx,sy,3).attr(graphic._style["assoc-bullet"]),destBullet=interaction.paper.circle(dx,dy,3).attr(graphic._style["assoc-bullet"]),path=interaction.paper.path("M"+sx+","+sy+"L"+sx+","+sy).attr(graphic._style.assoc).animate({path:"M"+sx+","+sy+"L"+dx+","+dy
},300),layer=interaction.paper.path("M"+sx+","+sy+"L"+dx+","+dy).attr(graphic._style["assoc-layer"]),midPath=layer.getPointAtLength(layer.getTotalLength()/2),closerBg=interaction.paper.circle(midPath.x,midPath.y,9).attr(graphic._style["close-bg"]).toBack(),closer=interaction.paper.path(graphic._style.close.path).attr(graphic._style.close).transform("T"+(midPath.x-9)+","+(midPath.y-9)).attr("title",_("Click again to remove")).toBack();srcElement.toFront(),destElement.toFront(),vset=[srcBullet,path,destBullet,layer,closerBg,closer],interaction._vsets.push(vset),_.invoke(vset,"data","assoc-path",!0),layer.click(function(){0===closer.attrs.opacity?showCloser():hideCloser();
}),$container.on("unselect.graphicassociate",function(){hideCloser()})},_shapesSelectable=function(interaction,active){var assocs=active.data("assocs")||[];_.forEach(interaction.getChoices(),function(choice){var element;_.contains(assocs,choice.id())||(element=interaction.paper.getById(choice.serial),!element.active&&element.id!==active.id&&_isMatchable(element,active)&&(element.selectable=!0,graphic.updateElementState(element,"selectable")))})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,element.active=!1,graphic.updateElementState(element,"basic"));
})},_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||0,matchable=0===matchMax||matchMax>matching),matchable},_getRawResponse=function(interaction){var responses=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial),assocs=element.data("assocs");element&&assocs&&(responses=responses.concat(_.map(assocs,function(id){return[choice.id(),id]})))}),responses},setResponse=function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction);
}catch(e){}if(_.isArray(responseValues)){var map=_.transform(interaction.getChoices(),function(res,choice){res[choice.id()]=interaction.paper.getById(choice.serial)});_.forEach(responseValues,function(responseValue){var el1,el2;_.isArray(responseValue)&&2===responseValue.length&&(el1=map[responseValue[0]],el2=map[responseValue[1]],el1&&el2&&(graphic.trigger(el1,"click"),graphic.trigger(el2,"click")))})}}},resetResponse=function(interaction){var toRemove=[];_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&element.data({max:choice.attr("matchMax"),matching:0,assocs:[]})}),interaction.paper.forEach(function(elt){
elt.data("assoc-path")&&toRemove.push(elt)}),_.invoke(toRemove,"remove")},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));return response},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$container.off(".graphicassociate"),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),
$("ul",$container).empty()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"graphicAssociateInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction clearfix',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal source">\n            ',options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.gapImgs)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.gapImgs,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{
hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","module","core/promise","core/mouseEvent","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","interact","ui/interactUtils"],function($,_,__,module,Promise,triggerMouseEvent,tpl,graphic,pciResponse,containerHelper,instructionMgr,interact,interactUtils){
"use strict";var isDragAndDropEnabled,activeDrop=null,_choiceUsages={},isDirectedPairFlipped=module.config().flipDirectedPair,_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||[],matchable=0===matchMax||matchMax>matching.length),matchable},_shapesSelectable=function(interaction){var tooltip=__("Select the area to add an image");_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);_isMatchable(element)&&(element.selectable=!0,graphic.setStyle(element,"selectable"),graphic.updateTitle(element,tooltip))}),_.forEach(interaction.gapFillers,function(gapFiller){
gapFiller.forEach(function(element){graphic.updateTitle(element,tooltip)})})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,graphic.setStyle(element,"basic"),graphic.updateTitle(element,__("Select an image first")))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,__("Remove"))})})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),$gapImages=$("ul > li",$container),bgImage=interaction.paper.getById("bg-image-"+interaction.serial);
bgImage&&interact(bgImage.node).on("tap",function(){_shapesUnSelectable(interaction),$gapImages.removeClass("active")})},_setChoice=function(interaction,$choice){var matchMax,usages,choiceSerial=$choice.data("serial"),choice=interaction.getGapImg(choiceSerial);_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,!interaction.responseMappingMode&&choice.attr("matchMax")&&(matchMax=+choice.attr("matchMax"),usages=+_choiceUsages[choiceSerial],0!==matchMax&&matchMax<=usages&&(interact($choice.get(0)).draggable(!1),$choice.addClass("disabled"),$choice.removeClass("selectable")))},_unsetChoice=function(interaction,$choice){var choiceSerial=$choice.data("serial");
_choiceUsages[choiceSerial]--,$choice.removeClass("disabled"),$choice.addClass("selectable"),interact($choice.get(0)).draggable(!0)},_selectShape=function(interaction,element,trackResponse){var $img,$clone,gapFiller,id,bbox,shapeOffset,activeOffset,matching,currentCount,$container=containerHelper.get(interaction),$gapList=$("ul",$container),$active=$gapList.find(".active:first"),$imageBox=$(".main-image-box",$container),boxOffset=$imageBox.offset();"undefined"==typeof trackResponse&&(trackResponse=!0),$active.length&&(id=$active.data("identifier"),matching=element.data("matching")||[],matching.push(id),element.data("matching",matching),currentCount=matching.length,
$img=$active.find("img"),_shapesUnSelectable(interaction),$gapList.children().removeClass("active"),_setChoice(interaction,$active),$clone=$img.clone(),shapeOffset=$(element.node).offset(),activeOffset=$active.offset(),$clone.css({position:"absolute",display:"block","z-index":1e4,opacity:.8,top:activeOffset.top-boxOffset.top,left:activeOffset.left-boxOffset.left}),$clone.appendTo($imageBox),$clone.animate({top:shapeOffset.top-boxOffset.top,left:shapeOffset.left-boxOffset.left},200,function(){var gapFillerImage;$clone.remove(),bbox=element.getBBox(),gapFiller=graphic.createBorderedImage(interaction.paper,{url:$img.attr("src"),left:bbox.x+8*(currentCount-1),top:bbox.y+8*(currentCount-1),
width:parseInt($img.attr("width"),10),height:parseInt($img.attr("height"),10),padding:0,border:!1,shadow:!0}).data("identifier",id).toFront(),gapFillerImage=gapFiller[2].node,interact(gapFillerImage).on("tap",function(e){var target=e.currentTarget,rElement=interaction.paper.getById(target.raphaelid);e.preventDefault(),e.stopPropagation(),$gapList.find(".active").length>0?interactUtils.tapOn(element.node):(element.data("matching",_.without(element.data("matching")||[],rElement.data("identifier"))),interaction.gapFillers=_.without(interaction.gapFillers,gapFiller),gapFiller.remove(),_unsetChoice(interaction,$active),containerHelper.triggerResponseChangeEvent(interaction));
}),interaction.gapFillers.push(gapFiller),containerHelper.triggerResponseChangeEvent(interaction)}))},_renderChoice=function(interaction,choice){function handleShapeSelect(){_isMatchable(rElement)&&rElement.selectable===!0&&_selectShape(interaction,rElement)}var rElement=graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select an image first"),hover:!1}).data("max",choice.attr("matchMax")).data("matching",[]);interact(rElement.node).on("tap",function(){handleShapeSelect()}),isDragAndDropEnabled&&interact(rElement.node).dropzone({overlap:.15,ondragenter:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"hover"),
activeDrop=rElement.node)},ondrop:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),handleShapeSelect(),activeDrop=null)},ondragleave:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),activeDrop=null)}})},_iFrameDragFix=function(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){activeDrop&&interact(activeDrop).fire({type:"drop",target:activeDrop,relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})},_renderGapList=function(interaction,$gapList){function toggleActiveGapState($target){$target.hasClass("disabled")||($target.hasClass("active")?_setInactiveGapState($target):_setActiveGapState($target));
}function _setActiveGapState($target){$gapList.children("li").removeClass("active"),$target.addClass("active"),_shapesSelectable(interaction)}function _setInactiveGapState($target){$target.removeClass("active"),_shapesUnSelectable(interaction)}var dragOptions,gapFillersSelector=$gapList.selector+" li";interact(gapFillersSelector).on("tap",function(e){e.stopPropagation(),e.preventDefault(),toggleActiveGapState($(e.currentTarget))}),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},$(gapFillersSelector).each(function(index,gap){interact(gap).draggable(_.assign({},dragOptions,{
onstart:function(e){var $target=$(e.target);_setActiveGapState($target),$target.addClass("dragged"),_iFrameDragFix(gapFillersSelector,e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);_setInactiveGapState($target),$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1)}))},render=function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),$gapList=$("ul.source",$container),background=interaction.object.attributes;interaction.gapFillers=[],self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").graphicGapMatch&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").graphicGapMatch),
$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container,resize:function(newSize,factor){$gapList.css("max-width",newSize+"px"),1!==factor&&$gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)})}}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_renderGapList(interaction,$gapList),_paperUnSelect(interaction);
})},_getRawResponse=function(interaction){var pairs=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_.isArray(element.data("matching"))&&_.forEach(element.data("matching"),function(gapImg){isDirectedPairFlipped?pairs.push([choice.id(),gapImg]):pairs.push([gapImg,choice.id()])})}),_.sortBy(pairs,[0,1])},setResponse=function(interaction,response){var responseValues,$container=containerHelper.get(interaction);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){responseValues=null}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){
var element=interaction.paper.getById(choice.serial);element&&_.forEach(responseValues,function(pair){var responseChoice,responseGap;2===pair.length&&(responseChoice=isDirectedPairFlipped?pair[0]:pair[1],responseGap=isDirectedPairFlipped?pair[1]:pair[0],responseChoice===choice.id()&&($("[data-identifier="+responseGap+"]",$container).addClass("active"),_selectShape(interaction,element,!1)))})})}},resetResponse=function(interaction){_shapesUnSelectable(interaction),_.forEach(interaction.gapFillers,function(gapFiller){interactUtils.tapOn(gapFiller.items[2][0])})},getResponse=function(interaction){var raw=_getRawResponse(interaction);return pciResponse.serialize(raw,interaction);
},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty(),interact($container.find("ul.source li").selector).unset(),interact($container.find(".main-image-box rect").selector).unset()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),
interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"graphicGapMatchInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,isDirectedPairFlipped:isDirectedPairFlipped}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";
return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),
(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction clearfix',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal ordinals"></ul>\n    </div>\n</div>\n';
})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),$orderList=$("ul",$container),background=interaction.object.attributes;
$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_renderOrderList(interaction,$orderList),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction,$orderList)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){graphic.highlightError(data.target)}});
})},_renderChoice=function(interaction,$orderList,choice){graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(this.active?_unselectShape(interaction.paper,this,$orderList):_selectShape(interaction.paper,this,$orderList),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice}))})},_renderOrderList=function(interaction,$orderList){var $orderers,size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices");
max>0&&max<size?size=max:min>0&&min<size&&(size=min),_.times(size,function(index){var position=index+1,$orderer=$('<li class="selectable" data-number="'+position+'">'+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)}),_createTexts(interaction.paper,size,$orderList),$orderers=$orderList.children("li"),$orderers.click(function(e){e.preventDefault();var $orderer=$(this);$orderer.hasClass("active")||$orderer.hasClass("disabled")||($orderers.removeClass("active"),$orderer.addClass("active"))})},_selectShape=function(paper,element,$orderList){var $active=$orderList.find(".active:first");$active.length&&$active.data("number")>0&&(element.data("number",$active.data("number")),
element.active=!0,_showText(paper,element),graphic.updateElementState(element,"active"),$active.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},_unselectShape=function(paper,element,$orderList){var number=element.data("number");element.active=!1,_hideText(paper,element),element.removeData("number"),graphic.updateElementState(element,"basic"),$orderList.children().removeClass("active").filter("[data-number="+number+"]").removeClass("disabled").addClass("active")},_createTexts=function(paper,size){var texts=[];return _.times(size,function(index){var number=index+1,text=graphic.createText(paper,{id:"text-"+number,content:number,
title:__("Remove"),style:"order-text",hide:!0});text.click(function(){paper.forEach(function(element){if(element.data("number")===number&&element.events){var evt=_.where(element.events,{name:"click"});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.call(element)}})}),texts.push(text)}),texts},_showText=function(paper,element){var transf,bbox=element.getBBox(),text=paper.getById("text-"+element.data("number"));text&&(transf="T"+(bbox.x+bbox.width/2)+","+(bbox.y+bbox.height/2),text.transform(transf).show().toFront())},_hideText=function(paper,element){var text=paper.getById("text-"+element.data("number"));text&&text.hide()},_getRawResponse=function(interaction){
var response=[];return _.forEach(interaction.getChoices(),function(choice){var elt=interaction.paper.getById(choice.serial);elt&&elt.data("number")&&response.push({index:elt.data("number"),id:choice.id()})}),_(response).sortBy("index").map("id").value()},setResponse=function(interaction,response){var responseValues,$container=containerHelper.get(interaction),$orderList=$("ul",$container);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(responseValues,function(responseValue,index){var element,number=index+1,choice=_(interaction.getChoices()).where({attributes:{identifier:responseValue
}}).first();choice&&(element=interaction.paper.getById(choice.serial),element&&($orderList.children("[data-number="+number+"]").addClass("active"),_selectShape(interaction.paper,element,$orderList)))})}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),$orderList=$("ul",$container);_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_unselectShape(interaction.paper,element,$orderList)}),$orderList.children("li").removeClass("active disabled").first().addClass("active")},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction);
},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();
return response&&(state.response=response),state};return{qtiClass:"graphicOrderInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction clearfix',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{
hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})});define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),
getResponse:_getRawResponse,onError:function(data){data.target.active&&(data.target.active=!1,graphic.updateElementState(this,"basic",__("Select this area")),graphic.highlightError(data.target),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("inactiveChoice.qti-widget",[data.choice,data.target]))}})})},_renderChoice=function(interaction,choice){var $container=containerHelper.get(interaction);graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(){this.active?(graphic.updateElementState(this,"basic",__("Select this area")),this.active=!1,$container.trigger("inactiveChoice.qti-widget",[choice,this])):(graphic.updateElementState(this,"active",__("Click again to remove")),
this.active=!0,$container.trigger("activeChoice.qti-widget",[choice,this])),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this})})},_getRawResponse=function(interaction){return _(interaction.getChoices()).map(function(choice){var rElement=interaction.paper.getById(choice.serial);return!(!rElement||rElement.active!==!0)&&choice.id()}).filter(_.isString).value()},setResponse=function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){
var rElement;_.contains(responseValues,choice.attributes.identifier)&&(rElement=interaction.paper.getById(choice.serial),rElement&&(rElement.active=!0,graphic.updateElementState(rElement,"active",__("Click again to remove")),instructionMgr.validateInstructions(interaction,{choice:choice,target:rElement})))})}},resetResponse=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.active=!1,graphic.updateElementState(element,"basic"))}),instructionMgr.resetInstructions(interaction)},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));
return response},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();
return response&&(state.response=response),state};return{qtiClass:"hotspotInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}});define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-hottextInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="hottextInteraction"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{
hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="qti-flow-container">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){
"use strict";var pseudoLabel=function(interaction){var $container=containerHelper.get(interaction),setChoice=function($choice,interaction){var $inupt=$choice.find("input");if($inupt.prop("checked")||$inupt.hasClass("disabled"))$inupt.prop("checked",!1);else{var maxChoices=parseInt(interaction.attr("maxChoices")),currentChoices=_.values(_getRawResponse(interaction)).length;(currentChoices<maxChoices||0===maxChoices)&&$inupt.prop("checked",!0)}containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:$choice})};$(".hottext",$container).on("click",function(e){e.preventDefault(),setChoice($(this),interaction)});
},render=function(interaction){pseudoLabel(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){var $input,$choice,$icon;data.choice&&data.choice.length&&($choice=data.choice.addClass("error"),$input=$choice.find("input"),$icon=$choice.find(" > label > span").addClass("error cross"),setTimeout(function(){$input.prop("checked",!1),$choice.removeClass("error"),$icon.removeClass("error cross")},350))}})},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$("input",$container).prop("checked",!1)},setResponse=function(interaction,response){
var $container=containerHelper.get(interaction);try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$container.find('input[value="'+identifier+'"]').prop("checked",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $("input:checked",$container).each(function(){values.push($(this).val())}),values},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);
$container.find(".hottext").off("click"),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"hottextInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<select ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,
fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n        data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n        data-qti-class="inlineChoiceInteraction"\n        data-has-search="false"\n        ',
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n>\n    <option></option>                \n    <option value="empty"></option>\n    ',options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),
data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</select>\n"})}),function(window,document,undefined){!function(factory){"use strict";"function"==typeof define&&define.amd?define("qtip",["jquery"],factory):jQuery&&!jQuery.fn.qtip&&factory(jQuery)}(function($){"use strict";function QTip(target,options,id,attr){this.id=id,this.target=target,this.tooltip=NULL,this.elements={target:target},this._id=NAMESPACE+"-"+id,this.timers={img:{}},this.options=options,this.plugins={},this.cache={event:{},target:$(),disabled:FALSE,attr:attr,onTooltip:FALSE,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=FALSE;
}function invalidOpt(a){return a===NULL||"object"!==$.type(a)}function invalidContent(c){return!($.isFunction(c)||c&&c.attr||c.length||"object"===$.type(c)&&(c.jquery||c.then))}function sanitizeOptions(opts){var content,text,ajax,once;return invalidOpt(opts)?FALSE:(invalidOpt(opts.metadata)&&(opts.metadata={type:opts.metadata}),"content"in opts&&(content=opts.content,invalidOpt(content)||content.jquery||content.done?content=opts.content={text:text=invalidContent(content)?FALSE:content}:text=content.text,"ajax"in content&&(ajax=content.ajax,once=ajax&&ajax.once!==FALSE,delete content.ajax,content.text=function(event,api){var loading=text||$(this).attr(api.options.content.attr)||"Loading...",deferred=$.ajax($.extend({},ajax,{
context:api})).then(ajax.success,NULL,ajax.error).then(function(content){return content&&once&&api.set("content.text",content),content},function(xhr,status,error){api.destroyed||0===xhr.status||api.set("content.text",status+": "+error)});return once?loading:(api.set("content.text",loading),deferred)}),"title"in content&&($.isPlainObject(content.title)&&(content.button=content.title.button,content.title=content.title.text),invalidContent(content.title||FALSE)&&(content.title=FALSE))),"position"in opts&&invalidOpt(opts.position)&&(opts.position={my:opts.position,at:opts.position}),"show"in opts&&invalidOpt(opts.show)&&(opts.show=opts.show.jquery?{target:opts.show
}:opts.show===TRUE?{ready:TRUE}:{event:opts.show}),"hide"in opts&&invalidOpt(opts.hide)&&(opts.hide=opts.hide.jquery?{target:opts.hide}:{event:opts.hide}),"style"in opts&&invalidOpt(opts.style)&&(opts.style={classes:opts.style}),$.each(PLUGINS,function(){this.sanitize&&this.sanitize(opts)}),opts)}function convertNotation(options,notation){for(var obj,i=0,option=options,levels=notation.split(".");option=option[levels[i++]];)i<levels.length&&(obj=option);return[obj||options,levels.pop()]}function setCallback(notation,args){var category,rule,match;for(category in this.checks)for(rule in this.checks[category])(match=new RegExp(rule,"i").exec(notation))&&(args.push(match),
("builtin"===category||this.plugins[category])&&this.checks[category][rule].apply(this.plugins[category]||this,args))}function createWidgetClass(cls){return WIDGET.concat("").join(cls?"-"+cls+" ":" ")}function delay(callback,duration){return duration>0?setTimeout($.proxy(callback,this),duration):void callback.call(this)}function showMethod(event){this.tooltip.hasClass(CLASS_DISABLED)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=delay.call(this,function(){this.toggle(TRUE,event)},this.options.show.delay))}function hideMethod(event){if(!this.tooltip.hasClass(CLASS_DISABLED)&&!this.destroyed){var relatedTarget=$(event.relatedTarget),ontoTooltip=relatedTarget.closest(SELECTOR)[0]===this.tooltip[0],ontoTarget=relatedTarget[0]===this.options.show.target[0];
if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==relatedTarget[0]&&"mouse"===this.options.position.target&&ontoTooltip||this.options.hide.fixed&&/mouse(out|leave|move)/.test(event.type)&&(ontoTooltip||ontoTarget))try{event.preventDefault(),event.stopImmediatePropagation()}catch(e){}else this.timers.hide=delay.call(this,function(){this.toggle(FALSE,event)},this.options.hide.delay,this)}}function inactiveMethod(event){!this.tooltip.hasClass(CLASS_DISABLED)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=delay.call(this,function(){this.hide(event)},this.options.hide.inactive))}function repositionMethod(event){
this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(event)}function delegate(selector,events,method){$(document.body).delegate(selector,(events.split?events:events.join("."+NAMESPACE+" "))+"."+NAMESPACE,function(){var api=QTIP.api[$.attr(this,ATTR_ID)];api&&!api.disabled&&method.apply(api,arguments)})}function init(elem,id,opts){var obj,posOptions,attr,config,title,docBody=$(document.body),newTarget=elem[0]===document?docBody:elem,metadata=elem.metadata?elem.metadata(opts.metadata):NULL,metadata5="html5"===opts.metadata.type&&metadata?metadata[opts.metadata.name]:NULL,html5=elem.data(opts.metadata.name||"qtipopts");try{html5="string"==typeof html5?$.parseJSON(html5):html5;
}catch(e){}if(config=$.extend(TRUE,{},QTIP.defaults,opts,"object"==typeof html5?sanitizeOptions(html5):NULL,sanitizeOptions(metadata5||metadata)),posOptions=config.position,config.id=id,"boolean"==typeof config.content.text){if(attr=elem.attr(config.content.attr),config.content.attr===FALSE||!attr)return FALSE;config.content.text=attr}if(posOptions.container.length||(posOptions.container=docBody),posOptions.target===FALSE&&(posOptions.target=newTarget),config.show.target===FALSE&&(config.show.target=newTarget),config.show.solo===TRUE&&(config.show.solo=posOptions.container.closest("body")),config.hide.target===FALSE&&(config.hide.target=newTarget),config.position.viewport===TRUE&&(config.position.viewport=posOptions.container),
posOptions.container=posOptions.container.eq(0),posOptions.at=new CORNER(posOptions.at,TRUE),posOptions.my=new CORNER(posOptions.my),elem.data(NAMESPACE))if(config.overwrite)elem.qtip("destroy",!0);else if(config.overwrite===FALSE)return FALSE;return elem.attr(ATTR_HAS,id),config.suppress&&(title=elem.attr("title"))&&elem.removeAttr("title").attr(oldtitle,title).attr("title",""),obj=new QTip(elem,config,id,!!attr),elem.data(NAMESPACE,obj),obj}function camel(s){return s.charAt(0).toUpperCase()+s.slice(1)}function vendorCss(elem,prop){var cur,val,ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+" "+cssPrefixes.join(ucProp+" ")+ucProp).split(" "),i=0;
if(cssProps[prop])return elem.css(cssProps[prop]);for(;cur=props[i++];)if((val=elem.css(cur))!==undefined)return cssProps[prop]=cur,val}function intCss(elem,prop){return Math.ceil(parseFloat(vendorCss(elem,prop)))}function Tip(qtip,options){this._ns="tip",this.options=options,this.offset=options.offset,this.size=[options.width,options.height],this.init(this.qtip=qtip)}function Modal(api,options){this.options=options,this._ns="-modal",this.init(this.qtip=api)}var QTIP,PROTOTYPE,CORNER,CHECKS,trackingBound,TRUE=!0,FALSE=!1,NULL=null,X="x",Y="y",WIDTH="width",HEIGHT="height",TOP="top",LEFT="left",BOTTOM="bottom",RIGHT="right",CENTER="center",FLIPINVERT="flipinvert",SHIFT="shift",PLUGINS={},NAMESPACE="qtip",ATTR_HAS="data-hasqtip",ATTR_ID="data-qtip-id",WIDGET=["ui-widget","ui-tooltip"],SELECTOR="."+NAMESPACE,INACTIVE_EVENTS="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),CLASS_FIXED=NAMESPACE+"-fixed",CLASS_DEFAULT=NAMESPACE+"-default",CLASS_FOCUS=NAMESPACE+"-focus",CLASS_HOVER=NAMESPACE+"-hover",CLASS_DISABLED=NAMESPACE+"-disabled",replaceSuffix="_replacedByqTip",oldtitle="oldtitle",BROWSER={
ie:function(){for(var v=4,i=document.createElement("div");(i.innerHTML="<!--[if gt IE "+v+"]><i></i><![endif]-->")&&i.getElementsByTagName("i")[0];v+=1);return v>4?v:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||FALSE};PROTOTYPE=QTip.prototype,PROTOTYPE._when=function(deferreds){return $.when.apply($,deferreds)},PROTOTYPE.render=function(show){if(this.rendered||this.destroyed)return this;var tooltip,self=this,options=this.options,cache=this.cache,elements=this.elements,text=options.content.text,title=options.content.title,button=options.content.button,posOptions=options.position,deferreds=("."+this._id+" ",
[]);return $.attr(this.target[0],"aria-describedby",this._id),cache.posClass=this._createPosClass((this.position={my:posOptions.my,at:posOptions.at}).my),this.tooltip=elements.tooltip=tooltip=$("<div/>",{id:this._id,class:[NAMESPACE,CLASS_DEFAULT,options.style.classes,cache.posClass].join(" "),width:options.style.width||"",height:options.style.height||"",tracking:"mouse"===posOptions.target&&posOptions.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":FALSE,"aria-describedby":this._id+"-content","aria-hidden":TRUE}).toggleClass(CLASS_DISABLED,this.disabled).attr(ATTR_ID,this.id).data(NAMESPACE,this).appendTo(posOptions.container).append(elements.content=$("<div />",{
class:NAMESPACE+"-content",id:this._id+"-content","aria-atomic":TRUE})),this.rendered=-1,this.positioning=TRUE,title&&(this._createTitle(),$.isFunction(title)||deferreds.push(this._updateTitle(title,FALSE))),button&&this._createButton(),$.isFunction(text)||deferreds.push(this._updateContent(text,FALSE)),this.rendered=TRUE,this._setWidget(),$.each(PLUGINS,function(name){var instance;"render"===this.initialize&&(instance=this(self))&&(self.plugins[name]=instance)}),this._unassignEvents(),this._assignEvents(),this._when(deferreds).then(function(){self._trigger("render"),self.positioning=FALSE,self.hiddenDuringWait||!options.show.ready&&!show||self.toggle(TRUE,cache.event,FALSE),
self.hiddenDuringWait=FALSE}),QTIP.api[this.id]=this,this},PROTOTYPE.destroy=function(immediate){function process(){if(!this.destroyed){this.destroyed=TRUE;var timer,target=this.target,title=target.attr(oldtitle);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),$.each(this.plugins,function(name){this.destroy&&this.destroy()});for(timer in this.timers)clearTimeout(this.timers[timer]);target.removeData(NAMESPACE).removeAttr(ATTR_ID).removeAttr(ATTR_HAS).removeAttr("aria-describedby"),this.options.suppress&&title&&target.attr("title",title).removeAttr(oldtitle),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=NULL,
delete QTIP.api[this.id]}}return this.destroyed?this.target:(immediate===TRUE&&"hide"!==this.triggering||!this.rendered?process.call(this):(this.tooltip.one("tooltiphidden",$.proxy(process,this)),!this.triggering&&this.hide()),this.target)},CHECKS=PROTOTYPE.checks={builtin:{"^id$":function(obj,o,v,prev){var id=v===TRUE?QTIP.nextid:v,new_id=NAMESPACE+"-"+id;id!==FALSE&&id.length>0&&!$("#"+new_id).length?(this._id=new_id,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):obj[o]=prev},"^prerender":function(obj,o,v){v&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(obj,o,v){
this._updateContent(v)},"^content.attr$":function(obj,o,v,prev){this.options.content.text===this.target.attr(prev)&&this._updateContent(this.target.attr(v))},"^content.title$":function(obj,o,v){return v?(v&&!this.elements.title&&this._createTitle(),void this._updateTitle(v)):this._removeTitle()},"^content.button$":function(obj,o,v){this._updateButton(v)},"^content.title.(text|button)$":function(obj,o,v){this.set("content."+o,v)},"^position.(my|at)$":function(obj,o,v){"string"==typeof v&&(this.position[o]=obj[o]=new CORNER(v,"at"===o))},"^position.container$":function(obj,o,v){this.rendered&&this.tooltip.appendTo(v)},"^show.ready$":function(obj,o,v){v&&(!this.rendered&&this.render(TRUE)||this.toggle(TRUE));
},"^style.classes$":function(obj,o,v,p){this.rendered&&this.tooltip.removeClass(p).addClass(v)},"^style.(width|height)":function(obj,o,v){this.rendered&&this.tooltip.css(o,v)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(obj,o,v){this.rendered&&this.tooltip.toggleClass(CLASS_DEFAULT,!!v)},"^events.(render|show|move|hide|focus|blur)$":function(obj,o,v){this.rendered&&this.tooltip[($.isFunction(v)?"":"un")+"bind"]("tooltip"+o,v)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var posOptions=this.options.position;this.tooltip.attr("tracking","mouse"===posOptions.target&&posOptions.adjust.mouse),
this._unassignEvents(),this._assignEvents()}}}},PROTOTYPE.get=function(notation){if(this.destroyed)return this;var o=convertNotation(this.options,notation.toLowerCase()),result=o[0][o[1]];return result.precedance?result.string():result};var rmove=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,rrender=/^prerender|show\.ready/i;PROTOTYPE.set=function(option,value){if(this.destroyed)return this;var name,rendered=this.rendered,reposition=FALSE,options=this.options;this.checks;return"string"==typeof option?(name=option,option={},option[name]=value):option=$.extend({},option),$.each(option,function(notation,value){if(rendered&&rrender.test(notation))return void delete option[notation];
var previous,obj=convertNotation(options,notation.toLowerCase());previous=obj[0][obj[1]],obj[0][obj[1]]=value&&value.nodeType?$(value):value,reposition=rmove.test(notation)||reposition,option[notation]=[obj[0],obj[1],value,previous]}),sanitizeOptions(options),this.positioning=TRUE,$.each(option,$.proxy(setCallback,this)),this.positioning=FALSE,this.rendered&&this.tooltip[0].offsetWidth>0&&reposition&&this.reposition("mouse"===options.position.target?NULL:this.cache.event),this},PROTOTYPE._update=function(content,element,reposition){var self=this,cache=this.cache;return this.rendered&&content?($.isFunction(content)&&(content=content.call(this.elements.target,cache.event,this)||""),
$.isFunction(content.then)?(cache.waiting=TRUE,content.then(function(c){return cache.waiting=FALSE,self._update(c,element)},NULL,function(e){return self._update(e,element)})):content===FALSE||!content&&""!==content?FALSE:(content.jquery&&content.length>0?element.empty().append(content.css({display:"block",visibility:"visible"})):element.html(content),this._waitForContent(element).then(function(images){self.rendered&&self.tooltip[0].offsetWidth>0&&self.reposition(cache.event,!images.length)}))):FALSE},PROTOTYPE._waitForContent=function(element){var cache=this.cache;return cache.waiting=TRUE,($.fn.imagesLoaded?element.imagesLoaded():$.Deferred().resolve([])).done(function(){
cache.waiting=FALSE}).promise()},PROTOTYPE._updateContent=function(content,reposition){this._update(content,this.elements.content,reposition)},PROTOTYPE._updateTitle=function(content,reposition){this._update(content,this.elements.title,reposition)===FALSE&&this._removeTitle(FALSE)},PROTOTYPE._createTitle=function(){var elements=this.elements,id=this._id+"-title";elements.titlebar&&this._removeTitle(),elements.titlebar=$("<div />",{class:NAMESPACE+"-titlebar "+(this.options.style.widget?createWidgetClass("header"):"")}).append(elements.title=$("<div />",{id:id,class:NAMESPACE+"-title","aria-atomic":TRUE})).insertBefore(elements.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(event){
$(this).toggleClass("ui-state-active ui-state-focus","down"===event.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(event){$(this).toggleClass("ui-state-hover","mouseover"===event.type)}),this.options.content.button&&this._createButton()},PROTOTYPE._removeTitle=function(reposition){var elements=this.elements;elements.title&&(elements.titlebar.remove(),elements.titlebar=elements.title=elements.button=NULL,reposition!==FALSE&&this.reposition())},PROTOTYPE._createPosClass=function(my){return NAMESPACE+"-pos-"+(my||this.options.position.my).abbrev()},PROTOTYPE.reposition=function(event,effect){if(!this.rendered||this.positioning||this.destroyed)return this;
this.positioning=TRUE;var pluginCalculations,offset,adjusted,newClass,cache=this.cache,tooltip=this.tooltip,posOptions=this.options.position,target=posOptions.target,my=posOptions.my,at=posOptions.at,viewport=posOptions.viewport,container=posOptions.container,adjust=posOptions.adjust,method=adjust.method.split(" "),tooltipWidth=tooltip.outerWidth(FALSE),tooltipHeight=tooltip.outerHeight(FALSE),targetWidth=0,targetHeight=0,type=tooltip.css("position"),position={left:0,top:0},visible=tooltip[0].offsetWidth>0,isScroll=event&&"scroll"===event.type,win=$(window),doc=container[0].ownerDocument,mouse=this.mouse;if($.isArray(target)&&2===target.length)at={x:LEFT,y:TOP
},position={left:target[0],top:target[1]};else if("mouse"===target)at={x:LEFT,y:TOP},(!adjust.mouse||this.options.hide.distance)&&cache.origin&&cache.origin.pageX?event=cache.origin:!event||event&&("resize"===event.type||"scroll"===event.type)?event=cache.event:mouse&&mouse.pageX&&(event=mouse),"static"!==type&&(position=container.offset()),doc.body.offsetWidth!==(window.innerWidth||doc.documentElement.clientWidth)&&(offset=$(document.body).offset()),position={left:event.pageX-position.left+(offset&&offset.left||0),top:event.pageY-position.top+(offset&&offset.top||0)},adjust.mouse&&isScroll&&mouse&&(position.left-=(mouse.scrollX||0)-win.scrollLeft(),position.top-=(mouse.scrollY||0)-win.scrollTop());else{
if("event"===target?event&&event.target&&"scroll"!==event.type&&"resize"!==event.type?cache.target=$(event.target):event.target||(cache.target=this.elements.target):"event"!==target&&(cache.target=$(target.jquery?target:this.elements.target)),target=cache.target,target=$(target).eq(0),0===target.length)return this;target[0]===document||target[0]===window?(targetWidth=BROWSER.iOS?window.innerWidth:target.width(),targetHeight=BROWSER.iOS?window.innerHeight:target.height(),target[0]===window&&(position={top:(viewport||target).scrollTop(),left:(viewport||target).scrollLeft()})):PLUGINS.imagemap&&target.is("area")?pluginCalculations=PLUGINS.imagemap(this,target,at,PLUGINS.viewport?method:FALSE):PLUGINS.svg&&target&&target[0].ownerSVGElement?pluginCalculations=PLUGINS.svg(this,target,at,PLUGINS.viewport?method:FALSE):(targetWidth=target.outerWidth(FALSE),
targetHeight=target.outerHeight(FALSE),position=target.offset()),pluginCalculations&&(targetWidth=pluginCalculations.width,targetHeight=pluginCalculations.height,offset=pluginCalculations.offset,position=pluginCalculations.position),position=this.reposition.offset(target,position,container),(BROWSER.iOS>3.1&&BROWSER.iOS<4.1||BROWSER.iOS>=4.3&&BROWSER.iOS<4.33||!BROWSER.iOS&&"fixed"===type)&&(position.left-=win.scrollLeft(),position.top-=win.scrollTop()),(!pluginCalculations||pluginCalculations&&pluginCalculations.adjustable!==FALSE)&&(position.left+=at.x===RIGHT?targetWidth:at.x===CENTER?targetWidth/2:0,position.top+=at.y===BOTTOM?targetHeight:at.y===CENTER?targetHeight/2:0);
}return position.left+=adjust.x+(my.x===RIGHT?-tooltipWidth:my.x===CENTER?-tooltipWidth/2:0),position.top+=adjust.y+(my.y===BOTTOM?-tooltipHeight:my.y===CENTER?-tooltipHeight/2:0),PLUGINS.viewport?(adjusted=position.adjusted=PLUGINS.viewport(this,position,posOptions,targetWidth,targetHeight,tooltipWidth,tooltipHeight),offset&&adjusted.left&&(position.left+=offset.left),offset&&adjusted.top&&(position.top+=offset.top),adjusted.my&&(this.position.my=adjusted.my)):position.adjusted={left:0,top:0},cache.posClass!==(newClass=this._createPosClass(this.position.my))&&tooltip.removeClass(cache.posClass).addClass(cache.posClass=newClass),this._trigger("move",[position,viewport.elem||viewport],event)?(delete position.adjusted,
effect===FALSE||!visible||isNaN(position.left)||isNaN(position.top)||"mouse"===target||!$.isFunction(posOptions.effect)?tooltip.css(position):$.isFunction(posOptions.effect)&&(posOptions.effect.call(tooltip,this,$.extend({},position)),tooltip.queue(function(next){$(this).css({opacity:"",height:""}),BROWSER.ie&&this.style.removeAttribute("filter"),next()})),this.positioning=FALSE,this):this},PROTOTYPE.reposition.offset=function(elem,pos,container){function scroll(e,i){pos.left+=i*e.scrollLeft(),pos.top+=i*e.scrollTop()}if(!container[0])return pos;var scrolled,position,parentOffset,overflow,ownerDocument=$(elem[0].ownerDocument),quirks=!!BROWSER.ie&&"CSS1Compat"!==document.compatMode,parent=container[0];
do"static"!==(position=$.css(parent,"position"))&&("fixed"===position?(parentOffset=parent.getBoundingClientRect(),scroll(ownerDocument,-1)):(parentOffset=$(parent).position(),parentOffset.left+=parseFloat($.css(parent,"borderLeftWidth"))||0,parentOffset.top+=parseFloat($.css(parent,"borderTopWidth"))||0),pos.left-=parentOffset.left+(parseFloat($.css(parent,"marginLeft"))||0),pos.top-=parentOffset.top+(parseFloat($.css(parent,"marginTop"))||0),scrolled||"hidden"===(overflow=$.css(parent,"overflow"))||"visible"===overflow||(scrolled=$(parent)));while(parent=parent.offsetParent);return scrolled&&(scrolled[0]!==ownerDocument[0]||quirks)&&scroll(scrolled,1),pos};var C=(CORNER=PROTOTYPE.reposition.Corner=function(corner,forceY){
corner=(""+corner).replace(/([A-Z])/," $1").replace(/middle/gi,CENTER).toLowerCase(),this.x=(corner.match(/left|right/i)||corner.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(corner.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!forceY;var f=corner.charAt(0);this.precedance="t"===f||"b"===f?Y:X}).prototype;C.invert=function(z,center){this[z]=this[z]===LEFT?RIGHT:this[z]===RIGHT?LEFT:center||this[z]},C.string=function(join){var x=this.x,y=this.y,result=x!==y?"center"===x||"center"!==y&&(this.precedance===Y||this.forceY)?[y,x]:[x,y]:[x];return join!==!1?result.join(" "):result},C.abbrev=function(){var result=this.string(!1);return result[0].charAt(0)+(result[1]&&result[1].charAt(0)||"");
},C.clone=function(){return new CORNER(this.string(),this.forceY)},PROTOTYPE.toggle=function(state,event){var cache=this.cache,options=this.options,tooltip=this.tooltip;if(event){if(/over|enter/.test(event.type)&&cache.event&&/out|leave/.test(cache.event.type)&&options.show.target.add(event.target).length===options.show.target.length&&tooltip.has(event.relatedTarget).length)return this;cache.event=$.event.fix(event)}if(this.waiting&&!state&&(this.hiddenDuringWait=TRUE),!this.rendered)return state?this.render(1):this;if(this.destroyed||this.disabled)return this;var identicalState,allow,after,type=state?"show":"hide",opts=this.options[type],posOptions=(this.options[state?"hide":"show"],
this.options.position),contentOptions=this.options.content,width=this.tooltip.css("width"),visible=this.tooltip.is(":visible"),animate=state||1===opts.target.length,sameTarget=!event||opts.target.length<2||cache.target[0]===event.target;return(typeof state).search("boolean|number")&&(state=!visible),identicalState=!tooltip.is(":animated")&&visible===state&&sameTarget,allow=identicalState?NULL:!!this._trigger(type,[90]),this.destroyed?this:(allow!==FALSE&&state&&this.focus(event),!allow||identicalState?this:($.attr(tooltip[0],"aria-hidden",!state),state?(this.mouse&&(cache.origin=$.event.fix(this.mouse)),$.isFunction(contentOptions.text)&&this._updateContent(contentOptions.text,FALSE),
$.isFunction(contentOptions.title)&&this._updateTitle(contentOptions.title,FALSE),!trackingBound&&"mouse"===posOptions.target&&posOptions.adjust.mouse&&($(document).bind("mousemove."+NAMESPACE,this._storeMouse),trackingBound=TRUE),width||tooltip.css("width",tooltip.outerWidth(FALSE)),this.reposition(event,arguments[2]),width||tooltip.css("width",""),opts.solo&&("string"==typeof opts.solo?$(opts.solo):$(SELECTOR,opts.solo)).not(tooltip).not(opts.target).qtip("hide",$.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete cache.origin,trackingBound&&!$(SELECTOR+'[tracking="true"]:visible',opts.solo).not(tooltip).length&&($(document).unbind("mousemove."+NAMESPACE),
trackingBound=FALSE),this.blur(event)),after=$.proxy(function(){state?(BROWSER.ie&&tooltip[0].style.removeAttribute("filter"),tooltip.css("overflow",""),"string"==typeof opts.autofocus&&$(this.options.show.autofocus,tooltip).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):tooltip.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(state?"visible":"hidden")},this),opts.effect===FALSE||animate===FALSE?(tooltip[type](),after()):$.isFunction(opts.effect)?(tooltip.stop(1,1),opts.effect.call(tooltip,this),tooltip.queue("fx",function(n){after(),n()})):tooltip.fadeTo(90,state?1:0,after),state&&opts.target.trigger("qtip-"+this.id+"-inactive"),
this))},PROTOTYPE.show=function(event){return this.toggle(TRUE,event)},PROTOTYPE.hide=function(event){return this.toggle(FALSE,event)},PROTOTYPE.focus=function(event){if(!this.rendered||this.destroyed)return this;var qtips=$(SELECTOR),tooltip=this.tooltip,curIndex=parseInt(tooltip[0].style.zIndex,10),newIndex=QTIP.zindex+qtips.length;return tooltip.hasClass(CLASS_FOCUS)||this._trigger("focus",[newIndex],event)&&(curIndex!==newIndex&&(qtips.each(function(){this.style.zIndex>curIndex&&(this.style.zIndex=this.style.zIndex-1)}),qtips.filter("."+CLASS_FOCUS).qtip("blur",event)),tooltip.addClass(CLASS_FOCUS)[0].style.zIndex=newIndex),this},PROTOTYPE.blur=function(event){
return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(CLASS_FOCUS),this._trigger("blur",[this.tooltip.css("zIndex")],event),this)},PROTOTYPE.disable=function(state){return this.destroyed?this:("toggle"===state?state=!(this.rendered?this.tooltip.hasClass(CLASS_DISABLED):this.disabled):"boolean"!=typeof state&&(state=TRUE),this.rendered&&this.tooltip.toggleClass(CLASS_DISABLED,state).attr("aria-disabled",state),this.disabled=!!state,this)},PROTOTYPE.enable=function(){return this.disable(FALSE)},PROTOTYPE._createButton=function(){var self=this,elements=this.elements,tooltip=elements.tooltip,button=this.options.content.button,isString="string"==typeof button,close=isString?button:"Close tooltip";
elements.button&&elements.button.remove(),button.jquery?elements.button=button:elements.button=$("<a />",{class:"qtip-close "+(this.options.style.widget?"":NAMESPACE+"-icon"),title:close,"aria-label":close}).prepend($("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),elements.button.appendTo(elements.titlebar||tooltip).attr("role","button").click(function(event){return tooltip.hasClass(CLASS_DISABLED)||self.hide(event),FALSE})},PROTOTYPE._updateButton=function(button){if(!this.rendered)return FALSE;var elem=this.elements.button;button?this._createButton():elem.remove()},PROTOTYPE._setWidget=function(){var on=this.options.style.widget,elements=this.elements,tooltip=elements.tooltip,disabled=tooltip.hasClass(CLASS_DISABLED);
tooltip.removeClass(CLASS_DISABLED),CLASS_DISABLED=on?"ui-state-disabled":"qtip-disabled",tooltip.toggleClass(CLASS_DISABLED,disabled),tooltip.toggleClass("ui-helper-reset "+createWidgetClass(),on).toggleClass(CLASS_DEFAULT,this.options.style.def&&!on),elements.content&&elements.content.toggleClass(createWidgetClass("content"),on),elements.titlebar&&elements.titlebar.toggleClass(createWidgetClass("header"),on),elements.button&&elements.button.toggleClass(NAMESPACE+"-icon",!on)},PROTOTYPE._storeMouse=function(event){return(this.mouse=$.event.fix(event)).type="mousemove",this},PROTOTYPE._bind=function(targets,events,method,suffix,context){if(targets&&method&&events.length){
var ns="."+this._id+(suffix?"-"+suffix:"");return $(targets).bind((events.split?events:events.join(ns+" "))+ns,$.proxy(method,context||this)),this}},PROTOTYPE._unbind=function(targets,suffix){return targets&&$(targets).unbind("."+this._id+(suffix?"-"+suffix:"")),this},PROTOTYPE._trigger=function(type,args,event){var callback=$.Event("tooltip"+type);return callback.originalEvent=event&&$.extend({},event)||this.cache.event||NULL,this.triggering=type,this.tooltip.trigger(callback,[this].concat(args||[])),this.triggering=FALSE,!callback.isDefaultPrevented()},PROTOTYPE._bindEvents=function(showEvents,hideEvents,showTargets,hideTargets,showMethod,hideMethod){var similarTargets=showTargets.filter(hideTargets).add(hideTargets.filter(showTargets)),toggleEvents=[];
similarTargets.length&&($.each(hideEvents,function(i,type){var showIndex=$.inArray(type,showEvents);showIndex>-1&&toggleEvents.push(showEvents.splice(showIndex,1)[0])}),toggleEvents.length&&(this._bind(similarTargets,toggleEvents,function(event){var state=!!this.rendered&&this.tooltip[0].offsetWidth>0;(state?hideMethod:showMethod).call(this,event)}),showTargets=showTargets.not(similarTargets),hideTargets=hideTargets.not(similarTargets))),this._bind(showTargets,showEvents,showMethod),this._bind(hideTargets,hideEvents,hideMethod)},PROTOTYPE._assignInitialEvents=function(event){function hoverIntent(event){return this.disabled||this.destroyed?FALSE:(this.cache.event=event&&$.event.fix(event),
this.cache.target=event&&$(event.target),clearTimeout(this.timers.show),void(this.timers.show=delay.call(this,function(){this.render("object"==typeof event||options.show.ready)},options.prerender?0:options.show.delay)))}var options=this.options,showTarget=options.show.target,hideTarget=options.hide.target,showEvents=options.show.event?$.trim(""+options.show.event).split(" "):[],hideEvents=options.hide.event?$.trim(""+options.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(event){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(options.show.event)&&!/mouse(out|leave)/i.test(options.hide.event)&&hideEvents.push("mouseleave"),
this._bind(showTarget,"mousemove",function(event){this._storeMouse(event),this.cache.onTarget=TRUE}),this._bindEvents(showEvents,hideEvents,showTarget,hideTarget,hoverIntent,function(){return this.timers?void clearTimeout(this.timers.show):FALSE}),(options.show.ready||options.prerender)&&hoverIntent.call(this,event)},PROTOTYPE._assignEvents=function(){var self=this,options=this.options,posOptions=options.position,tooltip=this.tooltip,showTarget=options.show.target,hideTarget=options.hide.target,containerTarget=posOptions.container,viewportTarget=posOptions.viewport,documentTarget=$(document),windowTarget=($(document.body),$(window)),showEvents=options.show.event?$.trim(""+options.show.event).split(" "):[],hideEvents=options.hide.event?$.trim(""+options.hide.event).split(" "):[];
$.each(options.events,function(name,callback){self._bind(tooltip,"toggle"===name?["tooltipshow","tooltiphide"]:["tooltip"+name],callback,null,tooltip)}),/mouse(out|leave)/i.test(options.hide.event)&&"window"===options.hide.leave&&this._bind(documentTarget,["mouseout","blur"],function(event){/select|option/.test(event.target.nodeName)||event.relatedTarget||this.hide(event)}),options.hide.fixed?hideTarget=hideTarget.add(tooltip.addClass(CLASS_FIXED)):/mouse(over|enter)/i.test(options.show.event)&&this._bind(hideTarget,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+options.hide.event).indexOf("unfocus")>-1&&this._bind(containerTarget.closest("html"),["mousedown","touchstart"],function(event){
var elem=$(event.target),enabled=this.rendered&&!this.tooltip.hasClass(CLASS_DISABLED)&&this.tooltip[0].offsetWidth>0,isAncestor=elem.parents(SELECTOR).filter(this.tooltip[0]).length>0;elem[0]===this.target[0]||elem[0]===this.tooltip[0]||isAncestor||this.target.has(elem[0]).length||!enabled||this.hide(event)}),"number"==typeof options.hide.inactive&&(this._bind(showTarget,"qtip-"+this.id+"-inactive",inactiveMethod,"inactive"),this._bind(hideTarget.add(tooltip),QTIP.inactiveEvents,inactiveMethod)),this._bindEvents(showEvents,hideEvents,showTarget,hideTarget,showMethod,hideMethod),this._bind(showTarget.add(tooltip),"mousemove",function(event){if("number"==typeof options.hide.distance){
var origin=this.cache.origin||{},limit=this.options.hide.distance,abs=Math.abs;(abs(event.pageX-origin.pageX)>=limit||abs(event.pageY-origin.pageY)>=limit)&&this.hide(event)}this._storeMouse(event)}),"mouse"===posOptions.target&&posOptions.adjust.mouse&&(options.hide.event&&this._bind(showTarget,["mouseenter","mouseleave"],function(event){return this.cache?void(this.cache.onTarget="mouseenter"===event.type):FALSE}),this._bind(documentTarget,"mousemove",function(event){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(CLASS_DISABLED)&&this.tooltip[0].offsetWidth>0&&this.reposition(event)})),(posOptions.adjust.resize||viewportTarget.length)&&this._bind($.event.special.resize?viewportTarget:windowTarget,"resize",repositionMethod),
posOptions.adjust.scroll&&this._bind(windowTarget.add(posOptions.container),"scroll",repositionMethod)},PROTOTYPE._unassignEvents=function(){var options=this.options,showTargets=options.show.target,hideTargets=options.hide.target,targets=$.grep([this.elements.target[0],this.rendered&&this.tooltip[0],options.position.container[0],options.position.viewport[0],options.position.container.closest("html")[0],window,document],function(i){return"object"==typeof i});showTargets&&showTargets.toArray&&(targets=targets.concat(showTargets.toArray())),hideTargets&&hideTargets.toArray&&(targets=targets.concat(hideTargets.toArray())),this._unbind(targets)._unbind(targets,"destroy")._unbind(targets,"inactive");
},$(function(){delegate(SELECTOR,["mouseenter","mouseleave"],function(event){var state="mouseenter"===event.type,tooltip=$(event.currentTarget),target=$(event.relatedTarget||event.target),options=this.options;state?(this.focus(event),tooltip.hasClass(CLASS_FIXED)&&!tooltip.hasClass(CLASS_DISABLED)&&clearTimeout(this.timers.hide)):"mouse"===options.position.target&&options.position.adjust.mouse&&options.hide.event&&options.show.target&&!target.closest(options.show.target[0]).length&&this.hide(event),tooltip.toggleClass(CLASS_HOVER,state)}),delegate("["+ATTR_ID+"]",INACTIVE_EVENTS,inactiveMethod)}),QTIP=$.fn.qtip=function(options,notation,newValue){var command=(""+options).toLowerCase(),returned=NULL,args=$.makeArray(arguments).slice(1),event=args[args.length-1],opts=this[0]?$.data(this[0],NAMESPACE):NULL;
return!arguments.length&&opts||"api"===command?opts:"string"==typeof options?(this.each(function(){var api=$.data(this,NAMESPACE);if(!api)return TRUE;if(event&&event.timeStamp&&(api.cache.event=event),!notation||"option"!==command&&"options"!==command)api[command]&&api[command].apply(api,args);else{if(newValue===undefined&&!$.isPlainObject(notation))return returned=api.get(notation),FALSE;api.set(notation,newValue)}}),returned!==NULL?returned:this):"object"!=typeof options&&arguments.length?void 0:(opts=sanitizeOptions($.extend(TRUE,{},options)),this.each(function(i){var api,id;return id=$.isArray(opts.id)?opts.id[i]:opts.id,id=!id||id===FALSE||id.length<1||QTIP.api[id]?QTIP.nextid++:id,
api=init($(this),id,opts),api===FALSE?TRUE:(QTIP.api[id]=api,$.each(PLUGINS,function(){"initialize"===this.initialize&&this(api)}),void api._assignInitialEvents(event))}))},$.qtip=QTip,QTIP.api={},$.each({attr:function(attr,val){if(this.length){var self=this[0],title="title",api=$.data(self,"qtip");if(attr===title&&api&&"object"==typeof api&&api.options.suppress)return arguments.length<2?$.attr(self,oldtitle):(api&&api.options.content.attr===title&&api.cache.attr&&api.set("content.text",val),this.attr(oldtitle,val))}return $.fn["attr"+replaceSuffix].apply(this,arguments)},clone:function(keepData){var elems=($([]),$.fn["clone"+replaceSuffix].apply(this,arguments));
return keepData||elems.filter("["+oldtitle+"]").attr("title",function(){return $.attr(this,oldtitle)}).removeAttr(oldtitle),elems}},function(name,func){if(!func||$.fn[name+replaceSuffix])return TRUE;var old=$.fn[name+replaceSuffix]=$.fn[name];$.fn[name]=function(){return func.apply(this,arguments)||old.apply(this,arguments)}}),$.ui||($["cleanData"+replaceSuffix]=$.cleanData,$.cleanData=function(elems){for(var elem,i=0;(elem=$(elems[i])).length;i++)if(elem.attr(ATTR_HAS))try{elem.triggerHandler("removeqtip")}catch(e){}$["cleanData"+replaceSuffix].apply(this,arguments)}),QTIP.version="2.2.1",QTIP.nextid=0,QTIP.inactiveEvents=INACTIVE_EVENTS,QTIP.zindex=15e3,QTIP.defaults={
prerender:FALSE,id:FALSE,overwrite:TRUE,suppress:TRUE,content:{text:TRUE,attr:"title",title:FALSE,button:FALSE},position:{my:"top left",at:"bottom right",target:FALSE,container:FALSE,viewport:FALSE,adjust:{x:0,y:0,mouse:TRUE,scroll:TRUE,resize:TRUE,method:"flipinvert flipinvert"},effect:function(api,pos,viewport){$(this).animate(pos,{duration:200,queue:FALSE})}},show:{target:FALSE,event:"mouseenter",effect:TRUE,delay:90,solo:FALSE,ready:FALSE,autofocus:FALSE},hide:{target:FALSE,event:"mouseleave",effect:TRUE,delay:0,fixed:FALSE,inactive:FALSE,leave:"window",distance:FALSE},style:{classes:"",widget:FALSE,width:FALSE,height:FALSE,def:TRUE},events:{render:NULL,move:NULL,
show:NULL,hide:NULL,toggle:NULL,visible:NULL,hidden:NULL,focus:NULL,blur:NULL}};var TIP,MARGIN="margin",BORDER="border",COLOR="color",BG_COLOR="background-color",TRANSPARENT="transparent",IMPORTANT=" !important",HASCANVAS=!!document.createElement("canvas").getContext,INVALID=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,cssProps={},cssPrefixes=["Webkit","O","Moz","ms"];if(HASCANVAS)var PIXEL_RATIO=window.devicePixelRatio||1,BACKING_STORE_RATIO=function(){var context=document.createElement("canvas").getContext("2d");return context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||1;
}(),SCALE=PIXEL_RATIO/BACKING_STORE_RATIO;else var createVML=function(tag,props,style){return"<qtipvml:"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(props||"")+' style="behavior: url(#default#VML); '+(style||"")+'" />'};$.extend(Tip.prototype,{init:function(qtip){var context,tip;tip=this.element=qtip.elements.tip=$("<div />",{class:NAMESPACE+"-tip"}).prependTo(qtip.tooltip),HASCANVAS?(context=$("<canvas />").appendTo(this.element)[0].getContext("2d"),context.lineJoin="miter",context.miterLimit=1e5,context.save()):(context=createVML("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(context+context),qtip._bind($("*",tip).add(tip),["click","mousedown"],function(event){
event.stopPropagation()},this._ns)),qtip._bind(qtip.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(corner){var titlebar=this.qtip.elements.titlebar;return titlebar&&(corner.y===TOP||corner.y===CENTER&&this.element.position().top+this.size[1]/2+this.options.offset<titlebar.outerHeight(TRUE))},_parseCorner:function(corner){var my=this.qtip.options.position.my;return corner===FALSE||my===FALSE?corner=FALSE:corner===TRUE?corner=new CORNER(my.string()):corner.string||(corner=new CORNER(corner),
corner.fixed=TRUE),corner},_parseWidth:function(corner,side,use){var elements=this.qtip.elements,prop=BORDER+camel(side)+"Width";return(use?intCss(use,prop):intCss(elements.content,prop)||intCss(this._useTitle(corner)&&elements.titlebar||elements.content,prop)||intCss(elements.tooltip,prop))||0},_parseRadius:function(corner){var elements=this.qtip.elements,prop=BORDER+camel(corner.y)+camel(corner.x)+"Radius";return BROWSER.ie<9?0:intCss(this._useTitle(corner)&&elements.titlebar||elements.content,prop)||intCss(elements.tooltip,prop)||0},_invalidColour:function(elem,prop,compare){var val=elem.css(prop);return!val||compare&&val===elem.css(compare)||INVALID.test(val)?FALSE:val;
},_parseColours:function(corner){var elements=this.qtip.elements,tip=this.element.css("cssText",""),borderSide=BORDER+camel(corner[corner.precedance])+camel(COLOR),colorElem=this._useTitle(corner)&&elements.titlebar||elements.content,css=this._invalidColour,color=[];return color[0]=css(tip,BG_COLOR)||css(colorElem,BG_COLOR)||css(elements.content,BG_COLOR)||css(elements.tooltip,BG_COLOR)||tip.css(BG_COLOR),color[1]=css(tip,borderSide,COLOR)||css(colorElem,borderSide,COLOR)||css(elements.content,borderSide,COLOR)||css(elements.tooltip,borderSide,COLOR)||elements.tooltip.css(borderSide),$("*",tip).add(tip).css("cssText",BG_COLOR+":"+TRANSPARENT+IMPORTANT+";"+BORDER+":0"+IMPORTANT+";"),
color},_calculateSize:function(corner){var bigHyp,ratio,result,y=corner.precedance===Y,width=this.options.width,height=this.options.height,isCenter="c"===corner.abbrev(),base=(y?width:height)*(isCenter?.5:1),pow=Math.pow,round=Math.round,smallHyp=Math.sqrt(pow(base,2)+pow(height,2)),hyp=[this.border/base*smallHyp,this.border/height*smallHyp];return hyp[2]=Math.sqrt(pow(hyp[0],2)-pow(this.border,2)),hyp[3]=Math.sqrt(pow(hyp[1],2)-pow(this.border,2)),bigHyp=smallHyp+hyp[2]+hyp[3]+(isCenter?0:hyp[0]),ratio=bigHyp/smallHyp,result=[round(ratio*width),round(ratio*height)],y?result:result.reverse()},_calculateTip:function(corner,size,scale){scale=scale||1,size=size||this.size;
var width=size[0]*scale,height=size[1]*scale,width2=Math.ceil(width/2),height2=Math.ceil(height/2),tips={br:[0,0,width,height,width,0],bl:[0,0,width,0,0,height],tr:[0,height,width,0,width,height],tl:[0,0,0,height,width,height],tc:[0,height,width2,0,width,height],bc:[0,0,width,0,width2,height],rc:[0,0,width,height2,0,height],lc:[width,0,width,height,0,height2]};return tips.lt=tips.br,tips.rt=tips.bl,tips.lb=tips.tr,tips.rb=tips.tl,tips[corner.abbrev()]},_drawCoords:function(context,coords){context.beginPath(),context.moveTo(coords[0],coords[1]),context.lineTo(coords[2],coords[3]),context.lineTo(coords[4],coords[5]),context.closePath()},create:function(){var c=this.corner=(HASCANVAS||BROWSER.ie)&&this._parseCorner(this.options.corner);
return(this.enabled=!!this.corner&&"c"!==this.corner.abbrev())&&(this.qtip.cache.corner=c.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(corner,position){if(!this.enabled)return this;var color,precedance,context,coords,bigCoords,translate,newSize,border,elements=this.qtip.elements,tip=this.element,inner=tip.children(),options=this.options,curSize=this.size,mimic=options.mimic,round=Math.round;corner||(corner=this.qtip.cache.corner||this.corner),mimic===FALSE?mimic=corner:(mimic=new CORNER(mimic),mimic.precedance=corner.precedance,"inherit"===mimic.x?mimic.x=corner.x:"inherit"===mimic.y?mimic.y=corner.y:mimic.x===mimic.y&&(mimic[corner.precedance]=corner[corner.precedance])),
precedance=mimic.precedance,corner.precedance===X?this._swapDimensions():this._resetDimensions(),color=this.color=this._parseColours(corner),color[1]!==TRANSPARENT?(border=this.border=this._parseWidth(corner,corner[corner.precedance]),options.border&&border<1&&!INVALID.test(color[1])&&(color[0]=color[1]),this.border=border=options.border!==TRUE?options.border:border):this.border=border=0,newSize=this.size=this._calculateSize(corner),tip.css({width:newSize[0],height:newSize[1],lineHeight:newSize[1]+"px"}),translate=corner.precedance===Y?[round(mimic.x===LEFT?border:mimic.x===RIGHT?newSize[0]-curSize[0]-border:(newSize[0]-curSize[0])/2),round(mimic.y===TOP?newSize[1]-curSize[1]:0)]:[round(mimic.x===LEFT?newSize[0]-curSize[0]:0),round(mimic.y===TOP?border:mimic.y===BOTTOM?newSize[1]-curSize[1]-border:(newSize[1]-curSize[1])/2)],
HASCANVAS?(context=inner[0].getContext("2d"),context.restore(),context.save(),context.clearRect(0,0,6e3,6e3),coords=this._calculateTip(mimic,curSize,SCALE),bigCoords=this._calculateTip(mimic,this.size,SCALE),inner.attr(WIDTH,newSize[0]*SCALE).attr(HEIGHT,newSize[1]*SCALE),inner.css(WIDTH,newSize[0]).css(HEIGHT,newSize[1]),this._drawCoords(context,bigCoords),context.fillStyle=color[1],context.fill(),context.translate(translate[0]*SCALE,translate[1]*SCALE),this._drawCoords(context,coords),context.fillStyle=color[0],context.fill()):(coords=this._calculateTip(mimic),coords="m"+coords[0]+","+coords[1]+" l"+coords[2]+","+coords[3]+" "+coords[4]+","+coords[5]+" xe",
translate[2]=border&&/^(r|b)/i.test(corner.string())?8===BROWSER.ie?2:1:0,inner.css({coordsize:newSize[0]+border+" "+(newSize[1]+border),antialias:""+(mimic.string().indexOf(CENTER)>-1),left:translate[0]-translate[2]*Number(precedance===X),top:translate[1]-translate[2]*Number(precedance===Y),width:newSize[0]+border,height:newSize[1]+border}).each(function(i){var $this=$(this);$this[$this.prop?"prop":"attr"]({coordsize:newSize[0]+border+" "+(newSize[1]+border),path:coords,fillcolor:color[0],filled:!!i,stroked:!i}).toggle(!(!border&&!i)),!i&&$this.html(createVML("stroke",'weight="'+2*border+'px" color="'+color[1]+'" miterlimit="1000" joinstyle="miter"'))})),window.opera&&setTimeout(function(){
elements.tip.css({display:"inline-block",visibility:"visible"})},1),position!==FALSE&&this.calculate(corner,newSize)},calculate:function(corner,size){if(!this.enabled)return FALSE;var precedance,corners,self=this,elements=this.qtip.elements,tip=this.element,userOffset=this.options.offset,position=(elements.tooltip.hasClass("ui-widget"),{});return corner=corner||this.corner,precedance=corner.precedance,size=size||this._calculateSize(corner),corners=[corner.x,corner.y],precedance===X&&corners.reverse(),$.each(corners,function(i,side){var b,bc,br;side===CENTER?(b=precedance===Y?LEFT:TOP,position[b]="50%",position[MARGIN+"-"+b]=-Math.round(size[precedance===Y?0:1]/2)+userOffset):(b=self._parseWidth(corner,side,elements.tooltip),
bc=self._parseWidth(corner,side,elements.content),br=self._parseRadius(corner),position[side]=Math.max(-self.border,i?bc:userOffset+(br>b?br:-b)))}),position[corner[precedance]]-=size[precedance===X?0:1],tip.css({margin:"",top:"",bottom:"",left:"",right:""}).css(position),position},reposition:function(event,api,pos,viewport){function shiftflip(direction,precedance,popposite,side,opposite){direction===SHIFT&&newCorner.precedance===precedance&&adjust[side]&&newCorner[popposite]!==CENTER?newCorner.precedance=newCorner.precedance===X?Y:X:direction!==SHIFT&&adjust[side]&&(newCorner[precedance]=newCorner[precedance]===CENTER?adjust[side]>0?side:opposite:newCorner[precedance]===side?opposite:side);
}function shiftonly(xy,side,opposite){newCorner[xy]===CENTER?css[MARGIN+"-"+side]=shift[xy]=offset[MARGIN+"-"+side]-adjust[side]:(props=offset[opposite]!==undefined?[adjust[side],-offset[side]]:[-adjust[side],offset[side]],(shift[xy]=Math.max(props[0],props[1]))>props[0]&&(pos[side]-=adjust[side],shift[side]=FALSE),css[offset[opposite]!==undefined?opposite:side]=shift[xy])}if(this.enabled){var offset,props,cache=api.cache,newCorner=this.corner.clone(),adjust=pos.adjusted,method=api.options.position.adjust.method.split(" "),horizontal=method[0],vertical=method[1]||method[0],shift={left:FALSE,top:FALSE,x:0,y:0},css={};this.corner.fixed!==TRUE&&(shiftflip(horizontal,X,Y,LEFT,RIGHT),
shiftflip(vertical,Y,X,TOP,BOTTOM),newCorner.string()===cache.corner.string()&&cache.cornerTop===adjust.top&&cache.cornerLeft===adjust.left||this.update(newCorner,FALSE)),offset=this.calculate(newCorner),offset.right!==undefined&&(offset.left=-offset.right),offset.bottom!==undefined&&(offset.top=-offset.bottom),offset.user=this.offset,(shift.left=horizontal===SHIFT&&!!adjust.left)&&shiftonly(X,LEFT,RIGHT),(shift.top=vertical===SHIFT&&!!adjust.top)&&shiftonly(Y,TOP,BOTTOM),this.element.css(css).toggle(!(shift.x&&shift.y||newCorner.x===CENTER&&shift.y||newCorner.y===CENTER&&shift.x)),pos.left-=offset.left.charAt?offset.user:horizontal!==SHIFT||shift.top||!shift.left&&!shift.top?offset.left+this.border:0,
pos.top-=offset.top.charAt?offset.user:vertical!==SHIFT||shift.left||!shift.left&&!shift.top?offset.top+this.border:0,cache.cornerLeft=adjust.left,cache.cornerTop=adjust.top,cache.corner=newCorner.clone()}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),TIP=PLUGINS.tip=function(api){return new Tip(api,api.options.style.tip)},TIP.initialize="render",TIP.sanitize=function(options){if(options.style&&"tip"in options.style){var opts=options.style.tip;"object"!=typeof opts&&(opts=options.style.tip={corner:opts}),/string|boolean/i.test(typeof opts.corner)||(opts.corner=TRUE);
}},CHECKS.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(obj){this.size=[obj.width,obj.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},$.extend(TRUE,QTIP.defaults,{style:{tip:{corner:TRUE,mimic:FALSE,width:6,height:6,border:TRUE,offset:0}}}),PLUGINS.viewport=function(api,position,posOptions,targetWidth,targetHeight,elemWidth,elemHeight){function calculate(side,otherSide,type,adjust,side1,side2,lengthName,targetLength,elemLength){var initialPos=position[side1],mySide=my[side],atSide=at[side],isShift=type===SHIFT,myLength=mySide===side1?elemLength:mySide===side2?-elemLength:-elemLength/2,atLength=atSide===side1?targetLength:atSide===side2?-targetLength:-targetLength/2,sideOffset=viewportScroll[side1]+viewportOffset[side1]-(containerStatic?0:containerOffset[side1]),overflow1=sideOffset-initialPos,overflow2=initialPos+elemLength-(lengthName===WIDTH?viewportWidth:viewportHeight)-sideOffset,offset=myLength-(my.precedance===side||mySide===my[otherSide]?atLength:0)-(atSide===CENTER?targetLength/2:0);
return isShift?(offset=(mySide===side1?1:-1)*myLength,position[side1]+=overflow1>0?overflow1:overflow2>0?-overflow2:0,position[side1]=Math.max(-containerOffset[side1]+viewportOffset[side1],initialPos-offset,Math.min(Math.max(-containerOffset[side1]+viewportOffset[side1]+(lengthName===WIDTH?viewportWidth:viewportHeight),initialPos+offset),position[side1],"center"===mySide?initialPos-myLength:1e9))):(adjust*=type===FLIPINVERT?2:0,overflow1>0&&(mySide!==side1||overflow2>0)?(position[side1]-=offset+adjust,newMy.invert(side,side1)):overflow2>0&&(mySide!==side2||overflow1>0)&&(position[side1]-=(mySide===CENTER?-offset:offset)+adjust,newMy.invert(side,side2)),position[side1]<viewportScroll&&-position[side1]>overflow2&&(position[side1]=initialPos,
newMy=my.clone())),position[side1]-initialPos}var fixed,newMy,containerOffset,containerStatic,viewportWidth,viewportHeight,viewportScroll,viewportOffset,target=posOptions.target,tooltip=api.elements.tooltip,my=posOptions.my,at=posOptions.at,adjust=posOptions.adjust,method=adjust.method.split(" "),methodX=method[0],methodY=method[1]||method[0],viewport=posOptions.viewport,container=posOptions.container,adjusted=(api.cache,{left:0,top:0});return viewport.jquery&&target[0]!==window&&target[0]!==document.body&&"none"!==adjust.method?(containerOffset=container.offset()||adjusted,containerStatic="static"===container.css("position"),fixed="fixed"===tooltip.css("position"),
viewportWidth=viewport[0]===window?viewport.width():viewport.outerWidth(FALSE),viewportHeight=viewport[0]===window?viewport.height():viewport.outerHeight(FALSE),viewportScroll={left:fixed?0:viewport.scrollLeft(),top:fixed?0:viewport.scrollTop()},viewportOffset=viewport.offset()||adjusted,"shift"===methodX&&"shift"===methodY||(newMy=my.clone()),adjusted={left:"none"!==methodX?calculate(X,Y,methodX,adjust.x,LEFT,RIGHT,WIDTH,targetWidth,elemWidth):0,top:"none"!==methodY?calculate(Y,X,methodY,adjust.y,TOP,BOTTOM,HEIGHT,targetHeight,elemHeight):0,my:newMy}):adjusted},PLUGINS.polys={polygon:function(baseCoords,corner){var next,newWidth,newHeight,result={width:0,height:0,
position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:FALSE},i=0,coords=[],compareX=1,compareY=1,realX=0,realY=0;for(i=baseCoords.length;i--;)next=[parseInt(baseCoords[--i],10),parseInt(baseCoords[i+1],10)],next[0]>result.position.right&&(result.position.right=next[0]),next[0]<result.position.left&&(result.position.left=next[0]),next[1]>result.position.bottom&&(result.position.bottom=next[1]),next[1]<result.position.top&&(result.position.top=next[1]),coords.push(next);if(newWidth=result.width=Math.abs(result.position.right-result.position.left),newHeight=result.height=Math.abs(result.position.bottom-result.position.top),"c"===corner.abbrev())result.position={
left:result.position.left+result.width/2,top:result.position.top+result.height/2};else{for(;newWidth>0&&newHeight>0&&compareX>0&&compareY>0;)for(newWidth=Math.floor(newWidth/2),newHeight=Math.floor(newHeight/2),corner.x===LEFT?compareX=newWidth:corner.x===RIGHT?compareX=result.width-newWidth:compareX+=Math.floor(newWidth/2),corner.y===TOP?compareY=newHeight:corner.y===BOTTOM?compareY=result.height-newHeight:compareY+=Math.floor(newHeight/2),i=coords.length;i--&&!(coords.length<2);)realX=coords[i][0]-result.position.left,realY=coords[i][1]-result.position.top,(corner.x===LEFT&&realX>=compareX||corner.x===RIGHT&&realX<=compareX||corner.x===CENTER&&(realX<compareX||realX>result.width-compareX)||corner.y===TOP&&realY>=compareY||corner.y===BOTTOM&&realY<=compareY||corner.y===CENTER&&(realY<compareY||realY>result.height-compareY))&&coords.splice(i,1);
result.position={left:coords[0][0],top:coords[0][1]}}return result},rect:function(ax,ay,bx,by){return{width:Math.abs(bx-ax),height:Math.abs(by-ay),position:{left:Math.min(ax,bx),top:Math.min(ay,by)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(cx,cy,rx,ry,corner){var c=PLUGINS.polys._angles[corner.abbrev()],rxc=0===c?0:rx*Math.cos(c*Math.PI),rys=ry*Math.sin(c*Math.PI);return{width:2*rx-Math.abs(rxc),height:2*ry-Math.abs(rys),position:{left:cx+rxc,top:cy+rys},adjustable:FALSE}},circle:function(cx,cy,r,corner){return PLUGINS.polys.ellipse(cx,cy,r,r,corner)}},PLUGINS.svg=function(api,svg,corner){for(var frameOffset,mtx,transformed,len,next,i,points,result,position,elem=($(document),
svg[0]),root=$(elem.ownerSVGElement),ownerDocument=elem.ownerDocument,strokeWidth2=(parseInt(svg.css("stroke-width"),10)||0)/2;!elem.getBBox;)elem=elem.parentNode;if(!elem.getBBox||!elem.parentNode)return FALSE;switch(elem.nodeName){case"ellipse":case"circle":result=PLUGINS.polys.ellipse(elem.cx.baseVal.value,elem.cy.baseVal.value,(elem.rx||elem.r).baseVal.value+strokeWidth2,(elem.ry||elem.r).baseVal.value+strokeWidth2,corner);break;case"line":case"polygon":case"polyline":for(points=elem.points||[{x:elem.x1.baseVal.value,y:elem.y1.baseVal.value},{x:elem.x2.baseVal.value,y:elem.y2.baseVal.value}],result=[],i=-1,len=points.numberOfItems||points.length;++i<len;)next=points.getItem?points.getItem(i):points[i],
result.push.apply(result,[next.x,next.y]);result=PLUGINS.polys.polygon(result,corner);break;default:result=elem.getBBox(),result={width:result.width,height:result.height,position:{left:result.x,top:result.y}}}return position=result.position,root=root[0],root.createSVGPoint&&(mtx=elem.getScreenCTM(),points=root.createSVGPoint(),points.x=position.left,points.y=position.top,transformed=points.matrixTransform(mtx),position.left=transformed.x,position.top=transformed.y),ownerDocument!==document&&"mouse"!==api.position.target&&(frameOffset=$((ownerDocument.defaultView||ownerDocument.parentWindow).frameElement).offset(),frameOffset&&(position.left+=frameOffset.left,
position.top+=frameOffset.top)),ownerDocument=$(ownerDocument),position.left+=ownerDocument.scrollLeft(),position.top+=ownerDocument.scrollTop(),result};var MODAL,OVERLAY,MODALCLASS="qtip-modal",MODALSELECTOR="."+MODALCLASS;OVERLAY=function(){function focusable(element){if($.expr[":"].focusable)return $.expr[":"].focusable;var map,mapName,img,isTabIndexNotNaN=!isNaN($.attr(element,"tabindex")),nodeName=element.nodeName&&element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,!(!element.href||!mapName||"map"!==map.nodeName.toLowerCase())&&(img=$("img[usemap=#"+mapName+"]")[0],!!img&&img.is(":visible"))):/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN;
}function focusInputs(blurElems){focusableElems.length<1&&blurElems.length?blurElems.not("body").blur():focusableElems.first().focus()}function stealFocus(event){if(elem.is(":visible")){var targetOnTop,target=$(event.target),tooltip=current.tooltip,container=target.closest(SELECTOR);targetOnTop=container.length<1?FALSE:parseInt(container[0].style.zIndex,10)>parseInt(tooltip[0].style.zIndex,10),targetOnTop||target.closest(SELECTOR)[0]===tooltip[0]||focusInputs(target),onLast=event.target===focusableElems[focusableElems.length-1]}}var current,onLast,prevState,elem,self=this,focusableElems={};$.extend(self,{init:function(){return elem=self.elem=$("<div />",{id:"qtip-overlay",
html:"<div></div>",mousedown:function(){return FALSE}}).hide(),$(document.body).bind("focusin"+MODALSELECTOR,stealFocus),$(document).bind("keydown"+MODALSELECTOR,function(event){current&&current.options.show.modal.escape&&27===event.keyCode&&current.hide(event)}),elem.bind("click"+MODALSELECTOR,function(event){current&&current.options.show.modal.blur&&current.hide(event)}),self},update:function(api){current=api,focusableElems=api.options.show.modal.stealfocus!==FALSE?api.tooltip.find("*").filter(function(){return focusable(this)}):[]},toggle:function(api,state,duration){var tooltip=($(document.body),api.tooltip),options=api.options.show.modal,effect=options.effect,type=state?"show":"hide",visible=elem.is(":visible"),visibleModals=$(MODALSELECTOR).filter(":visible:not(:animated)").not(tooltip);
return self.update(api),state&&options.stealfocus!==FALSE&&focusInputs($(":focus")),elem.toggleClass("blurs",options.blur),state&&elem.appendTo(document.body),elem.is(":animated")&&visible===state&&prevState!==FALSE||!state&&visibleModals.length?self:(elem.stop(TRUE,FALSE),$.isFunction(effect)?effect.call(elem,state):effect===FALSE?elem[type]():elem.fadeTo(parseInt(duration,10)||90,state?1:0,function(){state||elem.hide()}),state||elem.queue(function(next){elem.css({left:"",top:""}),$(MODALSELECTOR).length||elem.detach(),next()}),prevState=state,current.destroyed&&(current=NULL),self)}}),self.init()},OVERLAY=new OVERLAY,$.extend(Modal.prototype,{init:function(qtip){
var tooltip=qtip.tooltip;return this.options.on?(qtip.elements.overlay=OVERLAY.elem,tooltip.addClass(MODALCLASS).css("z-index",QTIP.modal_zindex+$(MODALSELECTOR).length),qtip._bind(tooltip,["tooltipshow","tooltiphide"],function(event,api,duration){var oEvent=event.originalEvent;if(event.target===tooltip[0])if(oEvent&&"tooltiphide"===event.type&&/mouse(leave|enter)/.test(oEvent.type)&&$(oEvent.relatedTarget).closest(OVERLAY.elem[0]).length)try{event.preventDefault()}catch(e){}else(!oEvent||oEvent&&"tooltipsolo"!==oEvent.type)&&this.toggle(event,"tooltipshow"===event.type,duration)},this._ns,this),qtip._bind(tooltip,"tooltipfocus",function(event,api){if(!event.isDefaultPrevented()&&event.target===tooltip[0]){
var qtips=$(MODALSELECTOR),newIndex=QTIP.modal_zindex+qtips.length,curIndex=parseInt(tooltip[0].style.zIndex,10);OVERLAY.elem[0].style.zIndex=newIndex-1,qtips.each(function(){this.style.zIndex>curIndex&&(this.style.zIndex-=1)}),qtips.filter("."+CLASS_FOCUS).qtip("blur",event.originalEvent),tooltip.addClass(CLASS_FOCUS)[0].style.zIndex=newIndex,OVERLAY.update(api);try{event.preventDefault()}catch(e){}}},this._ns,this),void qtip._bind(tooltip,"tooltiphide",function(event){event.target===tooltip[0]&&$(MODALSELECTOR).filter(":visible").not(tooltip).last().qtip("focus",event)},this._ns,this)):this},toggle:function(event,state,duration){return event&&event.isDefaultPrevented()?this:void OVERLAY.toggle(this.qtip,!!state,duration);
},destroy:function(){this.qtip.tooltip.removeClass(MODALCLASS),this.qtip._unbind(this.qtip.tooltip,this._ns),OVERLAY.toggle(this.qtip,FALSE),delete this.qtip.elements.overlay}}),MODAL=PLUGINS.modal=function(api){return new Modal(api,api.options.show.modal)},MODAL.sanitize=function(opts){opts.show&&("object"!=typeof opts.show.modal?opts.show.modal={on:!!opts.show.modal}:"undefined"==typeof opts.show.modal.on&&(opts.show.modal.on=TRUE))},QTIP.modal_zindex=QTIP.zindex-200,MODAL.initialize="render",CHECKS.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},$.extend(TRUE,QTIP.defaults,{
show:{modal:{on:FALSE,effect:TRUE,blur:TRUE,stealfocus:TRUE,escape:TRUE}}})})}(window,document),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","select2","ui/tooltip"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var _emptyValue="empty",_defaultOptions={allowEmpty:!0,placeholderText:__("select a choice")},render=function(interaction,options){
var opts=_.clone(_defaultOptions),required=!!interaction.attr("required");_.extend(opts,options);var $container=containerHelper.get(interaction);opts.allowEmpty&&!required?$container.find("option[value="+_emptyValue+"]").text("--- "+__("leave empty")+" ---"):$container.find("option[value="+_emptyValue+"]").remove(),$container.select2({width:"element",placeholder:opts.placeholderText,minimumResultsForSearch:-1,dropdownCssClass:"qti-inlineChoiceInteraction-dropdown"});var $el=$container.select2("container");_setInstructions(interaction),$container.on("change",function(e){if($(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")){var $selectedIndex=$(e.currentTarget)[0].options.selectedIndex?$(e.currentTarget)[0].options.selectedIndex:null;
$container.find("option").one("click",function(e){e.stopPropagation()}),$container.find("option").eq($selectedIndex).trigger("click")}required&&""!==$container.val()&&$el.qtip("hide"),containerHelper.triggerResponseChangeEvent(interaction)}).on("select2-open",function(){required&&$el.qtip("hide")}).on("select2-close",function(){required&&""===$container.val()&&$el.qtip("show")})},_setInstructions=function(interaction){var required=!!interaction.attr("required"),$container=interaction.getContainer(),$el=$container.select2("container");required&&($el.qtip({theme:"warning",content:{text:__("A choice must be selected")}}),""===$container.val()&&$el.qtip("show"))},resetResponse=function(interaction){
_setVal(interaction,_emptyValue)},_setVal=function(interaction,choiceIdentifier){containerHelper.get(interaction).val(choiceIdentifier).select2("val",choiceIdentifier)},setResponse=function(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},_getRawResponse=function(interaction){var value=containerHelper.get(interaction).val();return value&&value!==_emptyValue?[value]:[]},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),$container.select2("destroy"),instructionMgr.removeInstructions(interaction),
containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$container.select2("disable").select2("close"),$("option[data-identifier]",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($container),$container.select2("enable")))},getState=function(interaction){
var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$("option[data-identifier]",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"inlineChoiceInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program11(depth0,data,depth1){var stack1,buffer="";return buffer+="\n      <tr>\n        ",stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.each.call(depth0,depth1&&depth1.matchSet1,{
hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      "}function program12(depth0,data){return'\n        <td>\n          <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n          </label>\n        </td>\n        '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-matchInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="matchInteraction"',
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="match-interaction-area">\n    <table class="matrix">\n      <thead>\n      <tr>\n        <th> </th>\n        ',options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},
(helper=helpers.matchSet1)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet1,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      </thead>\n      <tbody>\n      ",options={hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data},(helper=helpers.matchSet2)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet2,stack1=typeof helper===functionType?helper.call(depth0,options):helper),
helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n      </tbody>\n    </table>\n  </div>\n  <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){
"use strict";var inWarning=!1,render=function(interaction){var $container=containerHelper.get(interaction);_setInstructions(interaction),$container.on("click.commonRenderer","input[type=checkbox]",function(e){_onCheckboxSelected(interaction,e)}),instructionMgr.validateInstructions(interaction)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction);response=_filterResponse(response),"undefined"!=typeof response.list&&"undefined"!=typeof response.list.directedPair&&_(response.list.directedPair).forEach(function(directedPair){var x=$("th[data-identifier="+directedPair[0]+"]",$container).index()-1,y=$("th[data-identifier="+directedPair[1]+"]",$container).parent().index();
$(".matrix > tbody tr",$container).eq(y).find("input[type=checkbox]").eq(x).attr("checked",!0)}),instructionMgr.validateInstructions(interaction)},getResponse=function(interaction){var response=pciResponse.serialize(_getRawResponse(interaction),interaction);return response},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$("input[type=checkbox]:checked",$container).each(function(){$(this).prop("checked",!1)}),instructionMgr.validateInstructions(interaction)},_filterResponse=function(response){if("undefined"==typeof response.list){if("undefined"==typeof response.base)throw"The given response is not compliant with PCI JSON representation.";
if(null===response.base)return{list:{directedPair:[]}};if("undefined"==typeof response.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";return{list:{directedPair:[response.base.directedPair]}}}if("undefined"==typeof response.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";return response},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),values=[];return $container.find("input[type=checkbox]:checked").each(function(){values.push(_inferValue(this))}),values},_inferValue=function(element){var $element=$(element),$container=$element.closest(".match-interaction-area"),y=$element.closest("tr").index(),x=$element.closest("td").index(),firstId=$(".matrix > thead th",$container).eq(x).data("identifier"),secondId=$(".matrix > tbody th",$container).eq(y).data("identifier");
return[firstId,secondId]},_onCheckboxSelected=function(interaction,e){var choice,currentResponse=_getRawResponse(interaction),maxAssociations=(interaction.attr("minAssociations"),interaction.attr("maxAssociations"));0===maxAssociations&&(maxAssociations=_countChoices(interaction)),_.size(currentResponse)>maxAssociations?(e.preventDefault(),instructionMgr.validateInstructions(interaction)):(choice=_maxMatchReached(interaction,e.target))!==!1?(e.preventDefault(),instructionMgr.validateInstructions(interaction,choice)):(containerHelper.triggerResponseChangeEvent(interaction,{}),instructionMgr.validateInstructions(interaction))},_maxMatchReached=function(interaction,input){
var association=_inferValue(input),overflow=!1;return _(association).forEach(function(identifier){var choice=_getChoiceDefinitionByIdentifier(interaction,identifier),matchMax=(choice.attributes.matchMin,choice.attributes.matchMax),assoc=_countAssociations(interaction,choice);matchMax>0&&assoc>matchMax&&(overflow=choice)}),overflow},_countAssociations=function(interaction,choice){var rawResponse=_getRawResponse(interaction),count=0;return _(rawResponse).forEach(function(response){response[0]!==choice.attributes.identifier&&response[1]!==choice.attributes.identifier||count++}),count},_countChoices=function(interaction){var $container=containerHelper.get(interaction);
return $container.find("input[type=checkbox]").length},_getChoiceDefinitionByIdentifier=function(interaction,identifier){var rawChoices=_getRawChoices(interaction);return rawChoices[identifier]},_getRawChoices=function(interaction){var rawChoices={};return _(interaction.choices).forEach(function(matchset){_(matchset).forEach(function(choice){rawChoices[choice.attributes.identifier]=choice})}),rawChoices},_setInstructions=function(interaction){var msg,minAssociations=interaction.attr("minAssociations"),maxAssociations=interaction.attr("maxAssociations"),choiceCount=_countChoices(interaction),superClosure=function(){var onMaxChoicesReached=function(report,msg){
inWarning===!1&&(inWarning=!0,report.update({level:"warning",message:__("Maximum number of choices reached."),timeout:2e3,stop:function(){report.update({level:"success",message:msg}),inWarning=!1}}))},onMatchMaxReached=function(interaction,choice,report,msg,level){var $container=containerHelper.get(interaction);if(inWarning===!1){inWarning=!0;var $choice=$container.find('.qti-simpleAssociableChoice[data-identifier="'+choice.attributes.identifier+'"]'),originalBackgroundColor=$choice.css("background-color"),originalColor=$choice.css("color");report.update({level:"warning",message:__("The highlighted choice cannot be associated more than %d time(s).").replace("%d",choice.attributes.matchMax),
timeout:3e3,start:function(){$choice.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){$choice.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function(){$choice.animate({backgroundColor:originalBackgroundColor,color:originalColor},500),report.update({level:level,message:msg}),inWarning=!1}})}};0===minAssociations&&maxAssociations>0?(msg=__("You must select 0 to %d choices.").replace("%d",maxAssociations),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<=maxAssociations?this.setLevel("success"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):this.reset();
})):0===minAssociations&&0===maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):this.setLevel("success")})):minAssociations>0&&0===maxAssociations?(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));
choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<minAssociations?this.setLevel("info"):responseCount>choiceCount?onMaxChoicesReached(this,msg):this.setLevel("success")})):minAssociations>0&&maxAssociations>0&&(minAssociations!==maxAssociations?(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",maxAssociations)):(msg=__("You must select exactly %d choice(s)."),msg=msg.replace("%d",minAssociations)),instructionMgr.appendInstruction(interaction,msg,function(choice){
var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<minAssociations?this.setLevel("info"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):responseCount>=minAssociations&&responseCount<=maxAssociations&&this.setLevel("success")}))};superClosure()},destroy=function(interaction){var $container=containerHelper.get(interaction);$container.off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){
var $container;_.isObject(state)&&(_.isArray(state.order)&&2===state.order.length&&($container=containerHelper.get(interaction),$("thead .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[0],$(a).data("identifier")),bIndex=_.indexOf(state.order[0],$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($("thead tr",$container)),$("tbody .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[1],$(a).data("identifier")),bIndex=_.indexOf(state.order[1],$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().each(function(index,elt){$(elt).prependTo($("tbody tr",$container).eq(index));
})),state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[[],[]],$("thead .qti-choice",$container).each(function(){state.order[0].push($(this).data("identifier"))}),$("tbody .qti-choice",$container).each(function(){state.order[1].push($(this).data("identifier"))})),state};return{qtiClass:"matchInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,
resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,inferValue:_inferValue}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,
typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-mediaInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n';
})}),define("json!core/mimetype/categories.json",function(){return{video:{category:"media",mimes:["application/ogg","video/*"],extensions:["avi","mp4","ogg","mpeg","flv"]},audio:{category:"media",mimes:["audio/*"],extensions:["mp3","wav","aac"]},image:{category:"media",mimes:["image/*","application/x-gzip"],extensions:["png","jpg","jpeg","gif","svg","svgz","ico"]},flash:{category:"media",mimes:["application/x-shockwave-flash"],extensions:["flv","swf"]},geogebra:{category:"media",mimes:["application/vnd.geogebra.file","application/vnd.geogebra.tool"],extensions:["ggb","ggt"]},rdf:{category:"sources",mimes:["application/rdf+xml"],extensions:["rdf"]},xml:{category:"sources",
mimes:["application/xml","application/xml-dtd","text/xml"],extensions:["xml","dtd","qti"]},html:{category:"sources",mimes:["text/html","text/xhtml","application/xhtml+xml","application/qti+xml"],extensions:["html","htm","html5","xhtml"]},font:{category:"sources",mimes:["application/font-woff"],extensions:["woff","eot","ttf"]},js:{category:"sources",mimes:["application/javascript","application/json","text/javascript"],extensions:["js","json"]},css:{category:"sources",mimes:["text/css"],extensions:["css","sass","scss","less"]},shell:{category:"sources",mimes:["application/x-sh"],extensions:["sh"]},mathml:{category:"sources",mimes:["application/mathml+xml"],extensions:["mathml"]
},pdf:{category:"document",mimes:["application/pdf"],extensions:["pdf"]},office:{category:"document",mimes:["application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","application/vnd.ms-excel","application/msword"],extensions:["doc","odt","docx","xls","xlsx","ods","ppt","pptx","odp"]},text:{category:["document"],mimes:["text/*"],extensions:["txt","csv"]
},archive:{category:"archive",mimes:["application/zip","application/gzip","application/rar","application/x-7z-compressed","application/x-bzip","application/x-bzip2"],extensions:["zip","gz","bz","bz2","rar","p7z","7z"]},generic:{category:"generic",mimes:["application/octet-stream","application/force-download","application/x-force-download"]}}}),define("json!core/mimetype/extensions.json",function(){return{txt:"text/plain",htm:"text/html",html:"text/html",xhtml:"application/xhtml+xml",php:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"text/xml",rdf:"text/xml",swf:"application/x-shockwave-flash",flv:"video/x-flv",csv:"text/csv",
rtx:"text/richtext",rtf:"text/rtf",png:"image/png",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",ico:"image/vnd.microsoft.icon",tiff:"image/tiff",tif:"image/tiff",svg:"image/svg+xml",svgz:"image/svg+xml",zip:"application/zip",rar:"application/x-rar-compressed",exe:"application/x-msdownload",msi:"application/x-msdownload",cab:"application/vnd.ms-cab-compressed",mp3:"audio/mpeg",oga:"audio/ogg",ogg:"audio/ogg",aac:"audio/aac",qt:"video/quicktime",mov:"video/quicktime",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",pdf:"application/pdf",psd:"image/vnd.adobe.photoshop",ai:"application/postscript",eps:"application/postscript",
ps:"application/postscript",doc:"application/msword",rtf:"application/rtf",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",woff:"application/x-font-woff",eot:"application/vnd.ms-fontobject",ttf:"application/x-font-ttf"}}),define("tpl!ui/mediaplayer/tpl/player",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="\n        ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.is,null==stack1||stack1===!1?stack1:stack1.youtube),{hash:{},
inverse:self.program(5,program5,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program2(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <div class="media video youtube" data-video-src="',(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-video-id="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-type="youtube"></div>\n            '}function program5(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n        <video class="media video" poster="',(helper=helpers.poster)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.poster,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" controls ',
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.is,null==stack1||stack1===!1?stack1:stack1.cors),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your browser doesn’t support the video player.",options):helperMissing.call(depth0,"__","Your browser doesn’t support the video player.",options)))+"\n            ",
stack1=helpers.if.call(depth0,depth0&&depth0.link,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </video>\n        "}function program6(depth0,data){return"crossorigin"}function program8(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <source src="',(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            '}function program10(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <a href="',(helper=helpers.link)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.link,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Please download the video and view offline.",options):helperMissing.call(depth0,"__","Please download the video and view offline.",options)))+"</a>\n            ";
}function program12(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n        <audio class="media audio" controls ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.is,null==stack1||stack1===!1?stack1:stack1.cors),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your browser doesn’t support the audio player.",options):helperMissing.call(depth0,"__","Your browser doesn’t support the audio player.",options)))+"\n            ",
stack1=helpers.if.call(depth0,depth0&&depth0.link,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </audio>\n    "}function program13(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <a href="',(helper=helpers.link)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.link,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Please download the track and listen offline.",options):helperMissing.call(depth0,"__","Please download the track and listen offline.",options)))+"</a>\n            ";
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="mediaplayer ',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <div class="player">\n    ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.is,null==stack1||stack1===!1?stack1:stack1.video),{hash:{},inverse:self.program(12,program12,data),
fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        <div class="overlay">\n            <a class="action play" data-control="play"><span class="icon icon-play" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Play",options):helperMissing.call(depth0,"__","Play",options)))+'"></span></a>\n            <a class="action play" data-control="pause"><span class="icon icon-pause" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'"></span></a>\n        </div>\n    </div>\n    <div class="controls">\n        <div class="bar">\n            <div class="control actions playback">\n                <a class="action play" data-control="play" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Play",options):helperMissing.call(depth0,"__","Play",options)))+'"><span class="icon icon-play"></span></a>\n                <a class="action play" data-control="pause" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'"><span class="icon icon-pause"></span></a>\n            </div>\n            <div class="control seek"><div class="slider"></div></div>\n            <div class="control infos timer">\n                <span class="info time" data-control="time-cur" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Current playback position",options):helperMissing.call(depth0,"__","Current playback position",options)))+'">00:00</span>\n                <span class="info time" data-control="time-end" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Total duration",options):helperMissing.call(depth0,"__","Total duration",options)))+'">00:00</span>\n            </div>\n            <div class="control actions sound">\n                <div class="volume"><div class="slider"></div></div>\n                <a class="action mute" data-control="mute" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Mute",options):helperMissing.call(depth0,"__","Mute",options)))+'"><span class="icon icon-sound"></span></a>\n                <a class="action mute" data-control="unmute" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Restore sound",options):helperMissing.call(depth0,"__","Restore sound",options)))+'"><span class="icon icon-mute"></span></a>\n            </div>\n        </div>\n    </div>\n    <div class="error">\n        <div class="message">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"This media cannot be played!",options):helperMissing.call(depth0,"__","This media cannot be played!",options)))+"</div>\n    </div>\n</div>\n";
})}),define("css!ui/mediaplayer/css/player",[],function(){}),define("nouislider",["jquery"],function($){"use strict";function throwError(message){throw new RangeError("noUiSlider: "+message)}function throwEqualError(F,a,b){(F[a]||F[b])&&F[a]===F[b]&&throwError("(Link) '"+a+"' can't match '"+b+"'.'")}function limit(a){return Math.max(Math.min(a,100),0)}function closest(value,to){return Math.round(value/to)*to}function subRangeRatio(pa,pb){return 100/(pb-pa)}function typeMatch(a,b){return typeof a==typeof b}function isInstance(a){return a instanceof $||$.zepto&&$.zepto.isZ(a)}function isNumeric(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)}function asArray(a){
return $.isArray(a)?a:[a]}function addClassFor(element,className,duration){element.addClass(className),setTimeout(function(){element.removeClass(className)},duration)}function fromPercentage(range,value){return 100*value/(range[1]-range[0])}function toPercentage(range,value){return fromPercentage(range,range[0]<0?value+Math.abs(range[0]):value-range[0])}function isPercentage(range,value){return value*(range[1]-range[0])/100+range[0]}function toStepping(options,value){if(value>=options.xVal.slice(-1)[0])return 100;for(var va,vb,pa,pb,j=1;value>=options.xVal[j];)j++;return va=options.xVal[j-1],vb=options.xVal[j],pa=options.xPct[j-1],pb=options.xPct[j],pa+toPercentage([va,vb],value)/subRangeRatio(pa,pb);
}function fromStepping(options,value){if(value>=100)return options.xVal.slice(-1)[0];for(var va,vb,pa,pb,j=1;value>=options.xPct[j];)j++;return va=options.xVal[j-1],vb=options.xVal[j],pa=options.xPct[j-1],pb=options.xPct[j],isPercentage([va,vb],(value-pa)*subRangeRatio(pa,pb))}function getStep(options,value){for(var a,b,j=1;value>=options.xPct[j];)j++;return options.snap?(a=options.xPct[j-1],b=options.xPct[j],value-a>(b-a)/2?b:a):options.xSteps[j-1]?options.xPct[j-1]+closest(value-options.xPct[j-1],options.xSteps[j-1]):value}function fixEvent(e){e.preventDefault();var x,y,touch=0===e.type.indexOf("touch"),mouse=0===e.type.indexOf("mouse"),pointer=0===e.type.indexOf("pointer"),event=e;
return 0===e.type.indexOf("MSPointer")&&(pointer=!0),e.originalEvent&&(e=e.originalEvent),touch&&(x=e.changedTouches[0].pageX,y=e.changedTouches[0].pageY),(mouse||pointer)&&(pointer||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),x=e.clientX+window.pageXOffset,y=e.clientY+window.pageYOffset),event.points=[x,y],event.cursor=mouse,event}function Format(options){void 0===options&&(options={}),"object"!=typeof options&&throwError("(Format) 'format' option must be an object.");var settings={};$(Formatting).each(function(i,val){void 0===options[val]?settings[val]=FormatDefaults[i]:typeMatch(options[val],FormatDefaults[i])?("decimals"===val&&(options[val]<0||options[val]>7)&&throwError("(Format) 'format.decimals' option must be between 0 and 7."),
settings[val]=options[val]):throwError("(Format) 'format."+val+"' must be a "+typeof FormatDefaults[i]+".")}),throwEqualError(settings,"mark","thousand"),throwEqualError(settings,"prefix","negative"),throwEqualError(settings,"prefix","negativeBefore"),this.settings=settings}function Link(entry,update){if(!(this instanceof Link))throw new Error("Link: Don't use Link as a function. Use the 'new' keyword.");if(!entry)throw new RangeError("Link: missing parameters.");this.formatting=entry.format||{},this.update=!update;var that=this,target=entry.target||function(){},method=entry.method,isTooltip="string"==typeof target&&0===target.indexOf("-tooltip-"),isHidden="string"==typeof target&&0!==target.indexOf("-"),isMethod="function"==typeof target,is$=isInstance(target),isInput=is$&&target.is("input, select, textarea"),methodIsFunction=is$&&"function"==typeof method,methodIsName=is$&&"string"==typeof method&&target[method];
if(isTooltip)return this.method=method||"html",void(this.el=$(target.replace("-tooltip-","")||"<div/>")[0]);if(isHidden)return this.method="val",this.el=document.createElement("input"),this.el.name=target,void(this.el.type="hidden");if(isMethod)return this.target=!1,void(this.method=target);if(is$){if(method&&(methodIsFunction||methodIsName))return this.target=target,void(this.method=method);if(!method&&isInput)return this.method="val",this.target=target,void this.target.on("change",function(e){function at(a,b,c){return[c?a:b,c?b:a]}var output=at(null,$(e.target).val(),that.N);that.obj.val(output,{link:that})});if(!method&&!isInput)return this.method="html",void(this.target=target);
}throw new RangeError("Link: Invalid Link.")}function testStep(parsed,entry){isNumeric(entry)||throwError("'step' is not numeric."),parsed.xSteps[0]=entry}function testRange(parsed,entry){("object"!=typeof entry||$.isArray(entry))&&throwError("'range' is not an object."),$.each(entry,function(index,value){var percentage;"number"==typeof value&&(value=[value]),$.isArray(value)||throwError("'range' contains invalid value."),percentage="min"===index?0:"max"===index?100:parseFloat(index),isNumeric(percentage)&&isNumeric(value[0])||throwError("'range' value isn't numeric."),parsed.xPct.push(percentage),parsed.xVal.push(value[0]),percentage?parsed.xSteps.push(!isNaN(value[1])&&value[1]):isNaN(value[1])||(parsed.xSteps[0]=value[1]);
}),$.each(parsed.xSteps,function(i,n){return!n||void(parsed.xSteps[i]=fromPercentage([parsed.xVal[i],parsed.xVal[i+1]],n)/subRangeRatio(parsed.xPct[i],parsed.xPct[i+1]))})}function testStart(parsed,entry){"number"==typeof entry&&(entry=[entry]),(!$.isArray(entry)||!entry.length||entry.length>2)&&throwError("'start' option is incorrect."),parsed.handles=entry.length,parsed.start=entry}function testSnap(parsed,entry){parsed.snap=entry,"boolean"!=typeof entry&&throwError("'snap' option must be a boolean.")}function testConnect(parsed,entry){"lower"===entry&&1===parsed.handles?parsed.connect=1:"upper"===entry&&1===parsed.handles?parsed.connect=2:entry===!0&&2===parsed.handles?parsed.connect=3:entry===!1?parsed.connect=0:throwError("'connect' option was doesn't match handle count.");
}function testOrientation(parsed,entry){switch(entry){case"horizontal":parsed.ort=0;break;case"vertical":parsed.ort=1;break;default:throwError("'orientation' option is invalid.")}}function testMargin(parsed,entry){parsed.xPct.length>2&&throwError("'margin' option is only supported on linear sliders."),parsed.margin=fromPercentage(parsed.xVal,entry),isNumeric(entry)||throwError("'margin' option must be numeric.")}function testDirection(parsed,entry){switch(entry){case"ltr":parsed.dir=0;break;case"rtl":parsed.dir=1,parsed.connect=[0,2,1,3][parsed.connect];break;default:throwError("'direction' option was not recognized.")}}function testBehaviour(parsed,entry){"string"!=typeof entry&&throwError("'behaviour' must be a string containing options.");
var tap=entry.indexOf("tap")>=0,extend=entry.indexOf("extend")>=0,drag=entry.indexOf("drag")>=0,fixed=entry.indexOf("fixed")>=0,snap=entry.indexOf("snap")>=0;parsed.events={tap:tap||snap,extend:extend,drag:drag,fixed:fixed,snap:snap}}function testSerialization(parsed,entry,sliders){parsed.ser=[entry.lower,entry.upper],parsed.formatting=new Format(entry.format),$.each(parsed.ser,function(i,a){$.isArray(a)||throwError("'serialization."+(i?"upper":"lower")+"' must be an array."),$.each(a,function(){this instanceof Link||throwError("'serialization."+(i?"upper":"lower")+"' can only contain Link instances."),this.N=i,this.obj=sliders,this.scope=this.scope||sliders,
this.formatting=new Format($.extend({},entry.format,this.formatting))})}),parsed.dir&&parsed.handles>1&&parsed.ser.reverse()}function test(options,sliders){var tests,parsed={xPct:[],xVal:[],xSteps:[!1],margin:0};return tests={step:{r:!1,t:testStep},range:{r:!0,t:testRange},start:{r:!0,t:testStart},snap:{r:!1,t:testSnap},connect:{r:!0,t:testConnect},orientation:{r:!1,t:testOrientation},margin:{r:!1,t:testMargin},direction:{r:!0,t:testDirection},behaviour:{r:!0,t:testBehaviour},serialization:{r:!0,t:testSerialization}},options=$.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},options),options.serialization=$.extend({lower:[],upper:[],
format:{}},options.serialization),$.each(tests,function(name,test){if(void 0===options[name]){if(!test.r)return!0;throwError("'"+name+"' is required.")}test.t(parsed,options[name],sliders)}),parsed.style=parsed.ort?"top":"left",parsed}function addHandle(options,index){var handle=$("<div><div/></div>").addClass(Classes[2]),additions=["-lower","-upper"];return options.dir&&additions.reverse(),handle.children().addClass(Classes[3]+" "+Classes[3]+additions[index]),handle}function addElement(handle,link){return link.el&&(link=new Link({target:$(link.el).clone().appendTo(handle),method:link.method,format:link.formatting},!0)),link}function addElements(elements,handle,formatting){
var index,list=[];for(list.push(new Link({format:formatting},!0)),index=0;index<elements.length;index++)list.push(addElement(handle,elements[index]));return list}function addLinks(options,handles){var index,links=[];for(index=0;index<options.handles;index++)links[index]=addElements(options.ser[index],handles[index].children(),options.formatting);return links}function addConnection(connect,target,handles){switch(connect){case 1:target.addClass(Classes[7]),handles[0].addClass(Classes[6]);break;case 3:handles[1].addClass(Classes[6]);case 2:handles[0].addClass(Classes[7]);case 0:target.addClass(Classes[6])}}function addHandles(options,base){var index,handles=[];for(index=0;index<options.handles;index++)handles.push(addHandle(options,index).appendTo(base));
return handles}function addSlider(options,target){return target.addClass([Classes[0],Classes[8+options.dir],Classes[4+options.ort]].join(" ")),$("<div/>").appendTo(target).addClass(Classes[1])}function closure(target,options,originalOptions){function baseSize(){return $Base[["width","height"][options.ort]]()}function fireEvents(events){var index,values=[$Target.val()];for(index=0;index<events.length;index++)$Target.trigger(events[index],values)}function setHandle(handle,to,delimit){var n=handle[0]!==$Handles[0][0]?1:0,lower=$Locations[0]+options.margin,upper=$Locations[1]-options.margin;return delimit&&$Handles.length>1&&(to=n?Math.max(to,lower):Math.min(to,upper)),
to<100&&(to=getStep(options,to)),to=limit(parseFloat(to.toFixed(7))),to===$Locations[n]?1!==$Handles.length&&((to===lower||to===upper)&&0):(handle.css(options.style,to+"%"),handle.is(":first-child")&&handle.toggleClass(Classes[17],to>50),$Locations[n]=to,options.dir&&(to=100-to),$($Serialization[n]).each(function(){this.write(options,to,handle.children(),$Target)}),!0)}function getPositions(a,b,delimit){var c=a+b[0],d=a+b[1];return delimit?(c<0&&(d+=Math.abs(c)),d>100&&(c-=d-100),[limit(c),limit(d)]):[c,d]}function jump(handle,to,instant){instant||addClassFor($Target,Classes[14],300),setHandle(handle,to,!1),fireEvents(["slide","set","change"])}function attach(events,element,callback,data){
return events=events.replace(/\s/g,namespace+" ")+namespace,element.on(events,function(e){var disabled=$Target.attr("disabled");return disabled=!(void 0===disabled||null===disabled),!$Target.hasClass(Classes[14])&&!disabled&&(e=fixEvent(e),e.calcPoint=e.points[options.ort],void callback(e,data))})}function move(event,data){var positions,handles=data.handles||$Handles,state=!1,proposal=100*(event.calcPoint-data.start)/baseSize(),h=handles[0][0]!==$Handles[0][0]?1:0;positions=getPositions(proposal,data.positions,handles.length>1),state=setHandle(handles[0],positions[h],1===handles.length),handles.length>1&&(state=setHandle(handles[1],positions[h?0:1],!1)||state),
state&&fireEvents(["slide"])}function end(event){$("."+Classes[15]).removeClass(Classes[15]),event.cursor&&$("body").css("cursor","").off(namespace),doc.off(namespace),$Target.removeClass(Classes[12]),fireEvents(["set","change"])}function start(event,data){1===data.handles.length&&data.handles[0].children().addClass(Classes[15]),event.stopPropagation(),attach(actions.move,doc,move,{start:event.calcPoint,handles:data.handles,positions:[$Locations[0],$Locations[$Handles.length-1]]}),attach(actions.end,doc,end,null),event.cursor&&($("body").css("cursor",$(event.target).css("cursor")),$Handles.length>1&&$Target.addClass(Classes[12]),$("body").on("selectstart"+namespace,!1));
}function tap(event){var to,location=event.calcPoint,total=0;event.stopPropagation(),$.each($Handles,function(){total+=this.offset()[options.style]}),total=location<total/2||1===$Handles.length?0:1,location-=$Base.offset()[options.style],to=100*location/baseSize(),jump($Handles[total],to,options.events.snap),options.events.snap&&start(event,{handles:[$Handles[total]]})}function edge(event){var i=event.calcPoint<$Base.offset()[options.style],to=i?0:100;i=i?0:$Handles.length-1,jump($Handles[i],to,!1)}function events(behaviour){var i,drag;if(!behaviour.fixed)for(i=0;i<$Handles.length;i++)attach(actions.start,$Handles[i].children(),start,{handles:[$Handles[i]]});behaviour.tap&&attach(actions.start,$Base,tap,{
handles:$Handles}),behaviour.extend&&($Target.addClass(Classes[16]),behaviour.tap&&attach(actions.start,$Target,edge,{handles:$Handles})),behaviour.drag&&(drag=$Base.find("."+Classes[7]).addClass(Classes[10]),behaviour.fixed&&(drag=drag.add($Base.children().not(drag).children())),attach(actions.start,drag,start,{handles:$Handles}))}var $Base,$Serialization,$Handles,$Target=$(target),$Locations=[-1,-1];if(!$Target.is(":empty"))throw new Error("Slider was already initialized.");$Base=addSlider(options,$Target),$Handles=addHandles(options,$Base),$Serialization=addLinks(options,$Handles),addConnection(options.connect,$Target,$Handles),events(options.events),target.vSet=function(values,callback,link,update,animate){
var i,to;for(options.dir&&options.handles>1&&values.reverse(),animate&&addClassFor($Target,Classes[14],300),i=0;i<($Handles.length>1?3:1);i++)to=link||$Serialization[i%2][0],to=to.valueOf(values[i%2]),to!==!1&&(to=toStepping(options,to),options.dir&&(to=100-to),setHandle($Handles[i%2],to,!0)!==!0&&$($Serialization[i%2]).each(function(){this.write(options,$Locations[i%2],$Handles[i%2].children(),$Target,update)}));return callback===!0&&fireEvents(["set"]),this},target.vGet=function(){var i,retour=[];for(i=0;i<options.handles;i++)retour[i]=$Serialization[i][0].saved;return 1===retour.length?retour[0]:options.dir&&options.handles>1?retour.reverse():retour},target.destroy=function(){
return $.each($Serialization,function(){$.each(this,function(){this.target&&this.target.off(namespace)})}),$(this).off(namespace).removeClass(Classes.join(" ")).empty(),originalOptions},$Target.val(options.start)}function initialize(originalOptions){if(this.length){var options=test(originalOptions,this);return this.each(function(){closure(this,options,originalOptions)})}}function rebuild(options){return this.each(function(){var values=$(this).val(),originalOptions=this.destroy(),newOptions=$.extend({},originalOptions,options);$(this).noUiSlider(newOptions),originalOptions.start===newOptions.start&&$(this).val(values)})}var doc=$(document),namespace=".nui",$val=$.fn.val,actions=window.navigator.pointerEnabled?{
start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},Classes=["noUi-target","noUi-base","noUi-origin","noUi-handle","noUi-horizontal","noUi-vertical","noUi-background","noUi-connect","noUi-ltr","noUi-rtl","noUi-dragable","","noUi-state-drag","","noUi-state-tap","noUi-active","noUi-extended","noUi-stacking"],Formatting=["decimals","mark","thousand","prefix","postfix","encoder","decoder","negative","negativeBefore"],FormatDefaults=[2,".","","","",function(a){return a},function(a){return a;
},"-",""];Format.prototype.v=function(a){return this.settings[a]},Format.prototype.to=function(number){function reverse(a){return a.split("").reverse().join("")}number=this.v("encoder")(number);var negative="",preNegative="",base="",mark="";return number<0&&(negative=this.v("negative"),preNegative=this.v("negativeBefore")),number=Math.abs(number).toFixed(this.v("decimals")).toString(),number=number.split("."),0===parseFloat(number)&&(number[0]="0"),this.v("thousand")?(base=reverse(number[0]).match(/.{1,3}/g),base=reverse(base.join(reverse(this.v("thousand"))))):base=number[0],this.v("mark")&&number.length>1&&(mark=this.v("mark")+number[1]),preNegative+this.v("prefix")+negative+base+mark+this.v("postfix");
},Format.prototype.from=function(input){function esc(s){return s.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var isNeg;return null!==input&&void 0!==input&&(input=input.toString(),isNeg=input.replace(new RegExp("^"+esc(this.v("negativeBefore"))),""),input!==isNeg?(input=isNeg,isNeg="-"):isNeg="",input=input.replace(new RegExp("^"+esc(this.v("prefix"))),""),this.v.negative&&(isNeg="",input=input.replace(new RegExp("^"+esc(this.v("negative"))),"-")),input=input.replace(new RegExp(esc(this.v("postfix"))+"$"),"").replace(new RegExp(esc(this.v("thousand")),"g"),"").replace(this.v("mark"),"."),input=this.v("decoder")(parseFloat(isNeg+input)),!isNaN(input)&&input)},
Link.prototype.write=function(options,value,handle,slider,update){this.update&&update===!1||(value=fromStepping(options,value),value=this.format(value),this.saved=value,"function"==typeof this.method?this.method.call(this.target[0]||slider[0],value,handle,slider):this.target[this.method](value,handle,slider))},Link.prototype.format=function(a){return this.formatting.to(a)},Link.prototype.valueOf=function(a){return this.formatting.from(a)},$.noUiSlider={Link:Link},$.fn.noUiSlider=function(options,re){return(re?rebuild:initialize).call(this,options)},$.fn.val=function(){var set,link,update,animate,args=Array.prototype.slice.call(arguments,0);return args.length?("object"==typeof args[1]?(set=args[1].set,
link=args[1].link,update=args[1].update,animate=args[1].animate):args[1]===!0&&(set=!0),this.each(function(){$(this).hasClass(Classes[0])?this.vSet(asArray(args[0]),set,link,update,animate):$val.apply($(this),args)})):this.hasClass(Classes[0])?this[0].vGet():$val.apply(this)}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","ui/mediaplayer"],function($,_,__,Promise,tpl,pciResponse,containerHelper,mediaplayer){"use strict";var defaults={
type:"video/mp4",video:{width:480,height:270},audio:{width:400,height:30}},render=function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),media=interaction.object,$item=$container.parents(".qti-item"),maxPlays=parseInt(interaction.attr("maxPlays"),10)||0,url=media.attr("data")||"",canBePlayed=function(){var current=parseInt($container.data("timesPlayed"),10);return 0===maxPlays||maxPlays>current},resize=_.debounce(function(){var width,height;interaction.mediaElement&&(height=$container.find(".media-container").height(),width=$container.find(".media-container").width(),interaction.mediaElement.resize(width,height));
},200),initMediaPlayer=function(){interaction.mediaElement||(interaction.mediaElement=mediaplayer({url:url&&self.resolveUrl(url),type:media.attr("type")||defaults.type,canPause:$container.hasClass("pause"),maxPlays:maxPlays,canSeek:!maxPlays,width:media.attr("width"),height:media.attr("height"),volume:100,autoStart:!!interaction.attr("autostart")&&canBePlayed(),loop:!!interaction.attr("loop"),renderTo:$(".media-container",$container)}).on("render",function(){resize(),$(window).off("resize.mediaInteraction").on("resize.mediaInteraction",resize),$item.off("resize.gridEdit").on("resize.gridEdit",resize),resolve()}).on("ready",function(){$container.trigger("playerready"),
canBePlayed()||this.disable()}).on("update",_.throttle(function(){containerHelper.triggerResponseChangeEvent(interaction)},1e3)).on("ended",function(){$container.data("timesPlayed",$container.data("timesPlayed")+1),containerHelper.triggerResponseChangeEvent(interaction),canBePlayed()||this.disable()}))};0===_.size(media.attributes)&&(media.attr("type",defaults.type),media.attr("width",$container.innerWidth()),media.attr("height",defaults.video.height),media.attr("data","")),$container.data("timesPlayed")||$container.data("timesPlayed",0),$container.on("responseSet",function(){initMediaPlayer()}),initMediaPlayer()})},destroy=function(interaction){var $container=containerHelper.get(interaction);
interaction.mediaElement&&(interaction.mediaElement.destroy(),interaction.mediaElement=null),$(".instruction-container",$container).empty(),$(".media-container",$container).empty(),$container.removeData("timesPlayed"),$(window).off("resize.video"),containerHelper.reset(interaction)},_getRawResponse=function(interaction){return[containerHelper.get(interaction).data("timesPlayed")||0]},setResponse=function(interaction,response){var responseValues;if(response)try{responseValues=pciResponse.unserialize(response,interaction),containerHelper.get(interaction).data("timesPlayed",responseValues[0])}catch(e){}},resetResponse=function(interaction){containerHelper.get(interaction).data("timesPlayed",0);
},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},setState=function(interaction,state){var restorePlayerState=function(playerState){playerState&&interaction.mediaElement&&(_.isNumber(playerState.volume)&&interaction.mediaElement.setVolume(playerState.volume),_.isBoolean(playerState.muted)&&(interaction.mediaElement.mute(playerState.muted),interaction.mediaElement.startMuted=playerState.muted),playerState.position&&playerState.position>0&&(interaction.mediaElement.seek(playerState.position),interaction.attr("autostart")||interaction.mediaElement.pause()))};_.isObject(state)&&(state.response&&(interaction.resetResponse(),
interaction.setResponse(state.response)),_.isPlainObject(state.player)&&interaction.mediaElement&&(interaction.mediaElement.is("ready")?restorePlayerState(state.player):interaction.mediaElement.on("ready.state",function(){interaction.mediaElement.off("ready.state"),restorePlayerState(state.player)})))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),interaction.mediaElement&&(state.player={position:interaction.mediaElement.getPosition(),muted:interaction.mediaElement.is("muted"),volume:interaction.mediaElement.getVolume()}),state};return{qtiClass:"mediaInteraction",template:tpl,render:render,
getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){return" qti-horizontal"}function program5(depth0,data){return" qti-vertical";
}function program7(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program9(depth0,data){return"horizontal"}function program11(depth0,data){return"vertical"}function program13(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program15(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program17(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program19(depth0,data){return"icon-down"}function program21(depth0,data){return"icon-right"}function program23(depth0,data){return"icon-up"}function program25(depth0,data){return"icon-left"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-orderInteraction',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n     data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n     data-qti-class="orderInteraction"\n     data-orientation="',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(11,program11,data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{
hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="order-interaction-area">\n        <ul class="choice-area square source solid block-listing ',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n            ',options={hash:{},
inverse:self.noop,fn:self.program(17,program17,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(17,program17,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </ul>\n        <div class="arrow-bar middle">\n            <span class="icon-add-to-selection ',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(21,program21,data),fn:self.program(19,program19,data),data:data
}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>\n            <span class="icon-remove-from-selection ',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(25,program25,data),fn:self.program(23,program23,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n        </div>\n        <ul class="drag-container block-listing"></ul>\n        <ul class="result-area decimal target solid block-listing ',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n        </ul>\n        <div class="arrow-bar">\n            <span class="icon-move-before ',
stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(23,program23,data),fn:self.program(25,program25,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n            <span class="icon-move-after ',stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(19,program19,data),fn:self.program(21,program21,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n        </div>\n    </div>\n    <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","i18n","core/mouseEvent","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,$,__,triggerMouseEvent,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){
"use strict";var render=function(interaction){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){_isDropzoneVisible()&&interact($resultArea.selector).fire({type:"drop",target:$dropzoneElement.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _isDropzoneVisible(){return $.contains($container.get(0),$dropzoneElement.get(0))}function _insertDropzone($dragged){var insertPosition,draggedMiddle=_getMiddleOf($dragged),previousMiddle={x:0,y:0};$(resultSelector).each(function(index){var currentMiddle=_getMiddleOf($(this));if("horizontal"!==orientation){if(draggedMiddle.y>previousMiddle.y&&draggedMiddle.y<currentMiddle.y)return insertPosition=index,
!1;previousMiddle.y=currentMiddle.y}else{if(draggedMiddle.x>previousMiddle.x&&draggedMiddle.x<currentMiddle.x)return insertPosition=index,!1;previousMiddle.x=currentMiddle.x}}),"undefined"!=typeof insertPosition?$(resultSelector).eq(insertPosition).before($dropzoneElement):$resultArea.append($dropzoneElement),$dropzoneElement.height($dragged.height()),$dropzoneElement.find("div").text($dragged.text())}function _adjustDropzonePosition($dragged){var draggedBox=$dragged.get(0).getBoundingClientRect(),$prevResult=$dropzoneElement.prev(".qti-choice"),$nextResult=$dropzoneElement.next(".qti-choice"),prevMiddle=$prevResult.length>0&&_getMiddleOf($prevResult),nextMiddle=$nextResult.length>0&&_getMiddleOf($nextResult);
"horizontal"!==orientation?(prevMiddle&&draggedBox.top<prevMiddle.y&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.bottom>nextMiddle.y&&$nextResult.after($dropzoneElement)):(prevMiddle&&draggedBox.left<prevMiddle.x&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.right>nextMiddle.x&&$nextResult.after($dropzoneElement))}function _getMiddleOf($element){var elementBox=$element.get(0).getBoundingClientRect();return{x:elementBox.left+elementBox.width/2,y:elementBox.top+elementBox.height/2}}var isDragAndDropEnabled,dragOptions,$dropzoneElement,$container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$iconAdd=$container.find(".icon-add-to-selection"),$iconRemove=$container.find(".icon-remove-from-selection"),$iconBefore=$container.find(".icon-move-before"),$iconAfter=$container.find(".icon-move-after"),$activeChoice=null,choiceSelector=$choiceArea.selector+" >li:not(.deactivated)",resultSelector=$resultArea.selector+" >li",$dragContainer=$container.find(".drag-container"),orientation=interaction.attr("orientation")?interaction.attr("orientation"):"vertical",_activeControls=function(){
$iconAdd.addClass("inactive"),$iconRemove.removeClass("inactive").addClass("active"),$iconBefore.removeClass("inactive").addClass("active"),$iconAfter.removeClass("inactive").addClass("active")},_resetControls=function(){$iconAdd.removeClass("inactive"),$iconRemove.removeClass("active").addClass("inactive"),$iconBefore.removeClass("active").addClass("inactive"),$iconAfter.removeClass("active").addClass("inactive")},_setSelection=function($choice){$activeChoice&&$activeChoice.removeClass("active"),$activeChoice=$choice,$activeChoice.addClass("active")},_resetSelection=function(){$activeChoice&&($activeChoice.removeClass("active"),$activeChoice=null),_resetControls();
},_addChoiceToSelection=function($target,position){var $results=$(resultSelector);_resetSelection(),"undefined"!=typeof position&&position<$results.length?$results.eq(position).before($target):$resultArea.append($target),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},_toggleResultSelection=function($target){$target.hasClass("active")?_resetSelection():(_setSelection($target),_activeControls())},_removeChoice=function(){$activeChoice&&($choiceArea.append($activeChoice),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)),_resetSelection()},_moveResultBefore=function(){
var $prev=$activeChoice.prev();$prev.length&&($prev.before($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))},_moveResultAfter=function(){var $next=$activeChoice.next();$next.length&&($next.after($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))};interact($container.selector).on("tap",function(){_resetSelection()}),interact(choiceSelector).on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),$iconAdd.addClass("triggered"),setTimeout(function(){$iconAdd.removeClass("triggered")},150),_addChoiceToSelection($target))}),interact(resultSelector).on("tap",function(e){
var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_toggleResultSelection($target))}),interact($iconRemove.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_removeChoice())}),interact($iconBefore.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_moveResultBefore())}),interact($iconAfter.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_moveResultAfter())}),this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").order&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").order),
isDragAndDropEnabled&&($dropzoneElement=$("<li>",{class:"dropzone qti-choice"}),$("<div>",{class:"qti-block"}).appendTo($dropzoneElement),dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_iFrameDragFix(choiceSelector,e.target)},onmove:function(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx,e.dy),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),
interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(resultSelector).draggable(_.assign({},dragOptions,{onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_setSelection($target),$dragContainer.show(),$dragContainer.offset($target.offset()),"horizontal"===orientation?$dragContainer.width($(e.currentTarget).width()):$dragContainer.width($target.parent().width()),$dragContainer.append($target),_iFrameDragFix(resultSelector,e.target)},onmove:function(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx,e.dy),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function(e){var $target=$(e.target),hasBeenDroppedInResultArea=$target.parent===$resultArea;
$target.removeClass("dragged"),$dragContainer.hide(),hasBeenDroppedInResultArea||_removeChoice(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact($resultArea.selector).dropzone({overlap:.5,ondragenter:function(e){var $dragged=$(e.relatedTarget);_insertDropzone($dragged),$dragged.addClass("droppable")},ondrop:function(e){var $dragged=$(e.relatedTarget),dropzoneIndex=$(resultSelector).index($dropzoneElement);this.ondragleave(e),_addChoiceToSelection($dragged,dropzoneIndex),interactUtils.restoreOriginalPosition($dragged)},ondragleave:function(e){var $dragged=$(e.relatedTarget);$dropzoneElement.remove(),
$dragged.removeClass("droppable")}})),_setInstructions(interaction),$(document).on("attributeChange.qti-widget.commonRenderer",function(e,data){data.element.getSerial()===interaction.getSerial()&&("maxChoices"!==data.key&&"minChoices"!==data.key||(instructionMgr.removeInstructions(interaction),_setInstructions(interaction),instructionMgr.validateInstructions(interaction)))}),_freezeSize($container)},_freezeSize=function($container){var $orderArea=$container.find(".order-interaction-area");$orderArea.height($orderArea.height())},_setInstructions=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container),min=parseInt(interaction.attr("minChoices"),10),max=parseInt(interaction.attr("maxChoices"),10);
if(min&&instructionMgr.appendInstruction(interaction,__("You must use at least %d choices",min),function(){$resultArea.find(">li").length>=min?this.setLevel("success"):this.reset()}),max&&max<_.size(interaction.getChoices())){var instructionMax=instructionMgr.appendInstruction(interaction,__("You can use maximum %d choices",max),function(){$resultArea.find(">li").length>=max?($choiceArea.find(">li").addClass("deactivated"),this.setMessage(__("Maximum choices reached"))):($choiceArea.find(">li").removeClass("deactivated"),this.reset())});interact($choiceArea.selector+" >li.deactivated").on("tap",function(e){var $target=$(e.currentTarget);$target.addClass("brd-error"),
instructionMax.setLevel("warning",2e3),setTimeout(function(){$target.removeClass("brd-error")},150)}),interact($choiceArea.selector+" >li.deactivated").draggable({onstart:function(e){var $target=$(e.target);$target.addClass("brd-error"),instructionMax.setLevel("warning")},onend:function(e){var $target=$(e.target);$target.removeClass("brd-error"),instructionMax.setLevel("info")}}).styleCursor(!1)}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),initialOrder=_.keys(interaction.getChoices()),$choiceArea=$(".choice-area",$container).append($(".result-area>li",$container)),$choices=$choiceArea.children(".qti-choice");$container.find(".qti-choice.active").each(function(){
interactUtils.tapOn(this)}),$choices.detach().sort(function(choice1,choice2){return _.indexOf(initialOrder,$(choice1).data("serial"))>_.indexOf(initialOrder,$(choice2).data("serial"))}),$choiceArea.prepend($choices)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container);if(null===response||_.isEmpty(response))resetResponse(interaction);else try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$resultArea.append($choiceArea.find("[data-identifier="+identifier+"]"))})}catch(e){throw new Error("wrong response format in argument : "+e);
}instructionMgr.validateInstructions(interaction)},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),response=[];return $(".result-area>li",$container).each(function(){response.push($(this).data("identifier"))}),response},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},getCustomData=function(interaction,data){return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation")})},destroy=function(interaction){var $container=containerHelper.get(interaction),selectors=[".choice-area >li:not(.deactivated)",".result-area >li",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"];
selectors.forEach(function(selector){interact($container.find(selector).selector).unset()}),$(document).off(".commonRenderer"),$container.find(".order-interaction-area").removeAttr("style"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));
return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"orderInteraction",getData:getCustomData,template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState
}}),define("qtiCustomInteractionContext",[],function(){"use strict";return window._pciHooks=window._pciHooks||{},{register:function(pciHook){var typeIdentifier="function"==typeof pciHook.getTypeIdentifier?pciHook.getTypeIdentifier():pciHook.typeIdentifier;if(!typeIdentifier)throw new Error("invalid PCI hook");window._pciHooks[typeIdentifier]=pciHook},notifyReady:function(pciInstance){},notifyDone:function(pciInstance){},onready:function(customInteraction,state){},ondone:function(customInteraction,response,state,status){},createPciInstance:function(pciTypeIdentifier){if(window._pciHooks[pciTypeIdentifier]){var instance={},proto=window._pciHooks[pciTypeIdentifier];
for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];return instance}throw new Error("no portable custom interaction hook found with the id "+pciTypeIdentifier)}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator",["qtiCustomInteractionContext"],function(qtiCustomInteractionContext){"use strict";return{getPci:function(interaction){var pciTypeIdentifier,pci=interaction.data("pci");if(!pci){if(pciTypeIdentifier=interaction.typeIdentifier,pci=qtiCustomInteractionContext.createPciInstance(pciTypeIdentifier),
!pci)throw new Error("no custom interaction hook found for the type "+pciTypeIdentifier);interaction.data("pci",pci),pci._taoCustomInteraction=interaction}return pci}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common",["lodash","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,containerHelper,instanciator){"use strict";return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return runtime.hook&&requireEntries.push(runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(lib){requireEntries.push(lib.replace(/\.js$/,""));
}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),requireEntries},createInstance:function(interaction,context){var id=interaction.attr("responseIdentifier"),pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties),assetManager=context.assetManager,pciAssetManager={resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url||_.isUndefined(resolved)?assetManager.resolve(url):resolved}};pci.initialize(id,containerHelper.get(interaction).children().get(0),properties,pciAssetManager)},destroy:function(interaction){instanciator.getPci(interaction).destroy();
},setState:function(interaction,state){instanciator.getPci(interaction).setSerializedState(state)},getState:function(interaction){return instanciator.getPci(interaction).getSerializedState()}}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims",["lodash","core/logger","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,loggerFactory,containerHelper,instanciator){"use strict";var logger=loggerFactory("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims"),pciReadyCallback=function(pci,state){logger.info("pciReadyCallback called on PCI "+pci.typeIdentifier);
},pciDoneCallback=function(pci,response,state,status){logger.info("pciDoneCallback called on PCI "+pci.typeIdentifier)};return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return _.forEach(runtime.modules,function(module,name){requireEntries.push(name)}),requireEntries},createInstance:function(interaction,context){var config,pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties);_.forOwn(properties,function(propVal,propKey){properties[propKey]=_.isArray(propVal)||_.isObject(propVal)?JSON.stringify(propVal):propVal}),config={properties:properties,templateVariables:{},boundTo:context.response||{},onready:pciReadyCallback,
ondone:pciDoneCallback,status:"interacting"},pci.getInstance(containerHelper.get(interaction).get(0),config,context.state)},destroy:function(interaction){instanciator.getPci(interaction).oncompleted()},setState:_.noop,getState:function(interaction){return instanciator.getPci(interaction).getState()}}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-interaction qti-customInteraction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/PortableElement",["jquery"],function($){"use strict";function fixMarkupMediaSources(html,renderer){return html=html||"",html.replace(imgSrcPattern,function(substr,$1,$2,$3){var resolved=renderer.resolveUrl($2)||$2;return $1+resolved+$3})}var imgSrcPattern=/(<img[^>]*src=["'])([^"']+)(["'])/gi;return{fixMarkupMediaSources:fixMarkupMediaSources
}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",["lodash","core/promise","core/logger","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims","qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/ciRegistry"],function(_,Promise,loggerFactory,tpl,containerHelper,PortableElement,instanciator,commonPciRenderer,imsPciRenderer,qtiCustomInteractionContext,util,ciRegistry){
"use strict";var _setPciModel=function(interaction,runtime){var pciRenderer;pciRenderer="IMSPCI"===runtime.model?imsPciRenderer(runtime):commonPciRenderer(runtime),interaction.data("pci-model",runtime.model),interaction.data("pci-renderer",pciRenderer)},_getPciRenderer=function(interaction){return interaction.data("pci-renderer")},render=function(interaction,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var state,id=interaction.attr("responseIdentifier"),typeIdentifier=interaction.typeIdentifier,assetManager=self.getAssetManager(),response={};options.state&&options.state[id]&&(state=options.state[id]),response[id]={base:null
},ciRegistry.loadRuntimes({include:[typeIdentifier]}).then(function(){var pciRenderer,runtime=ciRegistry.getRuntime(typeIdentifier);return runtime?(_setPciModel(interaction,runtime),pciRenderer=_getPciRenderer(interaction),void require(pciRenderer.getRequiredModules(),function(){var pci=instanciator.getPci(interaction);return pci?(pciRenderer.createInstance(interaction,{response:response,state:state,assetManager:assetManager}),_.isFunction(pci.on)&&interaction.onPci("responseChange",function(){containerHelper.triggerResponseChangeEvent(interaction)}),resolve()):reject('Unable to initialize pci "'+id+'"')},reject)):reject("The runtime for the pci cannot be found : "+typeIdentifier);
}).catch(function(error){reject('Error loading runtime "'+id+'": '+error)})})},setResponse=function(interaction,response){instanciator.getPci(interaction).setResponse(response)},getResponse=function(interaction){return instanciator.getPci(interaction).getResponse()},resetResponse=function(interaction){instanciator.getPci(interaction).resetResponse()},destroy=function(interaction){_getPciRenderer(interaction).destroy(interaction)},setState=function(interaction,serializedState){_getPciRenderer(interaction).setState(interaction,serializedState)},getState=function(interaction){return _getPciRenderer(interaction).getState(interaction)};return{qtiClass:"customInteraction",
template:tpl,getData:function(customInteraction,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,getState:getState,setState:setState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-prompt-container" data-html-editable-container',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="qti-prompt" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-html-editable>',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"prompt",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,
typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction clearfix',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var getRawResponse=function(interaction){return interaction&&interaction.paper&&_.isArray(interaction.paper.points)?_.map(interaction.paper.points,function(point){return[point.x,point.y]}):[]},addPoint=function(interaction,point){var maxChoices=interaction.attr("maxChoices"),pointChange=function(){containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)};maxChoices>0&&getRawResponse(interaction).length>=maxChoices?instructionMgr.validateInstructions(interaction):(_.isArray(interaction.paper.points)||(interaction.paper.points=[]),graphic.createTarget(interaction.paper,{point:point,create:function(target){
interaction.isTouch&&target&&target.getBBox&&graphic.createTouchCircle(interaction.paper,target.getBBox()),interaction.paper.points.push(point),pointChange()},remove:function(){_.remove(interaction.paper.points,point),pointChange()}}))},enableSelection=function(interaction){var $container=containerHelper.get(interaction),$imageBox=$container.find(".main-image-box"),isResponsive=$container.hasClass("responsive"),image=interaction.paper.getById("bg-image-"+interaction.serial);interaction.paper.isTouch=!1,image.touchstart(function(){interaction.paper.isTouch=!0,image.untouchstart()}),image.click(function(event){addPoint(interaction,graphic.getPoint(event,interaction.paper,$imageBox,isResponsive));
})},render=function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),enableSelection(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),choiceCount:!1,
getResponse:getRawResponse,onError:function(data){data&&graphic.highlightError(data.target,"success")}})})},setResponse=function(interaction,response){var responseValues;if(response&&interaction.paper)try{responseValues=pciResponse.unserialize(response,interaction),"single"===interaction.getResponseDeclaration().attr("cardinality")&&(responseValues=[responseValues]),_(responseValues).filter(function(point){return _.isArray(point)&&2===point.length}).forEach(function(point){addPoint(interaction,{x:point[0],y:point[1]})})}catch(err){return}},resetResponse=function(interaction){interaction&&interaction.paper&&(interaction.paper.points=[],interaction.paper.forEach(function(element){
var point=element.data("point");"object"==typeof point&&graphic.trigger(element,"click")}))},getResponse=function(interaction){return pciResponse.serialize(getRawResponse(interaction),interaction)},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState=function(interaction,state){
_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"selectPointInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),
(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-sliderInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="sliderInteraction"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" >\r\n    ",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\r\n    <div class="instruction-container"></div>\r\n</div>\r\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","nouislider"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){
"use strict";var _slideTo=function(options){options.sliderCurrentValue.find(".qti-slider-cur-value").text(options.value),options.sliderValue.val(options.value)},render=function(interaction){var attributes=interaction.getAttributes(),$container=interaction.getContainer(),$el=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider",class:"qti-slider"}),$sliderLabels=$("<div />").attr({class:"qti-slider-values"}),$sliderCurrentValue=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider-cur-value",class:"qti-slider-cur-value"}),$sliderValue=$("<input />").attr({type:"hidden",id:attributes.responseIdentifier+"-qti-slider-value"}),orientation="horizontal",reverse=!("undefined"==typeof attributes.reverse||!attributes.reverse),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),step="undefined"!=typeof attributes.step&&attributes.step?parseInt(attributes.step):1,steps=(max-min)/step;
$sliderCurrentValue.append('<span class="qti-slider-cur-value-text">'+__("Current value:")+" </span>").append('<span class="qti-slider-cur-value"></span>'),$sliderLabels.append('<span class="slider-min">'+(reverse?max:min)+"</span>").append('<span class="slider-max">'+(reverse?min:max)+"</span>"),interaction.getContainer().append($el).append($sliderLabels).append($sliderCurrentValue).append($sliderValue),"undefined"!=typeof attributes.orientation&&$.inArray(attributes.orientation,["horizontal","vertical"])>-1&&(orientation=attributes.orientation);var sliderSize=0;if("horizontal"===orientation)$container.addClass("qti-slider-horizontal");else{var maxHeight=300;
sliderSize=20*steps,sliderSize>maxHeight&&(sliderSize=maxHeight),$container.addClass("qti-slider-vertical"),$el.height(sliderSize+"px"),$sliderLabels.height(sliderSize+"px")}if("undefined"!=typeof attributes.stepLabel&&attributes.stepLabel){var middleStep=parseInt(steps/2),leftOffset=100/steps*middleStep,middleValue=reverse?max-middleStep*step:min+middleStep*step;"horizontal"===orientation?$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="left:'+leftOffset+'%">'+middleValue+"</span>"):$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="top:'+leftOffset+'%">'+middleValue+"</span>")}$el.noUiSlider({start:reverse?max:min,
range:{min:min,max:max},step:step,orientation:orientation}).on("slide",function(e){var val=parseInt($(this).val());interaction.attr("reverse")&&(val=max+min-val),val=Math.round(1e3*val)/1e3,_slideTo({value:val,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),containerHelper.triggerResponseChangeEvent(interaction)}),_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue})},resetResponse=function(interaction){var attributes=interaction.getAttributes(),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),reverse=!("undefined"==typeof attributes.reverse||!attributes.reverse),startValue=reverse?max:min;
_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(startValue)},setResponse=function(interaction,response){var value,attributes=interaction.getAttributes(),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound);value=pciResponse.unserialize(response,interaction)[0],_slideTo({value:value,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(interaction.attr("reverse")?max+min-value:value);
},_getRawResponse=function(interaction){var value,attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),min=parseInt(attributes.lowerBound),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value");return"integer"===baseType?value=parseInt($sliderValue.val()):"float"===baseType&&(value=parseFloat($sliderValue.val())),isNaN(value)?min:value},getResponse=function(interaction){return pciResponse.serialize([_getRawResponse(interaction)],interaction)},destroy=function(interaction){var $container=interaction.getContainer();$container.empty(),containerHelper.reset(interaction)},setState=function(interaction,state){
_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"sliderInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<input ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-textEntryInteraction',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" data-qti-class="textEntryInteraction" type="text">\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/patternMask","util/locale","ui/tooltip"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,patternMaskHelper,locale){"use strict";var createTooltip=function($input,theme,message,forceCreation,hidden){
forceCreation||!$input.data("qtip")?$input.qtip({theme:theme,content:{text:message},show:{event:"custom"},hide:{event:"custom"}}):($input.qtip("option","content.text",message),$input.qtip("option","theme","info")),hidden||$input.qtip("show")},render=function(interaction){var expectedLength,updateConstraintTooltip,attributes=interaction.getAttributes(),$input=interaction.getContainer(),patternMask=interaction.attr("patternMask"),maxChars=parseInt(patternMaskHelper.parsePattern(patternMask,"chars"),10);attributes.expectedLength&&(expectedLength=parseInt(attributes.expectedLength)+2,$input.css("width",expectedLength+"ch"),$input.css("min-width",expectedLength+"ch")),
attributes.placeholderText&&$input.attr("placeholder",attributes.placeholderText),maxChars?(updateConstraintTooltip=function(){var message,count=$input.val().length;count>=maxChars?($input.addClass("maxed"),createTooltip($input,"warning",__("%d/%d",count,maxChars),!0)):(message=count?__("%d/%d",count,maxChars):__("%d characters allowed",maxChars),$input.hasClass("maxed")?($input.removeClass("maxed"),createTooltip($input,"info",message,!0)):createTooltip($input,"info",message))},$input.attr("maxlength",maxChars).on("focus.commonRenderer keydown.commonRenderer",updateConstraintTooltip).on("keyup.commonRenderer",function(){updateConstraintTooltip(),containerHelper.triggerResponseChangeEvent(interaction);
}).on("blur.commonRenderer",function(){$input.qtip("hide")})):attributes.patternMask?(createTooltip($input,"error",__("This is not a valid answer"),!0,!0),$input.on("keyup.commonRenderer",_.debounce(function(){var regex=new RegExp(attributes.patternMask);regex.test($input.val())?$input.removeClass("invalid").qtip("hide"):$input.addClass("invalid").qtip("show"),containerHelper.triggerResponseChangeEvent(interaction)},600)).on("keydown.commonRenderer",function(){$input.qtip("hide")})):$input.on("keyup.commonRenderer",function(){containerHelper.triggerResponseChangeEvent(interaction)})},resetResponse=function(interaction){interaction.getContainer().val("")},setResponse=function(interaction,response){
var responseValue;try{responseValue=pciResponse.unserialize(response,interaction)}catch(e){}responseValue&&responseValue.length&&interaction.getContainer().val(responseValue[0])},getResponse=function(interaction){var value,ret={base:{}},$input=interaction.getContainer(),attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),numericBase=attributes.base||10;return $input.hasClass("invalid")||attributes.placeholderText&&$input.val()===attributes.placeholderText?value="":"integer"===baseType?value=locale.parseInt($input.val(),numericBase):"float"===baseType?value=locale.parseFloat($input.val()):"string"===baseType&&(value=$input.val()),
ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value,ret},destroy=function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"textEntryInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,
getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper,buffer="";return buffer+='accept="',(helper=helpers.accept)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.accept,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n\t",stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n\t<div class="instruction-container"></div>\n    <div class="file-upload fixed-grid-row lft">\n        <div class="progressbar"></div>\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n        <input type="file" ',
stack1=helpers.if.call(depth0,depth0&&depth0.accept,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n    </div>\n    <div class="file-upload-preview lft visible-file-upload-preview runtime-visible-file-upload-preview">\n        <p class="nopreview">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+'</p>\n    </div>\n    <div class="file-upload-preview-popup modal">\n        <div class="modal-body">\n        </div>\n    </div>\n</div>\n';
})}),define("taoQtiItem/qtiCommonRenderer/helpers/uploadMime",["lodash","i18n"],function(_,__){"use strict";var uploadMime={getMimeTypes:function(){return[{mime:"application/zip",label:__("ZIP archive"),equivalent:["application/x-zip-compressed"]},{mime:"text/plain",label:__("Plain text")},{mime:"application/pdf",label:__("PDF file")},{mime:"image/jpeg",label:__("JPEG image")},{mime:"image/png",label:__("PNG image")},{mime:"image/gif",label:__("GIF image")},{mime:"image/svg+xml",label:__("SVG image")},{mime:"audio/mpeg",label:__("MPEG audio"),equivalent:["audio/mp3"]},{mime:"audio/x-ms-wma",label:__("Windows Media audio")},{mime:"audio/x-wav",label:__("WAV audio"),
equivalent:["audio/wav"]},{mime:"video/mpeg",label:__("MPEG video")},{mime:"video/mp4",label:__("MP4 video")},{mime:"video/quicktime",label:__("Quicktime video")},{mime:"video/x-ms-wmv",label:__("Windows Media video")},{mime:"video/x-flv",label:__("Flash video")},{mime:"text/csv",label:__("CSV file")},{mime:"application/msword",label:__("Microsoft Word"),equivalent:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]},{mime:"application/vnd.ms-excel",label:__("Microsoft Excel"),equivalent:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]},{mime:"application/vnd.ms-powerpoint",label:__("Microsoft Powerpoint"),equivalent:["application/vnd.openxmlformats-officedocument.presentationml.presentation"]
}]},setExpectedTypes:function(interaction,types){var classes=interaction.attr("class")||"";classes=classes.replace(/x-tao-upload-type-[-_a-zA-Z+.0-9]*/g,"").trim(),interaction.attr("class",classes),interaction.removeAttr("type"),types&&(1===types.length?"any/kind"!==types[0]&&interaction.attr("type",types[0]):interaction.attr("class",_.reduce(types,function(acc,selectedType){return acc+" x-tao-upload-type-"+selectedType.replace("/","_")},classes).trim()))},getExpectedTypes:function(interaction,includeEquivalents){var mimes,classes=interaction.attr("class")||"",types=[],equivalents=[];return interaction.attr("type")?types.push(interaction.attr("type")):classes.replace(/x-tao-upload-type-([-_a-zA-Z+.0-9]*)/g,function($0,type){
types.push(type.replace("_","/").trim())}),includeEquivalents===!0&&(mimes=uploadMime.getMimeTypes(),_.forEach(types,function(mime){var mimeData=_.find(mimes,{mime:mime});mimeData&&_.isArray(mimeData.equivalent)&&(equivalents=_.union(equivalents,mimeData.equivalent))})),_.union(types,equivalents)}};return uploadMime}),define("tpl!ui/documentViewer/documentViewer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="document-viewer"></div>'})}),define("tpl!ui/documentViewer/providers/pdfViewer/fallback/viewer",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<iframe ></iframe>"})}),define("tpl!ui/documentViewer/providers/pdfViewer/pdfjs/match",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="highlight ',(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-match="',(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n"})}),define("tpl!ui/documentViewer/providers/pdfViewer/pdfjs/findBar",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"checked "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;return buffer+='<button class="small search" data-control="pdf-search" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+'"><span class="icon icon-find"></span></button>\n<div class="pdf-find-bar hidden">\n    <label for="pdf-search-query">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+':</label>\n    <input type="text" id="pdf-search-query" data-control="pdf-search-query" placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Type your search",options):helperMissing.call(depth0,"__","Type your search",options)))+'"/>\n    <button class="small search" data-control="pdf-search-prev" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous match",options):helperMissing.call(depth0,"__","Previous match",options)))+'"><span class="icon icon-left"></span></button>\n    <button class="small search" data-control="pdf-search-next" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Next match",options):helperMissing.call(depth0,"__","Next match",options)))+'"><span class="icon icon-right"></span></button>\n    <input type="checkbox" id="highlight-all" data-control="highlight-all" value="1" ',stack1=helpers.if.call(depth0,depth0&&depth0.highlightAll,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/><label for="highlight-all">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Highlight all",options):helperMissing.call(depth0,"__","Highlight all",options)))+'</label>\n    <input type="checkbox" id="case-sensitive-search" data-control="case-sensitive-search" value="1" ',
stack1=helpers.if.call(depth0,depth0&&depth0.caseSensitive,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/><label for="case-sensitive-search">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Case sensitive",options):helperMissing.call(depth0,"__","Case sensitive",options)))+'</label>\n    <span class="pdf-search-info" data-control="pdf-search-info">\n        <span class="pdf-search-position hidden" data-control="pdf-search-position">\n            <span class="pdf-search-index" data-control="pdf-search-index"></span>/<span class="pdf-search-count" data-control="pdf-search-count"></span>\n        </span>\n        <span class="pdf-search-loop hidden" data-control="pdf-search-loop-begin">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"End of document reached. Continuing from the beginning.",options):helperMissing.call(depth0,"__","End of document reached. Continuing from the beginning.",options)))+'\n        </span>\n        <span class="pdf-search-loop hidden" data-control="pdf-search-loop-end">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start of document reached. Continuing from the end.",options):helperMissing.call(depth0,"__","Start of document reached. Continuing from the end.",options)))+"\n        </span>\n    </span>\n</div>\n"})}),define("tpl!ui/documentViewer/providers/pdfViewer/pdfjs/page",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="pdf-page hidden" data-page="',(helper=helpers.page)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.page,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <canvas class="pdf-content"></canvas>\n    <div class="pdf-text"></div>\n</div>\n'})}),define("tpl!ui/documentViewer/providers/pdfViewer/pdfjs/viewer",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+='\n        <input type="checkbox" id="fit-to-width" data-control="fit-to-width" value="1" checked /> <label for="fit-to-width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Fit to width",options):helperMissing.call(depth0,"__","Fit to width",options)))+"</label>\n        "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;
return buffer+='<div class="pdf-bar">\n    <div class="pdf-actions">\n        <button class="small navigation" data-control="pdf-page-prev" data-direction="-1" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous page",options):helperMissing.call(depth0,"__","Previous page",options)))+'"><span class="icon icon-step-backward"></span><span class="text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous",options):helperMissing.call(depth0,"__","Previous",options)))+'</span></button>\n        <button class="small navigation" data-control="pdf-page-next" data-direction="1" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Next page",options):helperMissing.call(depth0,"__","Next page",options)))+'"><span class="icon icon-step-forward"></span><span class="text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next",options):helperMissing.call(depth0,"__","Next",options)))+"</span></button>\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.fitToWidth,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </div>\n    <div class="pdf-info">\n        <label for="pdf-page-num">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Page",options):helperMissing.call(depth0,"__","Page",options)))+':</label>\n        <input class="info" id="pdf-page-num" data-control="pdf-page-num" value="1" />\n        <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+'</label>\n        <span class="info" data-control="pdf-page-count">1</span>\n    </div>\n</div>\n<div class="pdf-container"></div>\n'})}),define("tpl!ui/documentViewer/providers/pdfViewer/viewer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="pdf-viewer"></div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["jquery","lodash","i18n","context","core/mimetype","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/uploadMime","ui/progressbar","ui/previewer","ui/modal","ui/waitForMedia"],function($,_,__,context,mimetype,tpl,containerHelper,instructionMgr,uploadHelper){"use strict";var _initialInstructions=__("Browse your computer and select the appropriate file."),_readyInstructions=__("The selected file is ready to be sent."),validateFileType=function(file,interaction){
var expectedTypes=uploadHelper.getExpectedTypes(interaction,!0),filetype=mimetype.getMimeType(file);return!expectedTypes.length||_.indexOf(expectedTypes,filetype)>=0},getMessageWrongType=function(interaction,userSelectedType,messageWrongType){var types=uploadHelper.getExpectedTypes(interaction),expectedTypeLabels=_.map(_.uniq(types),function(type){var mime=_.find(uploadHelper.getMimeTypes(),{mime:type});return mime?mime.label:type});return messageWrongType&&_.isFunction(messageWrongType)?messageWrongType({userSelectedType:userSelectedType,types:expectedTypeLabels}):__('Wrong type of file. Expected %s. The selected file has the mimetype "%s".',expectedTypeLabels.join(__(" or ")),userSelectedType);
},_handleSelectedFiles=function(interaction,file,messageWrongType){var reader,$container=containerHelper.get(interaction),filename=file.name,filetype=mimetype.getMimeType(file);return instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),validateFileType(file,interaction)?($container.find(".file-name").empty().append(filename),reader=new FileReader,reader.onload=function(e){var base64Data,commaPosition,base64Raw,$previewArea;instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_readyInstructions,function(){this.setLevel("success")}),instructionMgr.validateInstructions(interaction),
$container.find(".progressbar").progressbar("value",100),base64Data=e.target.result,commaPosition=base64Data.indexOf(","),base64Raw=base64Data.substring(commaPosition+1),interaction.data("_response",{base:{file:{data:base64Raw,mime:filetype,name:filename}}}),$previewArea=$container.find(".file-upload-preview"),$previewArea.previewer({url:base64Data,name:filename,mime:filetype}),$previewArea.waitForMedia(function(){var imgNaturalWidth,isOversized,modalWidth,$originalImg=$previewArea.find("img"),$largeDisplay=$(".file-upload-preview-popup"),$item=$(".qti-item"),itemWidth=$item.width(),winWidth=$(window).width()-80,fullHeight=$("body").height();$originalImg.length&&(imgNaturalWidth=$originalImg[0].naturalWidth,
isOversized=imgNaturalWidth>itemWidth,modalWidth=Math.min(winWidth,imgNaturalWidth),$previewArea.toggleClass("clickable",isOversized),isOversized&&$previewArea.on("click",function(){var $modalBody;$(".upload-ia-modal-bg").remove(),$modalBody=$largeDisplay.find(".modal-body"),$modalBody.empty().append($originalImg.clone()),$largeDisplay.on("opened.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","hidden"),$largeDisplay.css({width:modalWidth,height:fullHeight,left:(modalWidth-itemWidth-40)/-2})}).on("closed.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","auto")}).modal({modalOverlayClass:"modal-bg upload-ia-modal-bg"
})}))})},reader.onloadstart=function(){instructionMgr.removeInstructions(interaction),$container.find(".progressbar").progressbar("value",0)},reader.onprogress=function(e){var percentProgress=Math.ceil(Math.round(e.loaded)/Math.round(e.total)*100);$container.find(".progressbar").progressbar("value",percentProgress)},void reader.readAsDataURL(file)):(instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,getMessageWrongType(interaction,filetype,messageWrongType),function(){this.setLevel("error")}),void instructionMgr.validateInstructions(interaction))},_resetGui=function(interaction){var $container=containerHelper.get(interaction);
$container.find(".file-name").text(__("No file selected")),$container.find(".btn-info").text(__("Browse..."))},render=function(interaction){var changeListener,$input,self=this,$container=containerHelper.get(interaction);if(_resetGui(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),interaction.data("_response",{base:null}),changeListener=function(e){var file=e.target.files[0];"undefined"!=typeof file&&_handleSelectedFiles(interaction,file,self.getCustomMessage("upload","wrongType"))},$input=$container.find("input"),$container.find(".progressbar").progressbar(),!window.FileReader)throw new Error("FileReader API not supported! Please use a compliant browser!");
$input.bind("change",changeListener),$input.bind("mousedown",function(e){return e.preventDefault(),$(this).blur(),!1})},resetResponse=function(interaction){_resetGui(interaction)},setResponse=function(interaction,response){var filename,$container=containerHelper.get(interaction);null!==response.base&&(filename="undefined"!=typeof response.base.file.name?response.base.file.name:"previously-uploaded-file",$container.find(".file-name").empty().text(filename)),interaction.data("_response",response)},getResponse=function(interaction){return interaction.data("_response")},destroy=function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),
instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getCustomData=function(interaction,data){return _.merge(data||{},{accept:uploadHelper.getExpectedTypes(interaction,!0).join(",")})};return{qtiClass:"uploadInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,
setState:setState,getState:getState,getData:getCustomData,resetGui:_resetGui}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=' id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program5(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-item tao-scope runtime" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data
}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),
(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-itemBody ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</div>\n    <div id="modalFeedbacks"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function($,_){
"use strict";var informLoaded=_.throttle(function(){$(document).trigger("customcssloaded.styleeditor")},10,{leading:!1}),attach=function(stylesheets){var $head=$("head");$head.length||($head=$("body")),_(stylesheets).forEach(function(stylesheet){var $link,href;stylesheet.attr("href")&&($link=$(stylesheet.render()),href=$link.attr("href"),$link.removeAttr("href").attr("href",href),$link.one("load",informLoaded).appendTo($head))})},detach=function(stylesheets){_(stylesheets).forEach(function(stylesheet){stylesheet.serial&&$('link[data-serial="'+stylesheet.serial+'"]').remove()})};return{attach:attach,detach:detach}}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(tpl,containerHelper,itemStylesheetHandler){
"use strict";return{qtiClass:"assessmentItem",template:tpl,getContainer:containerHelper.get,render:function(item){containerHelper.targetBlank(containerHelper.get(item)),itemStylesheetHandler.attach(item.stylesheets)},destroy:function(item){containerHelper.clear(),item.stylesheets&&itemStylesheetHandler.detach(item.stylesheets)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='<span data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="math"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='><math display="block">',(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math></span>"}function program2(depth0,data){
var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program4(depth0,data){var stack1,helper,buffer="";return buffer+='<span data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="math"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{
hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="><math>",(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math></span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers.if.call(depth0,depth0&&depth0.block,{hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),
data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/container","mathJax"],function(_,Promise,tpl,containerHelper,MathJax){"use strict";return"undefined"!=typeof MathJax&&MathJax&&(MathJax.Hub.processSectionDelay=0),{qtiClass:"math",template:tpl,getContainer:containerHelper.get,render:function(math){return new Promise(function(resolve){"undefined"!=typeof MathJax&&MathJax?(window.MathJax||(window.MathJax=MathJax),_.defer(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,containerHelper.get(math).parent()[0]]),
MathJax.Hub.Queue(resolve)})):resolve()})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"modal "}function program3(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program5(depth0,data){var stack1,buffer="";return buffer+='<h2 class="qti-title modal-title">'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,
typeof stack1===functionType?stack1.apply(depth0):stack1))+"</h2>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div id="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" class="',stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",(helper=helpers.feedbackStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.feedbackStyle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.title),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="modal-body">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},
data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiItem/helper/container","ui/waitForMedia","ui/modal"],function(_,tpl,containerHelper,coreContainerHelper){"use strict";var modalFeedbackRenderer={qtiClass:"modalFeedback",template:tpl,getContainer:containerHelper.get,minHeight:200,width:600,getData:function(fb,data){var feedbackStyle=coreContainerHelper.getEncodedData(fb,"modalFeedback");return data.feedbackStyle=feedbackStyle,data},render:function(modalFeedback,data){
data=data||{};var $modal=containerHelper.get(modalFeedback);$modal.waitForMedia(function(){$modal.on("opened.modal",function(){var $itemBody=containerHelper.get(modalFeedback.getRootElement()).children(".qti-itemBody"),requiredHeight=$modal.outerHeight()+parseInt($modal.css("top"));requiredHeight>$itemBody.height()&&$itemBody.height(requiredHeight)}).on("closed.modal",function(){_.isFunction(data.callback)&&data.callback.call(this)}).modal({startClosed:!1,minHeight:modalFeedbackRenderer.minHeight,width:modalFeedbackRenderer.width})})}};return modalFeedbackRenderer}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-object-container" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" >\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Object",["tpl!taoQtiItem/qtiCommonRenderer/tpl/object","taoQtiItem/qtiCommonRenderer/helpers/container","ui/previewer"],function(tpl,containerHelper){"use strict";return{qtiClass:"object",template:tpl,getContainer:containerHelper.get,render:function(obj){var $container=containerHelper.get(obj),previewOptions={
url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type")};obj.attr("height")&&(previewOptions.height=obj.attr("height")),obj.attr("width")&&(previewOptions.width=obj.attr("width")),previewOptions.url&&previewOptions.mime&&$container.previewer(previewOptions)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){
var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-infoControl',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data
}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("qtiInfoControlContext",[],function(){window._picHooks=window._picHooks||{};var taoQtiInfoControlContext={register:function(picHook){window._picHooks[picHook.getTypeIdentifier()]=picHook},notifyReady:function(picInstance){},createPciInstance:function(typeIdentifier){if(window._picHooks[typeIdentifier]){var instance={},proto=window._picHooks[typeIdentifier];for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];return instance}throw"no portable info control hook found with the id "+typeIdentifier;
}};return taoQtiInfoControlContext}),define("taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","qtiInfoControlContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/icRegistry"],function(_,Promise,tpl,containerHelper,PortableElement,qtiInfoControlContext,util,icRegistry){"use strict";var _getPic=function(infoControl){var typeIdentifier,pic=infoControl.data("pic")||void 0;if(!pic){if(typeIdentifier=infoControl.typeIdentifier,pic=qtiInfoControlContext.createPciInstance(typeIdentifier),
!pic)throw"no custom infoControl hook found for the type "+typeIdentifier;infoControl.data("pic",pic),pic._taoInfoControl=infoControl}return pic},render=function(infoControl,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var state={},id=infoControl.attr("id"),typeIdentifier=infoControl.typeIdentifier,config=infoControl.properties,$dom=containerHelper.get(infoControl).children(),assetManager=self.getAssetManager();icRegistry.loadRuntimes().then(function(){var requireEntries=[],runtime=icRegistry.getRuntime(typeIdentifier);return runtime?(runtime.hook&&requireEntries.push(runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(module){
requireEntries.push(module.replace(/\.js$/,""))}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),void require(requireEntries,function(){var pic=_getPic(infoControl),picAssetManager={resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url?assetManager.resolveBy("baseUrl",url):resolved}};return pic?(pic.initialize(id,$dom[0],config,picAssetManager),pic.setSerializedState(state),resolve()):reject("Unable to initialize pic : "+id)},reject)):reject("The runtime for the pic cannot be found : "+typeIdentifier)}).catch(function(error){reject("Error loading runtime : "+id);
})})},destroy=function(infoControl){_getPic(infoControl).destroy()},setState=function(infoControl,state){_getPic(infoControl).setSerializedState(state)},getState=function(infoControl){return _getPic(infoControl).getSerializedState()};return{qtiClass:"infoControl",template:tpl,getData:function(infoControl,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:render,getContainer:containerHelper.get,destroy:destroy,getState:getState,setState:setState}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" data-qti-class="printedVariable"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",["tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"printedVariable",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n<div class="grid-row qti-rubricBlock" data-use="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.use,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="rubricBlock"',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="col-12">\n        <div class="qti-rubricBlock-body">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    </div>\n</div>\n"}function program2(depth0,data){
var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers.unless.call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"rubricBlock",getContainer:containerHelper.get,template:tpl,getData:function(rubric,data){return rubric.isEmpty()&&(data.empty=!0),data}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='media="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.media,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<link \n    href="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.href,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    type="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.type,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    rel="stylesheet" \n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n    ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.media),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"stylesheet",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.class,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){var stack1,buffer="";return buffer+='summary="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.summary,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program5(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<table\n    class="qti-table',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.class),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n    data-qti-class="table"\n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n    ',
stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.summary),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    >\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</table>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Table",["tpl!taoQtiItem/qtiCommonRenderer/tpl/table","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"table",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='lang="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["xml:lang"],
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span\n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n    data-qti-class="_tooltip"\n    data-role="tooltip-target"\n    ',stack1=helpers.if.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["xml:lang"]),{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</span>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Tooltip",["tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip","taoQtiItem/qtiCommonRenderer/helpers/container","ui/tooltip"],function(tpl,containerHelper){"use strict";return{qtiClass:"_tooltip",template:tpl,getContainer:containerHelper.get,render:function(tooltip){
var $container=containerHelper.get(tooltip);$container.qtip({theme:"default",content:{text:tooltip.content()},position:{target:"event",my:"bottom center",at:"top center"}})}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}('@-o-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@-moz-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@-webkit-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}.loading-bar{height:6px;position:absolute;width:100%;top:0px;display:none;z-index:10000;cursor:progress}.loading-bar.fixed{position:fixed;width:100%}.loading-bar.fixed:before{top:0 !important}.loading-bar.loading{display:block;overflow:hidden;top:58px}.loading-bar.loading:before{position:absolute;content:\'\';height:6px;width:20%;display:block;transform:translateZ(0);background:-webkit-linear-gradient(to right, transparent 0%, #c35a13 20%, #c35a13 80%, transparent 100%);background:-moz-linear-gradient(to right, transparent 0%, #c35a13 20%, #c35a13 80%, transparent 100%);background:-ms-linear-gradient(to right, transparent 0%, #c35a13 20%, #c35a13 80%, transparent 100%);background:-o-linear-gradient(to right, transparent 0%, #c35a13 20%, #c35a13 80%, transparent 100%);background:linear-gradient(to right, transparent 0%, #c35a13 20%, #c35a13 80%, transparent 100%);-webkit-animation:loadingbar 5s linear infinite;-moz-animation:loadingbar 5s linear infinite;-ms-animation:loadingbar 5s linear infinite;-o-animation:loadingbar 5s linear infinite;animation:loadingbar 5s linear infinite}.loading-bar.loading.loadingbar-covered{top:0px;overflow-y:visible}.loading-bar.loading.loadingbar-covered:before{top:86px}.no-version-warning .loading-bar.loadingbar-covered:before{top:58px}.action-bar{background:#266d9c;padding:3px;overflow:hidden;color:#e7eff4}.action-bar li{float:left}.action-bar li .li-inner{padding-bottom:1px;text-decoration:none !important;outline:0;display:inline-block;color:inherit}.action-bar li .li-inner:hover{color:white}.action-bar li span.glyph{text-shadow:0 0 0 transparent;color:inherit}.action-bar li input{width:100%;font-size:12px;font-size:1.2rem;padding:2px 4px}.action-bar li.active .li-inner{color:white}.action-bar.horizontal-action-bar{padding:5px;height:35px}.action-bar.horizontal-action-bar .search-area{margin:2px 0 0 0;border:none;float:right;display:inline-block;position:relative;padding:0 30px 0 0}.action-bar.horizontal-action-bar .search-area input{padding-right:34px;min-width:250px !important}.action-bar.horizontal-action-bar .search-area button{position:absolute;right:32px;top:-2px;cursor:default;opacity:.5;background:transparent;width:25px;height:25px}.action-bar.horizontal-action-bar .search-area button:before{color:#666}.action-bar.horizontal-action-bar .search-area .icon-help{position:absolute;right:5px;top:-1px;text-shadow:0px 0px transparent;color:white;cursor:pointer;display:block;width:24px;height:24px;line-height:24px;text-align:center}.action-bar.horizontal-action-bar li{margin:0 1px;border:1px transparent solid;text-align:center;float:left}.action-bar.horizontal-action-bar li .glyph{width:14px}.action-bar.horizontal-action-bar li .svg-glyph{height:14px;width:14px;margin-right:9px}.action-bar.horizontal-action-bar li.btn-info{overflow:hidden;background:transparent}.action-bar.horizontal-action-bar li.btn-info:hover,.action-bar.horizontal-action-bar li.btn-info.active{border-color:rgba(255,255,255,0.3);opacity:1}.action-bar.horizontal-action-bar li.disabled{background:none !important;text-shadow:inherit !important;opacity:0.45 !important;color:inherit !important}.action-bar.horizontal-action-bar li.disabled a{cursor:not-allowed !important}.action-bar.vertical-action-bar li{max-height:60px}.action-bar.vertical-action-bar li .li-inner{height:60px;display:block;overflow:hidden;text-overflow:ellipsis;text-align:center;font-size:12px;font-size:1.2rem;line-height:12px}.action-bar.vertical-action-bar li .glyph{display:block;margin:12px auto 3px;width:20px;height:20px}.action-bar.tree-action-bar{background:#f3f1ef;position:relative;left:-1px;padding:0;margin:0 2.8571428571% 8px 2.8571428571%;width:94.6428571429%;font-size:13px;font-size:1.3rem}.action-bar.tree-action-bar li{background:rgba(255,255,255,0.5);border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;line-height:1.3;padding:0;text-align:center;float:left;width:65px;height:65px;margin:0 1px 1px 0}.action-bar.tree-action-bar li .glyph,.action-bar.tree-action-bar li .svg-glyph{display:block;color:#0e5d91;margin:12px auto 1px !important}.action-bar.tree-action-bar li .svg-glyph{width:20px;height:20px}.action-bar.tree-action-bar li .glyph{font-size:17px !important;font-size:1.7rem !important}.action-bar.tree-action-bar li .li-inner{display:block;height:65px;padding:2px;font-size:11px;font-size:1.1rem;color:#222}.action-bar.tree-action-bar li:hover{background:#ddd;color:#666}.action-bar .tree-filters{width:160px;position:relative}.action-bar .tree-filters input{padding-right:24px}.action-bar .tree-filters span{position:absolute;right:3px;color:#555;width:22px;top:2px;line-height:20px;display:inline-block;text-align:center;text-shadow:0 0 0 transparent;border-left:1px solid #ddd;cursor:pointer}.action-bar .tree-filters span.icon-close{display:none}.action-bar .tree-filters span:hover{color:#0e5d91}@media (max-width: 1150px){.action-bar.horizontal-action-bar .search-area{float:none;position:absolute;right:0px}.action-bar.horizontal-action-bar .search-area input{padding-right:30px;min-width:auto !important;width:150px}.action-bar.horizontal-action-bar .search-area input:focus{width:220px}}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area{float:none;position:absolute;right:0px}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area input{padding-right:30px;min-width:auto !important;width:150px}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area input:focus{width:220px}.section-container{top:0 !important}.section-container .flex-container-full{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%}.section-container .flex-container-half{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 50%;-webkit-flex:0 0 50%;flex:0 0 50%}.section-container .flex-container-third{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 33.3333333333%;-webkit-flex:0 0 33.3333333333%;flex:0 0 33.3333333333%}.section-container .flex-container-quarter{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 25%;-webkit-flex:0 0 25%;flex:0 0 25%}.section-container .flex-container-remaining{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:1 1 480px;-webkit-flex:1 1 480px;flex:1 1 480px}.section-container .flex-container-main-form{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 500px;-webkit-flex:0 0 500px;flex:0 0 500px;margin:0 20px 20px 0}.section-container .flex-container-navi{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 280px;-webkit-flex:0 0 280px;flex:0 0 280px}.section-container .section-header{border:none}.section-container .content-panel{width:100%;height:100%;margin:0;padding:0;border:none !important;display:box;display:-ms-flexbox;display:-webkit-flexbox;display:flexbox;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;flex-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;flex-line-pack:start;-ms-flex-line-pack:start;-webkit-align-content:flex-start;align-content:flex-start;flex-align:stretch;-ms-flex-align:stretch;-webkit-align-items:stretch;align-items:stretch}.section-container .tab-container{border:none;display:none;list-style-type:none;padding:0;margin:0}.section-container .tab-container li{float:left;position:relative;top:0;padding:0;margin:0 1px 0px 0;border-top:1px solid #f3f1ef !important;border-bottom:1px solid #f3f1ef !important;background:#f3f1ef !important}.section-container .tab-container li a{top:0 !important;margin-bottom:0 !important;padding:6px 16px;text-decoration:none;min-height:32px;color:#222;float:left}.section-container .tab-container li.active,.section-container .tab-container li:hover{border-bottom-color:#4a86ad !important;border-top-color:#6e9ebd !important;background:#266d9c !important}.section-container .tab-container li.active a,.section-container .tab-container li:hover a{background:transparent !important;border-color:transparent !important;color:#fff !important;text-shadow:1px 1px 0 rgba(0,0,0,0.2)}.section-container .tab-container li.disabled:hover{background:#f3f1ef !important}.section-container .tab-container li.disabled:hover a{cursor:not-allowed !important;color:#222 !important}.section-container .navi-container{display:none;background:#f3f1ef;-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 280px;-webkit-flex:0 0 280px;flex:0 0 280px;border-right:1px #ddd solid}.section-container .navi-container .block-title{font-size:14px;font-size:1.4rem;padding:2px 8px;margin:0}.section-container .navi-container .tree-action-bar-box{margin:10px 0;opacity:0}.section-container .navi-container .tree-action-bar-box.active{opacity:1;-webkit-opacity:0.25s ease-in-out;-moz-opacity:0.25s ease-in-out;opacity:0.25s ease-in-out}.section-container .content-container{border:none;-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:1 1 auto;-webkit-flex:1 1 auto;flex:1 1 auto;-ms-flex:1 1;-webkit-flex:1 1;flex:1 1}.section-container .content-block{padding:20px;overflow-y:auto;display:box;display:-ms-flexbox;display:-webkit-flexbox;display:flexbox;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;flex-wrap:wrap;flex-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;flex-line-pack:start;-ms-flex-line-pack:start;-webkit-align-content:flex-start;align-content:flex-start;flex-align:stretch;-ms-flex-align:stretch;-webkit-align-items:stretch;align-items:stretch}.section-container .content-block>.grid-container{width:100%}.section-container .content-block .data-container-wrapper{padding:0px 20px 0 0}.section-container .content-block .data-container-wrapper:before,.section-container .content-block .data-container-wrapper:after{content:" ";display:table}.section-container .content-block .data-container-wrapper:after{clear:both}.section-container .content-block .data-container-wrapper>section,.section-container .content-block .data-container-wrapper .data-container{width:260px;margin:0 20px 20px 0;float:left;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.section-container .content-block .data-container-wrapper>section.double,.section-container .content-block .data-container-wrapper .data-container.double{width:540px}.section-container .content-block .data-container-wrapper>section .emptyContentFooter,.section-container .content-block .data-container-wrapper .data-container .emptyContentFooter{display:none}.section-container .content-block .data-container-wrapper>section .tree,.section-container .content-block .data-container-wrapper .data-container .tree{border:none;max-width:none;max-height:none}.section-container .content-block .data-container-wrapper>section form,.section-container .content-block .data-container-wrapper .data-container form{background:none;border:none;margin:0;padding:0}.section-container .content-block .data-container-wrapper>section>header,.section-container .content-block .data-container-wrapper>section .ui-widget-header,.section-container .content-block .data-container-wrapper .data-container>header,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header{background:#f3f1ef;border-width:0px !important;border-bottom:1px #ddd solid !important}.section-container .content-block .data-container-wrapper>section>header h1,.section-container .content-block .data-container-wrapper>section>header h6,.section-container .content-block .data-container-wrapper>section .ui-widget-header h1,.section-container .content-block .data-container-wrapper>section .ui-widget-header h6,.section-container .content-block .data-container-wrapper .data-container>header h1,.section-container .content-block .data-container-wrapper .data-container>header h6,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header h1,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header h6{padding:4px;margin:0;font-size:14px;font-size:1.4rem}.section-container .content-block .data-container-wrapper>section>div,.section-container .content-block .data-container-wrapper>section .ui-widget-content,.section-container .content-block .data-container-wrapper>section .container-content,.section-container .content-block .data-container-wrapper .data-container>div,.section-container .content-block .data-container-wrapper .data-container .ui-widget-content,.section-container .content-block .data-container-wrapper .data-container .container-content{border-width:0px !important;overflow-y:auto;min-height:250px;padding:5px}.section-container .content-block .data-container-wrapper>section>div .icon-grip,.section-container .content-block .data-container-wrapper>section .ui-widget-content .icon-grip,.section-container .content-block .data-container-wrapper>section .container-content .icon-grip,.section-container .content-block .data-container-wrapper .data-container>div .icon-grip,.section-container .content-block .data-container-wrapper .data-container .ui-widget-content .icon-grip,.section-container .content-block .data-container-wrapper .data-container .container-content .icon-grip{cursor:move}.section-container .content-block .data-container-wrapper>section>footer,.section-container .content-block .data-container-wrapper .data-container>footer{min-height:33px}.section-container .content-block .data-container-wrapper>section>footer,.section-container .content-block .data-container-wrapper>section .data-container-footer,.section-container .content-block .data-container-wrapper .data-container>footer,.section-container .content-block .data-container-wrapper .data-container .data-container-footer{background:#f3f1ef;text-align:right !important;padding:4px;border-width:0px !important;border-top:1px #ddd solid !important}.section-container .content-block .data-container-wrapper>section>footer .square,.section-container .content-block .data-container-wrapper>section .data-container-footer .square,.section-container .content-block .data-container-wrapper .data-container>footer .square,.section-container .content-block .data-container-wrapper .data-container .data-container-footer .square{width:28px}.section-container .content-block .data-container-wrapper>section>footer .square span,.section-container .content-block .data-container-wrapper>section .data-container-footer .square span,.section-container .content-block .data-container-wrapper .data-container>footer .square span,.section-container .content-block .data-container-wrapper .data-container .data-container-footer .square span{padding:0;left:0}.section-container .content-block .data-container-wrapper>section ol,.section-container .content-block .data-container-wrapper .data-container ol{margin:0 0 0 15px;padding:10px}.section-container .content-block #form-container.ui-widget-content{border:none !important}.section-container .content-block form:not(.list-container){border:1px #ddd solid;background:#f3f1ef;padding:30px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.section-container .content-block [class^="btn-"],.section-container .content-block [class*=" btn-"]{margin:0 2px}.previewer,.previewer-component{position:relative}.item-previewer-scope{position:relative;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:calc(100vh - 0px)}.item-previewer-scope .test-runner-sections{-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:hidden;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.item-previewer-scope .test-sidebar{background:#f3f1ef;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;height:calc(100vh - 80px);overflow-y:auto;max-width:350px}.item-previewer-scope .test-sidebar>.qti-panel{max-width:350px;padding:10px}@media only screen and (max-device-width: 800px){.item-previewer-scope .test-sidebar{max-width:200px}.item-previewer-scope .test-sidebar>.qti-panel{max-width:200px}}@media only screen and (min-device-width: 800px) and (max-device-width: 1280px){.item-previewer-scope .test-sidebar{max-width:250px}.item-previewer-scope .test-sidebar>.qti-panel{max-width:250px}}@media only screen and (min-device-width: 1280px) and (max-device-width: 1440px){.item-previewer-scope .test-sidebar{max-width:300px}.item-previewer-scope .test-sidebar>.qti-panel{max-width:300px}}.item-previewer-scope .test-sidebar-left{border-right:1px #ddd solid}.item-previewer-scope .test-sidebar-right{border-left:1px #ddd solid}.item-previewer-scope .content-wrapper{position:relative;-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:auto;padding:0}.item-previewer-scope .content-wrapper .overlay{position:absolute;left:0;right:0;top:0;bottom:0;width:100%;opacity:.9}.item-previewer-scope .content-wrapper .overlay-full{background-color:#fff;opacity:1}.item-previewer-scope #qti-content{max-width:1024px;width:100%;margin:auto}.item-previewer-scope #qti-item{width:100%;min-width:100%;height:auto;overflow:visible}.item-previewer-scope .qti-item{padding:30px}.item-previewer-scope .size-wrapper{max-width:1280px;margin:auto;width:100%}.item-previewer-scope #qti-rubrics{margin:auto;max-width:1024px;width:100%}.item-previewer-scope #qti-rubrics .qti-rubricBlock{margin:20px 0}.item-previewer-scope #qti-rubrics .hidden{display:none}.no-controls .item-previewer-scope{height:100vh}.previewer-component{background:inherit}.previewer-component.fullpage{position:absolute;top:0;left:0;right:0;bottom:0;z-index:100000}.previewer-component.fullpage .item-previewer-scope{height:100vh}.previewer-component.readonly .qti-item::before{content:\' \';position:absolute;top:0;left:0;right:0;bottom:0;z-index:100000}.item-previewer-scope .preview-console-closer{position:absolute;right:10px;top:10px;cursor:pointer;color:rgba(255,255,255,0.9);text-shadow:none}.item-previewer-scope .preview-console-closer:hover{color:white}.item-previewer-scope .preview-console{background:#2b2b2b;color:#fff;font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;position:relative}.item-previewer-scope .preview-console .preview-console-body{padding:5px;margin:0;height:30vh;overflow:auto}.item-previewer-scope .preview-console .preview-console-body .log-time{color:#999}.item-previewer-scope .preview-console .preview-console-body .log-type{color:#eee}.item-previewer-scope .preview-console .preview-console-body .log-message{color:#69f}.item-previewer-scope .preview-console .preview-console-body pre{margin:0}.item-previewer-scope .action-bar.content-action-bar{padding:2px}.item-previewer-scope .action-bar.content-action-bar li{margin:2px 0 0 10px;border:none}.item-previewer-scope .action-bar.content-action-bar li.btn-info{padding-top:6px;height:33px;margin-top:0;border-bottom:solid 2px transparent;border-radius:0}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group{border:none !important;overflow:hidden;padding:0}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a{float:left;margin:0 2px;padding:0 15px;border:1px solid rgba(255,255,255,0.3);border-radius:0px;display:inline-block;height:inherit}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a:first-of-type{border-top-left-radius:3px;border-bottom-left-radius:3px;margin-left:0}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a:last-of-type{border-top-right-radius:3px;border-bottom-right-radius:3px;margin-right:0}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a:hover,.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a.active{border-color:rgba(255,255,255,0.8)}.item-previewer-scope .action-bar.content-action-bar li.btn-info.btn-group a .no-label{padding-right:0}.item-previewer-scope .action-bar.content-action-bar li.btn-info:hover,.item-previewer-scope .action-bar.content-action-bar li.btn-info.active{border-bottom-color:rgba(255,255,255,0.8)}.item-previewer-scope .action-bar.content-action-bar li.btn-info:active,.item-previewer-scope .action-bar.content-action-bar li.btn-info.active{background:#e7eff4;border-color:rgba(255,255,255,0.8)}.item-previewer-scope .action-bar.content-action-bar li.btn-info:active a,.item-previewer-scope .action-bar.content-action-bar li.btn-info.active a{color:#266d9c;text-shadow:none}.item-previewer-scope .action-bar.content-action-bar li.btn-info:active:hover,.item-previewer-scope .action-bar.content-action-bar li.btn-info.active:hover{background:#fff}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar{opacity:1;height:40px}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box{height:40px;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:space-between;-ms-flex-pack:space-between;justify-content:space-between;padding-left:10px;padding-right:10px}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box{color:rgba(255,255,255,0.9);text-shadow:1px 1px 0 black}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt{padding-left:20px}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:first-child,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:first-child{padding-left:0}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:last-child ul,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:last-child ul{display:inline-block}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class^="btn-"],.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class*=" btn-"]{white-space:nowrap}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box{position:relative;overflow:visible}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .action{position:relative;overflow:visible}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu{color:#222;background:#f3f1ef;border:1px solid #aaa9a7;overflow:auto;list-style:none;min-width:150px;margin:0;padding:0;position:absolute;bottom:36px;left:-3px}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action{display:inline-block;text-align:left;width:100%;white-space:nowrap;overflow:hidden;color:#222;border-bottom:1px solid #c2c1bf;margin:0;-moz-border-radius:0px;-webkit-border-radius:0px;border-radius:0px;height:32px;padding:6px 15px;line-height:1;border-left:solid 3px transparent}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon-checkbox-checked{display:none}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active{background-color:#dbd9d7;font-weight:bold}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox{display:none}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox-checked,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox-checked,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox-checked{display:inline-block}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover{background-color:#0e5d91;color:#fff;border-left-color:#313030 !important}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .label,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .label,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#fff}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#e7eff4}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .label,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon{font-size:14px;font-size:1.4rem;text-shadow:none;color:#222}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar{overflow:visible;position:relative}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .action{line-height:1.6}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .icon.no-label{padding-right:0}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .text,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .text,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .text,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .text,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .text{display:none}.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .icon,.item-previewer-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .icon{padding:0}\n\n/*# sourceMappingURL=item.css.map */.mediaplayer{position:relative;border:1px solid #333;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;background:#000}.mediaplayer .icon-sound:before{content:"\\e6af"}.mediaplayer .icon-mute:before{content:"\\e69e"}.mediaplayer .error{display:none}.mediaplayer .player{position:relative}.mediaplayer .player iframe{pointer-events:none}.mediaplayer .player .overlay{position:absolute;z-index:1;top:0;left:0;bottom:0;right:0;opacity:1;background:transparent none}.mediaplayer .player .action{position:absolute;z-index:2;top:50%;left:50%;width:64px;height:64px;margin-top:-32px;margin-left:-32px;text-align:center;text-decoration:none;display:none;font-size:64px;font-size:6.4rem;color:#fff}.mediaplayer .player .action .icon{-moz-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;padding:6px 12px;background-color:#000;opacity:0.2}.mediaplayer .player .action .icon:hover{opacity:0.6}.mediaplayer .controls{visibility:hidden;position:relative;padding:5px;display:table;table-layout:fixed;width:100%;border-top:1px solid #333}.mediaplayer .controls .bar{display:table-row}.mediaplayer .controls .control{display:table-cell}.mediaplayer .controls .actions{position:relative;-webkit-transition:all, .1, ease-in-out, 0s;-moz-transition:all, .1, ease-in-out, 0s;-ms-transition:all, .1, ease-in-out, 0s;-o-transition:all, .1, ease-in-out, 0s;transition:all, .1, ease-in-out, 0s}.mediaplayer .controls .actions .action{text-align:center;line-height:2.2rem;width:2.2rem;height:2.2rem;text-decoration:none;color:#dcdcdc;-webkit-transition:all, .2, ease-in-out, 0s;-moz-transition:all, .2, ease-in-out, 0s;-ms-transition:all, .2, ease-in-out, 0s;-o-transition:all, .2, ease-in-out, 0s;transition:all, .2, ease-in-out, 0s}.mediaplayer .controls .actions .action:hover{opacity:1}.mediaplayer .controls .actions .action .icon{line-height:2.2rem}.mediaplayer .controls .actions .play{opacity:0.7;border-right:1px solid #333}.mediaplayer .controls .actions .mute{opacity:0.8;border-left:1px solid #333}.mediaplayer .controls .slider{cursor:pointer;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;-webkit-transition:all, .1, ease-in-out, 0s;-moz-transition:all, .1, ease-in-out, 0s;-ms-transition:all, .1, ease-in-out, 0s;-o-transition:all, .1, ease-in-out, 0s;transition:all, .1, ease-in-out, 0s;background:#fff}.mediaplayer .controls .slider .noUi-background{-moz-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;background:#fff}.mediaplayer .controls .slider.noUi-connect,.mediaplayer .controls .slider .noUi-connect{-moz-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;background:#333}.mediaplayer .controls .slider .noUi-handle{width:11px;height:11px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;background:#858585}.mediaplayer .controls .slider .noUi-handle:hover{background:#5c5c5c}.mediaplayer .controls .slider .noUi-handle:after{display:none}.mediaplayer .controls .slider.noUi-horizontal{height:9px}.mediaplayer .controls .slider.noUi-horizontal .noUi-handle{top:-2px}.mediaplayer .controls .slider.noUi-vertical{width:9px}.mediaplayer .controls .slider.noUi-vertical .noUi-handle{left:-2px}.mediaplayer .controls .infos{cursor:default;margin:0 1rem;line-height:2.2rem;color:#999;font-size:10px;font-size:1rem;font-weight:bold}.mediaplayer .controls .infos [data-control="time-end"]:before{content:\' / \'}.mediaplayer .controls .timer{width:8rem;text-align:center}.mediaplayer .controls .seek{position:relative;height:1rem;margin-top:5px;padding-left:1rem}.mediaplayer .controls .playback{margin-right:1rem;width:2.2rem}.mediaplayer .controls .sound{width:2.2rem;height:2.2rem}.mediaplayer .controls .sound .volume{cursor:default;position:absolute;z-index:3;background-color:#000;padding:0 10px 0 10px;height:0;top:0;left:-1px;opacity:0;border:solid 1px #333;-webkit-transition:height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms;-moz-transition:height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms;-ms-transition:height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms;-o-transition:height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms;transition:height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms}.mediaplayer .controls .sound .volume.up,.mediaplayer .controls .sound .volume.down{height:120px;padding:10px 10px 5px 10px;opacity:1}.mediaplayer .controls .sound .volume.up .slider,.mediaplayer .controls .sound .volume.down .slider{opacity:1;transition:opacity 50ms linear 200ms;-webkit-transition:opacity 50ms linear 200ms;-moz-transition:opacity 50ms linear 200ms;-ms-transition:opacity 50ms linear 200ms;-o-transition:opacity 50ms linear 200ms;transition:opacity 50ms linear 200ms}.mediaplayer .controls .sound .volume.up{top:-125px;-webkit-transition:height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear;-moz-transition:height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear;-ms-transition:height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear;-o-transition:height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear;transition:height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear}.mediaplayer .controls .sound .volume.down{top:29px;-webkit-transition:height 300ms ease-out 50ms, opacity 50ms linear;-moz-transition:height 300ms ease-out 50ms, opacity 50ms linear;-ms-transition:height 300ms ease-out 50ms, opacity 50ms linear;-o-transition:height 300ms ease-out 50ms, opacity 50ms linear;transition:height 300ms ease-out 50ms, opacity 50ms linear}.mediaplayer .controls .sound .slider{opacity:0}.mediaplayer .controls .sound .slider .noUi-handle{cursor:pointer;width:9px;height:9px}.mediaplayer .controls .sound .slider.noUi-horizontal{width:50px;height:7px}.mediaplayer .controls .sound .slider.noUi-vertical{width:7px;height:100px}.mediaplayer .controls [data-control="play"]{display:none}.mediaplayer .controls [data-control="pause"]{display:none}.mediaplayer .controls [data-control="mute"]{display:inline-block}.mediaplayer .controls [data-control="unmute"]{display:none}.mediaplayer.video .sound .volume,.mediaplayer.youtube .sound .volume{width:2.2rem;bottom:2.2rem;right:0}.mediaplayer.audio .sound .volume{height:2.2rem;right:2.2rem;bottom:0}.mediaplayer.ready .controls{visibility:visible}.mediaplayer.ready.paused.canplay .overlay{cursor:pointer}.mediaplayer.ready.paused.canplay .player:hover [data-control="play"]{display:inline-block}.mediaplayer.ready.paused.canplay.youtube.ended .player:hover [data-control="play"]{display:none}.mediaplayer.ready.playing.canpause .overlay{cursor:pointer}.mediaplayer.ready.playing.canpause .player:hover [data-control="pause"]{display:inline-block}.mediaplayer.playing.canpause .controls [data-control="pause"]{display:inline-block}.mediaplayer.paused.canplay .controls [data-control="play"]{display:inline-block}.mediaplayer.paused.canplay .controls [data-control="pause"]{display:none}.mediaplayer.muted .controls [data-control="mute"]{display:none}.mediaplayer.muted .controls [data-control="unmute"]{display:inline-block}.mediaplayer.nogui .player iframe{pointer-events:inherit}.mediaplayer.nogui .overlay{display:none !important}.mediaplayer.nogui .controls{display:none !important}.mediaplayer.error .media,.mediaplayer.error .controls{display:none}.mediaplayer.error .error{display:table;text-align:center;width:100%;height:100%}.mediaplayer.error .error .message{color:#ba122b;display:table-cell;vertical-align:middle}.mediaplayer.loading::before{content:\'\';box-sizing:border-box;position:absolute;top:50%;left:50%;width:30px;height:30px;margin-top:-15px;margin-left:-15px;border-radius:50%;border:1px solid #ccc;border-top-color:#07d;animation:spinner .6s linear infinite}@keyframes spinner{to{transform:rotate(360deg)}}\n\n/*# sourceMappingURL=player.css.map */');
//# sourceMappingURL=qtiPreviewer.min.js.map